function setMaxDigits(e){maxDigits=e;ZERO_ARRAY=new Array(maxDigits);for(var t=0;t<ZERO_ARRAY.length;t++)ZERO_ARRAY[t]=0;bigZero=new BigInt;bigOne=new BigInt;bigOne.digits[0]=1}function BigInt(e){if(typeof e=="boolean"&&e==true){this.digits=null}else{this.digits=ZERO_ARRAY.slice(0)}this.isNeg=false}function biFromDecimal(e){var t=e.charAt(0)=="-";var n=t?1:0;var r;while(n<e.length&&e.charAt(n)=="0")++n;if(n==e.length){r=new BigInt}else{var i=e.length-n;var s=i%dpl10;if(s==0)s=dpl10;r=biFromNumber(Number(e.substr(n,s)));n+=s;while(n<e.length){r=biAdd(biMultiply(r,lr10),biFromNumber(Number(e.substr(n,dpl10))));n+=dpl10}r.isNeg=t}return r}function biCopy(e){var t=new BigInt(true);t.digits=e.digits.slice(0);t.isNeg=e.isNeg;return t}function biFromNumber(e){var t=new BigInt;t.isNeg=e<0;e=Math.abs(e);var n=0;while(e>0){t.digits[n++]=e&maxDigitVal;e>>=biRadixBits}return t}function reverseStr(e){var t="";for(var n=e.length-1;n>-1;--n){t+=e.charAt(n)}return t}function biToString(e,t){var n=new BigInt;n.digits[0]=t;var r=biDivideModulo(e,n);var i=hexatrigesimalToChar[r[1].digits[0]];while(biCompare(r[0],bigZero)==1){r=biDivideModulo(r[0],n);digit=r[1].digits[0];i+=hexatrigesimalToChar[r[1].digits[0]]}return(e.isNeg?"-":"")+reverseStr(i)}function biToDecimal(e){var t=new BigInt;t.digits[0]=10;var n=biDivideModulo(e,t);var r=String(n[1].digits[0]);while(biCompare(n[0],bigZero)==1){n=biDivideModulo(n[0],t);r+=String(n[1].digits[0])}return(e.isNeg?"-":"")+reverseStr(r)}function digitToHex(e){var t=15;var n="";for(i=0;i<4;++i){n+=hexToChar[e&t];e>>>=4}return reverseStr(n)}function biToHex(e){var t="";var n=biHighIndex(e);for(var r=biHighIndex(e);r>-1;--r){t+=digitToHex(e.digits[r])}return t}function charToHex(e){var t=48;var n=t+9;var r=97;var i=r+25;var s=65;var o=65+25;var u;if(e>=t&&e<=n){u=e-t}else if(e>=s&&e<=o){u=10+e-s}else if(e>=r&&e<=i){u=10+e-r}else{u=0}return u}function hexToDigit(e){var t=0;var n=Math.min(e.length,4);for(var r=0;r<n;++r){t<<=4;t|=charToHex(e.charCodeAt(r))}return t}function biFromHex(e){var t=new BigInt;var n=e.length;for(var r=n,i=0;r>0;r-=4,++i){t.digits[i]=hexToDigit(e.substr(Math.max(r-4,0),Math.min(r,4)))}return t}function biFromString(e,t){var n=e.charAt(0)=="-";var r=n?1:0;var i=new BigInt;var s=new BigInt;s.digits[0]=1;for(var o=e.length-1;o>=r;o--){var u=e.charCodeAt(o);var a=charToHex(u);var f=biMultiplyDigit(s,a);i=biAdd(i,f);s=biMultiplyDigit(s,t)}i.isNeg=n;return i}function biDump(e){return(e.isNeg?"-":"")+e.digits.join(" ")}function biAdd(e,t){var n;if(e.isNeg!=t.isNeg){t.isNeg=!t.isNeg;n=biSubtract(e,t);t.isNeg=!t.isNeg}else{n=new BigInt;var r=0;var i;for(var s=0;s<e.digits.length;++s){i=e.digits[s]+t.digits[s]+r;n.digits[s]=i&65535;r=Number(i>=biRadix)}n.isNeg=e.isNeg}return n}function biSubtract(e,t){var n;if(e.isNeg!=t.isNeg){t.isNeg=!t.isNeg;n=biAdd(e,t);t.isNeg=!t.isNeg}else{n=new BigInt;var r,i;i=0;for(var s=0;s<e.digits.length;++s){r=e.digits[s]-t.digits[s]+i;n.digits[s]=r&65535;if(n.digits[s]<0)n.digits[s]+=biRadix;i=0-Number(r<0)}if(i==-1){i=0;for(var s=0;s<e.digits.length;++s){r=0-n.digits[s]+i;n.digits[s]=r&65535;if(n.digits[s]<0)n.digits[s]+=biRadix;i=0-Number(r<0)}n.isNeg=!e.isNeg}else{n.isNeg=e.isNeg}}return n}function biHighIndex(e){var t=e.digits.length-1;while(t>0&&e.digits[t]==0)--t;return t}function biNumBits(e){var t=biHighIndex(e);var n=e.digits[t];var r=(t+1)*bitsPerDigit;var i;for(i=r;i>r-bitsPerDigit;--i){if((n&32768)!=0)break;n<<=1}return i}function biMultiply(e,t){var n=new BigInt;var r;var i=biHighIndex(e);var s=biHighIndex(t);var o,u,a;for(var f=0;f<=s;++f){r=0;a=f;for(j=0;j<=i;++j,++a){u=n.digits[a]+e.digits[j]*t.digits[f]+r;n.digits[a]=u&maxDigitVal;r=u>>>biRadixBits}n.digits[f+i+1]=r}n.isNeg=e.isNeg!=t.isNeg;return n}function biMultiplyDigit(e,t){var n,r,i;result=new BigInt;n=biHighIndex(e);r=0;for(var s=0;s<=n;++s){i=result.digits[s]+e.digits[s]*t+r;result.digits[s]=i&maxDigitVal;r=i>>>biRadixBits}result.digits[1+n]=r;return result}function arrayCopy(e,t,n,r,i){var s=Math.min(t+i,e.length);for(var o=t,u=r;o<s;++o,++u){n[u]=e[o]}}function biShiftLeft(e,t){var n=Math.floor(t/bitsPerDigit);var r=new BigInt;arrayCopy(e.digits,0,r.digits,n,r.digits.length-n);var i=t%bitsPerDigit;var s=bitsPerDigit-i;for(var o=r.digits.length-1,u=o-1;o>0;--o,--u){r.digits[o]=r.digits[o]<<i&maxDigitVal|(r.digits[u]&highBitMasks[i])>>>s}r.digits[0]=r.digits[o]<<i&maxDigitVal;r.isNeg=e.isNeg;return r}function biShiftRight(e,t){var n=Math.floor(t/bitsPerDigit);var r=new BigInt;arrayCopy(e.digits,n,r.digits,0,e.digits.length-n);var i=t%bitsPerDigit;var s=bitsPerDigit-i;for(var o=0,u=o+1;o<r.digits.length-1;++o,++u){r.digits[o]=r.digits[o]>>>i|(r.digits[u]&lowBitMasks[i])<<s}r.digits[r.digits.length-1]>>>=i;r.isNeg=e.isNeg;return r}function biMultiplyByRadixPower(e,t){var n=new BigInt;arrayCopy(e.digits,0,n.digits,t,n.digits.length-t);return n}function biDivideByRadixPower(e,t){var n=new BigInt;arrayCopy(e.digits,t,n.digits,0,n.digits.length-t);return n}function biModuloByRadixPower(e,t){var n=new BigInt;arrayCopy(e.digits,0,n.digits,0,t);return n}function biCompare(e,t){if(e.isNeg!=t.isNeg){return 1-2*Number(e.isNeg)}for(var n=e.digits.length-1;n>=0;--n){if(e.digits[n]!=t.digits[n]){if(e.isNeg){return 1-2*Number(e.digits[n]>t.digits[n])}else{return 1-2*Number(e.digits[n]<t.digits[n])}}}return 0}function biDivideModulo(e,t){var n=biNumBits(e);var r=biNumBits(t);var i=t.isNeg;var s,o;if(n<r){if(e.isNeg){s=biCopy(bigOne);s.isNeg=!t.isNeg;e.isNeg=false;t.isNeg=false;o=biSubtract(t,e);e.isNeg=true;t.isNeg=i}else{s=new BigInt;o=biCopy(e)}return new Array(s,o)}s=new BigInt;o=e;var u=Math.ceil(r/bitsPerDigit)-1;var a=0;while(t.digits[u]<biHalfRadix){t=biShiftLeft(t,1);++a;++r;u=Math.ceil(r/bitsPerDigit)-1}o=biShiftLeft(o,a);n+=a;var f=Math.ceil(n/bitsPerDigit)-1;var l=biMultiplyByRadixPower(t,f-u);while(biCompare(o,l)!=-1){++s.digits[f-u];o=biSubtract(o,l)}for(var c=f;c>u;--c){var h=c>=o.digits.length?0:o.digits[c];var p=c-1>=o.digits.length?0:o.digits[c-1];var d=c-2>=o.digits.length?0:o.digits[c-2];var v=u>=t.digits.length?0:t.digits[u];var m=u-1>=t.digits.length?0:t.digits[u-1];if(h==v){s.digits[c-u-1]=maxDigitVal}else{s.digits[c-u-1]=Math.floor((h*biRadix+p)/v)}var g=s.digits[c-u-1]*(v*biRadix+m);var y=h*biRadixSquared+(p*biRadix+d);while(g>y){--s.digits[c-u-1];g=s.digits[c-u-1]*(v*biRadix|m);y=h*biRadix*biRadix+(p*biRadix+d)}l=biMultiplyByRadixPower(t,c-u-1);o=biSubtract(o,biMultiplyDigit(l,s.digits[c-u-1]));if(o.isNeg){o=biAdd(o,l);--s.digits[c-u-1]}}o=biShiftRight(o,a);s.isNeg=e.isNeg!=i;if(e.isNeg){if(i){s=biAdd(s,bigOne)}else{s=biSubtract(s,bigOne)}t=biShiftRight(t,a);o=biSubtract(t,o)}if(o.digits[0]==0&&biHighIndex(o)==0)o.isNeg=false;return new Array(s,o)}function biDivide(e,t){return biDivideModulo(e,t)[0]}function biModulo(e,t){return biDivideModulo(e,t)[1]}function biMultiplyMod(e,t,n){return biModulo(biMultiply(e,t),n)}function biPow(e,t){var n=bigOne;var r=e;while(true){if((t&1)!=0)n=biMultiply(n,r);t>>=1;if(t==0)break;r=biMultiply(r,r)}return n}function biPowMod(e,t,n){var r=bigOne;var i=e;var s=t;while(true){if((s.digits[0]&1)!=0)r=biMultiplyMod(r,i,n);s=biShiftRight(s,1);if(s.digits[0]==0&&biHighIndex(s)==0)break;i=biMultiplyMod(i,i,n)}return r}function RSAKeyPair(e,t,n){if(e)this.e=biFromHex(e);if(t)this.d=biFromHex(t);this.m=biFromHex(n);this.chunkSize=2*biHighIndex(this.m);this.radix=16;this.barrett=new BarrettMu(this.m)}function twoDigit(e){return(e<10?"0":"")+String(e)}function encryptedString(e,t){var n=new Array;var r=t.length;var i=0;while(i<r){n[i]=t.charCodeAt(i);i++}while(n.length%e.chunkSize!=0){n[i++]=0}var s=n.length;var o="";var u,a,f;for(i=0;i<s;i+=e.chunkSize){f=new BigInt;u=0;for(a=i;a<i+e.chunkSize;++u){f.digits[u]=n[a++];f.digits[u]+=n[a++]<<8}var l=e.barrett.powMod(f,e.e);var c=e.radix==16?biToHex(l):biToString(l,e.radix);o+=c+" "}return o.substring(0,o.length-1)}function decryptedString(e,t){var n=t.split(" ");var r="";var i,s,o;for(i=0;i<n.length;++i){var u;if(e.radix==16){u=biFromHex(n[i])}else{u=biFromString(n[i],e.radix)}o=e.barrett.powMod(u,e.d);for(s=0;s<=biHighIndex(o);++s){r+=String.fromCharCode(o.digits[s]&255,o.digits[s]>>8)}}if(r.charCodeAt(r.length-1)==0){r=r.substring(0,r.length-1)}return r}function BarrettMu(e){this.modulus=biCopy(e);this.k=biHighIndex(this.modulus)+1;var t=new BigInt;t.digits[2*this.k]=1;this.mu=biDivide(t,this.modulus);this.bkplus1=new BigInt;this.bkplus1.digits[this.k+1]=1;this.modulo=BarrettMu_modulo;this.multiplyMod=BarrettMu_multiplyMod;this.powMod=BarrettMu_powMod}function BarrettMu_modulo(e){var t=biDivideByRadixPower(e,this.k-1);var n=biMultiply(t,this.mu);var r=biDivideByRadixPower(n,this.k+1);var i=biModuloByRadixPower(e,this.k+1);var s=biMultiply(r,this.modulus);var o=biModuloByRadixPower(s,this.k+1);var u=biSubtract(i,o);if(u.isNeg){u=biAdd(u,this.bkplus1)}var a=biCompare(u,this.modulus)>=0;while(a){u=biSubtract(u,this.modulus);a=biCompare(u,this.modulus)>=0}return u}function BarrettMu_multiplyMod(e,t){var n=biMultiply(e,t);return this.modulo(n)}function BarrettMu_powMod(e,t){var n=new BigInt;n.digits[0]=1;var r=e;var i=t;while(true){if((i.digits[0]&1)!=0)n=this.multiplyMod(n,r);i=biShiftRight(i,1);if(i.digits[0]==0&&biHighIndex(i)==0)break;r=this.multiplyMod(r,r)}return n}function showWindow(e,t){if(windowStack.length==0){$(".fadeBlack").fadeIn(200,t)}if(windowStack.length>0){$(windowStack[windowStack.length-1]).fadeOut(200)}$(e).slideDown(200,t);windowStack.push(e);windowsOpened++;console.log(windowStack)}function hideWindow(e,t){if(windowsOpened>0){windowsOpened--}if(windowStack.length>0){$(windowStack[windowStack.length-1]).fadeOut(200)}if(e==undefined){e=1}if(windowStack.length==1){windowStack.pop()}else if(e>0){windowStack.splice(windowStack.length-e,windowStack.length)}if(windowStack.length>0){$(windowStack[windowStack.length-1]).slideDown(200,t)}if(windowStack.length==0){$(".fadeBlack").fadeOut(200,t)}console.log(windowStack)}var bbq=bbq||{};bbq.buildings=bbq.buildings||{};bbq.buildings.configuration={Hut:{vision:0,turnsTilCap:2,foodProduced:10,defaultImagePath:"assets/Buildings/hut_$(team).png",commands:["Train"]},Farm:{vision:0,turnsTilCap:2,foodProduced:20,defaultImagePath:"assets/Buildings/farm_$(team).png"},HQ:{vision:0,turnsTilCap:4,foodProduced:10,defaultImagePath:"assets/Buildings/hq_$(team).png"}};ns("bbq.sounds.config");bbq.sounds.config.effects={list:["buttonClick.mp3","unitDeath.mp3","unitHit.mp3","unitSelect.mp3","unitWalk.mp3","weaponHit.mp3","weaponWindup.mp3"],default_:"assets/sounds/effects/default/",SpearWarrior:"assets/sounds/effects/SpearWarrior/",DartBlower:"assets/sounds/effects/DartBlower/",Enforcer:"assets/sounds/effects/Enforcer/",Harvester:"assets/sounds/effects/Harvester/",Catapult:"assets/sounds/effects/Catapult/"};bbq.sounds.config.ambience={list:["01.mp3","02.mp3","03.mp3","04.mp3","05.mp3"],default_:"assets/sounds/ambience/default/",Forest:"assets/sounds/ambience/forest/"};bbq.sounds.config.music={list:["01.mp3","02.mp3","03.mp3","04.mp3","05.mp3"],default_:"assets/sounds/music/default/",Forest:"assets/sounds/music/forest/"};ns("bbq.tilesets.forest");bbq.tilesets.forest.imagePath="assets/graphics/forestTiles.png";bbq.tilesets.forest.grass={offsets:{base0:{x:0,y:0,width:50,height:50},base1:{x:800,y:0,width:50,height:50},base2:{x:850,y:0,width:50,height:50},nw:{x:0,y:50,width:50,height:50},n:{x:100,y:0,width:50,height:50},ne:{x:50,y:50,width:50,height:50},w:{x:50,y:0,width:50,height:50},e:{x:200,y:0,width:50,height:50},sw:{x:350,y:50,width:50,height:50},s:{x:400,y:0,width:50,height:50},se:{x:150,y:50,width:50,height:50}},properties:{moveCost:function(e){return 100},visionCost:function(e){return 100},attackCost:function(e){return 100},zIndex:3}};bbq.tilesets.forest.dirt={offsets:{base:{x:0,y:150,width:50,height:50},nw:{x:0,y:200,width:50,height:50},n:{x:100,y:150,width:50,height:50},ne:{x:50,y:200,width:50,height:50},w:{x:50,y:150,width:50,height:50},e:{x:200,y:150,width:50,height:50},sw:{x:350,y:200,width:50,height:50},s:{x:400,y:150,width:50,height:50},se:{x:150,y:200,width:50,height:50}},properties:{moveCost:function(e){var t=$em(e.entity).comp("Movement");if(t&&t.bonus){return t.bonus("dirt")}return 100},visionCost:function(e){return 100},attackCost:function(e){return 100},zIndex:2}};bbq.tilesets.forest.water={offsets:{base0:{x:0,y:300,width:50,height:50},base1:{x:50,y:300,width:50,height:50},base2:{x:100,y:300,width:50,height:50},base3:{x:150,y:300,width:50,height:50},base4:{x:200,y:300,width:50,height:50},base5:{x:250,y:300,width:50,height:50},base6:{x:300,y:300,width:50,height:50},base7:{x:350,y:300,width:50,height:50},base8:{x:400,y:300,width:50,height:50},base9:{x:450,y:300,width:50,height:50}},properties:{moveCost:function(e){var t=100;if(e.em.getComponentForEntity(e.rangeComponentName,e.entity)){var n=e.maxRange-e.currentCost;if(n>100){t=n}}return t},visionCost:function(e){return 100},attackCost:function(e){return 100},zIndex:1}};bbq.tilesets.forest.props={offsets:{rock:{x:0,y:450,width:50,height:50},highgrass:{x:50,y:450,width:50,height:50},tree:{x:100,y:450,width:50,height:50},berries:{x:150,y:450,width:50,height:50}},properties:{rock:{moveCost:function(e){return 99999}},highgrass:{visionCost:function(e){var t=e.em.getComponentForEntity(e.rangeComponentName,e.entity);if(t){var n=0;return t.range+n-1}return 0}},tree:{visionBonus:1},berries:{foodPerTurn:10}}};bbq.tilesets.forest.edges={offsets:{nw:{x:750,y:250,width:100,height:100},n:{x:850,y:250,width:50,height:100},ne:{x:900,y:250,width:100,height:100},w:{x:750,y:350,width:100,height:50},e:{x:900,y:350,width:100,height:50},sw:{x:750,y:400,width:100,height:100},s:{x:850,y:400,width:50,height:100},se:{x:900,y:400,width:100,height:100}}};ns("bbq.units.configuration");bbq.units.configuration.baseLoadout=["SpearWarrior","DartBlower","Scout","Harvester","Enforcer","Catapult"];bbq.units.configuration.unlockableUnits=["Brute","Oracle","WitchDoctor"];bbq.units.configuration.SpearWarrior={foodCost:30,health:10,moveRange:4,visionRange:2,attackMinRange:1,attackMaxRange:1,attackDamage:4,moveSpeed:250,moveBonus:{dirt:1},displayName:"Spear Warrior",spinePath:"assets/graphics/spine/spearwarrior/spearwarrior",description:"The backbone of your tribe. Cheap and efficient.",commands:["Attack","Move","Hold"],levelUp:{maxLevels:3,level2:{requiredKills:3,moveRange:0,visionRange:0,attackRange:0,attackDamage:1,health:1},level3:{requiredKills:6,attackDamage:1,health:1}}};bbq.units.configuration.DartBlower={foodCost:35,health:10,moveRange:3,visionRange:3,attackMinRange:2,attackMaxRange:4,attackDamage:4,moveSpeed:200,moveBonus:{dirt:1},displayName:"Axe Thrower",commands:["Attack","Move","Hold"],spinePath:"assets/graphics/spine/dartblower/dartblower",description:"Can attack from a short distance. Be careful of enemies getting too close!",levelUp:{maxLevels:3,level2:{requiredKills:3,attackDamage:1,moveRange:1},level3:{requiredKills:6,attackDamage:1,attackMaxRange:1}}};bbq.units.configuration.Enforcer={foodCost:60,health:16,moveRange:3,visionRange:3,attackMinRange:1,attackMaxRange:1,attackDamage:3,moveSpeed:350,moveBonus:{dirt:1},displayName:"Enforcer",commands:["Attack","Move","Hold"],spinePath:"assets/graphics/spine/enforcer/enforcer",description:"Slow but durable. Good for charging into the enemy base!",levelUp:{maxLevels:3,level2:{requiredKills:3,health:2,attackDamage:2,moveRange:1},level3:{requiredKills:5,health:3,attackDamage:1,moveRange:1}}};bbq.units.configuration.Harvester={foodCost:25,health:8,moveRange:4,visionRange:2,attackMinRange:1,attackMaxRange:1,attackDamage:1,moveSpeed:175,moveBonus:{dirt:1},displayName:"Harvester",commands:["Attack","Move","Hold","Gather","Capture"],spinePath:"assets/graphics/spine/harvester/harvester",description:"The only unit that can capture buildings and harvest berries! She's peaceful and doesn't do well in battle.",levelUp:{maxLevels:3,level2:{requiredKills:2,health:1,moveRange:1,attackDamage:1},level3:{requiredKills:4,health:2,moveRange:2,attackDamage:1}}};bbq.units.configuration.Scout={foodCost:50,health:12,moveRange:6,visionRange:5,attackMinRange:1,attackMaxRange:1,attackDamage:4,moveSpeed:125,moveBonus:{dirt:1},displayName:"Scout",commands:["Attack","Move","Hold"],spinePath:"assets/graphics/spine/scout/scout",description:"Need to see peek into enemy territory? Send him in! He does a good amount of damage too!",levelUp:{maxLevels:3,level2:{requiredKills:3,attackDamage:1,moveRange:1},level3:{requiredKills:5,visionRange:1,moveRange:1}}};bbq.units.configuration.Catapult={foodCost:100,health:6,moveRange:2,visionRange:2,attackMinRange:3,attackMaxRange:8,attackDamage:7,moveSpeed:400,moveBonus:{dirt:2},displayName:"Catapult",commands:["Attack","Move","Hold"],spinePath:"assets/graphics/spine/catapult/catapult",description:"Expensive but packs a punch from a really long distance! However, this unit is too heavy to travel long distances.",levelUp:{maxLevels:3,level2:{requiredKills:3,attackDamage:1},level3:{requiredKills:6,attackRange:1}}};bbq.units.configuration.AxeThrower={foodCost:40,health:12,moveRange:4,visionRange:4,attackMinRange:1,attackMaxRange:3,attackDamage:3,moveSpeed:200,moveBonus:{dirt:1},displayName:"Axe Thrower",spinePath:"assets/graphics/spine/axethrower/axethrower",commands:["Attack","Move","Hold"],unlock:{price:100,currency:"BattleBadge"},description:"The Axe Thrower can throw an axe from a distance with great and deadly force.",levelUp:{maxLevels:3,level2:{requiredKills:3,attackDamage:1},level3:{requiredKills:6,attackRange:1}}};bbq.units.configuration.Brute={foodCost:100,health:12,moveRange:4,visionRange:2,attackMinRange:1,attackMaxRange:1,attackDamage:10,moveSpeed:200,moveBonus:{dirt:1},displayName:"Brute",commands:["Attack","Move","Hold"],spinePath:"assets/graphics/spine/brute/brute",unlock:{price:120,currency:"BattleBadge"},description:"A force to be reckoned with! Although he requires a lot of food, he is strong and durable enough to be worth it.",levelUp:{maxLevels:3,level2:{requiredKills:3,attackDamage:1},level3:{requiredKills:6,moveRange:1,attackDamage:2}}};bbq.units.configuration.Oracle={foodCost:40,health:8,moveRange:3,visionRange:2,attackMinRange:1,attackMaxRange:2,attackDamage:1,moveSpeed:200,moveBonus:{dirt:1},revealRange:8,revealRadius:2,displayName:"Oracle",spinePath:"assets/graphics/spine/oracle/oracle",commands:["Attack","Move","Hold","Reveal"],unlock:{price:150,currency:"BattleBadge"},description:"The Oracle can reveal a portion of the map from afar. Even units hidden in tall grass can be seen!",levelUp:{maxLevels:3,level2:{requiredKills:3,attackDamage:1,revealRange:1,revealRadius:1},level3:{requiredKills:6,attackRange:1,revealRange:1,revealRadius:1}}};bbq.units.configuration.WitchDoctor={foodCost:40,health:8,moveRange:4,visionRange:3,attackMinRange:1,attackMaxRange:1,attackDamage:1,moveSpeed:200,moveBonus:{dirt:1},healPoints:3,displayName:"Witch Doctor",spinePath:"assets/graphics/spine/witchdoctor/witchdoctor",description:"When units are weak, the Witch Doctor can bring them back to health! Don't expect to do any damage with this unit though.",unlock:{price:200,currency:"BattleBadge"},commands:["Attack","Move","Hold","Heal"],levelUp:{maxLevels:3,level2:{requiredKills:3,attackDamage:1,healPoints:1},level3:{requiredKills:6,attackRange:1,healPoints:2}}};var biRadixBase=2;var biRadixBits=16;var bitsPerDigit=biRadixBits;var biRadix=1<<16;var biHalfRadix=biRadix>>>1;var biRadixSquared=biRadix*biRadix;var maxDigitVal=biRadix-1;var maxInteger=9999999999999998;var maxDigits;var ZERO_ARRAY;var bigZero,bigOne;setMaxDigits(20);var dpl10=15;var lr10=biFromNumber(1e15);var hexatrigesimalToChar=new Array("0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z");var hexToChar=new Array("0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f");var highBitMasks=new Array(0,32768,49152,57344,61440,63488,64512,65024,65280,65408,65472,65504,65520,65528,65532,65534,65535);var lowBitMasks=new Array(0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535);ns("boc.core");window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){var t=1e3/60;window.setTimeout(function(){e(+(new Date))},t)}}();boc.core.GameEngine=function(e,t){this._systems=e||[];this._speed=t&&t.speed?this.speed(t.speed):1;this._stop=false;this._stopCallback=null;this._paused=false;this._reqAnim=null;this._started=false};boc.core.GameEngine.prototype.addSystem=function(e){this._systems.push(e)};boc.core.GameEngine.prototype.removeSystem=function(e){for(var t=0;t<this._systems.length;t++){if(this._systems[t]===systems){return this._systems.splice(t,1)[0]}}return null};(function(){var e=0;boc.core.GameEngine.prototype.start=function(){if(this._started){return}var t=function(e){e.preventDefault()};document.addEventListener("touchmove",t);var n=window.navigator.userAgent.toLowerCase().indexOf("firefox")>=0?+(new Date):e;var r=this;var i=function(t){if(r._stop){if(r._stopCallback){r._stopCallback()}if(window.cancelAnimationFrame){cancelAnimationFrame(r._reqAnim)}e=n;return}r._reqAnim=requestAnimFrame(i);var s=(t-n)*r._speed;if(!r._paused){for(var o=0;o<r._systems.length;o++){r._systems[o].processTick(s)}}n=t};i(n)}})();boc.core.GameEngine.prototype.stop=function(e){this._stopCallback=e;this._stop=true};boc.core.GameEngine.prototype.pause=function(){this._paused=true};boc.core.GameEngine.prototype.resume=function(){this._paused=false};boc.core.GameEngine.prototype.speed=function(e){if(typeof e=="undefined"){return this._speed}switch(e){case 2:this._speed=2;break;case 4:this._speed=4;break;case 8:this._speed=8;break;case.5:this._speed=.5;break;case.25:this._speed=.25;break;default:this._speed=1}return this._speed};(function(e,t){function P(e){var t=e.length,n=b.type(e);return b.isWindow(e)?!1:1===e.nodeType&&t?!0:"array"===n||"function"!==n&&(0===t||"number"==typeof t&&t>0&&t-1 in e)}function B(e){var t=H[e]={};return b.each(e.match(E)||[],function(e,n){t[n]=!0}),t}function I(e,n,r,i){if(b.acceptData(e)){var s,o,u=b.expando,a="string"==typeof n,f=e.nodeType,c=f?b.cache:e,h=f?e[u]:e[u]&&u;if(h&&c[h]&&(i||c[h].data)||!a||r!==t)return h||(f?e[u]=h=l.pop()||b.guid++:h=u),c[h]||(c[h]={},f||(c[h].toJSON=b.noop)),("object"==typeof n||"function"==typeof n)&&(i?c[h]=b.extend(c[h],n):c[h].data=b.extend(c[h].data,n)),s=c[h],i||(s.data||(s.data={}),s=s.data),r!==t&&(s[b.camelCase(n)]=r),a?(o=s[n],null==o&&(o=s[b.camelCase(n)])):o=s,o}}function q(e,t,n){if(b.acceptData(e)){var r,i,s,o=e.nodeType,u=o?b.cache:e,a=o?e[b.expando]:b.expando;if(u[a]){if(t&&(s=n?u[a]:u[a].data)){b.isArray(t)?t=t.concat(b.map(t,b.camelCase)):t in s?t=[t]:(t=b.camelCase(t),t=t in s?[t]:t.split(" "));for(r=0,i=t.length;i>r;r++)delete s[t[r]];if(!(n?U:b.isEmptyObject)(s))return}(n||(delete u[a].data,U(u[a])))&&(o?b.cleanData([e],!0):b.support.deleteExpando||u!=u.window?delete u[a]:u[a]=null)}}}function R(e,n,r){if(r===t&&1===e.nodeType){var i="data-"+n.replace(F,"-$1").toLowerCase();if(r=e.getAttribute(i),"string"==typeof r){try{r="true"===r?!0:"false"===r?!1:"null"===r?null:+r+""===r?+r:j.test(r)?b.parseJSON(r):r}catch(s){}b.data(e,n,r)}else r=t}return r}function U(e){var t;for(t in e)if(("data"!==t||!b.isEmptyObject(e[t]))&&"toJSON"!==t)return!1;return!0}function it(){return!0}function st(){return!1}function ct(e,t){do e=e[t];while(e&&1!==e.nodeType);return e}function ht(e,t,n){if(t=t||0,b.isFunction(t))return b.grep(e,function(e,r){var i=!!t.call(e,r,e);return i===n});if(t.nodeType)return b.grep(e,function(e){return e===t===n});if("string"==typeof t){var r=b.grep(e,function(e){return 1===e.nodeType});if(at.test(t))return b.filter(t,r,!n);t=b.filter(t,r)}return b.grep(e,function(e){return b.inArray(e,t)>=0===n})}function pt(e){var t=dt.split("|"),n=e.createDocumentFragment();if(n.createElement)while(t.length)n.createElement(t.pop());return n}function Mt(e,t){return e.getElementsByTagName(t)[0]||e.appendChild(e.ownerDocument.createElement(t))}function _t(e){var t=e.getAttributeNode("type");return e.type=(t&&t.specified)+"/"+e.type,e}function Dt(e){var t=Ct.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function Pt(e,t){var n,r=0;for(;null!=(n=e[r]);r++)b._data(n,"globalEval",!t||b._data(t[r],"globalEval"))}function Ht(e,t){if(1===t.nodeType&&b.hasData(e)){var n,r,i,s=b._data(e),o=b._data(t,s),u=s.events;if(u){delete o.handle,o.events={};for(n in u)for(r=0,i=u[n].length;i>r;r++)b.event.add(t,n,u[n][r])}o.data&&(o.data=b.extend({},o.data))}}function Bt(e,t){var n,r,i;if(1===t.nodeType){if(n=t.nodeName.toLowerCase(),!b.support.noCloneEvent&&t[b.expando]){i=b._data(t);for(r in i.events)b.removeEvent(t,r,i.handle);t.removeAttribute(b.expando)}"script"===n&&t.text!==e.text?(_t(t).text=e.text,Dt(t)):"object"===n?(t.parentNode&&(t.outerHTML=e.outerHTML),b.support.html5Clone&&e.innerHTML&&!b.trim(t.innerHTML)&&(t.innerHTML=e.innerHTML)):"input"===n&&xt.test(e.type)?(t.defaultChecked=t.checked=e.checked,t.value!==e.value&&(t.value=e.value)):"option"===n?t.defaultSelected=t.selected=e.defaultSelected:("input"===n||"textarea"===n)&&(t.defaultValue=e.defaultValue)}}function jt(e,n){var r,s,o=0,u=typeof e.getElementsByTagName!==i?e.getElementsByTagName(n||"*"):typeof e.querySelectorAll!==i?e.querySelectorAll(n||"*"):t;if(!u)for(u=[],r=e.childNodes||e;null!=(s=r[o]);o++)!n||b.nodeName(s,n)?u.push(s):b.merge(u,jt(s,n));return n===t||n&&b.nodeName(e,n)?b.merge([e],u):u}function Ft(e){xt.test(e.type)&&(e.defaultChecked=e.checked)}function tn(e,t){if(t in e)return t;var n=t.charAt(0).toUpperCase()+t.slice(1),r=t,i=en.length;while(i--)if(t=en[i]+n,t in e)return t;return r}function nn(e,t){return e=t||e,"none"===b.css(e,"display")||!b.contains(e.ownerDocument,e)}function rn(e,t){var n,r,i,s=[],o=0,u=e.length;for(;u>o;o++)r=e[o],r.style&&(s[o]=b._data(r,"olddisplay"),n=r.style.display,t?(s[o]||"none"!==n||(r.style.display=""),""===r.style.display&&nn(r)&&(s[o]=b._data(r,"olddisplay",an(r.nodeName)))):s[o]||(i=nn(r),(n&&"none"!==n||!i)&&b._data(r,"olddisplay",i?n:b.css(r,"display"))));for(o=0;u>o;o++)r=e[o],r.style&&(t&&"none"!==r.style.display&&""!==r.style.display||(r.style.display=t?s[o]||"":"none"));return e}function sn(e,t,n){var r=$t.exec(t);return r?Math.max(0,r[1]-(n||0))+(r[2]||"px"):t}function on(e,t,n,r,i){var s=n===(r?"border":"content")?4:"width"===t?1:0,o=0;for(;4>s;s+=2)"margin"===n&&(o+=b.css(e,n+Zt[s],!0,i)),r?("content"===n&&(o-=b.css(e,"padding"+Zt[s],!0,i)),"margin"!==n&&(o-=b.css(e,"border"+Zt[s]+"Width",!0,i))):(o+=b.css(e,"padding"+Zt[s],!0,i),"padding"!==n&&(o+=b.css(e,"border"+Zt[s]+"Width",!0,i)));return o}function un(e,t,n){var r=!0,i="width"===t?e.offsetWidth:e.offsetHeight,s=qt(e),o=b.support.boxSizing&&"border-box"===b.css(e,"boxSizing",!1,s);if(0>=i||null==i){if(i=Rt(e,t,s),(0>i||null==i)&&(i=e.style[t]),Jt.test(i))return i;r=o&&(b.support.boxSizingReliable||i===e.style[t]),i=parseFloat(i)||0}return i+on(e,t,n||(o?"border":"content"),r,s)+"px"}function an(e){var t=s,n=Qt[e];return n||(n=fn(e,t),"none"!==n&&n||(It=(It||b("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(t.documentElement),t=(It[0].contentWindow||It[0].contentDocument).document,t.write("<!doctype html><html><body>"),t.close(),n=fn(e,t),It.detach()),Qt[e]=n),n}function fn(e,t){var n=b(t.createElement(e)).appendTo(t.body),r=b.css(n[0],"display");return n.remove(),r}function vn(e,t,n,r){var i;if(b.isArray(t))b.each(t,function(t,i){n||cn.test(e)?r(e,i):vn(e+"["+("object"==typeof i?t:"")+"]",i,n,r)});else if(n||"object"!==b.type(t))r(e,t);else for(i in t)vn(e+"["+i+"]",t[i],n,r)}function _n(e){return function(t,n){"string"!=typeof t&&(n=t,t="*");var r,i=0,s=t.toLowerCase().match(E)||[];if(b.isFunction(n))while(r=s[i++])"+"===r[0]?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(n)):(e[r]=e[r]||[]).push(n)}}function Dn(e,n,r,i){function u(a){var f;return s[a]=!0,b.each(e[a]||[],function(e,a){var l=a(n,r,i);return"string"!=typeof l||o||s[l]?o?!(f=l):t:(n.dataTypes.unshift(l),u(l),!1)}),f}var s={},o=e===An;return u(n.dataTypes[0])||!s["*"]&&u("*")}function Pn(e,n){var r,i,s=b.ajaxSettings.flatOptions||{};for(i in n)n[i]!==t&&((s[i]?e:r||(r={}))[i]=n[i]);return r&&b.extend(!0,e,r),e}function Hn(e,n,r){var i,s,o,u,a=e.contents,f=e.dataTypes,l=e.responseFields;for(u in l)u in r&&(n[l[u]]=r[u]);while("*"===f[0])f.shift(),s===t&&(s=e.mimeType||n.getResponseHeader("Content-Type"));if(s)for(u in a)if(a[u]&&a[u].test(s)){f.unshift(u);break}if(f[0]in r)o=f[0];else{for(u in r){if(!f[0]||e.converters[u+" "+f[0]]){o=u;break}i||(i=u)}o=o||i}return o?(o!==f[0]&&f.unshift(o),r[o]):t}function Bn(e,t){var n,r,i,s,o={},u=0,a=e.dataTypes.slice(),f=a[0];if(e.dataFilter&&(t=e.dataFilter(t,e.dataType)),a[1])for(i in e.converters)o[i.toLowerCase()]=e.converters[i];for(;r=a[++u];)if("*"!==r){if("*"!==f&&f!==r){if(i=o[f+" "+r]||o["* "+r],!i)for(n in o)if(s=n.split(" "),s[1]===r&&(i=o[f+" "+s[0]]||o["* "+s[0]])){i===!0?i=o[n]:o[n]!==!0&&(r=s[0],a.splice(u--,0,r));break}if(i!==!0)if(i&&e["throws"])t=i(t);else try{t=i(t)}catch(l){return{state:"parsererror",error:i?l:"No conversion from "+f+" to "+r}}}f=r}return{state:"success",data:t}}function zn(){try{return new e.XMLHttpRequest}catch(t){}}function Wn(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}function Yn(){return setTimeout(function(){Xn=t}),Xn=b.now()}function Zn(e,t){b.each(t,function(t,n){var r=(Gn[t]||[]).concat(Gn["*"]),i=0,s=r.length;for(;s>i;i++)if(r[i].call(e,t,n))return})}function er(e,t,n){var r,i,s=0,o=Qn.length,u=b.Deferred().always(function(){delete a.elem}),a=function(){if(i)return!1;var t=Xn||Yn(),n=Math.max(0,f.startTime+f.duration-t),r=n/f.duration||0,s=1-r,o=0,a=f.tweens.length;for(;a>o;o++)f.tweens[o].run(s);return u.notifyWith(e,[f,s,n]),1>s&&a?n:(u.resolveWith(e,[f]),!1)},f=u.promise({elem:e,props:b.extend({},t),opts:b.extend(!0,{specialEasing:{}},n),originalProperties:t,originalOptions:n,startTime:Xn||Yn(),duration:n.duration,tweens:[],createTween:function(t,n){var r=b.Tween(e,f.opts,t,n,f.opts.specialEasing[t]||f.opts.easing);return f.tweens.push(r),r},stop:function(t){var n=0,r=t?f.tweens.length:0;if(i)return this;for(i=!0;r>n;n++)f.tweens[n].run(1);return t?u.resolveWith(e,[f,t]):u.rejectWith(e,[f,t]),this}}),l=f.props;for(tr(l,f.opts.specialEasing);o>s;s++)if(r=Qn[s].call(f,e,l,f.opts))return r;return Zn(f,l),b.isFunction(f.opts.start)&&f.opts.start.call(e,f),b.fx.timer(b.extend(a,{elem:e,anim:f,queue:f.opts.queue})),f.progress(f.opts.progress).done(f.opts.done,f.opts.complete).fail(f.opts.fail).always(f.opts.always)}function tr(e,t){var n,r,i,s,o;for(i in e)if(r=b.camelCase(i),s=t[r],n=e[i],b.isArray(n)&&(s=n[1],n=e[i]=n[0]),i!==r&&(e[r]=n,delete e[i]),o=b.cssHooks[r],o&&"expand"in o){n=o.expand(n),delete e[r];for(i in n)i in e||(e[i]=n[i],t[i]=s)}else t[r]=s}function nr(e,t,n){var r,i,s,o,u,a,f,l,c,h=this,p=e.style,d={},v=[],m=e.nodeType&&nn(e);n.queue||(l=b._queueHooks(e,"fx"),null==l.unqueued&&(l.unqueued=0,c=l.empty.fire,l.empty.fire=function(){l.unqueued||c()}),l.unqueued++,h.always(function(){h.always(function(){l.unqueued--,b.queue(e,"fx").length||l.empty.fire()})})),1===e.nodeType&&("height"in t||"width"in t)&&(n.overflow=[p.overflow,p.overflowX,p.overflowY],"inline"===b.css(e,"display")&&"none"===b.css(e,"float")&&(b.support.inlineBlockNeedsLayout&&"inline"!==an(e.nodeName)?p.zoom=1:p.display="inline-block")),n.overflow&&(p.overflow="hidden",b.support.shrinkWrapBlocks||h.always(function(){p.overflow=n.overflow[0],p.overflowX=n.overflow[1],p.overflowY=n.overflow[2]}));for(i in t)if(o=t[i],$n.exec(o)){if(delete t[i],a=a||"toggle"===o,o===(m?"hide":"show"))continue;v.push(i)}if(s=v.length){u=b._data(e,"fxshow")||b._data(e,"fxshow",{}),"hidden"in u&&(m=u.hidden),a&&(u.hidden=!m),m?b(e).show():h.done(function(){b(e).hide()}),h.done(function(){var t;b._removeData(e,"fxshow");for(t in d)b.style(e,t,d[t])});for(i=0;s>i;i++)r=v[i],f=h.createTween(r,m?u[r]:0),d[r]=u[r]||b.style(e,r),r in u||(u[r]=f.start,m&&(f.end=f.start,f.start="width"===r||"height"===r?1:0))}}function rr(e,t,n,r,i){return new rr.prototype.init(e,t,n,r,i)}function ir(e,t){var n,r={height:e},i=0;for(t=t?1:0;4>i;i+=2-t)n=Zt[i],r["margin"+n]=r["padding"+n]=e;return t&&(r.opacity=r.width=e),r}function sr(e){return b.isWindow(e)?e:9===e.nodeType?e.defaultView||e.parentWindow:!1}var n,r,i=typeof t,s=e.document,o=e.location,u=e.jQuery,a=e.$,f={},l=[],c="1.9.1",h=l.concat,p=l.push,d=l.slice,v=l.indexOf,m=f.toString,g=f.hasOwnProperty,y=c.trim,b=function(e,t){return new b.fn.init(e,t,r)},w=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,E=/\S+/g,S=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,x=/^(?:(<[\w\W]+>)[^>]*|#([\w-]*))$/,T=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,N=/^[\],:{}\s]*$/,C=/(?:^|:|,)(?:\s*\[)+/g,k=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,L=/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g,A=/^-ms-/,O=/-([\da-z])/gi,M=function(e,t){return t.toUpperCase()},_=function(e){(s.addEventListener||"load"===e.type||"complete"===s.readyState)&&(D(),b.ready())},D=function(){s.addEventListener?(s.removeEventListener("DOMContentLoaded",_,!1),e.removeEventListener("load",_,!1)):(s.detachEvent("onreadystatechange",_),e.detachEvent("onload",_))};b.fn=b.prototype={jquery:c,constructor:b,init:function(e,n,r){var i,o;if(!e)return this;if("string"==typeof e){if(i="<"===e.charAt(0)&&">"===e.charAt(e.length-1)&&e.length>=3?[null,e,null]:x.exec(e),!i||!i[1]&&n)return!n||n.jquery?(n||r).find(e):this.constructor(n).find(e);if(i[1]){if(n=n instanceof b?n[0]:n,b.merge(this,b.parseHTML(i[1],n&&n.nodeType?n.ownerDocument||n:s,!0)),T.test(i[1])&&b.isPlainObject(n))for(i in n)b.isFunction(this[i])?this[i](n[i]):this.attr(i,n[i]);return this}if(o=s.getElementById(i[2]),o&&o.parentNode){if(o.id!==i[2])return r.find(e);this.length=1,this[0]=o}return this.context=s,this.selector=e,this}return e.nodeType?(this.context=this[0]=e,this.length=1,this):b.isFunction(e)?r.ready(e):(e.selector!==t&&(this.selector=e.selector,this.context=e.context),b.makeArray(e,this))},selector:"",length:0,size:function(){return this.length},toArray:function(){return d.call(this)},get:function(e){return null==e?this.toArray():0>e?this[this.length+e]:this[e]},pushStack:function(e){var t=b.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return b.each(this,e,t)},ready:function(e){return b.ready.promise().done(e),this},slice:function(){return this.pushStack(d.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(0>e?t:0);return this.pushStack(n>=0&&t>n?[this[n]]:[])},map:function(e){return this.pushStack(b.map(this,function(t,n){return e.call(t,n,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:p,sort:[].sort,splice:[].splice},b.fn.init.prototype=b.fn,b.extend=b.fn.extend=function(){var e,n,r,i,s,o,u=arguments[0]||{},a=1,f=arguments.length,l=!1;for("boolean"==typeof u&&(l=u,u=arguments[1]||{},a=2),"object"==typeof u||b.isFunction(u)||(u={}),f===a&&(u=this,--a);f>a;a++)if(null!=(s=arguments[a]))for(i in s)e=u[i],r=s[i],u!==r&&(l&&r&&(b.isPlainObject(r)||(n=b.isArray(r)))?(n?(n=!1,o=e&&b.isArray(e)?e:[]):o=e&&b.isPlainObject(e)?e:{},u[i]=b.extend(l,o,r)):r!==t&&(u[i]=r));return u},b.extend({noConflict:function(t){return e.$===b&&(e.$=a),t&&e.jQuery===b&&(e.jQuery=u),b},isReady:!1,readyWait:1,holdReady:function(e){e?b.readyWait++:b.ready(!0)},ready:function(e){if(e===!0?!--b.readyWait:!b.isReady){if(!s.body)return setTimeout(b.ready);b.isReady=!0,e!==!0&&--b.readyWait>0||(n.resolveWith(s,[b]),b.fn.trigger&&b(s).trigger("ready").off("ready"))}},isFunction:function(e){return"function"===b.type(e)},isArray:Array.isArray||function(e){return"array"===b.type(e)},isWindow:function(e){return null!=e&&e==e.window},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?f[m.call(e)]||"object":typeof e},isPlainObject:function(e){if(!e||"object"!==b.type(e)||e.nodeType||b.isWindow(e))return!1;try{if(e.constructor&&!g.call(e,"constructor")&&!g.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(n){return!1}var r;for(r in e);return r===t||g.call(e,r)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},error:function(e){throw Error(e)},parseHTML:function(e,t,n){if(!e||"string"!=typeof e)return null;"boolean"==typeof t&&(n=t,t=!1),t=t||s;var r=T.exec(e),i=!n&&[];return r?[t.createElement(r[1])]:(r=b.buildFragment([e],t,i),i&&b(i).remove(),b.merge([],r.childNodes))},parseJSON:function(n){return e.JSON&&e.JSON.parse?e.JSON.parse(n):null===n?n:"string"==typeof n&&(n=b.trim(n),n&&N.test(n.replace(k,"@").replace(L,"]").replace(C,"")))?Function("return "+n)():(b.error("Invalid JSON: "+n),t)},parseXML:function(n){var r,i;if(!n||"string"!=typeof n)return null;try{e.DOMParser?(i=new DOMParser,r=i.parseFromString(n,"text/xml")):(r=new ActiveXObject("Microsoft.XMLDOM"),r.async="false",r.loadXML(n))}catch(s){r=t}return r&&r.documentElement&&!r.getElementsByTagName("parsererror").length||b.error("Invalid XML: "+n),r},noop:function(){},globalEval:function(t){t&&b.trim(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(A,"ms-").replace(O,M)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,n){var r,i=0,s=e.length,o=P(e);if(n){if(o){for(;s>i;i++)if(r=t.apply(e[i],n),r===!1)break}else for(i in e)if(r=t.apply(e[i],n),r===!1)break}else if(o){for(;s>i;i++)if(r=t.call(e[i],i,e[i]),r===!1)break}else for(i in e)if(r=t.call(e[i],i,e[i]),r===!1)break;return e},trim:y&&!y.call("﻿ ")?function(e){return null==e?"":y.call(e)}:function(e){return null==e?"":(e+"").replace(S,"")},makeArray:function(e,t){var n=t||[];return null!=e&&(P(Object(e))?b.merge(n,"string"==typeof e?[e]:e):p.call(n,e)),n},inArray:function(e,t,n){var r;if(t){if(v)return v.call(t,e,n);for(r=t.length,n=n?0>n?Math.max(0,r+n):n:0;r>n;n++)if(n in t&&t[n]===e)return n}return-1},merge:function(e,n){var r=n.length,i=e.length,s=0;if("number"==typeof r)for(;r>s;s++)e[i++]=n[s];else while(n[s]!==t)e[i++]=n[s++];return e.length=i,e},grep:function(e,t,n){var r,i=[],s=0,o=e.length;for(n=!!n;o>s;s++)r=!!t(e[s],s),n!==r&&i.push(e[s]);return i},map:function(e,t,n){var r,i=0,s=e.length,o=P(e),u=[];if(o)for(;s>i;i++)r=t(e[i],i,n),null!=r&&(u[u.length]=r);else for(i in e)r=t(e[i],i,n),null!=r&&(u[u.length]=r);return h.apply([],u)},guid:1,proxy:function(e,n){var r,i,s;return"string"==typeof n&&(s=e[n],n=e,e=s),b.isFunction(e)?(r=d.call(arguments,2),i=function(){return e.apply(n||this,r.concat(d.call(arguments)))},i.guid=e.guid=e.guid||b.guid++,i):t},access:function(e,n,r,i,s,o,u){var a=0,f=e.length,l=null==r;if("object"===b.type(r)){s=!0;for(a in r)b.access(e,n,a,r[a],!0,o,u)}else if(i!==t&&(s=!0,b.isFunction(i)||(u=!0),l&&(u?(n.call(e,i),n=null):(l=n,n=function(e,t,n){return l.call(b(e),n)})),n))for(;f>a;a++)n(e[a],r,u?i:i.call(e[a],a,n(e[a],r)));return s?e:l?n.call(e):f?n(e[0],r):o},now:function(){return(new Date).getTime()}}),b.ready.promise=function(t){if(!n)if(n=b.Deferred(),"complete"===s.readyState)setTimeout(b.ready);else if(s.addEventListener)s.addEventListener("DOMContentLoaded",_,!1),e.addEventListener("load",_,!1);else{s.attachEvent("onreadystatechange",_),e.attachEvent("onload",_);var r=!1;try{r=null==e.frameElement&&s.documentElement}catch(i){}r&&r.doScroll&&function o(){if(!b.isReady){try{r.doScroll("left")}catch(e){return setTimeout(o,50)}D(),b.ready()}}()}return n.promise(t)},b.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){f["[object "+t+"]"]=t.toLowerCase()});r=b(s);var H={};b.Callbacks=function(e){e="string"==typeof e?H[e]||B(e):b.extend({},e);var n,r,i,s,o,u,a=[],f=!e.once&&[],l=function(t){for(r=e.memory&&t,i=!0,o=u||0,u=0,s=a.length,n=!0;a&&s>o;o++)if(a[o].apply(t[0],t[1])===!1&&e.stopOnFalse){r=!1;break}n=!1,a&&(f?f.length&&l(f.shift()):r?a=[]:c.disable())},c={add:function(){if(a){var t=a.length;(function i(t){b.each(t,function(t,n){var r=b.type(n);"function"===r?e.unique&&c.has(n)||a.push(n):n&&n.length&&"string"!==r&&i(n)})})(arguments),n?s=a.length:r&&(u=t,l(r))}return this},remove:function(){return a&&b.each(arguments,function(e,t){var r;while((r=b.inArray(t,a,r))>-1)a.splice(r,1),n&&(s>=r&&s--,o>=r&&o--)}),this},has:function(e){return e?b.inArray(e,a)>-1:!(!a||!a.length)},empty:function(){return a=[],this},disable:function(){return a=f=r=t,this},disabled:function(){return!a},lock:function(){return f=t,r||c.disable(),this},locked:function(){return!f},fireWith:function(e,t){return t=t||[],t=[e,t.slice?t.slice():t],!a||i&&!f||(n?f.push(t):l(t)),this},fire:function(){return c.fireWith(this,arguments),this},fired:function(){return!!i}};return c},b.extend({Deferred:function(e){var t=[["resolve","done",b.Callbacks("once memory"),"resolved"],["reject","fail",b.Callbacks("once memory"),"rejected"],["notify","progress",b.Callbacks("memory")]],n="pending",r={state:function(){return n},always:function(){return i.done(arguments).fail(arguments),this},then:function(){var e=arguments;return b.Deferred(function(n){b.each(t,function(t,s){var o=s[0],u=b.isFunction(e[t])&&e[t];i[s[1]](function(){var e=u&&u.apply(this,arguments);e&&b.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[o+"With"](this===r?n.promise():this,u?[e]:arguments)})}),e=null}).promise()},promise:function(e){return null!=e?b.extend(e,r):r}},i={};return r.pipe=r.then,b.each(t,function(e,s){var o=s[2],u=s[3];r[s[1]]=o.add,u&&o.add(function(){n=u},t[1^e][2].disable,t[2][2].lock),i[s[0]]=function(){return i[s[0]+"With"](this===i?r:this,arguments),this},i[s[0]+"With"]=o.fireWith}),r.promise(i),e&&e.call(i,i),i},when:function(e){var t=0,n=d.call(arguments),r=n.length,i=1!==r||e&&b.isFunction(e.promise)?r:0,s=1===i?e:b.Deferred(),o=function(e,t,n){return function(r){t[e]=this,n[e]=arguments.length>1?d.call(arguments):r,n===u?s.notifyWith(t,n):--i||s.resolveWith(t,n)}},u,a,f;if(r>1)for(u=Array(r),a=Array(r),f=Array(r);r>t;t++)n[t]&&b.isFunction(n[t].promise)?n[t].promise().done(o(t,f,n)).fail(s.reject).progress(o(t,a,u)):--i;return i||s.resolveWith(f,n),s.promise()}}),b.support=function(){var t,n,r,o,u,a,f,l,c,h,p=s.createElement("div");if(p.setAttribute("className","t"),p.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",n=p.getElementsByTagName("*"),r=p.getElementsByTagName("a")[0],!n||!r||!n.length)return{};u=s.createElement("select"),f=u.appendChild(s.createElement("option")),o=p.getElementsByTagName("input")[0],r.style.cssText="top:1px;float:left;opacity:.5",t={getSetAttribute:"t"!==p.className,leadingWhitespace:3===p.firstChild.nodeType,tbody:!p.getElementsByTagName("tbody").length,htmlSerialize:!!p.getElementsByTagName("link").length,style:/top/.test(r.getAttribute("style")),hrefNormalized:"/a"===r.getAttribute("href"),opacity:/^0.5/.test(r.style.opacity),cssFloat:!!r.style.cssFloat,checkOn:!!o.value,optSelected:f.selected,enctype:!!s.createElement("form").enctype,html5Clone:"<:nav></:nav>"!==s.createElement("nav").cloneNode(!0).outerHTML,boxModel:"CSS1Compat"===s.compatMode,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,boxSizingReliable:!0,pixelPosition:!1},o.checked=!0,t.noCloneChecked=o.cloneNode(!0).checked,u.disabled=!0,t.optDisabled=!f.disabled;try{delete p.test}catch(d){t.deleteExpando=!1}o=s.createElement("input"),o.setAttribute("value",""),t.input=""===o.getAttribute("value"),o.value="t",o.setAttribute("type","radio"),t.radioValue="t"===o.value,o.setAttribute("checked","t"),o.setAttribute("name","t"),a=s.createDocumentFragment(),a.appendChild(o),t.appendChecked=o.checked,t.checkClone=a.cloneNode(!0).cloneNode(!0).lastChild.checked,p.attachEvent&&(p.attachEvent("onclick",function(){t.noCloneEvent=!1}),p.cloneNode(!0).click());for(h in{submit:!0,change:!0,focusin:!0})p.setAttribute(l="on"+h,"t"),t[h+"Bubbles"]=l in e||p.attributes[l].expando===!1;return p.style.backgroundClip="content-box",p.cloneNode(!0).style.backgroundClip="",t.clearCloneStyle="content-box"===p.style.backgroundClip,b(function(){var n,r,o,u="padding:0;margin:0;border:0;display:block;box-sizing:content-box;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;",a=s.getElementsByTagName("body")[0];a&&(n=s.createElement("div"),n.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",a.appendChild(n).appendChild(p),p.innerHTML="<table><tr><td></td><td>t</td></tr></table>",o=p.getElementsByTagName("td"),o[0].style.cssText="padding:0;margin:0;border:0;display:none",c=0===o[0].offsetHeight,o[0].style.display="",o[1].style.display="none",t.reliableHiddenOffsets=c&&0===o[0].offsetHeight,p.innerHTML="",p.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",t.boxSizing=4===p.offsetWidth,t.doesNotIncludeMarginInBodyOffset=1!==a.offsetTop,e.getComputedStyle&&(t.pixelPosition="1%"!==(e.getComputedStyle(p,null)||{}).top,t.boxSizingReliable="4px"===(e.getComputedStyle(p,null)||{width:"4px"}).width,r=p.appendChild(s.createElement("div")),r.style.cssText=p.style.cssText=u,r.style.marginRight=r.style.width="0",p.style.width="1px",t.reliableMarginRight=!parseFloat((e.getComputedStyle(r,null)||{}).marginRight)),typeof p.style.zoom!==i&&(p.innerHTML="",p.style.cssText=u+"width:1px;padding:1px;display:inline;zoom:1",t.inlineBlockNeedsLayout=3===p.offsetWidth,p.style.display="block",p.innerHTML="<div></div>",p.firstChild.style.width="5px",t.shrinkWrapBlocks=3!==p.offsetWidth,t.inlineBlockNeedsLayout&&(a.style.zoom=1)),a.removeChild(n),n=p=o=r=null)}),n=u=a=f=r=o=null,t}();var j=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,F=/([A-Z])/g;b.extend({cache:{},expando:"jQuery"+(c+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(e){return e=e.nodeType?b.cache[e[b.expando]]:e[b.expando],!!e&&!U(e)},data:function(e,t,n){return I(e,t,n)},removeData:function(e,t){return q(e,t)},_data:function(e,t,n){return I(e,t,n,!0)},_removeData:function(e,t){return q(e,t,!0)},acceptData:function(e){if(e.nodeType&&1!==e.nodeType&&9!==e.nodeType)return!1;var t=e.nodeName&&b.noData[e.nodeName.toLowerCase()];return!t||t!==!0&&e.getAttribute("classid")===t}}),b.fn.extend({data:function(e,n){var r,i,s=this[0],o=0,u=null;if(e===t){if(this.length&&(u=b.data(s),1===s.nodeType&&!b._data(s,"parsedAttrs"))){for(r=s.attributes;r.length>o;o++)i=r[o].name,i.indexOf("data-")||(i=b.camelCase(i.slice(5)),R(s,i,u[i]));b._data(s,"parsedAttrs",!0)}return u}return"object"==typeof e?this.each(function(){b.data(this,e)}):b.access(this,function(n){return n===t?s?R(s,e,b.data(s,e)):null:(this.each(function(){b.data(this,e,n)}),t)},null,n,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){b.removeData(this,e)})}});b.extend({queue:function(e,n,r){var i;return e?(n=(n||"fx")+"queue",i=b._data(e,n),r&&(!i||b.isArray(r)?i=b._data(e,n,b.makeArray(r)):i.push(r)),i||[]):t},dequeue:function(e,t){t=t||"fx";var n=b.queue(e,t),r=n.length,i=n.shift(),s=b._queueHooks(e,t),o=function(){b.dequeue(e,t)};"inprogress"===i&&(i=n.shift(),r--),s.cur=i,i&&("fx"===t&&n.unshift("inprogress"),delete s.stop,i.call(e,o,s)),!r&&s&&s.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return b._data(e,n)||b._data(e,n,{empty:b.Callbacks("once memory").add(function(){b._removeData(e,t+"queue"),b._removeData(e,n)})})}}),b.fn.extend({queue:function(e,n){var r=2;return"string"!=typeof e&&(n=e,e="fx",r--),r>arguments.length?b.queue(this[0],e):n===t?this:this.each(function(){var t=b.queue(this,e,n);b._queueHooks(this,e),"fx"===e&&"inprogress"!==t[0]&&b.dequeue(this,e)})},dequeue:function(e){return this.each(function(){b.dequeue(this,e)})},delay:function(e,t){return e=b.fx?b.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var r=setTimeout(t,e);n.stop=function(){clearTimeout(r)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,n){var r,i=1,s=b.Deferred(),o=this,u=this.length,a=function(){--i||s.resolveWith(o,[o])};"string"!=typeof e&&(n=e,e=t),e=e||"fx";while(u--)r=b._data(o[u],e+"queueHooks"),r&&r.empty&&(i++,r.empty.add(a));return a(),s.promise(n)}});var z,W,X=/[\t\r\n]/g,V=/\r/g,$=/^(?:input|select|textarea|button|object)$/i,J=/^(?:a|area)$/i,K=/^(?:checked|selected|autofocus|autoplay|async|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped)$/i,Q=/^(?:checked|selected)$/i,G=b.support.getSetAttribute,Y=b.support.input;b.fn.extend({attr:function(e,t){return b.access(this,b.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){b.removeAttr(this,e)})},prop:function(e,t){return b.access(this,b.prop,e,t,arguments.length>1)},removeProp:function(e){return e=b.propFix[e]||e,this.each(function(){try{this[e]=t,delete this[e]}catch(n){}})},addClass:function(e){var t,n,r,i,s,o=0,u=this.length,a="string"==typeof e&&e;if(b.isFunction(e))return this.each(function(t){b(this).addClass(e.call(this,t,this.className))});if(a)for(t=(e||"").match(E)||[];u>o;o++)if(n=this[o],r=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(X," "):" ")){s=0;while(i=t[s++])0>r.indexOf(" "+i+" ")&&(r+=i+" ");n.className=b.trim(r)}return this},removeClass:function(e){var t,n,r,i,s,o=0,u=this.length,a=0===arguments.length||"string"==typeof e&&e;if(b.isFunction(e))return this.each(function(t){b(this).removeClass(e.call(this,t,this.className))});if(a)for(t=(e||"").match(E)||[];u>o;o++)if(n=this[o],r=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(X," "):"")){s=0;while(i=t[s++])while(r.indexOf(" "+i+" ")>=0)r=r.replace(" "+i+" "," ");n.className=e?b.trim(r):""}return this},toggleClass:function(e,t){var n=typeof e,r="boolean"==typeof t;return b.isFunction(e)?this.each(function(n){b(this).toggleClass(e.call(this,n,this.className,t),t)}):this.each(function(){if("string"===n){var s,o=0,u=b(this),a=t,f=e.match(E)||[];while(s=f[o++])a=r?a:!u.hasClass(s),u[a?"addClass":"removeClass"](s)}else(n===i||"boolean"===n)&&(this.className&&b._data(this,"__className__",this.className),this.className=this.className||e===!1?"":b._data(this,"__className__")||"")})},hasClass:function(e){var t=" "+e+" ",n=0,r=this.length;for(;r>n;n++)if(1===this[n].nodeType&&(" "+this[n].className+" ").replace(X," ").indexOf(t)>=0)return!0;return!1},val:function(e){var n,r,i,s=this[0];{if(arguments.length)return i=b.isFunction(e),this.each(function(n){var s,o=b(this);1===this.nodeType&&(s=i?e.call(this,n,o.val()):e,null==s?s="":"number"==typeof s?s+="":b.isArray(s)&&(s=b.map(s,function(e){return null==e?"":e+""})),r=b.valHooks[this.type]||b.valHooks[this.nodeName.toLowerCase()],r&&"set"in r&&r.set(this,s,"value")!==t||(this.value=s))});if(s)return r=b.valHooks[s.type]||b.valHooks[s.nodeName.toLowerCase()],r&&"get"in r&&(n=r.get(s,"value"))!==t?n:(n=s.value,"string"==typeof n?n.replace(V,""):null==n?"":n)}}}),b.extend({valHooks:{option:{get:function(e){var t=e.attributes.value;return!t||t.specified?e.value:e.text}},select:{get:function(e){var t,n,r=e.options,i=e.selectedIndex,s="select-one"===e.type||0>i,o=s?null:[],u=s?i+1:r.length,a=0>i?u:s?i:0;for(;u>a;a++)if(n=r[a],!(!n.selected&&a!==i||(b.support.optDisabled?n.disabled:null!==n.getAttribute("disabled"))||n.parentNode.disabled&&b.nodeName(n.parentNode,"optgroup"))){if(t=b(n).val(),s)return t;o.push(t)}return o},set:function(e,t){var n=b.makeArray(t);return b(e).find("option").each(function(){this.selected=b.inArray(b(this).val(),n)>=0}),n.length||(e.selectedIndex=-1),n}}},attr:function(e,n,r){var s,o,u,a=e.nodeType;if(e&&3!==a&&8!==a&&2!==a)return typeof e.getAttribute===i?b.prop(e,n,r):(o=1!==a||!b.isXMLDoc(e),o&&(n=n.toLowerCase(),s=b.attrHooks[n]||(K.test(n)?W:z)),r===t?s&&o&&"get"in s&&null!==(u=s.get(e,n))?u:(typeof e.getAttribute!==i&&(u=e.getAttribute(n)),null==u?t:u):null!==r?s&&o&&"set"in s&&(u=s.set(e,r,n))!==t?u:(e.setAttribute(n,r+""),r):(b.removeAttr(e,n),t))},removeAttr:function(e,t){var n,r,i=0,s=t&&t.match(E);if(s&&1===e.nodeType)while(n=s[i++])r=b.propFix[n]||n,K.test(n)?!G&&Q.test(n)?e[b.camelCase("default-"+n)]=e[r]=!1:e[r]=!1:b.attr(e,n,""),e.removeAttribute(G?n:r)},attrHooks:{type:{set:function(e,t){if(!b.support.radioValue&&"radio"===t&&b.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(e,n,r){var i,s,o,u=e.nodeType;if(e&&3!==u&&8!==u&&2!==u)return o=1!==u||!b.isXMLDoc(e),o&&(n=b.propFix[n]||n,s=b.propHooks[n]),r!==t?s&&"set"in s&&(i=s.set(e,r,n))!==t?i:e[n]=r:s&&"get"in s&&null!==(i=s.get(e,n))?i:e[n]},propHooks:{tabIndex:{get:function(e){var n=e.getAttributeNode("tabindex");return n&&n.specified?parseInt(n.value,10):$.test(e.nodeName)||J.test(e.nodeName)&&e.href?0:t}}}}),W={get:function(e,n){var r=b.prop(e,n),i="boolean"==typeof r&&e.getAttribute(n),s="boolean"==typeof r?Y&&G?null!=i:Q.test(n)?e[b.camelCase("default-"+n)]:!!i:e.getAttributeNode(n);return s&&s.value!==!1?n.toLowerCase():t},set:function(e,t,n){return t===!1?b.removeAttr(e,n):Y&&G||!Q.test(n)?e.setAttribute(!G&&b.propFix[n]||n,n):e[b.camelCase("default-"+n)]=e[n]=!0,n}},Y&&G||(b.attrHooks.value={get:function(e,n){var r=e.getAttributeNode(n);return b.nodeName(e,"input")?e.defaultValue:r&&r.specified?r.value:t},set:function(e,n,r){return b.nodeName(e,"input")?(e.defaultValue=n,t):z&&z.set(e,n,r)}}),G||(z=b.valHooks.button={get:function(e,n){var r=e.getAttributeNode(n);return r&&("id"===n||"name"===n||"coords"===n?""!==r.value:r.specified)?r.value:t},set:function(e,n,r){var i=e.getAttributeNode(r);return i||e.setAttributeNode(i=e.ownerDocument.createAttribute(r)),i.value=n+="","value"===r||n===e.getAttribute(r)?n:t}},b.attrHooks.contenteditable={get:z.get,set:function(e,t,n){z.set(e,""===t?!1:t,n)}},b.each(["width","height"],function(e,n){b.attrHooks[n]=b.extend(b.attrHooks[n],{set:function(e,r){return""===r?(e.setAttribute(n,"auto"),r):t}})})),b.support.hrefNormalized||(b.each(["href","src","width","height"],function(e,n){b.attrHooks[n]=b.extend(b.attrHooks[n],{get:function(e){var r=e.getAttribute(n,2);return null==r?t:r}})}),b.each(["href","src"],function(e,t){b.propHooks[t]={get:function(e){return e.getAttribute(t,4)}}})),b.support.style||(b.attrHooks.style={get:function(e){return e.style.cssText||t},set:function(e,t){return e.style.cssText=t+""}}),b.support.optSelected||(b.propHooks.selected=b.extend(b.propHooks.selected,{get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}})),b.support.enctype||(b.propFix.enctype="encoding"),b.support.checkOn||b.each(["radio","checkbox"],function(){b.valHooks[this]={get:function(e){return null===e.getAttribute("value")?"on":e.value}}}),b.each(["radio","checkbox"],function(){b.valHooks[this]=b.extend(b.valHooks[this],{set:function(e,n){return b.isArray(n)?e.checked=b.inArray(b(e).val(),n)>=0:t}})});var Z=/^(?:input|select|textarea)$/i,et=/^key/,tt=/^(?:mouse|contextmenu)|click/,nt=/^(?:focusinfocus|focusoutblur)$/,rt=/^([^.]*)(?:\.(.+)|)$/;b.event={global:{},add:function(e,n,r,s,o){var u,a,f,l,c,h,p,d,v,m,g,y=b._data(e);if(y){r.handler&&(l=r,r=l.handler,o=l.selector),r.guid||(r.guid=b.guid++),(a=y.events)||(a=y.events={}),(h=y.handle)||(h=y.handle=function(e){return typeof b===i||e&&b.event.triggered===e.type?t:b.event.dispatch.apply(h.elem,arguments)},h.elem=e),n=(n||"").match(E)||[""],f=n.length;while(f--)u=rt.exec(n[f])||[],v=g=u[1],m=(u[2]||"").split(".").sort(),c=b.event.special[v]||{},v=(o?c.delegateType:c.bindType)||v,c=b.event.special[v]||{},p=b.extend({type:v,origType:g,data:s,handler:r,guid:r.guid,selector:o,needsContext:o&&b.expr.match.needsContext.test(o),namespace:m.join(".")},l),(d=a[v])||(d=a[v]=[],d.delegateCount=0,c.setup&&c.setup.call(e,s,m,h)!==!1||(e.addEventListener?e.addEventListener(v,h,!1):e.attachEvent&&e.attachEvent("on"+v,h))),c.add&&(c.add.call(e,p),p.handler.guid||(p.handler.guid=r.guid)),o?d.splice(d.delegateCount++,0,p):d.push(p),b.event.global[v]=!0;e=null}},remove:function(e,t,n,r,i){var s,o,u,a,f,l,c,h,p,d,v,m=b.hasData(e)&&b._data(e);if(m&&(l=m.events)){t=(t||"").match(E)||[""],f=t.length;while(f--)if(u=rt.exec(t[f])||[],p=v=u[1],d=(u[2]||"").split(".").sort(),p){c=b.event.special[p]||{},p=(r?c.delegateType:c.bindType)||p,h=l[p]||[],u=u[2]&&RegExp("(^|\\.)"+d.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=s=h.length;while(s--)o=h[s],!i&&v!==o.origType||n&&n.guid!==o.guid||u&&!u.test(o.namespace)||r&&r!==o.selector&&("**"!==r||!o.selector)||(h.splice(s,1),o.selector&&h.delegateCount--,c.remove&&c.remove.call(e,o));a&&!h.length&&(c.teardown&&c.teardown.call(e,d,m.handle)!==!1||b.removeEvent(e,p,m.handle),delete l[p])}else for(p in l)b.event.remove(e,p+t[f],n,r,!0);b.isEmptyObject(l)&&(delete m.handle,b._removeData(e,"events"))}},trigger:function(n,r,i,o){var u,a,f,l,c,h,p,d=[i||s],v=g.call(n,"type")?n.type:n,m=g.call(n,"namespace")?n.namespace.split("."):[];if(f=h=i=i||s,3!==i.nodeType&&8!==i.nodeType&&!nt.test(v+b.event.triggered)&&(v.indexOf(".")>=0&&(m=v.split("."),v=m.shift(),m.sort()),a=0>v.indexOf(":")&&"on"+v,n=n[b.expando]?n:new b.Event(v,"object"==typeof n&&n),n.isTrigger=!0,n.namespace=m.join("."),n.namespace_re=n.namespace?RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,n.result=t,n.target||(n.target=i),r=null==r?[n]:b.makeArray(r,[n]),c=b.event.special[v]||{},o||!c.trigger||c.trigger.apply(i,r)!==!1)){if(!o&&!c.noBubble&&!b.isWindow(i)){for(l=c.delegateType||v,nt.test(l+v)||(f=f.parentNode);f;f=f.parentNode)d.push(f),h=f;h===(i.ownerDocument||s)&&d.push(h.defaultView||h.parentWindow||e)}p=0;while((f=d[p++])&&!n.isPropagationStopped())n.type=p>1?l:c.bindType||v,u=(b._data(f,"events")||{})[n.type]&&b._data(f,"handle"),u&&u.apply(f,r),u=a&&f[a],u&&b.acceptData(f)&&u.apply&&u.apply(f,r)===!1&&n.preventDefault();if(n.type=v,!(o||n.isDefaultPrevented()||c._default&&c._default.apply(i.ownerDocument,r)!==!1||"click"===v&&b.nodeName(i,"a")||!b.acceptData(i)||!a||!i[v]||b.isWindow(i))){h=i[a],h&&(i[a]=null),b.event.triggered=v;try{i[v]()}catch(y){}b.event.triggered=t,h&&(i[a]=h)}return n.result}},dispatch:function(e){e=b.event.fix(e);var n,r,i,s,o,u=[],a=d.call(arguments),f=(b._data(this,"events")||{})[e.type]||[],l=b.event.special[e.type]||{};if(a[0]=e,e.delegateTarget=this,!l.preDispatch||l.preDispatch.call(this,e)!==!1){u=b.event.handlers.call(this,e,f),n=0;while((s=u[n++])&&!e.isPropagationStopped()){e.currentTarget=s.elem,o=0;while((i=s.handlers[o++])&&!e.isImmediatePropagationStopped())(!e.namespace_re||e.namespace_re.test(i.namespace))&&(e.handleObj=i,e.data=i.data,r=((b.event.special[i.origType]||{}).handle||i.handler).apply(s.elem,a),r!==t&&(e.result=r)===!1&&(e.preventDefault(),e.stopPropagation()))}return l.postDispatch&&l.postDispatch.call(this,e),e.result}},handlers:function(e,n){var r,i,s,o,u=[],a=n.delegateCount,f=e.target;if(a&&f.nodeType&&(!e.button||"click"!==e.type))for(;f!=this;f=f.parentNode||this)if(1===f.nodeType&&(f.disabled!==!0||"click"!==e.type)){for(s=[],o=0;a>o;o++)i=n[o],r=i.selector+" ",s[r]===t&&(s[r]=i.needsContext?b(r,this).index(f)>=0:b.find(r,this,null,[f]).length),s[r]&&s.push(i);s.length&&u.push({elem:f,handlers:s})}return n.length>a&&u.push({elem:this,handlers:n.slice(a)}),u},fix:function(e){if(e[b.expando])return e;var t,n,r,i=e.type,o=e,u=this.fixHooks[i];u||(this.fixHooks[i]=u=tt.test(i)?this.mouseHooks:et.test(i)?this.keyHooks:{}),r=u.props?this.props.concat(u.props):this.props,e=new b.Event(o),t=r.length;while(t--)n=r[t],e[n]=o[n];return e.target||(e.target=o.srcElement||s),3===e.target.nodeType&&(e.target=e.target.parentNode),e.metaKey=!!e.metaKey,u.filter?u.filter(e,o):e},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,n){var r,i,o,u=n.button,a=n.fromElement;return null==e.pageX&&null!=n.clientX&&(i=e.target.ownerDocument||s,o=i.documentElement,r=i.body,e.pageX=n.clientX+(o&&o.scrollLeft||r&&r.scrollLeft||0)-(o&&o.clientLeft||r&&r.clientLeft||0),e.pageY=n.clientY+(o&&o.scrollTop||r&&r.scrollTop||0)-(o&&o.clientTop||r&&r.clientTop||0)),!e.relatedTarget&&a&&(e.relatedTarget=a===e.target?n.toElement:a),e.which||u===t||(e.which=1&u?1:2&u?3:4&u?2:0),e}},special:{load:{noBubble:!0},click:{trigger:function(){return b.nodeName(this,"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):t}},focus:{trigger:function(){if(this!==s.activeElement&&this.focus)try{return this.focus(),!1}catch(e){}},delegateType:"focusin"},blur:{trigger:function(){return this===s.activeElement&&this.blur?(this.blur(),!1):t},delegateType:"focusout"},beforeunload:{postDispatch:function(e){e.result!==t&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,n,r){var i=b.extend(new b.Event,n,{type:e,isSimulated:!0,originalEvent:{}});r?b.event.trigger(i,null,t):b.event.dispatch.call(t,i),i.isDefaultPrevented()&&n.preventDefault()}},b.removeEvent=s.removeEventListener?function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)}:function(e,t,n){var r="on"+t;e.detachEvent&&(typeof e[r]===i&&(e[r]=null),e.detachEvent(r,n))},b.Event=function(e,n){return this instanceof b.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||e.returnValue===!1||e.getPreventDefault&&e.getPreventDefault()?it:st):this.type=e,n&&b.extend(this,n),this.timeStamp=e&&e.timeStamp||b.now(),this[b.expando]=!0,t):new b.Event(e,n)},b.Event.prototype={isDefaultPrevented:st,isPropagationStopped:st,isImmediatePropagationStopped:st,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=it,e&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=it,e&&(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=it,this.stopPropagation()}},b.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){b.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=this,i=e.relatedTarget,s=e.handleObj;return(!i||i!==r&&!b.contains(r,i))&&(e.type=s.origType,n=s.handler.apply(this,arguments),e.type=t),n}}}),b.support.submitBubbles||(b.event.special.submit={setup:function(){return b.nodeName(this,"form")?!1:(b.event.add(this,"click._submit keypress._submit",function(e){var n=e.target,r=b.nodeName(n,"input")||b.nodeName(n,"button")?n.form:t;r&&!b._data(r,"submitBubbles")&&(b.event.add(r,"submit._submit",function(e){e._submit_bubble=!0}),b._data(r,"submitBubbles",!0))}),t)},postDispatch:function(e){e._submit_bubble&&(delete e._submit_bubble,this.parentNode&&!e.isTrigger&&b.event.simulate("submit",this.parentNode,e,!0))},teardown:function(){return b.nodeName(this,"form")?!1:(b.event.remove(this,"._submit"),t)}}),b.support.changeBubbles||(b.event.special.change={setup:function(){return Z.test(this.nodeName)?(("checkbox"===this.type||"radio"===this.type)&&(b.event.add(this,"propertychange._change",function(e){"checked"===e.originalEvent.propertyName&&(this._just_changed=!0)}),b.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1),b.event.simulate("change",this,e,!0)})),!1):(b.event.add(this,"beforeactivate._change",function(e){var t=e.target;Z.test(t.nodeName)&&!b._data(t,"changeBubbles")&&(b.event.add(t,"change._change",function(e){!this.parentNode||e.isSimulated||e.isTrigger||b.event.simulate("change",this.parentNode,e,!0)}),b._data(t,"changeBubbles",!0))}),t)},handle:function(e){var n=e.target;return this!==n||e.isSimulated||e.isTrigger||"radio"!==n.type&&"checkbox"!==n.type?e.handleObj.handler.apply(this,arguments):t},teardown:function(){return b.event.remove(this,"._change"),!Z.test(this.nodeName)}}),b.support.focusinBubbles||b.each({focus:"focusin",blur:"focusout"},function(e,t){var n=0,r=function(e){b.event.simulate(t,e.target,b.event.fix(e),!0)};b.event.special[t]={setup:function(){0===n++&&s.addEventListener(e,r,!0)},teardown:function(){0===--n&&s.removeEventListener(e,r,!0)}}}),b.fn.extend({on:function(e,n,r,i,s){var o,u;if("object"==typeof e){"string"!=typeof n&&(r=r||n,n=t);for(o in e)this.on(o,n,r,e[o],s);return this}if(null==r&&null==i?(i=n,r=n=t):null==i&&("string"==typeof n?(i=r,r=t):(i=r,r=n,n=t)),i===!1)i=st;else if(!i)return this;return 1===s&&(u=i,i=function(e){return b().off(e),u.apply(this,arguments)},i.guid=u.guid||(u.guid=b.guid++)),this.each(function(){b.event.add(this,e,i,r,n)})},one:function(e,t,n,r){return this.on(e,t,n,r,1)},off:function(e,n,r){var i,s;if(e&&e.preventDefault&&e.handleObj)return i=e.handleObj,b(e.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler),this;if("object"==typeof e){for(s in e)this.off(s,n,e[s]);return this}return(n===!1||"function"==typeof n)&&(r=n,n=t),r===!1&&(r=st),this.each(function(){b.event.remove(this,e,r,n)})},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)},trigger:function(e,t){return this.each(function(){b.event.trigger(e,t,this)})},triggerHandler:function(e,n){var r=this[0];return r?b.event.trigger(e,n,r,!0):t}}),function(e,t){function rt(e){return J.test(e+"")}function it(){var e,t=[];return e=function(n,r){return t.push(n+=" ")>i.cacheLength&&delete e[t.shift()],e[n]=r}}function st(e){return e[w]=!0,e}function ot(e){var t=c.createElement("div");try{return e(t)}catch(n){return!1}finally{t=null}}function ut(e,t,n,r){var i,s,o,u,a,f,h,v,m,y;if((t?t.ownerDocument||t:E)!==c&&l(t),t=t||c,n=n||[],!e||"string"!=typeof e)return n;if(1!==(u=t.nodeType)&&9!==u)return[];if(!p&&!r){if(i=K.exec(e))if(o=i[1]){if(9===u){if(s=t.getElementById(o),!s||!s.parentNode)return n;if(s.id===o)return n.push(s),n}else if(t.ownerDocument&&(s=t.ownerDocument.getElementById(o))&&g(t,s)&&s.id===o)return n.push(s),n}else{if(i[2])return _.apply(n,D.call(t.getElementsByTagName(e),0)),n;if((o=i[3])&&S.getByClassName&&t.getElementsByClassName)return _.apply(n,D.call(t.getElementsByClassName(o),0)),n}if(S.qsa&&!d.test(e)){if(h=!0,v=w,m=t,y=9===u&&e,1===u&&"object"!==t.nodeName.toLowerCase()){f=ht(e),(h=t.getAttribute("id"))?v=h.replace(Y,"\\$&"):t.setAttribute("id",v),v="[id='"+v+"'] ",a=f.length;while(a--)f[a]=v+pt(f[a]);m=$.test(e)&&t.parentNode||t,y=f.join(",")}if(y)try{return _.apply(n,D.call(m.querySelectorAll(y),0)),n}catch(b){}finally{h||t.removeAttribute("id")}}}return Et(e.replace(R,"$1"),t,n,r)}function at(e,t){var n=t&&e,r=n&&(~t.sourceIndex||A)-(~e.sourceIndex||A);if(r)return r;if(n)while(n=n.nextSibling)if(n===t)return-1;return e?1:-1}function ft(e){return function(t){var n=t.nodeName.toLowerCase();return"input"===n&&t.type===e}}function lt(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function ct(e){return st(function(t){return t=+t,st(function(n,r){var i,s=e([],n.length,t),o=s.length;while(o--)n[i=s[o]]&&(n[i]=!(r[i]=n[i]))})})}function ht(e,t){var n,r,s,o,u,a,f,l=C[e+" "];if(l)return t?0:l.slice(0);u=e,a=[],f=i.preFilter;while(u){(!n||(r=U.exec(u)))&&(r&&(u=u.slice(r[0].length)||u),a.push(s=[])),n=!1,(r=z.exec(u))&&(n=r.shift(),s.push({value:n,type:r[0].replace(R," ")}),u=u.slice(n.length));for(o in i.filter)!(r=V[o].exec(u))||f[o]&&!(r=f[o](r))||(n=r.shift(),s.push({value:n,type:o,matches:r}),u=u.slice(n.length));if(!n)break}return t?u.length:u?ut.error(e):C(e,a).slice(0)}function pt(e){var t=0,n=e.length,r="";for(;n>t;t++)r+=e[t].value;return r}function dt(e,t,n){var i=t.dir,s=n&&"parentNode"===i,o=T++;return t.first?function(t,n,r){while(t=t[i])if(1===t.nodeType||s)return e(t,n,r)}:function(t,n,u){var a,f,l,c=x+" "+o;if(u){while(t=t[i])if((1===t.nodeType||s)&&e(t,n,u))return!0}else while(t=t[i])if(1===t.nodeType||s)if(l=t[w]||(t[w]={}),(f=l[i])&&f[0]===c){if((a=f[1])===!0||a===r)return a===!0}else if(f=l[i]=[c],f[1]=e(t,n,u)||r,f[1]===!0)return!0}}function vt(e){return e.length>1?function(t,n,r){var i=e.length;while(i--)if(!e[i](t,n,r))return!1;return!0}:e[0]}function mt(e,t,n,r,i){var s,o=[],u=0,a=e.length,f=null!=t;for(;a>u;u++)(s=e[u])&&(!n||n(s,r,i))&&(o.push(s),f&&t.push(u));return o}function gt(e,t,n,r,i,s){return r&&!r[w]&&(r=gt(r)),i&&!i[w]&&(i=gt(i,s)),st(function(s,o,u,a){var f,l,c,h=[],p=[],d=o.length,v=s||wt(t||"*",u.nodeType?[u]:u,[]),m=!e||!s&&t?v:mt(v,h,e,u,a),g=n?i||(s?e:d||r)?[]:o:m;if(n&&n(m,g,u,a),r){f=mt(g,p),r(f,[],u,a),l=f.length;while(l--)(c=f[l])&&(g[p[l]]=!(m[p[l]]=c))}if(s){if(i||e){if(i){f=[],l=g.length;while(l--)(c=g[l])&&f.push(m[l]=c);i(null,g=[],f,a)}l=g.length;while(l--)(c=g[l])&&(f=i?P.call(s,c):h[l])>-1&&(s[f]=!(o[f]=c))}}else g=mt(g===o?g.splice(d,g.length):g),i?i(null,o,g,a):_.apply(o,g)})}function yt(e){var t,n,r,s=e.length,o=i.relative[e[0].type],u=o||i.relative[" "],a=o?1:0,l=dt(function(e){return e===t},u,!0),c=dt(function(e){return P.call(t,e)>-1},u,!0),h=[function(e,n,r){return!o&&(r||n!==f)||((t=n).nodeType?l(e,n,r):c(e,n,r))}];for(;s>a;a++)if(n=i.relative[e[a].type])h=[dt(vt(h),n)];else{if(n=i.filter[e[a].type].apply(null,e[a].matches),n[w]){for(r=++a;s>r;r++)if(i.relative[e[r].type])break;return gt(a>1&&vt(h),a>1&&pt(e.slice(0,a-1)).replace(R,"$1"),n,r>a&&yt(e.slice(a,r)),s>r&&yt(e=e.slice(r)),s>r&&pt(e))}h.push(n)}return vt(h)}function bt(e,t){var n=0,s=t.length>0,o=e.length>0,u=function(u,a,l,h,p){var d,v,m,g=[],y=0,b="0",w=u&&[],E=null!=p,S=f,T=u||o&&i.find.TAG("*",p&&a.parentNode||a),N=x+=null==S?1:Math.random()||.1;for(E&&(f=a!==c&&a,r=n);null!=(d=T[b]);b++){if(o&&d){v=0;while(m=e[v++])if(m(d,a,l)){h.push(d);break}E&&(x=N,r=++n)}s&&((d=!m&&d)&&y--,u&&w.push(d))}if(y+=b,s&&b!==y){v=0;while(m=t[v++])m(w,g,a,l);if(u){if(y>0)while(b--)w[b]||g[b]||(g[b]=M.call(h));g=mt(g)}_.apply(h,g),E&&!u&&g.length>0&&y+t.length>1&&ut.uniqueSort(h)}return E&&(x=N,f=S),w};return s?st(u):u}function wt(e,t,n){var r=0,i=t.length;for(;i>r;r++)ut(e,t[r],n);return n}function Et(e,t,n,r){var s,o,a,f,l,c=ht(e);if(!r&&1===c.length){if(o=c[0]=c[0].slice(0),o.length>2&&"ID"===(a=o[0]).type&&9===t.nodeType&&!p&&i.relative[o[1].type]){if(t=i.find.ID(a.matches[0].replace(et,tt),t)[0],!t)return n;e=e.slice(o.shift().value.length)}s=V.needsContext.test(e)?0:o.length;while(s--){if(a=o[s],i.relative[f=a.type])break;if((l=i.find[f])&&(r=l(a.matches[0].replace(et,tt),$.test(o[0].type)&&t.parentNode||t))){if(o.splice(s,1),e=r.length&&pt(o),!e)return _.apply(n,D.call(r,0)),n;break}}}return u(e,c)(r,t,p,n,$.test(e)),n}function St(){}var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,w="sizzle"+ -(new Date),E=e.document,S={},x=0,T=0,N=it(),C=it(),k=it(),L=typeof t,A=1<<31,O=[],M=O.pop,_=O.push,D=O.slice,P=O.indexOf||function(e){var t=0,n=this.length;for(;n>t;t++)if(this[t]===e)return t;return-1},H="[\\x20\\t\\r\\n\\f]",B="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",j=B.replace("w","w#"),F="([*^$|!~]?=)",I="\\["+H+"*("+B+")"+H+"*(?:"+F+H+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+j+")|)|)"+H+"*\\]",q=":("+B+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+I.replace(3,8)+")*)|.*)\\)|)",R=RegExp("^"+H+"+|((?:^|[^\\\\])(?:\\\\.)*)"+H+"+$","g"),U=RegExp("^"+H+"*,"+H+"*"),z=RegExp("^"+H+"*([\\x20\\t\\r\\n\\f>+~])"+H+"*"),W=RegExp(q),X=RegExp("^"+j+"$"),V={ID:RegExp("^#("+B+")"),CLASS:RegExp("^\\.("+B+")"),NAME:RegExp("^\\[name=['\"]?("+B+")['\"]?\\]"),TAG:RegExp("^("+B.replace("w","w*")+")"),ATTR:RegExp("^"+I),PSEUDO:RegExp("^"+q),CHILD:RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+H+"*(even|odd|(([+-]|)(\\d*)n|)"+H+"*(?:([+-]|)"+H+"*(\\d+)|))"+H+"*\\)|)","i"),needsContext:RegExp("^"+H+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+H+"*((?:-\\d)?\\d*)"+H+"*\\)|)(?=[^-]|$)","i")},$=/[\x20\t\r\n\f]*[+~]/,J=/^[^{]+\{\s*\[native code/,K=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,Q=/^(?:input|select|textarea|button)$/i,G=/^h\d$/i,Y=/'|\\/g,Z=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,et=/\\([\da-fA-F]{1,6}[\x20\t\r\n\f]?|.)/g,tt=function(e,t){var n="0x"+t-65536;return n!==n?t:0>n?String.fromCharCode(n+65536):String.fromCharCode(55296|n>>10,56320|1023&n)};try{D.call(E.documentElement.childNodes,0)[0].nodeType}catch(nt){D=function(e){var t,n=[];while(t=this[e++])n.push(t);return n}}o=ut.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?"HTML"!==t.nodeName:!1},l=ut.setDocument=function(e){var n=e?e.ownerDocument||e:E;return n!==c&&9===n.nodeType&&n.documentElement?(c=n,h=n.documentElement,p=o(n),S.tagNameNoComments=ot(function(e){return e.appendChild(n.createComment("")),!e.getElementsByTagName("*").length}),S.attributes=ot(function(e){e.innerHTML="<select></select>";var t=typeof e.lastChild.getAttribute("multiple");return"boolean"!==t&&"string"!==t}),S.getByClassName=ot(function(e){return e.innerHTML="<div class='hidden e'></div><div class='hidden'></div>",e.getElementsByClassName&&e.getElementsByClassName("e").length?(e.lastChild.className="e",2===e.getElementsByClassName("e").length):!1}),S.getByName=ot(function(e){e.id=w+0,e.innerHTML="<a name='"+w+"'></a><div name='"+w+"'></div>",h.insertBefore(e,h.firstChild);var t=n.getElementsByName&&n.getElementsByName(w).length===2+n.getElementsByName(w+0).length;return S.getIdNotName=!n.getElementById(w),h.removeChild(e),t}),i.attrHandle=ot(function(e){return e.innerHTML="<a href='#'></a>",e.firstChild&&typeof e.firstChild.getAttribute!==L&&"#"===e.firstChild.getAttribute("href")})?{}:{href:function(e){return e.getAttribute("href",2)},type:function(e){return e.getAttribute("type")}},S.getIdNotName?(i.find.ID=function(e,t){if(typeof t.getElementById!==L&&!p){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}},i.filter.ID=function(e){var t=e.replace(et,tt);return function(e){return e.getAttribute("id")===t}}):(i.find.ID=function(e,n){if(typeof n.getElementById!==L&&!p){var r=n.getElementById(e);return r?r.id===e||typeof r.getAttributeNode!==L&&r.getAttributeNode("id").value===e?[r]:t:[]}},i.filter.ID=function(e){var t=e.replace(et,tt);return function(e){var n=typeof e.getAttributeNode!==L&&e.getAttributeNode("id");return n&&n.value===t}}),i.find.TAG=S.tagNameNoComments?function(e,n){return typeof n.getElementsByTagName!==L?n.getElementsByTagName(e):t}:function(e,t){var n,r=[],i=0,s=t.getElementsByTagName(e);if("*"===e){while(n=s[i++])1===n.nodeType&&r.push(n);return r}return s},i.find.NAME=S.getByName&&function(e,n){return typeof n.getElementsByName!==L?n.getElementsByName(name):t},i.find.CLASS=S.getByClassName&&function(e,n){return typeof n.getElementsByClassName===L||p?t:n.getElementsByClassName(e)},v=[],d=[":focus"],(S.qsa=rt(n.querySelectorAll))&&(ot(function(e){e.innerHTML="<select><option selected=''></option></select>",e.querySelectorAll("[selected]").length||d.push("\\["+H+"*(?:checked|disabled|ismap|multiple|readonly|selected|value)"),e.querySelectorAll(":checked").length||d.push(":checked")}),ot(function(e){e.innerHTML="<input type='hidden' i=''/>",e.querySelectorAll("[i^='']").length&&d.push("[*^$]="+H+"*(?:\"\"|'')"),e.querySelectorAll(":enabled").length||d.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),d.push(",.*:")})),(S.matchesSelector=rt(m=h.matchesSelector||h.mozMatchesSelector||h.webkitMatchesSelector||h.oMatchesSelector||h.msMatchesSelector))&&ot(function(e){S.disconnectedMatch=m.call(e,"div"),m.call(e,"[s!='']:x"),v.push("!=",q)}),d=RegExp(d.join("|")),v=RegExp(v.join("|")),g=rt(h.contains)||h.compareDocumentPosition?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)while(t=t.parentNode)if(t===e)return!0;return!1},y=h.compareDocumentPosition?function(e,t){var r;return e===t?(a=!0,0):(r=t.compareDocumentPosition&&e.compareDocumentPosition&&e.compareDocumentPosition(t))?1&r||e.parentNode&&11===e.parentNode.nodeType?e===n||g(E,e)?-1:t===n||g(E,t)?1:0:4&r?-1:1:e.compareDocumentPosition?-1:1}:function(e,t){var r,i=0,s=e.parentNode,o=t.parentNode,u=[e],f=[t];if(e===t)return a=!0,0;if(!s||!o)return e===n?-1:t===n?1:s?-1:o?1:0;if(s===o)return at(e,t);r=e;while(r=r.parentNode)u.unshift(r);r=t;while(r=r.parentNode)f.unshift(r);while(u[i]===f[i])i++;return i?at(u[i],f[i]):u[i]===E?-1:f[i]===E?1:0},a=!1,[0,0].sort(y),S.detectDuplicates=a,c):c},ut.matches=function(e,t){return ut(e,null,null,t)},ut.matchesSelector=function(e,t){if((e.ownerDocument||e)!==c&&l(e),t=t.replace(Z,"='$1']"),!(!S.matchesSelector||p||v&&v.test(t)||d.test(t)))try{var n=m.call(e,t);if(n||S.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(r){}return ut(t,c,null,[e]).length>0},ut.contains=function(e,t){return(e.ownerDocument||e)!==c&&l(e),g(e,t)},ut.attr=function(e,t){var n;return(e.ownerDocument||e)!==c&&l(e),p||(t=t.toLowerCase()),(n=i.attrHandle[t])?n(e):p||S.attributes?e.getAttribute(t):((n=e.getAttributeNode(t))||e.getAttribute(t))&&e[t]===!0?t:n&&n.specified?n.value:null},ut.error=function(e){throw Error("Syntax error, unrecognized expression: "+e)},ut.uniqueSort=function(e){var t,n=[],r=1,i=0;if(a=!S.detectDuplicates,e.sort(y),a){for(;t=e[r];r++)t===e[r-1]&&(i=n.push(r));while(i--)e.splice(n[i],1)}return e};s=ut.getText=function(e){var t,n="",r=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=s(e)}else if(3===i||4===i)return e.nodeValue}else for(;t=e[r];r++)n+=s(t);return n},i=ut.selectors={cacheLength:50,createPseudo:st,match:V,find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(et,tt),e[3]=(e[4]||e[5]||"").replace(et,tt),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||ut.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&ut.error(e[0]),e},PSEUDO:function(e){var t,n=!e[5]&&e[2];return V.CHILD.test(e[0])?null:(e[4]?e[2]=e[4]:n&&W.test(n)&&(t=ht(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){return"*"===e?function(){return!0}:(e=e.replace(et,tt).toLowerCase(),function(t){return t.nodeName&&t.nodeName.toLowerCase()===e})},CLASS:function(e){var t=N[e+" "];return t||(t=RegExp("(^|"+H+")"+e+"("+H+"|$)"))&&N(e,function(e){return t.test(e.className||typeof e.getAttribute!==L&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r){var i=ut.attr(r,e);return null==i?"!="===t:t?(i+="","="===t?i===n:"!="===t?i!==n:"^="===t?n&&0===i.indexOf(n):"*="===t?n&&i.indexOf(n)>-1:"$="===t?n&&i.slice(-n.length)===n:"~="===t?(" "+i+" ").indexOf(n)>-1:"|="===t?i===n||i.slice(0,n.length+1)===n+"-":!1):!0}},CHILD:function(e,t,n,r,i){var s="nth"!==e.slice(0,3),o="last"!==e.slice(-4),u="of-type"===t;return 1===r&&0===i?function(e){return!!e.parentNode}:function(t,n,a){var f,l,c,h,p,d,v=s!==o?"nextSibling":"previousSibling",m=t.parentNode,g=u&&t.nodeName.toLowerCase(),y=!a&&!u;if(m){if(s){while(v){c=t;while(c=c[v])if(u?c.nodeName.toLowerCase()===g:1===c.nodeType)return!1;d=v="only"===e&&!d&&"nextSibling"}return!0}if(d=[o?m.firstChild:m.lastChild],o&&y){l=m[w]||(m[w]={}),f=l[e]||[],p=f[0]===x&&f[1],h=f[0]===x&&f[2],c=p&&m.childNodes[p];while(c=++p&&c&&c[v]||(h=p=0)||d.pop())if(1===c.nodeType&&++h&&c===t){l[e]=[x,p,h];break}}else if(y&&(f=(t[w]||(t[w]={}))[e])&&f[0]===x)h=f[1];else while(c=++p&&c&&c[v]||(h=p=0)||d.pop())if((u?c.nodeName.toLowerCase()===g:1===c.nodeType)&&++h&&(y&&((c[w]||(c[w]={}))[e]=[x,h]),c===t))break;return h-=i,h===r||0===h%r&&h/r>=0}}},PSEUDO:function(e,t){var n,r=i.pseudos[e]||i.setFilters[e.toLowerCase()]||ut.error("unsupported pseudo: "+e);return r[w]?r(t):r.length>1?(n=[e,e,"",t],i.setFilters.hasOwnProperty(e.toLowerCase())?st(function(e,n){var i,s=r(e,t),o=s.length;while(o--)i=P.call(e,s[o]),e[i]=!(n[i]=s[o])}):function(e){return r(e,0,n)}):r}},pseudos:{not:st(function(e){var t=[],n=[],r=u(e.replace(R,"$1"));return r[w]?st(function(e,t,n,i){var s,o=r(e,null,i,[]),u=e.length;while(u--)(s=o[u])&&(e[u]=!(t[u]=s))}):function(e,i,s){return t[0]=e,r(t,null,s,n),!n.pop()}}),has:st(function(e){return function(t){return ut(e,t).length>0}}),contains:st(function(e){return function(t){return(t.textContent||t.innerText||s(t)).indexOf(e)>-1}}),lang:st(function(e){return X.test(e||"")||ut.error("unsupported lang: "+e),e=e.replace(et,tt).toLowerCase(),function(t){var n;do if(n=p?t.getAttribute("xml:lang")||t.getAttribute("lang"):t.lang)return n=n.toLowerCase(),n===e||0===n.indexOf(e+"-");while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===h},focus:function(e){return e===c.activeElement&&(!c.hasFocus||c.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeName>"@"||3===e.nodeType||4===e.nodeType)return!1;return!0},parent:function(e){return!i.pseudos.empty(e)},header:function(e){return G.test(e.nodeName)},input:function(e){return Q.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||t.toLowerCase()===e.type)},first:ct(function(){return[0]}),last:ct(function(e,t){return[t-1]}),eq:ct(function(e,t,n){return[0>n?n+t:n]}),even:ct(function(e,t){var n=0;for(;t>n;n+=2)e.push(n);return e}),odd:ct(function(e,t){var n=1;for(;t>n;n+=2)e.push(n);return e}),lt:ct(function(e,t,n){var r=0>n?n+t:n;for(;--r>=0;)e.push(r);return e}),gt:ct(function(e,t,n){var r=0>n?n+t:n;for(;t>++r;)e.push(r);return e})}};for(n in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})i.pseudos[n]=ft(n);for(n in{submit:!0,reset:!0})i.pseudos[n]=lt(n);u=ut.compile=function(e,t){var n,r=[],i=[],s=k[e+" "];if(!s){t||(t=ht(e)),n=t.length;while(n--)s=yt(t[n]),s[w]?r.push(s):i.push(s);s=k(e,bt(i,r))}return s};i.pseudos.nth=i.pseudos.eq;i.filters=St.prototype=i.pseudos,i.setFilters=new St,l(),ut.attr=b.attr,b.find=ut,b.expr=ut.selectors,b.expr[":"]=b.expr.pseudos,b.unique=ut.uniqueSort,b.text=ut.getText,b.isXMLDoc=ut.isXML,b.contains=ut.contains}(e);var ot=/Until$/,ut=/^(?:parents|prev(?:Until|All))/,at=/^.[^:#\[\.,]*$/,ft=b.expr.match.needsContext,lt={children:!0,contents:!0,next:!0,prev:!0};b.fn.extend({find:function(e){var t,n,r,i=this.length;if("string"!=typeof e)return r=this,this.pushStack(b(e).filter(function(){for(t=0;i>t;t++)if(b.contains(r[t],this))return!0}));for(n=[],t=0;i>t;t++)b.find(e,this[t],n);return n=this.pushStack(i>1?b.unique(n):n),n.selector=(this.selector?this.selector+" ":"")+e,n},has:function(e){var t,n=b(e,this),r=n.length;return this.filter(function(){for(t=0;r>t;t++)if(b.contains(this,n[t]))return!0})},not:function(e){return this.pushStack(ht(this,e,!1))},filter:function(e){return this.pushStack(ht(this,e,!0))},is:function(e){return!!e&&("string"==typeof e?ft.test(e)?b(e,this.context).index(this[0])>=0:b.filter(e,this).length>0:this.filter(e).length>0)},closest:function(e,t){var n,r=0,i=this.length,s=[],o=ft.test(e)||"string"!=typeof e?b(e,t||this.context):0;for(;i>r;r++){n=this[r];while(n&&n.ownerDocument&&n!==t&&11!==n.nodeType){if(o?o.index(n)>-1:b.find.matchesSelector(n,e)){s.push(n);break}n=n.parentNode}}return this.pushStack(s.length>1?b.unique(s):s)},index:function(e){return e?"string"==typeof e?b.inArray(this[0],b(e)):b.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){var n="string"==typeof e?b(e,t):b.makeArray(e&&e.nodeType?[e]:e),r=b.merge(this.get(),n);return this.pushStack(b.unique(r))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),b.fn.andSelf=b.fn.addBack;b.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return b.dir(e,"parentNode")},parentsUntil:function(e,t,n){return b.dir(e,"parentNode",n)},next:function(e){return ct(e,"nextSibling")},prev:function(e){return ct(e,"previousSibling")},nextAll:function(e){return b.dir(e,"nextSibling")},prevAll:function(e){return b.dir(e,"previousSibling")},nextUntil:function(e,t,n){return b.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return b.dir(e,"previousSibling",n)},siblings:function(e){return b.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return b.sibling(e.firstChild)},contents:function(e){return b.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:b.merge([],e.childNodes)}},function(e,t){b.fn[e]=function(n,r){var i=b.map(this,t,n);return ot.test(e)||(r=n),r&&"string"==typeof r&&(i=b.filter(r,i)),i=this.length>1&&!lt[e]?b.unique(i):i,this.length>1&&ut.test(e)&&(i=i.reverse()),this.pushStack(i)}}),b.extend({filter:function(e,t,n){return n&&(e=":not("+e+")"),1===t.length?b.find.matchesSelector(t[0],e)?[t[0]]:[]:b.find.matches(e,t)},dir:function(e,n,r){var i=[],s=e[n];while(s&&9!==s.nodeType&&(r===t||1!==s.nodeType||!b(s).is(r)))1===s.nodeType&&i.push(s),s=s[n];return i},sibling:function(e,t){var n=[];for(;e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n}});var dt="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",vt=/ jQuery\d+="(?:null|\d+)"/g,mt=RegExp("<(?:"+dt+")[\\s/>]","i"),gt=/^\s+/,yt=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,bt=/<([\w:]+)/,wt=/<tbody/i,Et=/<|&#?\w+;/,St=/<(?:script|style|link)/i,xt=/^(?:checkbox|radio)$/i,Tt=/checked\s*(?:[^=]|=\s*.checked.)/i,Nt=/^$|\/(?:java|ecma)script/i,Ct=/^true\/(.*)/,kt=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,Lt={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:b.support.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},At=pt(s),Ot=At.appendChild(s.createElement("div"));Lt.optgroup=Lt.option,Lt.tbody=Lt.tfoot=Lt.colgroup=Lt.caption=Lt.thead,Lt.th=Lt.td,b.fn.extend({text:function(e){return b.access(this,function(e){return e===t?b.text(this):this.empty().append((this[0]&&this[0].ownerDocument||s).createTextNode(e))},null,e,arguments.length)},wrapAll:function(e){if(b.isFunction(e))return this.each(function(t){b(this).wrapAll(e.call(this,t))});if(this[0]){var t=b(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstChild&&1===e.firstChild.nodeType)e=e.firstChild;return e}).append(this)}return this},wrapInner:function(e){return b.isFunction(e)?this.each(function(t){b(this).wrapInner(e.call(this,t))}):this.each(function(){var t=b(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=b.isFunction(e);return this.each(function(n){b(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){b.nodeName(this,"body")||b(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(e){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&this.appendChild(e)})},prepend:function(){return this.domManip(arguments,!0,function(e){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&this.insertBefore(e,this.firstChild)})},before:function(){return this.domManip(arguments,!1,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,!1,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){var n,r=0;for(;null!=(n=this[r]);r++)(!e||b.filter(e,[n]).length>0)&&(t||1!==n.nodeType||b.cleanData(jt(n)),n.parentNode&&(t&&b.contains(n.ownerDocument,n)&&Pt(jt(n,"script")),n.parentNode.removeChild(n)));return this},empty:function(){var e,t=0;for(;null!=(e=this[t]);t++){1===e.nodeType&&b.cleanData(jt(e,!1));while(e.firstChild)e.removeChild(e.firstChild);e.options&&b.nodeName(e,"select")&&(e.options.length=0)}return this},clone:function(e,t){return e=null==e?!1:e,t=null==t?e:t,this.map(function(){return b.clone(this,e,t)})},html:function(e){return b.access(this,function(e){var n=this[0]||{},r=0,i=this.length;if(e===t)return 1===n.nodeType?n.innerHTML.replace(vt,""):t;if(!("string"!=typeof e||St.test(e)||!b.support.htmlSerialize&&mt.test(e)||!b.support.leadingWhitespace&&gt.test(e)||Lt[(bt.exec(e)||["",""])[1].toLowerCase()])){e=e.replace(yt,"<$1></$2>");try{for(;i>r;r++)n=this[r]||{},1===n.nodeType&&(b.cleanData(jt(n,!1)),n.innerHTML=e);n=0}catch(s){}}n&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(e){var t=b.isFunction(e);return t||"string"==typeof e||(e=b(e).not(this).detach()),this.domManip([e],!0,function(e){var t=this.nextSibling,n=this.parentNode;n&&(b(this).remove(),n.insertBefore(e,t))})},detach:function(e){return this.remove(e,!0)},domManip:function(e,n,r){e=h.apply([],e);var i,s,o,u,a,f,l=0,c=this.length,p=this,d=c-1,v=e[0],m=b.isFunction(v);if(m||!(1>=c||"string"!=typeof v||b.support.checkClone)&&Tt.test(v))return this.each(function(i){var s=p.eq(i);m&&(e[0]=v.call(this,i,n?s.html():t)),s.domManip(e,n,r)});if(c&&(f=b.buildFragment(e,this[0].ownerDocument,!1,this),i=f.firstChild,1===f.childNodes.length&&(f=i),i)){for(n=n&&b.nodeName(i,"tr"),u=b.map(jt(f,"script"),_t),o=u.length;c>l;l++)s=f,l!==d&&(s=b.clone(s,!0,!0),o&&b.merge(u,jt(s,"script"))),r.call(n&&b.nodeName(this[l],"table")?Mt(this[l],"tbody"):this[l],s,l);if(o)for(a=u[u.length-1].ownerDocument,b.map(u,Dt),l=0;o>l;l++)s=u[l],Nt.test(s.type||"")&&!b._data(s,"globalEval")&&b.contains(a,s)&&(s.src?b.ajax({url:s.src,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0}):b.globalEval((s.text||s.textContent||s.innerHTML||"").replace(kt,"")));f=i=null}return this}});b.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){b.fn[e]=function(e){var n,r=0,i=[],s=b(e),o=s.length-1;for(;o>=r;r++)n=r===o?this:this.clone(!0),b(s[r])[t](n),p.apply(i,n.get());return this.pushStack(i)}});b.extend({clone:function(e,t,n){var r,i,s,o,u,a=b.contains(e.ownerDocument,e);if(b.support.html5Clone||b.isXMLDoc(e)||!mt.test("<"+e.nodeName+">")?s=e.cloneNode(!0):(Ot.innerHTML=e.outerHTML,Ot.removeChild(s=Ot.firstChild)),!(b.support.noCloneEvent&&b.support.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||b.isXMLDoc(e)))for(r=jt(s),u=jt(e),o=0;null!=(i=u[o]);++o)r[o]&&Bt(i,r[o]);if(t)if(n)for(u=u||jt(e),r=r||jt(s),o=0;null!=(i=u[o]);o++)Ht(i,r[o]);else Ht(e,s);return r=jt(s,"script"),r.length>0&&Pt(r,!a&&jt(e,"script")),r=u=i=null,s},buildFragment:function(e,t,n,r){var i,s,o,u,a,f,l,c=e.length,h=pt(t),p=[],d=0;for(;c>d;d++)if(s=e[d],s||0===s)if("object"===b.type(s))b.merge(p,s.nodeType?[s]:s);else if(Et.test(s)){u=u||h.appendChild(t.createElement("div")),a=(bt.exec(s)||["",""])[1].toLowerCase(),l=Lt[a]||Lt._default,u.innerHTML=l[1]+s.replace(yt,"<$1></$2>")+l[2],i=l[0];while(i--)u=u.lastChild;if(!b.support.leadingWhitespace&&gt.test(s)&&p.push(t.createTextNode(gt.exec(s)[0])),!b.support.tbody){s="table"!==a||wt.test(s)?"<table>"!==l[1]||wt.test(s)?0:u:u.firstChild,i=s&&s.childNodes.length;while(i--)b.nodeName(f=s.childNodes[i],"tbody")&&!f.childNodes.length&&s.removeChild(f)}b.merge(p,u.childNodes),u.textContent="";while(u.firstChild)u.removeChild(u.firstChild);u=h.lastChild}else p.push(t.createTextNode(s));u&&h.removeChild(u),b.support.appendChecked||b.grep(jt(p,"input"),Ft),d=0;while(s=p[d++])if((!r||-1===b.inArray(s,r))&&(o=b.contains(s.ownerDocument,s),u=jt(h.appendChild(s),"script"),o&&Pt(u),n)){i=0;while(s=u[i++])Nt.test(s.type||"")&&n.push(s)}return u=null,h},cleanData:function(e,t){var n,r,s,o,u=0,a=b.expando,f=b.cache,c=b.support.deleteExpando,h=b.event.special;for(;null!=(n=e[u]);u++)if((t||b.acceptData(n))&&(s=n[a],o=s&&f[s])){if(o.events)for(r in o.events)h[r]?b.event.remove(n,r):b.removeEvent(n,r,o.handle);f[s]&&(delete f[s],c?delete n[a]:typeof n.removeAttribute!==i?n.removeAttribute(a):n[a]=null,l.push(s))}}});var It,qt,Rt,Ut=/alpha\([^)]*\)/i,zt=/opacity\s*=\s*([^)]*)/,Wt=/^(top|right|bottom|left)$/,Xt=/^(none|table(?!-c[ea]).+)/,Vt=/^margin/,$t=RegExp("^("+w+")(.*)$","i"),Jt=RegExp("^("+w+")(?!px)[a-z%]+$","i"),Kt=RegExp("^([+-])=("+w+")","i"),Qt={BODY:"block"},Gt={position:"absolute",visibility:"hidden",display:"block"},Yt={letterSpacing:0,fontWeight:400},Zt=["Top","Right","Bottom","Left"],en=["Webkit","O","Moz","ms"];b.fn.extend({css:function(e,n){return b.access(this,function(e,n,r){var i,s,o={},u=0;if(b.isArray(n)){for(s=qt(e),i=n.length;i>u;u++)o[n[u]]=b.css(e,n[u],!1,s);return o}return r!==t?b.style(e,n,r):b.css(e,n)},e,n,arguments.length>1)},show:function(){return rn(this,!0)},hide:function(){return rn(this)},toggle:function(e){var t="boolean"==typeof e;return this.each(function(){(t?e:nn(this))?b(this).show():b(this).hide()})}}),b.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Rt(e,"opacity");return""===n?"1":n}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":b.support.cssFloat?"cssFloat":"styleFloat"},style:function(e,n,r,i){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var s,o,u,a=b.camelCase(n),f=e.style;if(n=b.cssProps[a]||(b.cssProps[a]=tn(f,a)),u=b.cssHooks[n]||b.cssHooks[a],r===t)return u&&"get"in u&&(s=u.get(e,!1,i))!==t?s:f[n];if(o=typeof r,"string"===o&&(s=Kt.exec(r))&&(r=(s[1]+1)*s[2]+parseFloat(b.css(e,n)),o="number"),!(null==r||"number"===o&&isNaN(r)||("number"!==o||b.cssNumber[a]||(r+="px"),b.support.clearCloneStyle||""!==r||0!==n.indexOf("background")||(f[n]="inherit"),u&&"set"in u&&(r=u.set(e,r,i))===t)))try{f[n]=r}catch(l){}}},css:function(e,n,r,i){var s,o,u,a=b.camelCase(n);return n=b.cssProps[a]||(b.cssProps[a]=tn(e.style,a)),u=b.cssHooks[n]||b.cssHooks[a],u&&"get"in u&&(o=u.get(e,!0,r)),o===t&&(o=Rt(e,n,i)),"normal"===o&&n in Yt&&(o=Yt[n]),""===r||r?(s=parseFloat(o),r===!0||b.isNumeric(s)?s||0:o):o},swap:function(e,t,n,r){var i,s,o={};for(s in t)o[s]=e.style[s],e.style[s]=t[s];i=n.apply(e,r||[]);for(s in t)e.style[s]=o[s];return i}}),e.getComputedStyle?(qt=function(t){return e.getComputedStyle(t,null)},Rt=function(e,n,r){var i,s,o,u=r||qt(e),a=u?u.getPropertyValue(n)||u[n]:t,f=e.style;return u&&(""!==a||b.contains(e.ownerDocument,e)||(a=b.style(e,n)),Jt.test(a)&&Vt.test(n)&&(i=f.width,s=f.minWidth,o=f.maxWidth,f.minWidth=f.maxWidth=f.width=a,a=u.width,f.width=i,f.minWidth=s,f.maxWidth=o)),a}):s.documentElement.currentStyle&&(qt=function(e){return e.currentStyle},Rt=function(e,n,r){var i,s,o,u=r||qt(e),a=u?u[n]:t,f=e.style;return null==a&&f&&f[n]&&(a=f[n]),Jt.test(a)&&!Wt.test(n)&&(i=f.left,s=e.runtimeStyle,o=s&&s.left,o&&(s.left=e.currentStyle.left),f.left="fontSize"===n?"1em":a,a=f.pixelLeft+"px",f.left=i,o&&(s.left=o)),""===a?"auto":a});b.each(["height","width"],function(e,n){b.cssHooks[n]={get:function(e,r,i){return r?0===e.offsetWidth&&Xt.test(b.css(e,"display"))?b.swap(e,Gt,function(){return un(e,n,i)}):un(e,n,i):t},set:function(e,t,r){var i=r&&qt(e);return sn(e,t,r?on(e,n,r,b.support.boxSizing&&"border-box"===b.css(e,"boxSizing",!1,i),i):0)}}}),b.support.opacity||(b.cssHooks.opacity={get:function(e,t){return zt.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":t?"1":""},set:function(e,t){var n=e.style,r=e.currentStyle,i=b.isNumeric(t)?"alpha(opacity="+100*t+")":"",s=r&&r.filter||n.filter||"";n.zoom=1,(t>=1||""===t)&&""===b.trim(s.replace(Ut,""))&&n.removeAttribute&&(n.removeAttribute("filter"),""===t||r&&!r.filter)||(n.filter=Ut.test(s)?s.replace(Ut,i):s+" "+i)}}),b(function(){b.support.reliableMarginRight||(b.cssHooks.marginRight={get:function(e,n){return n?b.swap(e,{display:"inline-block"},Rt,[e,"marginRight"]):t}}),!b.support.pixelPosition&&b.fn.position&&b.each(["top","left"],function(e,n){b.cssHooks[n]={get:function(e,r){return r?(r=Rt(e,n),Jt.test(r)?b(e).position()[n]+"px":r):t}}})}),b.expr&&b.expr.filters&&(b.expr.filters.hidden=function(e){return 0>=e.offsetWidth&&0>=e.offsetHeight||!b.support.reliableHiddenOffsets&&"none"===(e.style&&e.style.display||b.css(e,"display"))},b.expr.filters.visible=function(e){return!b.expr.filters.hidden(e)}),b.each({margin:"",padding:"",border:"Width"},function(e,t){b.cssHooks[e+t]={expand:function(n){var r=0,i={},s="string"==typeof n?n.split(" "):[n];for(;4>r;r++)i[e+Zt[r]+t]=s[r]||s[r-2]||s[0];return i}},Vt.test(e)||(b.cssHooks[e+t].set=sn)});var ln=/%20/g,cn=/\[\]$/,hn=/\r?\n/g,pn=/^(?:submit|button|image|reset|file)$/i,dn=/^(?:input|select|textarea|keygen)/i;b.fn.extend({serialize:function(){return b.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=b.prop(this,"elements");return e?b.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!b(this).is(":disabled")&&dn.test(this.nodeName)&&!pn.test(e)&&(this.checked||!xt.test(e))}).map(function(e,t){var n=b(this).val();return null==n?null:b.isArray(n)?b.map(n,function(e){return{name:t.name,value:e.replace(hn,"\r\n")}}):{name:t.name,value:n.replace(hn,"\r\n")}}).get()}}),b.param=function(e,n){var r,i=[],s=function(e,t){t=b.isFunction(t)?t():null==t?"":t,i[i.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(n===t&&(n=b.ajaxSettings&&b.ajaxSettings.traditional),b.isArray(e)||e.jquery&&!b.isPlainObject(e))b.each(e,function(){s(this.name,this.value)});else for(r in e)vn(r,e[r],n,s);return i.join("&").replace(ln,"+")};b.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){b.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}),b.fn.hover=function(e,t){return this.mouseenter(e).mouseleave(t||e)};var mn,gn,yn=b.now(),bn=/\?/,wn=/#.*$/,En=/([?&])_=[^&]*/,Sn=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,xn=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Tn=/^(?:GET|HEAD)$/,Nn=/^\/\//,Cn=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,kn=b.fn.load,Ln={},An={},On="*/".concat("*");try{gn=o.href}catch(Mn){gn=s.createElement("a"),gn.href="",gn=gn.href}mn=Cn.exec(gn.toLowerCase())||[];b.fn.load=function(e,n,r){if("string"!=typeof e&&kn)return kn.apply(this,arguments);var i,s,o,u=this,a=e.indexOf(" ");return a>=0&&(i=e.slice(a,e.length),e=e.slice(0,a)),b.isFunction(n)?(r=n,n=t):n&&"object"==typeof n&&(o="POST"),u.length>0&&b.ajax({url:e,type:o,dataType:"html",data:n}).done(function(e){s=arguments,u.html(i?b("<div>").append(b.parseHTML(e)).find(i):e)}).complete(r&&function(e,t){u.each(r,s||[e.responseText,t,e])}),this},b.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){b.fn[t]=function(e){return this.on(t,e)}}),b.each(["get","post"],function(e,n){b[n]=function(e,r,i,s){return b.isFunction(r)&&(s=s||i,i=r,r=t),b.ajax({url:e,type:n,dataType:s,data:r,success:i})}}),b.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:gn,type:"GET",isLocal:xn.test(mn[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":On,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":e.String,"text html":!0,"text json":b.parseJSON,"text xml":b.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Pn(Pn(e,b.ajaxSettings),t):Pn(b.ajaxSettings,e)},ajaxPrefilter:_n(Ln),ajaxTransport:_n(An),ajax:function(e,n){function N(e,n,r,i){var l,g,y,E,S,T=n;2!==w&&(w=2,u&&clearTimeout(u),f=t,o=i||"",x.readyState=e>0?4:0,r&&(E=Hn(c,x,r)),e>=200&&300>e||304===e?(c.ifModified&&(S=x.getResponseHeader("Last-Modified"),S&&(b.lastModified[s]=S),S=x.getResponseHeader("etag"),S&&(b.etag[s]=S)),204===e?(l=!0,T="nocontent"):304===e?(l=!0,T="notmodified"):(l=Bn(c,E),T=l.state,g=l.data,y=l.error,l=!y)):(y=T,(e||!T)&&(T="error",0>e&&(e=0))),x.status=e,x.statusText=(n||T)+"",l?d.resolveWith(h,[g,T,x]):d.rejectWith(h,[x,T,y]),x.statusCode(m),m=t,a&&p.trigger(l?"ajaxSuccess":"ajaxError",[x,c,l?g:y]),v.fireWith(h,[x,T]),a&&(p.trigger("ajaxComplete",[x,c]),--b.active||b.event.trigger("ajaxStop")))}"object"==typeof e&&(n=e,e=t),n=n||{};var r,i,s,o,u,a,f,l,c=b.ajaxSetup({},n),h=c.context||c,p=c.context&&(h.nodeType||h.jquery)?b(h):b.event,d=b.Deferred(),v=b.Callbacks("once memory"),m=c.statusCode||{},g={},y={},w=0,S="canceled",x={readyState:0,getResponseHeader:function(e){var t;if(2===w){if(!l){l={};while(t=Sn.exec(o))l[t[1].toLowerCase()]=t[2]}t=l[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===w?o:null},setRequestHeader:function(e,t){var n=e.toLowerCase();return w||(e=y[n]=y[n]||e,g[e]=t),this},overrideMimeType:function(e){return w||(c.mimeType=e),this},statusCode:function(e){var t;if(e)if(2>w)for(t in e)m[t]=[m[t],e[t]];else x.always(e[x.status]);return this},abort:function(e){var t=e||S;return f&&f.abort(t),N(0,t),this}};if(d.promise(x).complete=v.add,x.success=x.done,x.error=x.fail,c.url=((e||c.url||gn)+"").replace(wn,"").replace(Nn,mn[1]+"//"),c.type=n.method||n.type||c.method||c.type,c.dataTypes=b.trim(c.dataType||"*").toLowerCase().match(E)||[""],null==c.crossDomain&&(r=Cn.exec(c.url.toLowerCase()),c.crossDomain=!(!r||r[1]===mn[1]&&r[2]===mn[2]&&(r[3]||("http:"===r[1]?80:443))==(mn[3]||("http:"===mn[1]?80:443)))),c.data&&c.processData&&"string"!=typeof c.data&&(c.data=b.param(c.data,c.traditional)),Dn(Ln,c,n,x),2===w)return x;a=c.global,a&&0===b.active++&&b.event.trigger("ajaxStart"),c.type=c.type.toUpperCase(),c.hasContent=!Tn.test(c.type),s=c.url,c.hasContent||(c.data&&(s=c.url+=(bn.test(s)?"&":"?")+c.data,delete c.data),c.cache===!1&&(c.url=En.test(s)?s.replace(En,"$1_="+yn++):s+(bn.test(s)?"&":"?")+"_="+yn++)),c.ifModified&&(b.lastModified[s]&&x.setRequestHeader("If-Modified-Since",b.lastModified[s]),b.etag[s]&&x.setRequestHeader("If-None-Match",b.etag[s])),(c.data&&c.hasContent&&c.contentType!==!1||n.contentType)&&x.setRequestHeader("Content-Type",c.contentType),x.setRequestHeader("Accept",c.dataTypes[0]&&c.accepts[c.dataTypes[0]]?c.accepts[c.dataTypes[0]]+("*"!==c.dataTypes[0]?", "+On+"; q=0.01":""):c.accepts["*"]);for(i in c.headers)x.setRequestHeader(i,c.headers[i]);if(c.beforeSend&&(c.beforeSend.call(h,x,c)===!1||2===w))return x.abort();S="abort";for(i in{success:1,error:1,complete:1})x[i](c[i]);if(f=Dn(An,c,n,x)){x.readyState=1,a&&p.trigger("ajaxSend",[x,c]),c.async&&c.timeout>0&&(u=setTimeout(function(){x.abort("timeout")},c.timeout));try{w=1,f.send(g,N)}catch(T){if(!(2>w))throw T;N(-1,T)}}else N(-1,"No Transport");return x},getScript:function(e,n){return b.get(e,t,n,"script")},getJSON:function(e,t,n){return b.get(e,t,n,"json")}});b.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return b.globalEval(e),e}}}),b.ajaxPrefilter("script",function(e){e.cache===t&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),b.ajaxTransport("script",function(e){if(e.crossDomain){var n,r=s.head||b("head")[0]||s.documentElement;return{send:function(t,i){n=s.createElement("script"),n.async=!0,e.scriptCharset&&(n.charset=e.scriptCharset),n.src=e.url,n.onload=n.onreadystatechange=function(e,t){(t||!n.readyState||/loaded|complete/.test(n.readyState))&&(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),n=null,t||i(200,"success"))},r.insertBefore(n,r.firstChild)},abort:function(){n&&n.onload(t,!0)}}}});var jn=[],Fn=/(=)\?(?=&|$)|\?\?/;b.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=jn.pop()||b.expando+"_"+yn++;return this[e]=!0,e}}),b.ajaxPrefilter("json jsonp",function(n,r,i){var s,o,u,a=n.jsonp!==!1&&(Fn.test(n.url)?"url":"string"==typeof n.data&&!(n.contentType||"").indexOf("application/x-www-form-urlencoded")&&Fn.test(n.data)&&"data");return a||"jsonp"===n.dataTypes[0]?(s=n.jsonpCallback=b.isFunction(n.jsonpCallback)?n.jsonpCallback():n.jsonpCallback,a?n[a]=n[a].replace(Fn,"$1"+s):n.jsonp!==!1&&(n.url+=(bn.test(n.url)?"&":"?")+n.jsonp+"="+s),n.converters["script json"]=function(){return u||b.error(s+" was not called"),u[0]},n.dataTypes[0]="json",o=e[s],e[s]=function(){u=arguments},i.always(function(){e[s]=o,n[s]&&(n.jsonpCallback=r.jsonpCallback,jn.push(s)),u&&b.isFunction(o)&&o(u[0]),u=o=t}),"script"):t});var In,qn,Rn=0,Un=e.ActiveXObject&&function(){var e;for(e in In)In[e](t,!0)};b.ajaxSettings.xhr=e.ActiveXObject?function(){return!this.isLocal&&zn()||Wn()}:zn,qn=b.ajaxSettings.xhr(),b.support.cors=!!qn&&"withCredentials"in qn,qn=b.support.ajax=!!qn,qn&&b.ajaxTransport(function(n){if(!n.crossDomain||b.support.cors){var r;return{send:function(i,s){var o,u,a=n.xhr();if(n.username?a.open(n.type,n.url,n.async,n.username,n.password):a.open(n.type,n.url,n.async),n.xhrFields)for(u in n.xhrFields)a[u]=n.xhrFields[u];n.mimeType&&a.overrideMimeType&&a.overrideMimeType(n.mimeType),n.crossDomain||i["X-Requested-With"]||(i["X-Requested-With"]="XMLHttpRequest");try{for(u in i)a.setRequestHeader(u,i[u])}catch(f){}a.send(n.hasContent&&n.data||null),r=function(e,i){var u,f,l,c;try{if(r&&(i||4===a.readyState))if(r=t,o&&(a.onreadystatechange=b.noop,Un&&delete In[o]),i)4!==a.readyState&&a.abort();else{c={},u=a.status,f=a.getAllResponseHeaders(),"string"==typeof a.responseText&&(c.text=a.responseText);try{l=a.statusText}catch(h){l=""}u||!n.isLocal||n.crossDomain?1223===u&&(u=204):u=c.text?200:404}}catch(p){i||s(-1,p)}c&&s(u,l,c,f)},n.async?4===a.readyState?setTimeout(r):(o=++Rn,Un&&(In||(In={},b(e).unload(Un)),In[o]=r),a.onreadystatechange=r):r()},abort:function(){r&&r(t,!0)}}}});var Xn,Vn,$n=/^(?:toggle|show|hide)$/,Jn=RegExp("^(?:([+-])=|)("+w+")([a-z%]*)$","i"),Kn=/queueHooks$/,Qn=[nr],Gn={"*":[function(e,t){var n,r,i=this.createTween(e,t),s=Jn.exec(t),o=i.cur(),u=+o||0,a=1,f=20;if(s){if(n=+s[2],r=s[3]||(b.cssNumber[e]?"":"px"),"px"!==r&&u){u=b.css(i.elem,e,!0)||n||1;do a=a||".5",u/=a,b.style(i.elem,e,u+r);while(a!==(a=i.cur()/o)&&1!==a&&--f)}i.unit=r,i.start=u,i.end=s[1]?u+(s[1]+1)*n:n}return i}]};b.Animation=b.extend(er,{tweener:function(e,t){b.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");var n,r=0,i=e.length;for(;i>r;r++)n=e[r],Gn[n]=Gn[n]||[],Gn[n].unshift(t)},prefilter:function(e,t){t?Qn.unshift(e):Qn.push(e)}});b.Tween=rr,rr.prototype={constructor:rr,init:function(e,t,n,r,i,s){this.elem=e,this.prop=n,this.easing=i||"swing",this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=s||(b.cssNumber[n]?"":"px")},cur:function(){var e=rr.propHooks[this.prop];return e&&e.get?e.get(this):rr.propHooks._default.get(this)},run:function(e){var t,n=rr.propHooks[this.prop];return this.pos=t=this.options.duration?b.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):rr.propHooks._default.set(this),this}},rr.prototype.init.prototype=rr.prototype,rr.propHooks={_default:{get:function(e){var t;return null==e.elem[e.prop]||e.elem.style&&null!=e.elem.style[e.prop]?(t=b.css(e.elem,e.prop,""),t&&"auto"!==t?t:0):e.elem[e.prop]},set:function(e){b.fx.step[e.prop]?b.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[b.cssProps[e.prop]]||b.cssHooks[e.prop])?b.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},rr.propHooks.scrollTop=rr.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},b.each(["toggle","show","hide"],function(e,t){var n=b.fn[t];b.fn[t]=function(e,r,i){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(ir(t,!0),e,r,i)}}),b.fn.extend({fadeTo:function(e,t,n,r){return this.filter(nn).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=b.isEmptyObject(e),s=b.speed(t,n,r),o=function(){var t=er(this,b.extend({},e),s);o.finish=function(){t.stop(!0)},(i||b._data(this,"finish"))&&t.stop(!0)};return o.finish=o,i||s.queue===!1?this.each(o):this.queue(s.queue,o)},stop:function(e,n,r){var i=function(e){var t=e.stop;delete e.stop,t(r)};return"string"!=typeof e&&(r=n,n=e,e=t),n&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,n=null!=e&&e+"queueHooks",s=b.timers,o=b._data(this);if(n)o[n]&&o[n].stop&&i(o[n]);else for(n in o)o[n]&&o[n].stop&&Kn.test(n)&&i(o[n]);for(n=s.length;n--;)s[n].elem!==this||null!=e&&s[n].queue!==e||(s[n].anim.stop(r),t=!1,s.splice(n,1));(t||!r)&&b.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,n=b._data(this),r=n[e+"queue"],i=n[e+"queueHooks"],s=b.timers,o=r?r.length:0;for(n.finish=!0,b.queue(this,e,[]),i&&i.cur&&i.cur.finish&&i.cur.finish.call(this),t=s.length;t--;)s[t].elem===this&&s[t].queue===e&&(s[t].anim.stop(!0),s.splice(t,1));for(t=0;o>t;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete n.finish})}});b.each({slideDown:ir("show"),slideUp:ir("hide"),slideToggle:ir("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){b.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),b.speed=function(e,t,n){var r=e&&"object"==typeof e?b.extend({},e):{complete:n||!n&&t||b.isFunction(e)&&e,duration:e,easing:n&&t||t&&!b.isFunction(t)&&t};return r.duration=b.fx.off?0:"number"==typeof r.duration?r.duration:r.duration in b.fx.speeds?b.fx.speeds[r.duration]:b.fx.speeds._default,(null==r.queue||r.queue===!0)&&(r.queue="fx"),r.old=r.complete,r.complete=function(){b.isFunction(r.old)&&r.old.call(this),r.queue&&b.dequeue(this,r.queue)},r},b.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},b.timers=[],b.fx=rr.prototype.init,b.fx.tick=function(){var e,n=b.timers,r=0;for(Xn=b.now();n.length>r;r++)e=n[r],e()||n[r]!==e||n.splice(r--,1);n.length||b.fx.stop(),Xn=t},b.fx.timer=function(e){e()&&b.timers.push(e)&&b.fx.start()},b.fx.interval=13,b.fx.start=function(){Vn||(Vn=setInterval(b.fx.tick,b.fx.interval))},b.fx.stop=function(){clearInterval(Vn),Vn=null},b.fx.speeds={slow:600,fast:200,_default:400},b.fx.step={},b.expr&&b.expr.filters&&(b.expr.filters.animated=function(e){return b.grep(b.timers,function(t){return e===t.elem}).length}),b.fn.offset=function(e){if(arguments.length)return e===t?this:this.each(function(t){b.offset.setOffset(this,e,t)});var n,r,s={top:0,left:0},o=this[0],u=o&&o.ownerDocument;if(u)return n=u.documentElement,b.contains(n,o)?(typeof o.getBoundingClientRect!==i&&(s=o.getBoundingClientRect()),r=sr(u),{top:s.top+(r.pageYOffset||n.scrollTop)-(n.clientTop||0),left:s.left+(r.pageXOffset||n.scrollLeft)-(n.clientLeft||0)}):s},b.offset={setOffset:function(e,t,n){var r=b.css(e,"position");"static"===r&&(e.style.position="relative");var i=b(e),s=i.offset(),o=b.css(e,"top"),u=b.css(e,"left"),a=("absolute"===r||"fixed"===r)&&b.inArray("auto",[o,u])>-1,f={},l={},c,h;a?(l=i.position(),c=l.top,h=l.left):(c=parseFloat(o)||0,h=parseFloat(u)||0),b.isFunction(t)&&(t=t.call(e,n,s)),null!=t.top&&(f.top=t.top-s.top+c),null!=t.left&&(f.left=t.left-s.left+h),"using"in t?t.using.call(e,f):i.css(f)}},b.fn.extend({position:function(){if(this[0]){var e,t,n={top:0,left:0},r=this[0];return"fixed"===b.css(r,"position")?t=r.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),b.nodeName(e[0],"html")||(n=e.offset()),n.top+=b.css(e[0],"borderTopWidth",!0),n.left+=b.css(e[0],"borderLeftWidth",!0)),{top:t.top-n.top-b.css(r,"marginTop",!0),left:t.left-n.left-b.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||s.documentElement;while(e&&!b.nodeName(e,"html")&&"static"===b.css(e,"position"))e=e.offsetParent;return e||s.documentElement})}}),b.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,n){var r=/Y/.test(n);b.fn[e]=function(i){return b.access(this,function(e,i,s){var o=sr(e);return s===t?o?n in o?o[n]:o.document.documentElement[i]:e[i]:(o?o.scrollTo(r?b(o).scrollLeft():s,r?s:b(o).scrollTop()):e[i]=s,t)},e,i,arguments.length,null)}});b.each({Height:"height",Width:"width"},function(e,n){b.each({padding:"inner"+e,content:n,"":"outer"+e},function(r,i){b.fn[i]=function(i,s){var o=arguments.length&&(r||"boolean"!=typeof i),u=r||(i===!0||s===!0?"margin":"border");return b.access(this,function(n,r,i){var s;return b.isWindow(n)?n.document.documentElement["client"+e]:9===n.nodeType?(s=n.documentElement,Math.max(n.body["scroll"+e],s["scroll"+e],n.body["offset"+e],s["offset"+e],s["client"+e])):i===t?b.css(n,r,u):b.style(n,r,i,u)},n,o?i:t,o,null)}})}),e.jQuery=e.$=b,"function"==typeof define&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return b})})(window);(function(){var e=function(e,t){return t.priority-e.priority};var t=function(e,t){return e.priority-t.priority};PriorityQueue=function(n){var r=[];var i=false;var s;if(n&&n.low){s=e}else{s=t}var o=function(){r.sort(s);i=true};var u={pop:function(){if(!i){o()}var e=r.pop();if(e){return e.object}else{return undefined}},top:function(){if(!i){o()}var e=r[r.length-1];if(e){return e.object}else{return undefined}},includes:function(e,t){if(!t)t=function(e,t){return e===t};for(var n=r.length-1;n>=0;n--){if(t(r[n].object,e)){return true}}return false},size:function(){return r.length},empty:function(){return r.length===0},push:function(e,t){r.push({object:e,priority:t});i=false},remove:function(e){for(var t=0;t<r.length;t++){if(e==r[t]){r.splice(t,1);return e}}return null}};return u}})();ns("boc.core");boc.core.EntityManager=function(){function s(e,t,r){if(n[e]&&n[e][t]){for(var i=0;i<n[e][t].length;i++){n[e][t][i](r)}}}var e=0;var t={};var n={};var r={};var i={};this.clear=function(){e=0;t={};n={};r={};i={}};this.addListenerForEntity=function(e,t,r){if(n[e]){if(!n[e][t]){n[e][t]=[]}n[e][t].push(r)}else{throw"Entity "+e+" not found!"}};this.removeListenerForEntity=function(e,t,r){if(n[e]){if(n[e][t]){var i=n[e][t].indexOf(r);if(i>=0){n[e][t].splice(i,1)}}}else{throw"Entity "+e+" not found!"}};this.createEntity=function(r){var i="#"+e;if(r){i+="_"+r}t[i]={};n[i]={};e++;return i};this.addComponentToEntity=function(e,n){var o=t[n];if(!o){throw"Entity "+n+" not found."}var u=e.className();var a=r[u];if(!a){a=[];r[u]=a}else{for(var f=0;f<a.length;f++){if(a===n){throw"Entity already has component "+u}}}o[u]=e;a.push(n);if(!i[u]){i[u]=[]}i[u].push(e);s(n,"onComponentAdded",{entityId:n,component:e})};this.removeComponentFromEntity=function(e,n){var o=t[n];if(!o){throw"Entity "+n+" not found."}var u=r[e];var a=-1,f=0,l;for(var f=0,c=u.length;f<c;f++){if(n===u[f]){a=f;break}}if(a===-1){return}var h=o[e];var p=i[e];var d=-1;for(var f=0,v=p.length;f<v;f++){if(h===p[f]){d=f;break}}p.splice(d,1);u.splice(a,1);o[e]=null;s(n,"onComponentRemoved",{entityId:n,componentName:e})};this.getAllComponents=function(e){var t=i[e];if(!t){throw"No such component "+e}return t};this.getComponentForEntity=function(e,n){var r=t[n];if(!r){return null}return r[e]};this.getAllComponentsForEntity=function(e){var n=t[e];if(!n){throw"Entity "+e+" not found."}return n};this.getAllEntitiesWithComponent=function(e){var t=r[e];if(!t){return[]}return t};this.entityExists=function(e){return t[e]!=null&&t[e]!=undefined};this.killEntity=function(e){var r=t[e];if(!r){throw"Entity "+e+" not found."}s(e,"onKill",{entity:e});var i=[];for(var o in r){i.push(o)}for(var o=0;o<i.length;o++){this.removeComponentFromEntity(i[o],e)}t[e]=null;n[e]=null}};boc.core.Entity_internal={_emInstance:null,em:function(){if(!this._emInstance){this._emInstance=new boc.core.EntityManager}return this._emInstance}};boc.core.Entity=function(e){function i(e){t[e.component.className()]=e.component}function s(e){delete t[e.componentName]}var t=this;if(!e){e={}}if(!e.em){e.em=boc.core.Entity_internal.em()}if(e.id!=undefined&&e.id!=null){if(!e.em.entityExists(e.id)){throw"Entity id "+e.id+" does not exist."}var n=e.em.getAllComponentsForEntity(e.id);for(var r in n){this[r]=n[r]}}else{e.id=e.em.createEntity(e.description)}this.id=function(){return e.id};e.em.addListenerForEntity(e.id,"onComponentAdded",i);e.em.addListenerForEntity(e.id,"onComponentRemoved",s);this.addComponent=function(t){e.em.addComponentToEntity(t,e.id);this[t.className()]=t};this.removeComponent=function(t){e.em.removeComponentFromEntity(t,e.id);delete this[t]};this.getAllComponents=function(){return e.em.getAllComponentsForEntity(e.id)};this.kill=function(){e.em.killEntity(e.id)};this.addListener=function(t,n){e.em.addListenerForEntity(e.id,t,n)};this.removeListener=function(t,n){e.em.removeListenerForEntity(e.id,t,n)}};(function(e){function t(e){e=e.split(".");var t=window;for(var n=0;n<e.length;n++){t=t[e[n]]}return t}window.$em=function(n){if(typeof n=="undefined"){return e}var r=null,i=null,s="boc.components",o=t("boc.components");if(n.indexOf("#")==0){r=n}else{i=e.getAllEntitiesWithComponent(n)}var u={ns:function(e){if(s!==e){s=e;o=t(s)}return this},add:function(t,n){if(r){if(typeof t=="object"&&t.className&&typeof t.className==="function"){e.addComponentToEntity(t,r)}else if(typeof t=="string"){var i=new o[t](n);e.addComponentToEntity(i,r)}}return this},remove:function(t){if(r&&t){e.removeComponentFromEntity(t,r)}return this},has:function(t){if(r&&t){return e.getComponentForEntity(t,r)?true:false}return false},comp:function(t){if(r&&t){return e.getComponentForEntity(t,r)}return null},each:function(t){for(var s=0;s<i.length;s++){r=i[s];if(t){t(i[s],e.getComponentForEntity(n,i[s]))}}},kill:function(){e.killEntity(r)},first:function(e){return i[0]},all:function(){return i},at:function(e){return i[e]},exists:function(){return e.entityExists(r)},listen:function(t,n){e.addListenerForEntity(r,t,n);return this},unlisten:function(t,n){e.removeListenerForEntity(r,t,n);return this}};return u}})(boc.core.Entity_internal.em());$em.create=function(e){return $em().createEntity(e)};(function(e,t,n,r,i,s,o){function u(e){var t,r,i=this,s=e.length;var o=0,u=i.i=i.j=i.m=0;i.S=[];i.c=[];if(!s){e=[s++]}while(o<n){i.S[o]=o++}for(o=0;o<n;o++){t=i.S[o];u=l(u+t+e[o%s]);r=i.S[u];i.S[o]=r;i.S[u]=t}i.g=function(t){var r=i.S;var s=l(i.i+1);var o=r[s];var u=l(i.j+o);var a=r[u];r[s]=a;r[u]=o;var f=r[l(o+a)];while(--t){s=l(s+1);o=r[s];u=l(u+o);a=r[u];r[s]=a;r[u]=o;f=f*n+r[l(o+a)]}i.i=s;i.j=u;return f};i.g(n)}function a(e,t,n,r,i){n=[];i=typeof e;if(t&&i=="object"){for(r in e){if(r.indexOf("S")<5){try{n.push(a(e[r],t-1))}catch(s){}}}}return n.length?n:e+(i!="string"?"\0":"")}function f(e,t,n,r){e+="";n=0;for(r=0;r<e.length;r++){t[l(r)]=l((n^=t[l(r)]*19)+e.charCodeAt(r))}e="";for(r in t){e+=String.fromCharCode(t[r])}return e}function l(e){return e&n-1}t["seedrandom"]=function(c,h){var p=[];var d;c=f(a(h?[c,e]:arguments.length?c:[(new Date).getTime(),e,window],3),p);d=new u(p);f(d.S,e);t["_random"]=function(){var t=d.g(r);var u=o;var a=0;while(t<i){t=(t+a)*n;u*=n;a=d.g(1)}while(t>=s){t/=2;u/=2;a>>>=1}return(t+a)/u};return c};o=t.pow(n,r);i=t.pow(2,i);s=i*2;f(t.random(),e)})([],Math,256,6,52);var io={};(function(){(function(e,t){var n=e;n.version="0.9.16";n.protocol=1;n.transports=[];n.j=[];n.sockets={};n.connect=function(e,r){var i=n.util.parseUri(e),s,o;if(t&&t.location){i.protocol=i.protocol||t.location.protocol.slice(0,-1);i.host=i.host||(t.document?t.document.domain:t.location.hostname);i.port=i.port||t.location.port}s=n.util.uniqueUri(i);var u={host:i.host,secure:"https"==i.protocol,port:i.port||("https"==i.protocol?443:80),query:i.query||""};n.util.merge(u,r);if(u["force new connection"]||!n.sockets[s]){o=new n.Socket(u)}if(!u["force new connection"]&&o){n.sockets[s]=o}o=o||n.sockets[s];return o.of(i.path.length>1?i.path:"")}})(this.io,this);(function(e,t){var n=e.util={};var r=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;var i=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];n.parseUri=function(e){var t=r.exec(e||""),n={},s=14;while(s--){n[i[s]]=t[s]||""}return n};n.uniqueUri=function(e){var n=e.protocol,r=e.host,i=e.port;if("document"in t){r=r||document.domain;i=i||(n=="https"&&document.location.protocol!=="https:"?443:document.location.port)}else{r=r||"localhost";if(!i&&n=="https"){i=443}}return(n||"http")+"://"+r+":"+(i||80)};n.query=function(e,t){var r=n.chunkQuery(e||""),i=[];n.merge(r,n.chunkQuery(t||""));for(var s in r){if(r.hasOwnProperty(s)){i.push(s+"="+r[s])}}return i.length?"?"+i.join("&"):""};n.chunkQuery=function(e){var t={},n=e.split("&"),r=0,i=n.length,s;for(;r<i;++r){s=n[r].split("=");if(s[0]){t[s[0]]=s[1]}}return t};var s=false;n.load=function(e){if("document"in t&&document.readyState==="complete"||s){return e()}n.on(t,"load",e,false)};n.on=function(e,t,n,r){if(e.attachEvent){e.attachEvent("on"+t,n)}else if(e.addEventListener){e.addEventListener(t,n,r)}};n.request=function(e){if(e&&"undefined"!=typeof XDomainRequest&&!n.ua.hasCORS){return new XDomainRequest}if("undefined"!=typeof XMLHttpRequest&&(!e||n.ua.hasCORS)){return new XMLHttpRequest}if(!e){try{return new(window[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(t){}}return null};if("undefined"!=typeof window){n.load(function(){s=true})}n.defer=function(e){if(!n.ua.webkit||"undefined"!=typeof importScripts){return e()}n.load(function(){setTimeout(e,100)})};n.merge=function(e,t,r,i){var s=i||[],o=typeof r=="undefined"?2:r,u;for(u in t){if(t.hasOwnProperty(u)&&n.indexOf(s,u)<0){if(typeof e[u]!=="object"||!o){e[u]=t[u];s.push(t[u])}else{n.merge(e[u],t[u],o-1,s)}}}return e};n.mixin=function(e,t){n.merge(e.prototype,t.prototype)};n.inherit=function(e,t){function n(){}n.prototype=t.prototype;e.prototype=new n};n.isArray=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"};n.intersect=function(e,t){var r=[],i=e.length>t.length?e:t,s=e.length>t.length?t:e;for(var o=0,u=s.length;o<u;o++){if(~n.indexOf(i,s[o]))r.push(s[o])}return r};n.indexOf=function(e,t,n){for(var r=e.length,n=n<0?n+r<0?0:n+r:n||0;n<r&&e[n]!==t;n++){}return r<=n?-1:n};n.toArray=function(e){var t=[];for(var n=0,r=e.length;n<r;n++)t.push(e[n]);return t};n.ua={};n.ua.hasCORS="undefined"!=typeof XMLHttpRequest&&function(){try{var e=new XMLHttpRequest}catch(t){return false}return e.withCredentials!=undefined}();n.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent);n.ua.iDevice="undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)})("undefined"!=typeof io?io:module.exports,this);(function(e,t){function n(){}e.EventEmitter=n;n.prototype.on=function(e,n){if(!this.$events){this.$events={}}if(!this.$events[e]){this.$events[e]=n}else if(t.util.isArray(this.$events[e])){this.$events[e].push(n)}else{this.$events[e]=[this.$events[e],n]}return this};n.prototype.addListener=n.prototype.on;n.prototype.once=function(e,t){function n(){r.removeListener(e,n);t.apply(this,arguments)}var r=this;n.listener=t;this.on(e,n);return this};n.prototype.removeListener=function(e,n){if(this.$events&&this.$events[e]){var r=this.$events[e];if(t.util.isArray(r)){var i=-1;for(var s=0,o=r.length;s<o;s++){if(r[s]===n||r[s].listener&&r[s].listener===n){i=s;break}}if(i<0){return this}r.splice(i,1);if(!r.length){delete this.$events[e]}}else if(r===n||r.listener&&r.listener===n){delete this.$events[e]}}return this};n.prototype.removeAllListeners=function(e){if(e===undefined){this.$events={};return this}if(this.$events&&this.$events[e]){this.$events[e]=null}return this};n.prototype.listeners=function(e){if(!this.$events){this.$events={}}if(!this.$events[e]){this.$events[e]=[]}if(!t.util.isArray(this.$events[e])){this.$events[e]=[this.$events[e]]}return this.$events[e]};n.prototype.emit=function(e){if(!this.$events){return false}var n=this.$events[e];if(!n){return false}var r=Array.prototype.slice.call(arguments,1);if("function"==typeof n){n.apply(this,r)}else if(t.util.isArray(n)){var i=n.slice();for(var s=0,o=i.length;s<o;s++){i[s].apply(this,r)}}else{return false}return true}})("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports);(function(exports,nativeJSON){"use strict";function f(e){return e<10?"0"+e:e}function date(e,t){return isFinite(e.valueOf())?e.getUTCFullYear()+"-"+f(e.getUTCMonth()+1)+"-"+f(e.getUTCDate())+"T"+f(e.getUTCHours())+":"+f(e.getUTCMinutes())+":"+f(e.getUTCSeconds())+"Z":null}function quote(e){escapable.lastIndex=0;return escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return typeof t==="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,r,i,s,o=gap,u,a=t[e];if(a instanceof Date){a=date(e)}if(typeof rep==="function"){a=rep.call(t,e,a)}switch(typeof a){case"string":return quote(a);case"number":return isFinite(a)?String(a):"null";case"boolean":case"null":return String(a);case"object":if(!a){return"null"}gap+=indent;u=[];if(Object.prototype.toString.apply(a)==="[object Array]"){s=a.length;for(n=0;n<s;n+=1){u[n]=str(n,a)||"null"}i=u.length===0?"[]":gap?"[\n"+gap+u.join(",\n"+gap)+"\n"+o+"]":"["+u.join(",")+"]";gap=o;return i}if(rep&&typeof rep==="object"){s=rep.length;for(n=0;n<s;n+=1){if(typeof rep[n]==="string"){r=rep[n];i=str(r,a);if(i){u.push(quote(r)+(gap?": ":":")+i)}}}}else{for(r in a){if(Object.prototype.hasOwnProperty.call(a,r)){i=str(r,a);if(i){u.push(quote(r)+(gap?": ":":")+i)}}}}i=u.length===0?"{}":gap?"{\n"+gap+u.join(",\n"+gap)+"\n"+o+"}":"{"+u.join(",")+"}";gap=o;return i}}if(nativeJSON&&nativeJSON.parse){return exports.JSON={parse:nativeJSON.parse,stringify:nativeJSON.stringify}}var JSON=exports.JSON={};var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;JSON.stringify=function(e,t,n){var r;gap="";indent="";if(typeof n==="number"){for(r=0;r<n;r+=1){indent+=" "}}else if(typeof n==="string"){indent=n}rep=t;if(t&&typeof t!=="function"&&(typeof t!=="object"||typeof t.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":e})};JSON.parse=function(text,reviver){function walk(e,t){var n,r,i=e[t];if(i&&typeof i==="object"){for(n in i){if(Object.prototype.hasOwnProperty.call(i,n)){r=walk(i,n);if(r!==undefined){i[n]=r}else{delete i[n]}}}}return reviver.call(e,t,i)}var j;text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}})("undefined"!=typeof io?io:module.exports,typeof JSON!=="undefined"?JSON:undefined);(function(e,t){var n=e.parser={};var r=n.packets=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"];var i=n.reasons=["transport not supported","client not handshaken","unauthorized"];var s=n.advice=["reconnect"];var o=t.JSON,u=t.util.indexOf;n.encodePacket=function(e){var t=u(r,e.type),n=e.id||"",a=e.endpoint||"",f=e.ack,l=null;switch(e.type){case"error":var c=e.reason?u(i,e.reason):"",h=e.advice?u(s,e.advice):"";if(c!==""||h!=="")l=c+(h!==""?"+"+h:"");break;case"message":if(e.data!=="")l=e.data;break;case"event":var p={name:e.name};if(e.args&&e.args.length){p.args=e.args}l=o.stringify(p);break;case"json":l=o.stringify(e.data);break;case"connect":if(e.qs)l=e.qs;break;case"ack":l=e.ackId+(e.args&&e.args.length?"+"+o.stringify(e.args):"");break}var d=[t,n+(f=="data"?"+":""),a];if(l!==null&&l!==undefined)d.push(l);return d.join(":")};n.encodePayload=function(e){var t="";if(e.length==1)return e[0];for(var n=0,r=e.length;n<r;n++){var i=e[n];t+="�"+i.length+"�"+e[n]}return t};var a=/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/;n.decodePacket=function(e){var t=e.match(a);if(!t)return{};var n=t[2]||"",e=t[5]||"",u={type:r[t[1]],endpoint:t[4]||""};if(n){u.id=n;if(t[3])u.ack="data";else u.ack=true}switch(u.type){case"error":var t=e.split("+");u.reason=i[t[0]]||"";u.advice=s[t[1]]||"";break;case"message":u.data=e||"";break;case"event":try{var f=o.parse(e);u.name=f.name;u.args=f.args}catch(l){}u.args=u.args||[];break;case"json":try{u.data=o.parse(e)}catch(l){}break;case"connect":u.qs=e||"";break;case"ack":var t=e.match(/^([0-9]+)(\+)?(.*)/);if(t){u.ackId=t[1];u.args=[];if(t[3]){try{u.args=t[3]?o.parse(t[3]):[]}catch(l){}}}break;case"disconnect":case"heartbeat":break}return u};n.decodePayload=function(e){if(e.charAt(0)=="�"){var t=[];for(var r=1,i="";r<e.length;r++){if(e.charAt(r)=="�"){t.push(n.decodePacket(e.substr(r+1).substr(0,i)));r+=Number(i)+1;i=""}else{i+=e.charAt(r)}}return t}else{return[n.decodePacket(e)]}}})("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports);(function(e,t){function n(e,t){this.socket=e;this.sessid=t}e.Transport=n;t.util.mixin(n,t.EventEmitter);n.prototype.heartbeats=function(){return true};n.prototype.onData=function(e){this.clearCloseTimeout();if(this.socket.connected||this.socket.connecting||this.socket.reconnecting){this.setCloseTimeout()}if(e!==""){var n=t.parser.decodePayload(e);if(n&&n.length){for(var r=0,i=n.length;r<i;r++){this.onPacket(n[r])}}}return this};n.prototype.onPacket=function(e){this.socket.setHeartbeatTimeout();if(e.type=="heartbeat"){return this.onHeartbeat()}if(e.type=="connect"&&e.endpoint==""){this.onConnect()}if(e.type=="error"&&e.advice=="reconnect"){this.isOpen=false}this.socket.onPacket(e);return this};n.prototype.setCloseTimeout=function(){if(!this.closeTimeout){var e=this;this.closeTimeout=setTimeout(function(){e.onDisconnect()},this.socket.closeTimeout)}};n.prototype.onDisconnect=function(){if(this.isOpen)this.close();this.clearTimeouts();this.socket.onDisconnect();return this};n.prototype.onConnect=function(){this.socket.onConnect();return this};n.prototype.clearCloseTimeout=function(){if(this.closeTimeout){clearTimeout(this.closeTimeout);this.closeTimeout=null}};n.prototype.clearTimeouts=function(){this.clearCloseTimeout();if(this.reopenTimeout){clearTimeout(this.reopenTimeout)}};n.prototype.packet=function(e){this.send(t.parser.encodePacket(e))};n.prototype.onHeartbeat=function(e){this.packet({type:"heartbeat"})};n.prototype.onOpen=function(){this.isOpen=true;this.clearCloseTimeout();this.socket.onOpen()};n.prototype.onClose=function(){var e=this;this.isOpen=false;this.socket.onClose();this.onDisconnect()};n.prototype.prepareUrl=function(){var e=this.socket.options;return this.scheme()+"://"+e.host+":"+e.port+"/"+e.resource+"/"+t.protocol+"/"+this.name+"/"+this.sessid};n.prototype.ready=function(e,t){t.call(this)}})("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports);(function(e,t,n){function r(e){this.options={port:80,secure:false,document:"document"in n?document:false,resource:"socket.io",transports:t.transports,"connect timeout":1e4,"try multiple transports":true,reconnect:true,"reconnection delay":500,"reconnection limit":Infinity,"reopen delay":3e3,"max reconnection attempts":10,"sync disconnect on unload":false,"auto connect":true,"flash policy port":10843,manualFlush:false};t.util.merge(this.options,e);this.connected=false;this.open=false;this.connecting=false;this.reconnecting=false;this.namespaces={};this.buffer=[];this.doBuffer=false;if(this.options["sync disconnect on unload"]&&(!this.isXDomain()||t.util.ua.hasCORS)){var r=this;t.util.on(n,"beforeunload",function(){r.disconnectSync()},false)}if(this.options["auto connect"]){this.connect()}}function i(){}e.Socket=r;t.util.mixin(r,t.EventEmitter);r.prototype.of=function(e){if(!this.namespaces[e]){this.namespaces[e]=new t.SocketNamespace(this,e);if(e!==""){this.namespaces[e].packet({type:"connect"})}}return this.namespaces[e]};r.prototype.publish=function(){this.emit.apply(this,arguments);var e;for(var t in this.namespaces){if(this.namespaces.hasOwnProperty(t)){e=this.of(t);e.$emit.apply(e,arguments)}}};r.prototype.handshake=function(e){function n(t){if(t instanceof Error){r.connecting=false;r.onError(t.message)}else{e.apply(null,t.split(":"))}}var r=this,s=this.options;var o=["http"+(s.secure?"s":"")+":/",s.host+":"+s.port,s.resource,t.protocol,t.util.query(this.options.query,"t="+ +(new Date))].join("/");if(this.isXDomain()&&!t.util.ua.hasCORS){var u=document.getElementsByTagName("script")[0],a=document.createElement("script");a.src=o+"&jsonp="+t.j.length;u.parentNode.insertBefore(a,u);t.j.push(function(e){n(e);a.parentNode.removeChild(a)})}else{var f=t.util.request();f.open("GET",o,true);if(this.isXDomain()){f.withCredentials=true}f.onreadystatechange=function(){if(f.readyState==4){f.onreadystatechange=i;if(f.status==200){n(f.responseText)}else if(f.status==403){r.onError(f.responseText)}else{r.connecting=false;!r.reconnecting&&r.onError(f.responseText)}}};f.send(null)}};r.prototype.getTransport=function(e){var n=e||this.transports,r;for(var i=0,s;s=n[i];i++){if(t.Transport[s]&&t.Transport[s].check(this)&&(!this.isXDomain()||t.Transport[s].xdomainCheck(this))){return new t.Transport[s](this,this.sessionid)}}return null};r.prototype.connect=function(e){if(this.connecting){return this}var n=this;n.connecting=true;this.handshake(function(r,i,s,o){function u(e){if(n.transport)n.transport.clearTimeouts();n.transport=n.getTransport(e);if(!n.transport)return n.publish("connect_failed");n.transport.ready(n,function(){n.connecting=true;n.publish("connecting",n.transport.name);n.transport.open();if(n.options["connect timeout"]){n.connectTimeoutTimer=setTimeout(function(){if(!n.connected){n.connecting=false;if(n.options["try multiple transports"]){var e=n.transports;while(e.length>0&&e.splice(0,1)[0]!=n.transport.name){}if(e.length){u(e)}else{n.publish("connect_failed")}}}},n.options["connect timeout"])}})}n.sessionid=r;n.closeTimeout=s*1e3;n.heartbeatTimeout=i*1e3;if(!n.transports)n.transports=n.origTransports=o?t.util.intersect(o.split(","),n.options.transports):n.options.transports;n.setHeartbeatTimeout();u(n.transports);n.once("connect",function(){clearTimeout(n.connectTimeoutTimer);e&&typeof e=="function"&&e()})});return this};r.prototype.setHeartbeatTimeout=function(){clearTimeout(this.heartbeatTimeoutTimer);if(this.transport&&!this.transport.heartbeats())return;var e=this;this.heartbeatTimeoutTimer=setTimeout(function(){e.transport.onClose()},this.heartbeatTimeout)};r.prototype.packet=function(e){if(this.connected&&!this.doBuffer){this.transport.packet(e)}else{this.buffer.push(e)}return this};r.prototype.setBuffer=function(e){this.doBuffer=e;if(!e&&this.connected&&this.buffer.length){if(!this.options["manualFlush"]){this.flushBuffer()}}};r.prototype.flushBuffer=function(){this.transport.payload(this.buffer);this.buffer=[]};r.prototype.disconnect=function(){if(this.connected||this.connecting){if(this.open){this.of("").packet({type:"disconnect"})}this.onDisconnect("booted")}return this};r.prototype.disconnectSync=function(){var e=t.util.request();var n=["http"+(this.options.secure?"s":"")+":/",this.options.host+":"+this.options.port,this.options.resource,t.protocol,"",this.sessionid].join("/")+"/?disconnect=1";e.open("GET",n,false);e.send(null);this.onDisconnect("booted")};r.prototype.isXDomain=function(){var e=n.location.port||("https:"==n.location.protocol?443:80);return this.options.host!==n.location.hostname||this.options.port!=e};r.prototype.onConnect=function(){if(!this.connected){this.connected=true;this.connecting=false;if(!this.doBuffer){this.setBuffer(false)}this.emit("connect")}};r.prototype.onOpen=function(){this.open=true};r.prototype.onClose=function(){this.open=false;clearTimeout(this.heartbeatTimeoutTimer)};r.prototype.onPacket=function(e){this.of(e.endpoint).onPacket(e)};r.prototype.onError=function(e){if(e&&e.advice){if(e.advice==="reconnect"&&(this.connected||this.connecting)){this.disconnect();if(this.options.reconnect){this.reconnect()}}}this.publish("error",e&&e.reason?e.reason:e)};r.prototype.onDisconnect=function(e){var t=this.connected,n=this.connecting;this.connected=false;this.connecting=false;this.open=false;if(t||n){this.transport.close();this.transport.clearTimeouts();if(t){this.publish("disconnect",e);if("booted"!=e&&this.options.reconnect&&!this.reconnecting){this.reconnect()}}}};r.prototype.reconnect=function(){function e(){if(n.connected){for(var e in n.namespaces){if(n.namespaces.hasOwnProperty(e)&&""!==e){n.namespaces[e].packet({type:"connect"})}}n.publish("reconnect",n.transport.name,n.reconnectionAttempts)}clearTimeout(n.reconnectionTimer);n.removeListener("connect_failed",t);n.removeListener("connect",t);n.reconnecting=false;delete n.reconnectionAttempts;delete n.reconnectionDelay;delete n.reconnectionTimer;delete n.redoTransports;n.options["try multiple transports"]=i}function t(){if(!n.reconnecting){return}if(n.connected){return e()}if(n.connecting&&n.reconnecting){return n.reconnectionTimer=setTimeout(t,1e3)}if(n.reconnectionAttempts++>=r){if(!n.redoTransports){n.on("connect_failed",t);n.options["try multiple transports"]=true;n.transports=n.origTransports;n.transport=n.getTransport();n.redoTransports=true;n.connect()}else{n.publish("reconnect_failed");e()}}else{if(n.reconnectionDelay<s){n.reconnectionDelay*=2}n.connect();n.publish("reconnecting",n.reconnectionDelay,n.reconnectionAttempts);n.reconnectionTimer=setTimeout(t,n.reconnectionDelay)}}this.reconnecting=true;this.reconnectionAttempts=0;this.reconnectionDelay=this.options["reconnection delay"];var n=this,r=this.options["max reconnection attempts"],i=this.options["try multiple transports"],s=this.options["reconnection limit"];this.options["try multiple transports"]=false;this.reconnectionTimer=setTimeout(t,this.reconnectionDelay);this.on("connect",t)}})("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports,this);(function(e,t){function n(e,t){this.socket=e;this.name=t||"";this.flags={};this.json=new r(this,"json");this.ackPackets=0;this.acks={}}function r(e,t){this.namespace=e;this.name=t}e.SocketNamespace=n;t.util.mixin(n,t.EventEmitter);n.prototype.$emit=t.EventEmitter.prototype.emit;n.prototype.of=function(){return this.socket.of.apply(this.socket,arguments)};n.prototype.packet=function(e){e.endpoint=this.name;this.socket.packet(e);this.flags={};return this};n.prototype.send=function(e,t){var n={type:this.flags.json?"json":"message",data:e};if("function"==typeof t){n.id=++this.ackPackets;n.ack=true;this.acks[n.id]=t}return this.packet(n)};n.prototype.emit=function(e){var t=Array.prototype.slice.call(arguments,1),n=t[t.length-1],r={type:"event",name:e};if("function"==typeof n){r.id=++this.ackPackets;r.ack="data";this.acks[r.id]=n;t=t.slice(0,t.length-1)}r.args=t;return this.packet(r)};n.prototype.disconnect=function(){if(this.name===""){this.socket.disconnect()}else{this.packet({type:"disconnect"});this.$emit("disconnect")}return this};n.prototype.onPacket=function(e){function n(){r.packet({type:"ack",args:t.util.toArray(arguments),ackId:e.id})}var r=this;switch(e.type){case"connect":this.$emit("connect");break;case"disconnect":if(this.name===""){this.socket.onDisconnect(e.reason||"booted")}else{this.$emit("disconnect",e.reason)}break;case"message":case"json":var i=["message",e.data];if(e.ack=="data"){i.push(n)}else if(e.ack){this.packet({type:"ack",ackId:e.id})}this.$emit.apply(this,i);break;case"event":var i=[e.name].concat(e.args);if(e.ack=="data")i.push(n);this.$emit.apply(this,i);break;case"ack":if(this.acks[e.ackId]){this.acks[e.ackId].apply(this,e.args);delete this.acks[e.ackId]}break;case"error":if(e.advice){this.socket.onError(e)}else{if(e.reason=="unauthorized"){this.$emit("connect_failed",e.reason)}else{this.$emit("error",e.reason)}}break}};r.prototype.send=function(){this.namespace.flags[this.name]=true;this.namespace.send.apply(this.namespace,arguments)};r.prototype.emit=function(){this.namespace.flags[this.name]=true;this.namespace.emit.apply(this.namespace,arguments)}})("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports);(function(e,t,n){function r(e){t.Transport.apply(this,arguments)}e.websocket=r;t.util.inherit(r,t.Transport);r.prototype.name="websocket";r.prototype.open=function(){var e=t.util.query(this.socket.options.query),r=this,i;if(!i){i=n.MozWebSocket||n.WebSocket}this.websocket=new i(this.prepareUrl()+e);this.websocket.onopen=function(){r.onOpen();r.socket.setBuffer(false)};this.websocket.onmessage=function(e){r.onData(e.data)};this.websocket.onclose=function(){r.onClose();r.socket.setBuffer(true)};this.websocket.onerror=function(e){r.onError(e)};return this};if(t.util.ua.iDevice){r.prototype.send=function(e){var t=this;setTimeout(function(){t.websocket.send(e)},0);return this}}else{r.prototype.send=function(e){this.websocket.send(e);return this}}r.prototype.payload=function(e){for(var t=0,n=e.length;t<n;t++){this.packet(e[t])}return this};r.prototype.close=function(){this.websocket.close();return this};r.prototype.onError=function(e){this.socket.onError(e)};r.prototype.scheme=function(){return this.socket.options.secure?"wss":"ws"};r.check=function(){return"WebSocket"in n&&!("__addTask"in WebSocket)||"MozWebSocket"in n};r.xdomainCheck=function(){return true};t.transports.push("websocket")})("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this);(function(e,t,n){function r(e){if(!e)return;t.Transport.apply(this,arguments);this.sendBuffer=[]}function i(){}e.XHR=r;t.util.inherit(r,t.Transport);r.prototype.open=function(){this.socket.setBuffer(false);this.onOpen();this.get();this.setCloseTimeout();return this};r.prototype.payload=function(e){var n=[];for(var r=0,i=e.length;r<i;r++){n.push(t.parser.encodePacket(e[r]))}this.send(t.parser.encodePayload(n))};r.prototype.send=function(e){this.post(e);return this};r.prototype.post=function(e){function t(){if(this.readyState==4){this.onreadystatechange=i;s.posting=false;if(this.status==200){s.socket.setBuffer(false)}else{s.onClose()}}}function r(){this.onload=i;s.socket.setBuffer(false)}var s=this;this.socket.setBuffer(true);this.sendXHR=this.request("POST");if(n.XDomainRequest&&this.sendXHR instanceof XDomainRequest){this.sendXHR.onload=this.sendXHR.onerror=r}else{this.sendXHR.onreadystatechange=t}this.sendXHR.send(e)};r.prototype.close=function(){this.onClose();return this};r.prototype.request=function(e){var n=t.util.request(this.socket.isXDomain()),r=t.util.query(this.socket.options.query,"t="+ +(new Date));n.open(e||"GET",this.prepareUrl()+r,true);if(e=="POST"){try{if(n.setRequestHeader){n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}else{n.contentType="text/plain"}}catch(i){}}return n};r.prototype.scheme=function(){return this.socket.options.secure?"https":"http"};r.check=function(e,r){try{var i=t.util.request(r),s=n.XDomainRequest&&i instanceof XDomainRequest,o=e&&e.options&&e.options.secure?"https:":"http:",u=n.location&&o!=n.location.protocol;if(i&&!(s&&u)){return true}}catch(a){}return false};r.xdomainCheck=function(e){return r.check(e,true)}})("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this);(function(e,t){function n(e){t.Transport.XHR.apply(this,arguments)}e.htmlfile=n;t.util.inherit(n,t.Transport.XHR);n.prototype.name="htmlfile";n.prototype.get=function(){this.doc=new(window[["Active"].concat("Object").join("X")])("htmlfile");this.doc.open();this.doc.write("<html></html>");this.doc.close();this.doc.parentWindow.s=this;var e=this.doc.createElement("div");e.className="socketio";this.doc.body.appendChild(e);this.iframe=this.doc.createElement("iframe");e.appendChild(this.iframe);var n=this,r=t.util.query(this.socket.options.query,"t="+ +(new Date));this.iframe.src=this.prepareUrl()+r;t.util.on(window,"unload",function(){n.destroy()})};n.prototype._=function(e,t){e=e.replace(/\\\//g,"/");this.onData(e);try{var n=t.getElementsByTagName("script")[0];n.parentNode.removeChild(n)}catch(r){}};n.prototype.destroy=function(){if(this.iframe){try{this.iframe.src="about:blank"}catch(e){}this.doc=null;this.iframe.parentNode.removeChild(this.iframe);this.iframe=null;CollectGarbage()}};n.prototype.close=function(){this.destroy();return t.Transport.XHR.prototype.close.call(this)};n.check=function(e){if(typeof window!="undefined"&&["Active"].concat("Object").join("X")in window){try{var n=new(window[["Active"].concat("Object").join("X")])("htmlfile");return n&&t.Transport.XHR.check(e)}catch(r){}}return false};n.xdomainCheck=function(){return false};t.transports.push("htmlfile")})("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports);(function(e,t,n){function r(){t.Transport.XHR.apply(this,arguments)}function i(){}e["xhr-polling"]=r;t.util.inherit(r,t.Transport.XHR);t.util.merge(r,t.Transport.XHR);r.prototype.name="xhr-polling";r.prototype.heartbeats=function(){return false};r.prototype.open=function(){var e=this;t.Transport.XHR.prototype.open.call(e);return false};r.prototype.get=function(){function e(){if(this.readyState==4){this.onreadystatechange=i;if(this.status==200){s.onData(this.responseText);s.get()}else{s.onClose()}}}function t(){this.onload=i;this.onerror=i;s.retryCounter=1;s.onData(this.responseText);s.get()}function r(){s.retryCounter++;if(!s.retryCounter||s.retryCounter>3){s.onClose()}else{s.get()}}if(!this.isOpen)return;var s=this;this.xhr=this.request();if(n.XDomainRequest&&this.xhr instanceof XDomainRequest){this.xhr.onload=t;this.xhr.onerror=r}else{this.xhr.onreadystatechange=e}this.xhr.send(null)};r.prototype.onClose=function(){t.Transport.XHR.prototype.onClose.call(this);if(this.xhr){this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=i;try{this.xhr.abort()}catch(e){}this.xhr=null}};r.prototype.ready=function(e,n){var r=this;t.util.defer(function(){n.call(r)})};t.transports.push("xhr-polling")})("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this);(function(e,t,n){function r(e){t.Transport["xhr-polling"].apply(this,arguments);this.index=t.j.length;var n=this;t.j.push(function(e){n._(e)})}var i=n.document&&"MozAppearance"in n.document.documentElement.style;e["jsonp-polling"]=r;t.util.inherit(r,t.Transport["xhr-polling"]);r.prototype.name="jsonp-polling";r.prototype.post=function(e){function n(){r();i.socket.setBuffer(false)}function r(){if(i.iframe){i.form.removeChild(i.iframe)}try{f=document.createElement('<iframe name="'+i.iframeId+'">')}catch(e){f=document.createElement("iframe");f.name=i.iframeId}f.id=i.iframeId;i.form.appendChild(f);i.iframe=f}var i=this,s=t.util.query(this.socket.options.query,"t="+ +(new Date)+"&i="+this.index);if(!this.form){var o=document.createElement("form"),u=document.createElement("textarea"),a=this.iframeId="socketio_iframe_"+this.index,f;o.className="socketio";o.style.position="absolute";o.style.top="0px";o.style.left="0px";o.style.display="none";o.target=a;o.method="POST";o.setAttribute("accept-charset","utf-8");u.name="d";o.appendChild(u);document.body.appendChild(o);this.form=o;this.area=u}this.form.action=this.prepareUrl()+s;r();this.area.value=t.JSON.stringify(e);try{this.form.submit()}catch(l){}if(this.iframe.attachEvent){f.onreadystatechange=function(){if(i.iframe.readyState=="complete"){n()}}}else{this.iframe.onload=n}this.socket.setBuffer(true)};r.prototype.get=function(){var e=this,n=document.createElement("script"),r=t.util.query(this.socket.options.query,"t="+ +(new Date)+"&i="+this.index);if(this.script){this.script.parentNode.removeChild(this.script);this.script=null}n.async=true;n.src=this.prepareUrl()+r;n.onerror=function(){e.onClose()};var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(n,s);this.script=n;if(i){setTimeout(function(){var e=document.createElement("iframe");document.body.appendChild(e);document.body.removeChild(e)},100)}};r.prototype._=function(e){this.onData(e);if(this.isOpen){this.get()}return this};r.prototype.ready=function(e,n){var r=this;if(!i)return n.call(this);t.util.load(function(){n.call(r)})};r.check=function(){return"document"in n};r.xdomainCheck=function(){return true};t.transports.push("jsonp-polling")})("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this);if(typeof define==="function"&&define.amd){define([],function(){return io})}})();ns("boc.utils");boc.utils.AnimationSequence=function(e){function o(t){if(i){return}s++;if(s>=n.length){if(e.onLoopComplete){e.onLoopComplete()}if(!r){return}else{s=0}}u.elapsedTime=0;u.state=boc.constants.ANIMATION_PLAYING;u.componentName=n[s].componentName;u.propertyDeltas=n[s].propertyDeltas;u.easing=n[s].easing;u.duration=n[s].duration}var t=e.entity;if(typeof t=="string"){t=new boc.core.Entity({id:t})}var n=e.animations;var r=e.loop!=null&&e.loop!=undefined?e.loop:false;var i=false;var s=0;var u=new boc.components.Animation({});u.addListener("onComplete",o);if(e.onAnimationComplete){var a=e.onAnimationComplete instanceof Array?e.onAnimationComplete:[e.onAnimationComplete];for(var f=0;f<a.length;f++){u.addListener("onComplete",a[f])}}u.componentName=n[0].componentName;u.propertyDeltas=n[0].propertyDeltas;u.easing=n[0].easing;u.duration=n[0].duration;this.stop=function(){i=true;u.state=boc.constants.ANIMATION_STOPPED};this.pause=function(){u.state=boc.constants.ANIMATION_PAUSED};this.start=function(){i=false;var e=t.Animation;if(e){t.removeComponent("Animation")}t.addComponent(u);u.state=boc.constants.ANIMATION_PLAYING}};ns("boc.utils");boc.utils.Camera=function(e){var t=this;this.xmin=e.xmin;this.xmax=e.xmax;this.ymin=e.ymin;this.ymax=e.ymax;this.zoom=1;this.width=function(){return this.xmax-this.xmin};this.height=function(){return this.ymax-this.ymin};var n=new boc.utils.EventManager;this.move=function(e,t){this.update({xmin:this.xmin+e,xmax:this.xmax+e,ymin:this.ymin+t,ymax:this.ymax+t})};this.update=function(e){if(!e){e={}}if(e.xmin==undefined||e.xmin==null){e.xmin=this.xmin}if(e.ymin==undefined||e.ymin==null){e.ymin=this.ymin}if(e.xmax==undefined||e.xmax==null){e.xmax=this.xmax}if(e.ymax==undefined||e.ymax==null){e.ymax=this.ymax}if(e.zoom==undefined||e.zoom==null){e.zoom=this.zoom}var t=e.xmin==this.xmin&&e.ymin==this.ymin&&e.xmax==this.xmax&&e.ymax==this.ymax&&e.zoom==this.zoom;var r={xmin:this.xmin,xmax:this.xmax,ymin:this.ymin,ymax:this.ymax,zoom:this.zoom};this.xmin=e.xmin;this.xmax=e.xmax;this.ymin=e.ymin;this.ymax=e.ymax;this.zoom=e.zoom;if(!t){n.notify("onchange",{oldCamera:r,newCamera:e})}};this.addListener=n.addListener;this.removeListener=n.removeListener;this.intersects=function(e){return this.xmin<e.xmax*this.zoom&&this.xmax/this.zoom>e.xmin&&this.ymin<e.ymax*this.zoom&&this.ymax/this.zoom>e.ymin};this.contains=function(e){return e.x<this.xmax&&e.x>this.xmin&&e.y<this.ymax&&e.y>this.ymin}};ns("boc.utils");boc.utils.EventManager=function(e){var t={};var n=this;this.notify=function(e,n){if(t[e]){for(var r=0;r<t[e].length;r++){t[e][r](n)}}};this.addListener=function(e,n){if(!t[e]){t[e]=[]}t[e].push(n)};this.removeListener=function(e,n){if(t[e]){if(typeof n=="undefined"||n==null){t[e]=[]}else{var r=t[e].indexOf(n);if(r>=0){t[e].splice(r,1)}}}};if(e){e.addListener=this.addListener;e.on=e.addListener;e.removeListener=this.removeListener;e.emit=this.notify;e.update=function(e,t){if(this[e]){var r=this[e];if(r===t){return}this[e]=t;n.notify("onPropertyChange",{propertyName:e,oldValue:r,newValue:t})}}}};ns("boc.utils");boc.utils.EventEmitter=function(){this._listeners={}};boc.utils.EventEmitter.prototype.on=function(e,t){if(!this._listeners[e]){this._listeners[e]=[]}this._listeners[e].push(t)};boc.utils.EventEmitter.prototype.addListener=boc.utils.EventEmitter.prototype.on;boc.utils.EventEmitter.prototype.removeListener=function(e,t){var n=this._listeners[e];if(!n){return}for(var r=0;r<n.length;r++){if(n[r]===t){n.splice(r,1);return}}};boc.utils.EventEmitter.prototype.emit=function(e,t){var n=this._listeners[e];if(!n){return}for(var r=0;r<n.length;r++){n[r](t)}};boc.utils.EventEmitter.prototype.notify=boc.utils.EventEmitter.prototype.emit;Math.linearTween=function(e,t,n,r){return n*e/r+t};Math.easeInQuad=function(e,t,n,r){return n*(e/=r)*e+t};Math.easeOutQuad=function(e,t,n,r){return-n*(e/=r)*(e-2)+t};Math.easeInOutQuad=function(e,t,n,r){if((e/=r/2)<1)return n/2*e*e+t;return-n/2*(--e*(e-2)-1)+t};Math.easeInCubic=function(e,t,n,r){return n*(e/=r)*e*e+t};Math.easeOutCubic=function(e,t,n,r){return n*((e=e/r-1)*e*e+1)+t};Math.easeInOutCubic=function(e,t,n,r){if((e/=r/2)<1)return n/2*e*e*e+t;return n/2*((e-=2)*e*e+2)+t};Math.easeInQuart=function(e,t,n,r){return n*(e/=r)*e*e*e+t};Math.easeOutQuart=function(e,t,n,r){return-n*((e=e/r-1)*e*e*e-1)+t};Math.easeInOutQuart=function(e,t,n,r){if((e/=r/2)<1)return n/2*e*e*e*e+t;return-n/2*((e-=2)*e*e*e-2)+t};Math.easeInQuint=function(e,t,n,r){return n*(e/=r)*e*e*e*e+t};Math.easeOutQuint=function(e,t,n,r){return n*((e=e/r-1)*e*e*e*e+1)+t};Math.easeInOutQuint=function(e,t,n,r){if((e/=r/2)<1)return n/2*e*e*e*e*e+t;return n/2*((e-=2)*e*e*e*e+2)+t};Math.easeInSine=function(e,t,n,r){return-n*Math.cos(e/r*(Math.PI/2))+n+t};Math.easeOutSine=function(e,t,n,r){return n*Math.sin(e/r*(Math.PI/2))+t};Math.easeInOutSine=function(e,t,n,r){return-n/2*(Math.cos(Math.PI*e/r)-1)+t};Math.easeInExpo=function(e,t,n,r){return e==0?t:n*Math.pow(2,10*(e/r-1))+t};Math.easeOutExpo=function(e,t,n,r){return e==r?t+n:n*(-Math.pow(2,-10*e/r)+1)+t};Math.easeInOutExpo=function(e,t,n,r){if(e==0)return t;if(e==r)return t+n;if((e/=r/2)<1)return n/2*Math.pow(2,10*(e-1))+t;return n/2*(-Math.pow(2,-10*--e)+2)+t};Math.easeInCirc=function(e,t,n,r){return-n*(Math.sqrt(1-(e/=r)*e)-1)+t};Math.easeOutCirc=function(e,t,n,r){return n*Math.sqrt(1-(e=e/r-1)*e)+t};Math.easeInOutCirc=function(e,t,n,r){if((e/=r/2)<1)return-n/2*(Math.sqrt(1-e*e)-1)+t;return n/2*(Math.sqrt(1-(e-=2)*e)+1)+t};Math.easeInElastic=function(e,t,n,r,i,s){if(!i)i=1;if(e==0)return t;if((e/=r)==1)return t+n;if(!s)s=r*.3;if(i<Math.abs(n)){i=n;var o=s/4}else var o=s/(2*Math.PI)*Math.asin(n/i);return-(i*Math.pow(2,10*(e-=1))*Math.sin((e*r-o)*2*Math.PI/s))+t};Math.easeOutElastic=function(e,t,n,r,i,s){if(!i)i=1;if(e==0)return t;if((e/=r)==1)return t+n;if(!s)s=r*.3;if(i<Math.abs(n)){i=n;var o=s/4}else var o=s/(2*Math.PI)*Math.asin(n/i);return i*Math.pow(2,-10*e)*Math.sin((e*r-o)*2*Math.PI/s)+n+t};Math.easeInOutElastic=function(e,t,n,r,i,s){if(!i)i=1;if(e==0)return t;if((e/=r/2)==2)return t+n;if(!s)s=r*.3*1.5;if(i<Math.abs(n)){i=n;var o=s/4}else var o=s/(2*Math.PI)*Math.asin(n/i);if(e<1)return-.5*i*Math.pow(2,10*(e-=1))*Math.sin((e*r-o)*2*Math.PI/s)+t;return i*Math.pow(2,-10*(e-=1))*Math.sin((e*r-o)*2*Math.PI/s)*.5+n+t};Math.easeInBack=function(e,t,n,r,i){if(i==undefined)i=1.70158;return n*(e/=r)*e*((i+1)*e-i)+t};Math.easeOutBack=function(e,t,n,r,i){if(i==undefined)i=1.70158;return n*((e=e/r-1)*e*((i+1)*e+i)+1)+t};Math.easeInOutBack=function(e,t,n,r,i){if(i==undefined)i=1.70158;if((e/=r/2)<1)return n/2*e*e*(((i*=1.525)+1)*e-i)+t;return n/2*((e-=2)*e*(((i*=1.525)+1)*e+i)+2)+t};Math.easeInBounce=function(e,t,n,r){return n-Math.easeOutBounce(r-e,0,n,r)+t};Math.easeOutBounce=function(e,t,n,r){if((e/=r)<1/2.75){return n*7.5625*e*e+t}else if(e<2/2.75){return n*(7.5625*(e-=1.5/2.75)*e+.75)+t}else if(e<2.5/2.75){return n*(7.5625*(e-=2.25/2.75)*e+.9375)+t}else{return n*(7.5625*(e-=2.625/2.75)*e+.984375)+t}};Math.easeInOutBounce=function(e,t,n,r){if(e<r/2)return Math.easeInBounce(e*2,0,n,r)*.5+t;return Math.easeOutBounce(e*2-r,0,n,r)*.5+n*.5+t};ns("boc.utils");boc.utils.SpriteAnimationSequence=function(e){function u(t){if(s){return}o++;if(o>=r.length){if(e.onLoopComplete){e.onLoopComplete()}if(!i){return}else{o=0}}a.elapsedTime=0;a.state=boc.constants.ANIMATION_PLAYING;a.sprites=r[o].sprites;a.easing=r[o].easing;a.duration=r[o].duration;a.currentFrame=0}var t=e.entityManager||boc.utils._em;var n=e.entity;if(typeof n!="string"){n=n.id()}var r=e.animations;var i=e.loop!=null&&e.loop!=undefined?e.loop:false;var s=false;var o=0;var a=new boc.components.SpriteAnimation({});a.addListener("onComplete",u);a.sprites=r[0].sprites;a.easing=r[0].easing;a.duration=r[0].duration;this.stop=function(){s=true;a.state=boc.constants.ANIMATION_STOPPED};this.pause=function(){a.state=boc.constants.ANIMATION_PAUSED};this.start=function(){s=false;var e=t.getComponentForEntity("SpriteAnimation",n);if(e){t.removeComponentFromEntity("SpriteAnimation",n)}a.state=boc.constants.ANIMATION_PLAYING;t.addComponentToEntity(a,n)}};var spine={};spine.BoneData=function(e,t){this.name=e;this.parent=t};spine.BoneData.prototype={length:0,x:0,y:0,rotation:0,scaleX:1,scaleY:1};spine.SlotData=function(e,t){this.name=e;this.boneData=t};spine.SlotData.prototype={r:1,g:1,b:1,a:1,attachmentName:null};spine.Bone=function(e,t){this.data=e;this.parent=t;this.setToSetupPose()};spine.Bone.yDown=false;spine.Bone.prototype={x:0,y:0,rotation:0,scaleX:1,scaleY:1,m00:0,m01:0,worldX:0,m10:0,m11:0,worldY:0,worldRotation:0,worldScaleX:1,worldScaleY:1,updateWorldTransform:function(e,t){var n=this.parent;if(n!=null){this.worldX=this.x*n.m00+this.y*n.m01+n.worldX;this.worldY=this.x*n.m10+this.y*n.m11+n.worldY;this.worldScaleX=n.worldScaleX*this.scaleX;this.worldScaleY=n.worldScaleY*this.scaleY;this.worldRotation=n.worldRotation+this.rotation}else{this.worldX=e?-this.x:this.x;this.worldY=t?-this.y:this.y;this.worldScaleX=this.scaleX;this.worldScaleY=this.scaleY;this.worldRotation=this.rotation}var r=this.worldRotation*Math.PI/180;var i=Math.cos(r);var s=Math.sin(r);this.m00=i*this.worldScaleX;this.m10=s*this.worldScaleX;this.m01=-s*this.worldScaleY;this.m11=i*this.worldScaleY;if(e){this.m00=-this.m00;this.m01=-this.m01}if(t){this.m10=-this.m10;this.m11=-this.m11}if(spine.Bone.yDown){this.m10=-this.m10;this.m11=-this.m11}},setToSetupPose:function(){var e=this.data;this.x=e.x;this.y=e.y;this.rotation=e.rotation;this.scaleX=e.scaleX;this.scaleY=e.scaleY}};spine.Slot=function(e,t,n){this.data=e;this.skeleton=t;this.bone=n;this.setToSetupPose()};spine.Slot.prototype={r:1,g:1,b:1,a:1,_attachmentTime:0,attachment:null,setAttachment:function(e){this.attachment=e;this._attachmentTime=this.skeleton.time},setAttachmentTime:function(e){this._attachmentTime=this.skeleton.time-e},getAttachmentTime:function(){return this.skeleton.time-this._attachmentTime},setToSetupPose:function(){var e=this.data;this.r=e.r;this.g=e.g;this.b=e.b;this.a=e.a;var t=this.skeleton.data.slots;for(var n=0,r=t.length;n<r;n++){if(t[n]==e){this.setAttachment(!e.attachmentName?null:this.skeleton.getAttachmentBySlotIndex(n,e.attachmentName));break}}}};spine.Skin=function(e){this.name=e;this.attachments={}};spine.Skin.prototype={addAttachment:function(e,t,n){this.attachments[e+":"+t]=n},getAttachment:function(e,t){return this.attachments[e+":"+t]},_attachAll:function(e,t){for(var n in t.attachments){var r=n.indexOf(":");var i=parseInt(n.substring(0,r));var s=n.substring(r+1);var o=e.slots[i];if(o.attachment&&o.attachment.name==s){var u=this.getAttachment(i,s);if(u)o.setAttachment(u)}}}};spine.Animation=function(e,t,n){this.name=e;this.timelines=t;this.duration=n};spine.Animation.prototype={apply:function(e,t,n){if(n&&this.duration!=0)t%=this.duration;var r=this.timelines;for(var i=0,s=r.length;i<s;i++)r[i].apply(e,t,1)},mix:function(e,t,n,r){if(n&&this.duration!=0)t%=this.duration;var i=this.timelines;for(var s=0,o=i.length;s<o;s++)i[s].apply(e,t,r)}};spine.binarySearch=function(e,t,n){var r=0;var i=Math.floor(e.length/n)-2;if(i==0)return n;var s=i>>>1;while(true){if(e[(s+1)*n]<=t)r=s+1;else i=s;if(r==i)return(r+1)*n;s=r+i>>>1}};spine.linearSearch=function(e,t,n){for(var r=0,i=e.length-n;r<=i;r+=n)if(e[r]>t)return r;return-1};spine.Curves=function(e){this.curves=[];this.curves.length=(e-1)*6};spine.Curves.prototype={setLinear:function(e){this.curves[e*6]=0},setStepped:function(e){this.curves[e*6]=-1},setCurve:function(e,t,n,r,i){var s=1/10;var o=s*s;var u=o*s;var a=3*s;var f=3*o;var l=6*o;var c=6*u;var h=-t*2+r;var p=-n*2+i;var d=(t-r)*3+1;var v=(n-i)*3+1;var m=e*6;var g=this.curves;g[m]=t*a+h*f+d*u;g[m+1]=n*a+p*f+v*u;g[m+2]=h*l+d*c;g[m+3]=p*l+v*c;g[m+4]=d*c;g[m+5]=v*c},getCurvePercent:function(e,t){t=t<0?0:t>1?1:t;var n=e*6;var r=this.curves;var i=r[n];if(!i)return t;if(i==-1)return 0;var s=r[n+1];var o=r[n+2];var u=r[n+3];var a=r[n+4];var f=r[n+5];var l=i,c=s;var h=10-2;while(true){if(l>=t){var p=l-i;var d=c-s;return d+(c-d)*(t-p)/(l-p)}if(h==0)break;h--;i+=o;s+=u;o+=a;u+=f;l+=i;c+=s}return c+(1-c)*(t-l)/(1-l)}};spine.RotateTimeline=function(e){this.curves=new spine.Curves(e);this.frames=[];this.frames.length=e*2};spine.RotateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(e,t,n){e*=2;this.frames[e]=t;this.frames[e+1]=n},apply:function(e,t,n){var r=this.frames;if(t<r[0])return;var i=e.bones[this.boneIndex];if(t>=r[r.length-2]){var s=i.data.rotation+r[r.length-1]-i.rotation;while(s>180)s-=360;while(s<-180)s+=360;i.rotation+=s*n;return}var o=spine.binarySearch(r,t,2);var u=r[o-1];var a=r[o];var f=1-(t-a)/(r[o-2]-a);f=this.curves.getCurvePercent(o/2-1,f);var s=r[o+1]-u;while(s>180)s-=360;while(s<-180)s+=360;s=i.data.rotation+(u+s*f)-i.rotation;while(s>180)s-=360;while(s<-180)s+=360;i.rotation+=s*n}};spine.TranslateTimeline=function(e){this.curves=new spine.Curves(e);this.frames=[];this.frames.length=e*3};spine.TranslateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(e,t,n,r){e*=3;this.frames[e]=t;this.frames[e+1]=n;this.frames[e+2]=r},apply:function(e,t,n){var r=this.frames;if(t<r[0])return;var i=e.bones[this.boneIndex];if(t>=r[r.length-3]){i.x+=(i.data.x+r[r.length-2]-i.x)*n;i.y+=(i.data.y+r[r.length-1]-i.y)*n;return}var s=spine.binarySearch(r,t,3);var o=r[s-2];var u=r[s-1];var a=r[s];var f=1-(t-a)/(r[s+ -3]-a);f=this.curves.getCurvePercent(s/3-1,f);i.x+=(i.data.x+o+(r[s+1]-o)*f-i.x)*n;i.y+=(i.data.y+u+(r[s+2]-u)*f-i.y)*n}};spine.ScaleTimeline=function(e){this.curves=new spine.Curves(e);this.frames=[];this.frames.length=e*3};spine.ScaleTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(e,t,n,r){e*=3;this.frames[e]=t;this.frames[e+1]=n;this.frames[e+2]=r},apply:function(e,t,n){var r=this.frames;if(t<r[0])return;var i=e.bones[this.boneIndex];if(t>=r[r.length-3]){i.scaleX+=(i.data.scaleX-1+r[r.length-2]-i.scaleX)*n;i.scaleY+=(i.data.scaleY-1+r[r.length-1]-i.scaleY)*n;return}var s=spine.binarySearch(r,t,3);var o=r[s-2];var u=r[s-1];var a=r[s];var f=1-(t-a)/(r[s+ -3]-a);f=this.curves.getCurvePercent(s/3-1,f);i.scaleX+=(i.data.scaleX-1+o+(r[s+1]-o)*f-i.scaleX)*n;i.scaleY+=(i.data.scaleY-1+u+(r[s+2]-u)*f-i.scaleY)*n}};spine.ColorTimeline=function(e){this.curves=new spine.Curves(e);this.frames=[];this.frames.length=e*5};spine.ColorTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length/5},setFrame:function(e,t,n,r,i,s){e*=5;this.frames[e]=t;this.frames[e+1]=n;this.frames[e+2]=r;this.frames[e+3]=i;this.frames[e+4]=s},apply:function(e,t,n){var r=this.frames;if(t<r[0])return;var i=e.slots[this.slotIndex];if(t>=r[r.length-5]){var s=r.length-1;i.r=r[s-3];i.g=r[s-2];i.b=r[s-1];i.a=r[s];return}var o=spine.binarySearch(r,t,5);var u=r[o-4];var a=r[o-3];var f=r[o-2];var l=r[o-1];var c=r[o];var h=1-(t-c)/(r[o-5]-c);h=this.curves.getCurvePercent(o/5-1,h);var p=u+(r[o+1]-u)*h;var d=a+(r[o+2]-a)*h;var v=f+(r[o+3]-f)*h;var m=l+(r[o+4]-l)*h;if(n<1){i.r+=(p-i.r)*n;i.g+=(d-i.g)*n;i.b+=(v-i.b)*n;i.a+=(m-i.a)*n}else{i.r=p;i.g=d;i.b=v;i.a=m}}};spine.AttachmentTimeline=function(e){this.curves=new spine.Curves(e);this.frames=[];this.frames.length=e;this.attachmentNames=[];this.attachmentNames.length=e};spine.AttachmentTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(e,t,n){this.frames[e]=t;this.attachmentNames[e]=n},apply:function(e,t,n){var r=this.frames;if(t<r[0])return;var i;if(t>=r[r.length-1])i=r.length-1;else i=spine.binarySearch(r,t,1)-1;var s=this.attachmentNames[i];e.slots[this.slotIndex].setAttachment(!s?null:e.getAttachmentBySlotIndex(this.slotIndex,s))}};spine.SkeletonData=function(){this.bones=[];this.slots=[];this.skins=[];this.animations=[]};spine.SkeletonData.prototype={defaultSkin:null,findBone:function(e){var t=this.bones;for(var n=0,r=t.length;n<r;n++)if(t[n].name==e)return t[n];return null},findBoneIndex:function(e){var t=this.bones;for(var n=0,r=t.length;n<r;n++)if(t[n].name==e)return n;return-1},findSlot:function(e){var t=this.slots;for(var n=0,r=t.length;n<r;n++){if(t[n].name==e)return slot[n]}return null},findSlotIndex:function(e){var t=this.slots;for(var n=0,r=t.length;n<r;n++)if(t[n].name==e)return n;return-1},findSkin:function(e){var t=this.skins;for(var n=0,r=t.length;n<r;n++)if(t[n].name==e)return t[n];return null},findAnimation:function(e){var t=this.animations;for(var n=0,r=t.length;n<r;n++)if(t[n].name==e)return t[n];return null}};spine.Skeleton=function(e){this.data=e;this.bones=[];for(var t=0,n=e.bones.length;t<n;t++){var r=e.bones[t];var i=!r.parent?null:this.bones[e.bones.indexOf(r.parent)];this.bones.push(new spine.Bone(r,i))}this.slots=[];this.drawOrder=[];for(var t=0,n=e.slots.length;t<n;t++){var s=e.slots[t];var o=this.bones[e.bones.indexOf(s.boneData)];var u=new spine.Slot(s,this,o);this.slots.push(u);this.drawOrder.push(u)}};spine.Skeleton.prototype={skin:null,r:1,g:1,b:1,a:1,time:0,flipX:false,flipY:false,updateWorldTransform:function(){var e=this.flipX;var t=this.flipY;var n=this.bones;for(var r=0,i=n.length;r<i;r++)n[r].updateWorldTransform(e,t)},setToSetupPose:function(){this.setBonesToSetupPose();this.setSlotsToSetupPose()},setBonesToSetupPose:function(){var e=this.bones;for(var t=0,n=e.length;t<n;t++)e[t].setToSetupPose()},setSlotsToSetupPose:function(){var e=this.slots;for(var t=0,n=e.length;t<n;t++)e[t].setToSetupPose(t)},getRootBone:function(){return this.bones.length==0?null:this.bones[0]},findBone:function(e){var t=this.bones;for(var n=0,r=t.length;n<r;n++)if(t[n].data.name==e)return t[n];return null},findBoneIndex:function(e){var t=this.bones;for(var n=0,r=t.length;n<r;n++)if(t[n].data.name==e)return n;return-1},findSlot:function(e){var t=this.slots;for(var n=0,r=t.length;n<r;n++)if(t[n].data.name==e)return t[n];return null},findSlotIndex:function(e){var t=this.slots;for(var n=0,r=t.length;n<r;n++)if(t[n].data.name==e)return n;return-1},setSkinByName:function(e){var t=this.data.findSkin(e);if(!t)throw"Skin not found: "+e;this.setSkin(t)},setSkin:function(e){if(this.skin&&e)e._attachAll(this,this.skin);this.skin=e},getAttachmentBySlotName:function(e,t){return this.getAttachmentBySlotIndex(this.data.findSlotIndex(e),t)},getAttachmentBySlotIndex:function(e,t){if(this.skin){var n=this.skin.getAttachment(e,t);if(n)return n}if(this.data.defaultSkin)return this.data.defaultSkin.getAttachment(e,t);return null},setAttachment:function(e,t){var n=this.slots;for(var r=0,i=n.size;r<i;r++){var s=n[r];if(s.data.name==e){var o=null;if(t){o=this.getAttachment(r,t);if(o==null)throw"Attachment not found: "+t+", for slot: "+e}s.setAttachment(o);return}}throw"Slot not found: "+e},update:function(e){time+=e}};spine.AttachmentType={region:0};spine.RegionAttachment=function(){this.offset=[];this.offset.length=8;this.uvs=[];this.uvs.length=8};spine.RegionAttachment.prototype={x:0,y:0,rotation:0,scaleX:1,scaleY:1,width:0,height:0,rendererObject:null,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,setUVs:function(e,t,n,r,i){var s=this.uvs;if(i){s[2]=e;s[3]=r;s[4]=e;s[5]=t;s[6]=n;s[7]=t;s[0]=n;s[1]=r}else{s[0]=e;s[1]=r;s[2]=e;s[3]=t;s[4]=n;s[5]=t;s[6]=n;s[7]=r}},updateOffset:function(){var e=this.width/this.regionOriginalWidth*this.scaleX;var t=this.height/this.regionOriginalHeight*this.scaleY;var n=-this.width/2*this.scaleX+this.regionOffsetX*e;var r=-this.height/2*this.scaleY+this.regionOffsetY*t;var i=n+this.regionWidth*e;var s=r+this.regionHeight*t;var o=this.rotation*Math.PI/180;var u=Math.cos(o);var a=Math.sin(o);var f=n*u+this.x;var l=n*a;var c=r*u+this.y;var h=r*a;var p=i*u+this.x;var d=i*a;var v=s*u+this.y;var m=s*a;var g=this.offset;g[0]=f-h;g[1]=c+l;g[2]=f-m;g[3]=v+l;g[4]=p-m;g[5]=v+d;g[6]=p-h;g[7]=c+d},computeVertices:function(e,t){var n=e.worldX;var r=e.worldY;var i=e.m00;var s=e.m01;var o=e.m10;var u=e.m11;var a=this.offset;t[0]=a[0]*i+a[1]*s+n;t[1]=a[0]*o+a[1]*u+r;t[2]=a[2]*i+a[3]*s+n;t[3]=a[2]*o+a[3]*u+r;t[4]=a[4]*i+a[5]*s+n;t[5]=a[4]*o+a[5]*u+r;t[6]=a[6]*i+a[7]*s+n;t[7]=a[6]*o+a[7]*u+r}};spine.AnimationStateData=function(e){this.skeletonData=e;this.animationToMixTime={}};spine.AnimationStateData.prototype={setMixByName:function(e,t,n){var r=this.skeletonData.findAnimation(e);if(!r)throw"Animation not found: "+e;var i=this.skeletonData.findAnimation(t);if(!i)throw"Animation not found: "+t;this.setMix(r,i,n)},setMix:function(e,t,n){this.animationToMixTime[e.name+":"+t.name]=n},getMix:function(e,t){var n=this.animationToMixTime[e.name+":"+t.name];return n?n:0}};spine.AnimationState=function(e){this.data=e;this.queue=[]};spine.AnimationState.prototype={current:null,previous:null,currentTime:0,previousTime:0,currentLoop:false,previousLoop:false,mixTime:0,mixDuration:0,update:function(e){this.currentTime+=e;this.previousTime+=e;this.mixTime+=e;if(this.queue.length>0){var t=this.queue[0];if(this.currentTime>=t.delay){this._setAnimation(t.animation,t.loop);this.queue.shift()}}},apply:function(e){if(!this.current)return;if(this.previous){this.previous.apply(e,this.previousTime,this.previousLoop);var t=this.mixTime/this.mixDuration;if(t>=1){t=1;this.previous=null}this.current.mix(e,this.currentTime,this.currentLoop,t)}else this.current.apply(e,this.currentTime,this.currentLoop)},clearAnimation:function(){this.previous=null;this.current=null;this.queue.length=0},_setAnimation:function(e,t){this.previous=null;if(e&&this.current){this.mixDuration=this.data.getMix(this.current,e);if(this.mixDuration>0){this.mixTime=0;this.previous=this.current;this.previousTime=this.currentTime;this.previousLoop=this.currentLoop}}this.current=e;this.currentLoop=t;this.currentTime=0},setAnimationByName:function(e,t){var n=this.data.skeletonData.findAnimation(e);if(!n)throw"Animation not found: "+e;this.setAnimation(n,t)},setAnimation:function(e,t){this.queue.length=0;this._setAnimation(e,t)},addAnimationByName:function(e,t,n){var r=this.data.skeletonData.findAnimation(e);if(!r)throw"Animation not found: "+e;this.addAnimation(r,t,n)},addAnimation:function(e,t,n){var r={};r.animation=e;r.loop=t;if(!n||n<=0){var i=this.queue.length==0?this.current:this.queue[this.queue.length-1].animation;if(i!=null)n=i.duration-this.data.getMix(i,e)+(n||0);else n=0}r.delay=n;this.queue.push(r)},isComplete:function(){return!this.current||this.currentTime>=this.current.duration}};spine.SkeletonJson=function(e){this.attachmentLoader=e};spine.SkeletonJson.prototype={scale:1,readSkeletonData:function(e){var t=new spine.SkeletonData;var n=e["bones"];for(var r=0,i=n.length;r<i;r++){var s=n[r];var o=null;if(s["parent"]){o=t.findBone(s["parent"]);if(!o)throw"Parent bone not found: "+s["parent"]}var u=new spine.BoneData(s["name"],o);u.length=(s["length"]||0)*this.scale;u.x=(s["x"]||0)*this.scale;u.y=(s["y"]||0)*this.scale;u.rotation=s["rotation"]||0;u.scaleX=s["scaleX"]||1;u.scaleY=s["scaleY"]||1;t.bones.push(u)}var a=e["slots"];for(var r=0,i=a.length;r<i;r++){var f=a[r];var u=t.findBone(f["bone"]);if(!u)throw"Slot bone not found: "+f["bone"];var l=new spine.SlotData(f["name"],u);var c=f["color"];if(c){l.r=spine.SkeletonJson.toColor(c,0);l.g=spine.SkeletonJson.toColor(c,1);l.b=spine.SkeletonJson.toColor(c,2);l.a=spine.SkeletonJson.toColor(c,3)}l.attachmentName=f["attachment"];t.slots.push(l)}var h=e["skins"];for(var p in h){if(!h.hasOwnProperty(p))continue;var d=h[p];var v=new spine.Skin(p);for(var m in d){if(!d.hasOwnProperty(m))continue;var g=t.findSlotIndex(m);var y=d[m];for(var b in y){if(!y.hasOwnProperty(b))continue;var w=this.readAttachment(v,b,y[b]);if(w!=null)v.addAttachment(g,b,w)}}t.skins.push(v);if(v.name=="default")t.defaultSkin=v}var E=e["animations"];for(var S in E){if(!E.hasOwnProperty(S))continue;this.readAnimation(S,E[S],t)}return t},readAttachment:function(e,t,n){t=n["name"]||t;var r=spine.AttachmentType[n["type"]||"region"];var i=this.attachmentLoader.newAttachment(e,r,t);if(r==spine.AttachmentType.region){i.x=(n["x"]||0)*this.scale;i.y=(n["y"]||0)*this.scale;i.scaleX=n["scaleX"]||1;i.scaleY=n["scaleY"]||1;i.rotation=n["rotation"]||0;i.width=(n["width"]||32)*this.scale;i.height=(n["height"]||32)*this.scale;i.updateOffset()}return i},readAnimation:function(e,t,n){var r=[];var i=0;var s=t["bones"];for(var o in s){if(!s.hasOwnProperty(o))continue;var u=n.findBoneIndex(o);if(u==-1)throw"Bone not found: "+o;var a=s[o];for(var f in a){if(!a.hasOwnProperty(f))continue;var l=a[f];if(f=="rotate"){var c=new spine.RotateTimeline(l.length);c.boneIndex=u;var h=0;for(var p=0,d=l.length;p<d;p++){var v=l[p];c.setFrame(h,v["time"],v["angle"]);spine.SkeletonJson.readCurve(c,h,v);h++}r.push(c);i=Math.max(i,c.frames[c.getFrameCount()*2-2])}else if(f=="translate"||f=="scale"){var c;var m=1;if(f=="scale")c=new spine.ScaleTimeline(l.length);else{c=new spine.TranslateTimeline(l.length);m=this.scale}c.boneIndex=u;var h=0;for(var p=0,d=l.length;p<d;p++){var v=l[p];var g=(v["x"]||0)*m;var y=(v["y"]||0)*m;c.setFrame(h,v["time"],g,y);spine.SkeletonJson.readCurve(c,h,v);h++}r.push(c);i=Math.max(i,c.frames[c.getFrameCount()*3-3])}else throw"Invalid timeline type for a bone: "+f+" ("+o+")"}}var b=t["slots"];for(var w in b){if(!b.hasOwnProperty(w))continue;var E=b[w];var S=n.findSlotIndex(w);for(var f in E){if(!E.hasOwnProperty(f))continue;var l=E[f];if(f=="color"){var c=new spine.ColorTimeline(l.length);c.slotIndex=S;var h=0;for(var p=0,d=l.length;p<d;p++){var v=l[p];var x=v["color"];var T=spine.SkeletonJson.toColor(x,0);var N=spine.SkeletonJson.toColor(x,1);var C=spine.SkeletonJson.toColor(x,2);var k=spine.SkeletonJson.toColor(x,3);c.setFrame(h,v["time"],T,N,C,k);spine.SkeletonJson.readCurve(c,h,v);h++}r.push(c);i=Math.max(i,c.frames[c.getFrameCount()*5-5])}else if(f=="attachment"){var c=new spine.AttachmentTimeline(l.length);c.slotIndex=S;var h=0;for(var p=0,d=l.length;p<d;p++){var v=l[p];c.setFrame(h++,v["time"],v["name"])}r.push(c);i=Math.max(i,c.frames[c.getFrameCount()-1])}else throw"Invalid timeline type for a slot: "+f+" ("+w+")"}}n.animations.push(new spine.Animation(e,r,i))}};spine.SkeletonJson.readCurve=function(e,t,n){var r=n["curve"];if(!r)return;if(r=="stepped")e.curves.setStepped(t);else if(r instanceof Array)e.curves.setCurve(t,r[0],r[1],r[2],r[3])};spine.SkeletonJson.toColor=function(e,t){if(e.length!=8)throw"Color hexidecimal length must be 8, recieved: "+e;return parseInt(e.substring(t*2,2),16)/255};spine.Atlas=function(e,t){this.textureLoader=t;this.pages=[];this.regions=[];var n=new spine.AtlasReader(e);var r=[];r.length=4;var i=null;while(true){var s=n.readLine();if(s==null)break;s=n.trim(s);if(s.length==0)i=null;else if(!i){i=new spine.AtlasPage;i.name=s;i.format=spine.Atlas.Format[n.readValue()];n.readTuple(r);i.minFilter=spine.Atlas.TextureFilter[r[0]];i.magFilter=spine.Atlas.TextureFilter[r[1]];var o=n.readValue();i.uWrap=spine.Atlas.TextureWrap.clampToEdge;i.vWrap=spine.Atlas.TextureWrap.clampToEdge;if(o=="x")i.uWrap=spine.Atlas.TextureWrap.repeat;else if(o=="y")i.vWrap=spine.Atlas.TextureWrap.repeat;else if(o=="xy")i.uWrap=i.vWrap=spine.Atlas.TextureWrap.repeat;t.load(i,s);this.pages.push(i)}else{var u=new spine.AtlasRegion;u.name=s;u.page=i;u.rotate=n.readValue()=="true";n.readTuple(r);var a=parseInt(r[0]);var f=parseInt(r[1]);n.readTuple(r);var l=parseInt(r[0]);var c=parseInt(r[1]);u.u=a/i.width;u.v=f/i.height;if(u.rotate){u.u2=(a+c)/i.width;u.v2=(f+l)/i.height}else{u.u2=(a+l)/i.width;u.v2=(f+c)/i.height}u.x=a;u.y=f;u.width=Math.abs(l);u.height=Math.abs(c);if(n.readTuple(r)==4){u.splits=[parseInt(r[0]),parseInt(r[1]),parseInt(r[2]),parseInt(r[3])];if(n.readTuple(r)==4){u.pads=[parseInt(r[0]),parseInt(r[1]),parseInt(r[2]),parseInt(r[3])];n.readTuple(r)}}u.originalWidth=parseInt(r[0]);u.originalHeight=parseInt(r[1]);n.readTuple(r);u.offsetX=parseInt(r[0]);u.offsetY=parseInt(r[1]);u.index=parseInt(n.readValue());this.regions.push(u)}}};spine.Atlas.prototype={findRegion:function(e){var t=this.regions;for(var n=0,r=t.length;n<r;n++)if(t[n].name==e)return t[n];return null},dispose:function(){var e=this.pages;for(var t=0,n=e.length;t<n;t++)this.textureLoader.unload(e[t].rendererObject)},updateUVs:function(e){var t=this.regions;for(var n=0,r=t.length;n<r;n++){var i=t[n];if(i.page!=e)continue;i.u=i.x/e.width;i.v=i.y/e.height;if(i.rotate){i.u2=(i.x+i.height)/e.width;i.v2=(i.y+i.width)/e.height}else{i.u2=(i.x+i.width)/e.width;i.v2=(i.y+i.height)/e.height}}}};spine.Atlas.Format={alpha:0,intensity:1,luminanceAlpha:2,rgb565:3,rgba4444:4,rgb888:5,rgba8888:6};spine.Atlas.TextureFilter={nearest:0,linear:1,mipMap:2,mipMapNearestNearest:3,mipMapLinearNearest:4,mipMapNearestLinear:5,mipMapLinearLinear:6};spine.Atlas.TextureWrap={mirroredRepeat:0,clampToEdge:1,repeat:2};spine.AtlasPage=function(){};spine.AtlasPage.prototype={name:null,format:null,minFilter:null,magFilter:null,uWrap:null,vWrap:null,rendererObject:null,width:0,height:0};spine.AtlasRegion=function(){};spine.AtlasRegion.prototype={page:null,name:null,x:0,y:0,width:0,height:0,u:0,v:0,u2:0,v2:0,offsetX:0,offsetY:0,originalWidth:0,originalHeight:0,index:0,rotate:false,splits:null,pads:null};spine.AtlasReader=function(e){this.lines=e.split(/\r\n|\r|\n/)};spine.AtlasReader.prototype={index:0,trim:function(e){return e.replace(/^\s+|\s+$/g,"")},readLine:function(){if(this.index>=this.lines.length)return null;return this.lines[this.index++]},readValue:function(){var e=this.readLine();var t=e.indexOf(":");if(t==-1)throw"Invalid line: "+e;return this.trim(e.substring(t+1))},readTuple:function(e){var t=this.readLine();var n=t.indexOf(":");if(n==-1)throw"Invalid line: "+t;var r=0,i=n+1;for(;r<3;r++){var s=t.indexOf(",",i);if(s==-1){if(r==0)throw"Invalid line: "+t;break}e[r]=this.trim(t.substr(i,s-i));i=s+1}e[r]=this.trim(t.substring(i));return r+1}};spine.AtlasAttachmentLoader=function(e){this.atlas=e};spine.AtlasAttachmentLoader.prototype={newAttachment:function(e,t,n){switch(t){case spine.AttachmentType.region:var r=this.atlas.findRegion(n);if(!r)throw"Region not found in atlas: "+n+" ("+t+")";var i=new spine.RegionAttachment(n);i.rendererObject=r;i.setUVs(r.u,r.v,r.u2,r.v2,r.rotate);i.regionOffsetX=r.offsetX;i.regionOffsetY=r.offsetY;i.regionWidth=r.width;i.regionHeight=r.height;i.regionOriginalWidth=r.originalWidth;i.regionOriginalHeight=r.originalHeight;return i}throw"Unknown attachment type: "+t}};ns("boc.pfx.components");boc.pfx.components.Emitter=function(e){this.particleFactory=e.particleFactory;this.startVector=e.startVector;this.startVelocity=e.startVelocity;this.emitRadius=e.emitRadius;this.accelerationVector=e.accelerationVector;this.particleDuration=e.particleDuration;this.particlesPerSecond=e.particlesPerSecond;this.particlesPerMillisecond=e.particlesPerSecond/1e3;this.elapsedSinceLastEmit=0;this.className=function(){return"Emitter"}};ns("boc.pfx.components");boc.pfx.components.EmitterBurstEvent=function(e){this.target=e.target;this.count=e.count;this.className=function(){return"EmitterBurstEvent"}};ns("boc.utils");boc.utils._em=null;boc.utils.setEntityManager=function(e){boc.utils._em=e};boc.utils.sessionKey=undefined;boc.utils.isSafari=navigator.userAgent.indexOf("Safari")>-1&&navigator.userAgent.indexOf("Chrome")==-1||navigator.userAgent.indexOf("Nintendo")>=0;boc.utils.getJson=function(e,t,n){if(boc.utils.isSafari&&SharedSession&&SharedSession.sessionKey){t["$boc_session"]=SharedSession.sessionKey}var r=boc.constants.API_HOST+"/"+e+"?callback=?";var i="";var s=0;for(var o in t){if(t[o]){i+="&"+o+"="+t[o];s+=t[o].length}}if(s>boc.constants.MAX_GET_LENGTH){r=r.replace("callback=?","");t.boc_session=typeof SharedSession!="undefined"?SharedSession.sessionKey:boc.utils.sessionKey;$.post(r,t,n)}else{$.getJSON(r+i,n)}};boc.utils.post=function(e,t,n){var r=boc.constants.API_HOST+"/"+e;t.boc_session=typeof SharedSession!="undefined"?SharedSession.sessionKey:boc.utils.sessionKey;$.post(r,t,n)};boc.utils.API_KEY=null;boc.utils.requestApiKey=function(e){boc.utils.getJson("requestkey",{},function(t){if(t.status=="ok"){setMaxDigits(19);var n=t.result.key.split("_");boc.utils.API_KEY=new RSAKeyPair(n[0],null,n[1]);if(e){e(boc.utils.API_KEY)}}})};boc.utils.createFilteredImage=function(e,t,n,r){function i(e,t,n,r){var i=document.createElement("canvas");i.width=100;i.height=100;var s=i.getContext("2d");s.drawImage(e,0,0);var o=s.getImageData(0,0,i.width,i.width);var u=o.data;for(var a=0;a<u.length;a+=4){u[a]=r[0]*u[a];u[a+1]=r[1]*u[a+1];u[a+2]=r[2]*u[a+2]}s.putImageData(o,0,0);return i}if(typeof r=="undefined"){r=.5}var s=e+"_filtered";var o=boc.resources.GraphicsManager.getImage(s);if(o){return o}var u=boc.resources.GraphicsManager.getImage(e);o=i(u,t,n,[r,r,r]);boc.resources.GraphicsManager.addImage(s,o);return o};boc.utils.getAngle=function(e,t){return Math.acos((e.x*t.x+e.y*t.y)/Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2))*Math.sqrt(Math.pow(t.x,2)+Math.pow(t.y,2)))};boc.utils.degToRad=function(e){return e*Math.PI/180};boc.utils.radToDeg=function(e){return e*180/Math.PI};boc.utils.createEvent=function(e,t,n){if(!t){t=boc.utils._em}var r=t.createEntity();t.addComponentToEntity(e,r);t.addComponentToEntity(new boc.components.Lifespan({duration:n&&n.duration?n.duration:1e3}),r);return r};boc.utils.consumeEvent=function(e,t,n){if(!n){n=boc.utils._em}var r=n.getComponentForEntity(t,e);if(r){var i=n.getComponentForEntity("Lifespan",e);if(i){i.duration=0}}};boc.utils.toBounds=function(e){return{xmin:e.x,xmax:e.x+e.width*e.scale,ymin:e.y,ymax:e.y+e.height*e.scale,containsPoint:function(e){return e.x<this.xmax&&e.x>this.xmin&&e.y<this.ymax&&e.y>this.ymin},intersects:function(e){return this.xmin<e.xmax&&this.xmax>e.xmin&&this.ymin<e.ymax&&this.ymax>e.ymin}}};boc.utils.toPoint=function(e){return{x:e.x+e.width/2,y:e.y+e.height/2}};boc.utils.Stopwatch=function(){var e=null,t=null,n=null;this.start=function(){e=+(new Date)};this.stop=function(){if(e==null){return}t=+(new Date);n+=t-e;e=null};this.reset=function(){n=0};this.duration=function(){return n};this.toString=function(){return n+" ms"}};boc.utils.follow=function(e,t,n){if(!n){n=boc.utils._em}var r=n.getComponentForEntity("Spatial",e);var i=n.getComponentForEntity("Spatial",t);if(!r||!i){return}boc.utils.unfollow(t,n);i.following=e;i.followCallback=function(e){var t=e.newDimension.x-e.oldDimension.x;var n=e.newDimension.y-e.oldDimension.y;var r=e.newDimension.z-e.oldDimension.z;i.update({x:i.x+t,y:i.y+n,z:i.z+r})};r.addListener("onchange",i.followCallback);n.addListenerForEntity(e,"onKill",function(){boc.utils.unfollow(t,n)})};boc.utils.unfollow=function(e,t){if(!t){t=boc.utils._em}var n=t.getComponentForEntity("Spatial",e);if(n&&n.following&&n.followCallback){var r=t.getComponentForEntity("Spatial",r);if(r){r.removeListener("onchange",n.followCallback)}delete n["followCallback"];delete n["following"]}};boc.utils.getDrawableComponent=function(e,t){if(!t){t=boc.utils._em}for(var n=0;n<boc.components.drawables.length;n++){var r=t.getComponentForEntity(boc.components.drawables[n],e);if(r){return r}}return null};boc.utils.createBouncingAnimation=function(e,t){if(!t){t={}}if(!t.height){t.height=30}if(!t.duration){t.duration=900}var n=new boc.utils.AnimationSequence({entity:e,loop:false,onLoopComplete:t.onLoopComplete,animations:[new boc.components.Animation({componentName:"Spatial",propertyDeltas:{y:-t.height},duration:t.duration*1/3,easing:"easeOutQuad"}),new boc.components.Animation({componentName:"Spatial",propertyDeltas:{y:t.height},duration:t.duration*2/3,easing:"easeOutBounce"})]});return n};boc.utils.createBouncingText=function(e,t,n,r){if(!r){r={}}if(!r.font){r.font="bold 14 Helvetica"}if(!r.fillStyle){r.fillStyle="rgb(255,100,100)"}if(!r.z){r.z=0}if(!r.em){r.em=boc.utils._em}if(!r.shadow){r.shadow={x:1,y:1}}var i=new boc.core.Entity({entityManager:r.em});i.addComponent(new boc.components.Spatial({x:t,y:n,z:r.z,width:16,height:16}));i.addComponent(new boc.components.DrawableText({font:r.font,fillStyle:r.fillStyle,text:e,shadow:r.shadow}));boc.utils.createBouncingAnimation(i,{onLoopComplete:function(){i.kill()}}).start()};boc.utils.leftPad=function(e,t){e=e.toString();var n="";if(t>e.length){for(i=0;i<t-e.length;i++){n+="0"}}return n+e.toString()};boc.utils.createBlinkingAnimation=function(e,t,n){if(!n){n=boc.utils._em}if(!t){t={}}if(!t.loopLength){t.loopLength=1e3}if(!t.drawableName){t.drawableName="DrawableRect"}if(!t.easing){t.easing="linearTween"}if(!t.delta){t.delta=.75}var r=new boc.utils.AnimationSequence({entity:e,entityManager:n,loop:true,animations:[new boc.components.Animation({duration:t.loopLength*.5,componentName:t.drawableName,propertyDeltas:{alpha:-t.delta},easing:t.easing}),new boc.components.Animation({duration:t.loopLength*.5,componentName:t.drawableName,propertyDeltas:{alpha:t.delta},easing:t.easing})]});return r};boc.utils.createBlinkingRect=function(e,t,n,r,i,s,o){if(!o){o=boc.utils._em}if(!s){s={}}if(!s.fillStyle){s.fillStyle="rgb(0,0,0)"}if(!s.lineWidth){s.lineWidth=0}var u=new boc.core.Entity({entityManager:o});u.addComponent(new boc.components.Spatial({x:e,y:t,z:n,width:r,height:i}));u.addComponent(new boc.components.DrawableRect({fillStyle:s.fillStyle,lineWidth:s.lineWidth}));boc.utils.createBlinkingAnimation(u.id(),s,o).start();return u.id()};boc.utils.toTileKey=function(e){return e.x+","+e.y};boc.utils.toTile=function(e){e=e.split(",");return{x:+e[0],y:+e[1]}};boc.utils.inherits=function(e,t){e.super_=t;e.prototype=Object.create(t.prototype,{constructor:{value:e}})};boc.utils.loadHtml=function(e,t,n,r){$.get(e,function(e){var i="";var s=/<link.*\/>/g,o=null;while(o=s.exec(e)){var u=true;if(r){for(var a=0;a<r.length;a++){var f=new RegExp('href="'+r[a]+'"');if(f.test(o[0])){u=false;break}}}if(u){i+=o[0].replace(/href="(.+)"/,'href="'+t+'$1"')}}if(n){n(i.trim()+/<body.*>([\s\S]*)<\/body>/mg.exec(e)[1].trim())}})};boc.utils.centerCamera=function(e,t){var n=(e.xmin+e.xmax)/2;var r=(e.ymin+e.ymax)/2;var i=$em(t).comp("Spatial");var s=i.x+i.width/2;var o=i.y+i.height/2;e.move(Math.round(s-n),Math.round(o-r))};boc.utils.waitForClick=function(e){$em($em.create()).ns("boc.components").add("WaitForClick",e)};ns("boc.spine");boc.spine.SkeletonManager=new function(){var t={};var n={};this.load=function(e,r){for(var i in e){if(t[i]&&n[i]){continue}var s=e[i];var o=new spine.Atlas(s.atlas,{load:function(){}});t[i]=o;var u=new spine.SkeletonJson(new spine.AtlasAttachmentLoader(o));var a=u.readSkeletonData(s.skeleton);a.name=i;n[i]=a}if(r){r()}};this.getSkeletonData=function(e){return n[e]};this.createSkeleton=function(e,t){var r=n[e];if(r){var i=new spine.Skeleton(r);i.getRootBone().x=t?t.x:0;i.getRootBone().y=t?t.y:0;i.updateWorldTransform();return i}}};boc.spine.AnimationStateManager=new function(){var t={};this.getAnimationData=function(e){return skeletonData_[e]};this.setAnimationData=function(e,n){t[e]=n}};boc.spine.SpineDrawable=function(t){this.skeleton=t.skeleton;this.visible=t.visible;this.className=function(){return"SpineDrawable"}};boc.spine.SpineAnimation=function(t){this.target=t.target;this.state=t.state||boc.constants.ANIMATION_STOPPED;var n=$em(this.target).comp("SpineDrawable");var r=boc.spine.AnimationStateManager[n.skeleton.data.name];if(!r){r=new spine.AnimationStateData(n.skeleton.data);boc.spine.AnimationStateManager[n.skeleton.data.name]=r}this.animationState=new spine.AnimationState(r);this.className=function(){return"SpineAnimation"};this.eventManager=new boc.utils.EventManager(this)};boc.spine.SpineAnimationSystem=function(){this.processTick=function(e){$em("SpineAnimation").each(function(t,n){if(n.target){var r=$em(n.target).comp("SpineDrawable");if(n.state==boc.constants.ANIMATION_PLAYING){n.animationState.update(e/1e3);n.animationState.apply(r.skeleton);r.skeleton.updateWorldTransform();if(!n.animationState.currentLoop&&n.animationState.isComplete()){n.state=boc.constants.ANIMATION_STOPPED;n.emit("onComplete",n.animationState.current.name)}}}})}};boc.spine.renderSkeleton=function(e,t){t.scale(1,-1);var n=e.drawOrder;for(var r=0;r<n.length;r++){var i=n[r];var s=i.attachment;if(!(s instanceof spine.RegionAttachment)){continue}t.save();t.translate(i.bone.worldX,i.bone.worldY);t.rotate(i.bone.worldRotation*Math.PI/180);t.scale(i.bone.worldScaleX,i.bone.worldScaleY);t.translate(s.x,s.y);t.rotate(s.rotation*Math.PI/180);t.scale(s.scaleX,s.scaleY);t.globalAlpha=i.a;t.scale(1,-1);t.drawImage(boc.resources.GraphicsManager.getImage(s.rendererObject.page.name),s.rendererObject.x,s.rendererObject.y,s.rendererObject.width,s.rendererObject.height,-(s.width/2),-(s.height/2),s.width,s.height);t.restore()}};(function(){var e={};boc.spine.loadSpineAssets=function(t,n){if(!n){n={teams:[""]}}var r=2+n.teams.length;var i=r*t.length;var s=0;var o=function(){if(s==i){if(n.onload){n.onload(e)}}};for(var u=0;u<t.length;u++){var a=t[u].substring(t[u].lastIndexOf("/")+1);var f=false;for(var l=0;l<n.teams.length;l++){var c=a+"_"+n.teams[l];if(!e[c]){e[c]={}}else{f=true;continue}}if(f){s+=r;o();continue}(function(r,i){var a=i.substring(0,i.lastIndexOf("/"))+"/";$.get(t[u]+".atlas",function(t){for(var i=0;i<n.teams.length;i++){var u=r+"_"+n.teams[i];e[u].atlas=t.replace(/(\w+).png/,a+"$1_"+n.teams[i]+".png")}s++;o()});$.get(t[u]+".json",function(t){var i=typeof t=="object"?t:JSON.parse(t);for(var u=0;u<n.teams.length;u++){var a=r+"_"+n.teams[u];e[a].skeleton=i}s++;o()})})(a,t[u]);var h=[];for(var l=0;l<n.teams.length;l++){h[l]=t[u]+"_"+n.teams[l]+".png"}boc.resources.GraphicsManager.loadFiles(h,function(){s+=2;o()})}}})();ns("boc.resources");boc.resources.GraphicsManager=new function(){var e={};var t=false;this.load=function(n,r){if(t){if(r){r()}return}var i=0;for(var s in n){if(s=="count")continue;var o=new Image;o.src="data:image/png;base64,"+n[s];o.tag=s;e[s]=o;o.onload=function(){i++;if(i>=n.count){t=true;if(r){r()}}}}};this.loadFiles=function(t,n){if(!(t instanceof Array))t=[t];var r=0;for(var i=0;i<t.length;i++){var s=new Image;s.src=t[i];s.tag=t[i];e[t[i]]=s;s.onload=function(){r++;if(r==t.length&&n)n()}}};this.getImage=function(t){return e[t]};this.addImage=function(t,n){e[t]=n}};ns("boc.pfx.particleFactories");boc.pfx.particleFactories.FadingStarFactory=function(e,t){var n=e;var r=t||25;var i=new Array(r);var s=0;var o=boc.resources.GraphicsManager.getImage("assets/graphics/pfx_star_small.png");this.maxParticles=function(){return r};var u=0;this.create=function(e,t,a,f,l,c){if(u>=r){return null}if(s>=r){s=0}if(i[s]){var h=n.getComponentForEntity("Lifespan",i[s]);if(h){h.duration=0}}var p=n.createEntity();i[s]=p;n.addComponentToEntity(new boc.pfx.components.Particle({directionVector:t,velocity:a,accelerationVector:f}),p);n.addComponentToEntity(new boc.components.Spatial({x:e.x+o.width/2,y:e.y+o.height/2,z:c,width:o.width,height:o.height}),p);n.addComponentToEntity(new boc.components.DrawableSprite({image:o,alpha:1}),p);n.addComponentToEntity(new boc.components.Lifespan({duration:l}),p);n.addComponentToEntity(new boc.components.Animation({componentName:"DrawableSprite",propertyDeltas:{alpha:-1},duration:l,easing:"easeOutQuad",state:boc.constants.ANIMATION_PLAYING}),p);s++;return p}};ns("boc.pfx.components");boc.pfx.components.Particle=function(e){this.directionVector=e.directionVector;this.veloctiy=e.velocity;this.velocity_ppms=e.velocity/1e3;this.accelerationVector=e.accelerationVector;this.className=function(){return"Particle"}};ns("boc.pfx");boc.pfx.ParticleFactory=function(e){this.maxParticles=function(){return 0};this.create=function(e,t,n,r,i){return null}};ns("boc.pfx.particleFactories");boc.pfx.particleFactories.SmokeFactory=function(e,t){var n=e;var r=t||25;var i=new Array(r);var s=0;var o=boc.resources.GraphicsManager.getImage("assets/graphics/pfx_smoke_small.png");var u=0;this.maxParticles=function(){return r};this.create=function(e,t,a,f,l){if(u>=r){return null}if(s>=r){s=0}if(i[s]){var c=n.getComponentForEntity("Lifespan",i[s]);if(c){c.duration=0}}var h=n.createEntity();i[s]=h;n.addComponentToEntity(new boc.pfx.components.Particle({directionVector:t,velocity:a,accelerationVector:f}),h);n.addComponentToEntity(new boc.components.Spatial({x:e.x+o.width/2,y:e.y+o.height/2,z:2e3,width:o.width,height:o.height}),h);n.addComponentToEntity(new boc.components.DrawableSprite({image:o,alpha:.2}),h);n.addComponentToEntity(new boc.components.Lifespan({duration:l,onKill:function(){u--}}),h);s++;u++;return h}};ns("boc.pfx.particleFactories");boc.pfx.particleFactories.SmokeStarFactory=function(e,t){var n=e;var r=t||25;var i=new Array(r);var s=0;var o=boc.resources.GraphicsManager.getImage("assets/graphics/pfx_star_small.png");var u=boc.resources.GraphicsManager.getImage("assets/graphics/pfx_smoke_small.png");this.maxParticles=function(){return r};var a=0;this.create=function(e,t,u,f,l){if(a>=r){return null}if(s>=r){s=0}if(i[s]){var c=n.getComponentForEntity("Lifespan",i[s]);if(c){c.duration=0}}var h=n.createEntity();i[s]=h;n.addComponentToEntity(new boc.pfx.components.Particle({directionVector:t,velocity:u,accelerationVector:f}),h);n.addComponentToEntity(new boc.components.Spatial({x:e.x+o.width/2,y:e.y+o.height/2,z:2e3,width:o.width,height:o.height}),h);n.addComponentToEntity(new boc.components.DrawableSprite({image:o,alpha:1,visible:false}),h);n.addComponentToEntity(new boc.components.Lifespan({duration:l}),h);n.addComponentToEntity(new boc.pfx.components.Emitter({particleFactory:new boc.pfx.particleFactories.SmokeFactory(n,r),startVector:{x:0,y:-1},startVelocity:25,accelerationVector:{x:0,y:-.025},emitRadius:360,particleDuration:l-20,particlesPerSecond:5}),h);s++;return h}};ns("boc.constants");boc.constants.ANIMATION_STOPPED=1;boc.constants.ANIMATION_PLAYING=2;boc.constants.ANIMATION_PAUSED=3;boc.constants.ANIMATION_COMPLETE=4;boc.constants.API_HOST="http://localhost:3000";boc.constants.MAX_GET_LENGTH=1800;boc.constants.RECAPTCHA_KEY="6Lf73NsSAAAAAFSkoNRw_rdyKP5IfR4ldas0B_UN";ns("boc.systems");boc.systems.CameraFollowSystem=function(e){this.processTick=function(t){var n=e.getAllEntitiesWithComponent("CameraFollow");for(var r=0;r<n.length;r++){if(!e.getComponentForEntity("CameraFollow",n[r]).onCameraChange){(function(t){var n=e.getComponentForEntity("CameraFollow",t);var r=e.getComponentForEntity("Spatial",t);n.onCameraChange=function(e){var t=(e.oldCamera.xmin-e.newCamera.xmin)/e.newCamera.zoom;var n=(e.oldCamera.ymin-e.newCamera.ymin)/e.newCamera.zoom;r.update({x:r.x-t,y:r.y-n})};n.camera.addListener("onchange",n.onCameraChange);n.onCameraRemoved=function(r){if(r.componentName=="CameraFollow"){n.camera.removeListener("onchange",n.onCameraChange);delete t["onCameraChange"];e.removeListenerForEntity(t,"onComponentRemoved",n.onCameraRemoved);delete t["onCameraRemoved"]}};e.addListenerForEntity(t,"onComponentRemoved",n.onCameraRemoved)})(n[r])}}}};ns("boc.systems");boc.systems.AnimationSystem=function(e){var t=e;this.processTick=function(e){var n=["Animation","FrameAnimation"];for(var r=0;r<n.length;r++){var i=t.getAllEntitiesWithComponent(n[r]);for(var s=0;s<i.length;s++){var o=t.getComponentForEntity(n[r],i[s]);if(o.state!=boc.constants.ANIMATION_PLAYING){continue}var u=t.getComponentForEntity(o.componentName,i[s]);if(o.elapsedTime==0){o._startValue={};o._finalValue={};for(var a in o.propertyDeltas){o._startValue[a]=u[a];o._finalValue[a]=u[a]+o.propertyDeltas[a]}}if(o.componentName=="Spatial"){var f={};for(var a in o.propertyDeltas){var l=Math[o.easing]||Math.linearTween;var c=l(o.elapsedTime,o._startValue[a],o.propertyDeltas[a],o.duration);f[a]=c}u.update(f)}else{for(var a in o.propertyDeltas){var l=Math[o.easing]||Math.linearTween;var c=l(o.elapsedTime,o._startValue[a],o.propertyDeltas[a],o.duration);u[a]=c}}o.elapsedTime+=e;if(o.elapsedTime>=o.duration){var f={};if(o.componentName=="Spatial"){for(var a in o.propertyDeltas){f[a]=o._finalValue[a]}u.update(f)}else{for(var a in o.propertyDeltas){u[a]=o._finalValue[a]}}o.state=boc.constants.ANIMATION_COMPLETE;o.notify("onComplete",{entity:i[s]})}}}}};ns("boc.pfx.systems");boc.pfx.systems.BasicParticleSystem=function(e){function r(e,t){var n={x:e.startVector.x,y:e.startVector.y};var r=Math.random()*e.emitRadius-e.emitRadius/2;var i=boc.utils.degToRad(r);n.x=e.startVector.x*Math.cos(i)-e.startVector.y*Math.sin(i);n.y=e.startVector.y*Math.cos(i)+e.startVector.x*Math.sin(i);return e.particleFactory.create(t,n,e.startVelocity,e.accelerationVector,e.particleDuration,t.z)}var t=e;var n=0;this.processTick=function(e){var n=t.getAllEntitiesWithComponent("EmitterBurstEvent");for(var i=0;i<n.length;i++){var s=n[i];var o=t.getComponentForEntity("EmitterBurstEvent",s);var u=t.getComponentForEntity("Emitter",o.target);var a=t.getComponentForEntity("Spatial",o.target);if(u){var f=Math.min(o.count,u.particleFactory.maxParticles());for(var l=0;l<f;l++){r(u,a)}}boc.utils.consumeEvent(s,"EmitterBurstEvent",t)}var c=t.getAllEntitiesWithComponent("Emitter");for(var i=0;i<c.length;i++){var h=c[i];var p=t.getComponentForEntity("Emitter",h);var d=t.getComponentForEntity("Spatial",h);p.elapsedSinceLastEmit+=e;var v=1/p.particlesPerMillisecond;if(p.elapsedSinceLastEmit>=v){var m=0;while(p.elapsedSinceLastEmit>=v&&m<=p.particleFactory.maxParticles()){if(!r(p,d)){p.elapsedSinceLastEmit=0;break}p.elapsedSinceLastEmit-=v;m++}if(m>0){p.elapsedSinceLastEmit=0}}}var g=t.getAllEntitiesWithComponent("Particle");for(var i=0;i<g.length;i++){var y=g[i];var b=t.getComponentForEntity("Particle",y);var a=t.getComponentForEntity("Spatial",y);var w={x:a.x+b.directionVector.x*b.velocity_ppms*e,y:a.y+b.directionVector.y*b.velocity_ppms*e};a.update(w);b.directionVector.x+=b.accelerationVector.x;b.directionVector.y+=b.accelerationVector.y}}};ns("boc.pfx.particleFactories");boc.pfx.particleFactories.StarFactory=function(e,t){var n=e;var r=t||25;var i=new Array(r);var s=0;var o=boc.resources.GraphicsManager.getImage("assets/graphics/pfx_star_small.png");this.maxParticles=function(){return r};var u=0;this.create=function(e,t,a,f,l){if(u>=r){return null}if(s>=r){s=0}if(i[s]){var c=n.getComponentForEntity("Lifespan",i[s]);if(c){c.duration=0}}var h=n.createEntity();i[s]=h;n.addComponentToEntity(new boc.pfx.components.Particle({directionVector:t,velocity:a,accelerationVector:f}),h);n.addComponentToEntity(new boc.components.Spatial({x:e.x+o.width/2,y:e.y+o.height/2,z:2e3,width:o.width,height:o.height}),h);n.addComponentToEntity(new boc.components.DrawableSprite({image:o,alpha:1}),h);n.addComponentToEntity(new boc.components.Lifespan({duration:l}),h);s++;return h}};ns("boc.systems");boc.systems.DelayedMethodSystem=function(e){this.processTick=function(e){var t=null;$em("DelayedMethod").each(function(n,r){r.elapsed+=e;if(r.elapsed>=r.delay){if(r.run){r.run()}if(!t){t=[]}t.push(n)}});if(t){while(t.length>0){$em(t.pop()).kill()}}}};ns("boc.systems");boc.systems.WaitForClickSystem=function(e,t){var n=e;this.processTick=function(){var e=$em("WaitForClick").all();var t=null;if(e.length>0){$em("MouseEvent").each(function(e,n){if(n.action=="mouseup"){$em("WaitForClick").each(function(e,r){if(n.timestamp>r.timestamp){r.run();if(!t){t=[]}t.push(e)}})}})}if(t){while(t.length>0){$em(t.pop()).kill()}}}};ns("boc.systems");boc.systems.LifespanSystem=function(e){var t=e;this.processTick=function(e){var n=t.getAllEntitiesWithComponent("Lifespan");if(n){n=n.slice()}for(var r=0;r<n.length;r++){var i=t.getComponentForEntity("Lifespan",n[r]);i.elapsed+=e;if(i.elapsed>=i.duration||i.duration<=0){t.killEntity(n[r]);if(i.onKill){i.onKill()}}}}};ns("boc.systems");boc.systems.IdentifySystem=function(e,t){var n=e;var r="idle";var i=null;var s=140;var o=t;this.processTick=function(e){var o=n.getAllEntitiesWithComponent("MouseEvent");if(o&&o.length>0){o=o.slice();o.sort(function(e,t){var r=n.getComponentForEntity("MouseEvent",e);var i=n.getComponentForEntity("MouseEvent",t);return r.timestamp-i.timestamp});for(var u=0;u<o.length;u++){var a=n.getComponentForEntity("MouseEvent",o[u]);var f=n.getComponentForEntity("Lifespan",o[u]);f.duration=0;if(a.action=="mousedown"){r="down"}else if(a.action=="mouseup"){if(r!="drag"){var l={x:$(document).scrollLeft()+t.xmin,y:$(document).scrollTop()+t.ymin};var c={x:(a.stateObj.clientX-a.element.offsetLeft+l.x)/t.zoom,y:(a.stateObj.clientY-a.element.offsetTop+l.y)/t.zoom};var h=n.getAllEntitiesWithComponent("Identifiable");var p=[];for(var d=0;d<h.length;d++){var v=n.getComponentForEntity("Spatial",h[d]);if(v&&boc.utils.toBounds(v).containsPoint(c)){p.push(h[d])}}if(p.length>0){boc.utils.createEvent(new boc.components.IdentifyEvent({identifiedEntities:p}),n);console.log(p)}}r="idle";if(i){clearTimeout(i);i=null}}else if(a.action=="mousedrag"){if(!i){i=setTimeout(function(){r="drag"},s)}}}}}};ns("boc.systems");boc.systems.MouseInputSystem=function(e,t){var n=e;var r=false;var i=180;t.onmousedown=function(e){r=true;var i=n.createEntity();n.addComponentToEntity(new boc.components.MouseEvent({action:"mousedown",element:t,stateObj:e}),i);n.addComponentToEntity(new boc.components.Lifespan({duration:1e3}),i)};t.onmouseup=function(e){r=false;var i=n.createEntity();n.addComponentToEntity(new boc.components.MouseEvent({action:"mouseup",element:t,stateObj:e}),i);n.addComponentToEntity(new boc.components.Lifespan({duration:1e3}),i)};t.onmousemove=function(e){if(r){var i=n.createEntity();n.addComponentToEntity(new boc.components.MouseEvent({action:"mousedrag",element:t,stateObj:e}),i);n.addComponentToEntity(new boc.components.Lifespan({duration:1e3}),i)}else{}};var s=0;this.processTick=function(e){$em("MouseEvent").each(function(e,r){if(r.action==="mouseup"){if(r.timestamp-s<i){boc.utils.createEvent(new boc.components.MouseEvent({action:"doubleclick",element:t,stateObj:r.stateObj}),n)}s=r.timestamp}})}};ns("boc.systems");boc.systems.SpriteAnimationSystem=function(e){this.processTick=function(t){var n=e.getAllEntitiesWithComponent("SpriteAnimation");for(var r=0;r<n.length;r++){var i=n[r];var s=e.getComponentForEntity("SpriteAnimation",i);if(s.state!=boc.constants.ANIMATION_PLAYING){continue}var o=e.getComponentForEntity("DrawableSprite",i);var u=s.sprites.length*(t/s.duration);s.elapsedTime+=t;if(s.elapsedTime>=s.duration){s.state=boc.constants.ANIMATION_COMPLETE;s.currentFrame=s.sprites.length-1;var a=s.sprites[s.currentFrame];o.update("image",a.image);o.update("clipRect",a.clipRect);o.update("alpha",a.alpha);s.notify("onComplete",{entity:i})}else{s.state=boc.constants.ANIMATION_PLAYING;s.currentFrame+=u;var a=s.sprites[Math.floor(s.currentFrame)];o.update("image",a.image);o.update("clipRect",a.clipRect);o.update("alpha",a.alpha)}}}};ns("boc.core");boc.core.System=function(e){this.processTick=function(e){}};ns("boc.systems");boc.systems.TouchInputSystem=function(e,t){var n=e;var r=false;var i=180;t.ontouchstart=function(e){r=true;var i=n.createEntity();n.addComponentToEntity(new boc.components.MouseEvent({action:"mousedown",element:t,stateObj:e.touches[0]}),i);n.addComponentToEntity(new boc.components.Lifespan({duration:1e3}),i)};t.ontouchend=function(e){r=false;var i=n.createEntity();n.addComponentToEntity(new boc.components.MouseEvent({action:"mouseup",element:t,stateObj:e.changedTouches[0]}),i);n.addComponentToEntity(new boc.components.Lifespan({duration:1e3}),i)};t.ontouchmove=function(e){if(r){var i=n.createEntity();n.addComponentToEntity(new boc.components.MouseEvent({action:"mousedrag",element:t,stateObj:e.changedTouches[0]}),i);n.addComponentToEntity(new boc.components.Lifespan({duration:1e3}),i)}};var s=0;this.processTick=function(e){$em("MouseEvent").each(function(e,r){if(r.action==="mouseup"){if(r.timestamp-s<i){boc.utils.createEvent(new boc.components.MouseEvent({action:"doubleclick",element:t,stateObj:r.stateObj}),n)}s=r.timestamp}})}};ns("boc.systems");boc.systems.PanningCameraSystem=function(e,t){var n=e;var r="idle";var i=null;var s=50;var o=null,u=null;var a=null;this.bounds=function(e){if(e==undefined){return a}a=e};var f=false;this.processTick=function(e){$em("PanningCameraEvent").each(function(e,t){if(t.action=="lock"){f=true;boc.utils.consumeEvent(e,t.className(),n)}else if(t.action=="unlock"){f=false;boc.utils.consumeEvent(e,t.className(),n)}});if(f){return}var l=n.getAllEntitiesWithComponent("MouseEvent");if(l&&l.length>0){l=l.slice();l.sort(function(e,t){var r=n.getComponentForEntity("MouseEvent",e);var i=n.getComponentForEntity("MouseEvent",t);return r.timestamp-i.timestamp});for(var c=0;c<l.length;c++){var h=n.getComponentForEntity("MouseEvent",l[c]);var p=n.getComponentForEntity("Lifespan",l[c]);if(p.duration==0){continue}p.duration=0;if(h.action=="mouseup"||h.action=="onblur"){r="idle";if(i!=null&&typeof i!="undefined"){clearTimeout(i);i=null}o=null;u=null}else if(h.action=="mousedrag"){if(i==null){i=setTimeout(function(){r="drag"},s)}if(r=="drag"){if(o&&u){var d=o-(h.stateObj.clientX-h.element.offsetLeft);var v=u-(h.stateObj.clientY-h.element.offsetTop);t.move(d,v);if(a){d=0;v=0;if(t.xmin/t.zoom<a.xmin){d=a.xmin-t.xmin/t.zoom}else if(t.xmax/t.zoom>a.xmax){d=a.xmax-t.xmax/t.zoom}if(t.ymin/t.zoom<a.ymin){v=a.ymin-t.ymin/t.zoom}else if(t.ymax/t.zoom>a.ymax){v=a.ymax-t.ymax/t.zoom}t.move(d,v)}}o=h.stateObj.clientX-h.element.offsetLeft;u=h.stateObj.clientY-h.element.offsetTop}}}}}};ns("boc.systems");boc.systems.RenderSystem=function(e,t,n){function s(e,t,n,r,i){if(e.length==0){e.push({z:r,payload:[i]})}else{var o=t+Math.floor((n-t)/2);var u=e[o];if(n<t){e.splice(t,0,{z:r,payload:[i]});return}if(u.z==r){u.payload.push(i)}else if(r<u.z){s(e,t,o-1,r,i)}else if(r>u.z){s(e,o+1,n,r,i)}}}var r=t.getContext("2d");var i=e;var o=null;this.camera=function(e){if(e==undefined){return o}o=e};this.camera(n);var u=2;this.debug=function(e){if(e==undefined){return e}u=e};this.processTick=function(e){var t=new boc.utils.Stopwatch;var n=boc.components.drawables;var a=[];r.save();r.translate(-o.xmin,-o.ymin);r.scale(o.zoom,o.zoom);var f=[];for(var l=0;l<n.length;l++){var c=i.getAllEntitiesWithComponent(n[l]);for(var h=0;h<c.length;h++){var p=c[h];var d=i.getComponentForEntity(n[l],p);var v=i.getComponentForEntity("SpineDrawable",p);var m=false;for(var g=0;g<f.length;g++){if(f[g]===p){m=true;break}}if(m){continue}if(d.className()=="DrawableSprite"&&v){f.push(p)}var y=i.getComponentForEntity("Spatial",p);if(d.visible&&o.intersects(boc.utils.toBounds(y))){if(u==2){s(a,0,a.length-1,y.z,p)}else{a.push(p)}}}}if(u==2){for(var b=0;b<a.length;b++){var w=a[b].payload;for(var g=0;g<w.length;g++){var d=null;for(var l=0;l<n.length;l++){d=i.getComponentForEntity(n[l],w[g]);if(!d){continue}var y=i.getComponentForEntity("Spatial",w[g]);if(d.className()=="DrawableRect"){r.save();var E=i.getComponentForEntity("Transformable",w[g]);if(E){for(var S=0;S<E.transforms.length;S++){E.transforms[S](a[b],r)}}if(y.angle!==0){r.translate(y.x+y.width/2,y.y+y.height/2);r.rotate(y.angle);r.translate(-y.x-y.width/2,-y.y-y.height/2)}if(y.scale!=1){r.scale(y.scale,y.scale);var x=y.x*y.scale-y.x;var T=y.y*y.scale-y.y;r.translate(-x/y.scale,-T/y.scale)}r.fillStyle=d.fillStyle;r.globalAlpha=d.alpha;r.fillRect(y.x,y.y,y.width,y.height);if(d.lineWidth>0){r.strokeStyle=d.strokeStyle;r.lineWidth=d.lineWidth;r.strokeRect(y.x+r.lineWidth/2,y.y+r.lineWidth/2,y.width-r.lineWidth,y.height-r.lineWidth)}r.restore();break}else if(d.className()=="FunkyDrawableRect"){r.save();var N=Math.round(d.currentFrame);var E=i.getComponentForEntity("Transformable",w[g]);if(E){for(var S=0;S<E.transforms.length;S++){E.transforms[S](a[b],r)}}r.fillStyle=d.fillStyles[N];r.fillRect(y.x,y.y,y.width,y.height);if(d.lineWidths[N]>0){r.strokeStyle=d.strokeStyles[N];r.lineWidth=d.lineWidths[N];r.strokeRect(y.x+r.lineWidth/2,y.y+r.lineWidth/2,y.width-r.lineWidth,y.height-r.lineWidth)}r.restore();break}else if(d.className()=="DrawableSprite"){r.save();var E=i.getComponentForEntity("Transformable",w[g]);if(E){for(var S=0;S<E.transforms.length;S++){E.transforms[S](a[b],r)}}if(y.angle!==0){r.translate(y.x+y.width/2,y.y+y.height/2);r.rotate(y.angle);r.translate(-y.x-y.width/2,-y.y-y.height/2)}if(y.scale!=1){r.scale(y.scale,y.scale);var x=y.x*y.scale-y.x;var T=y.y*y.scale-y.y;r.translate(-x/y.scale,-T/y.scale)}r.globalAlpha=d.alpha;if(!d.clipRect){try{r.drawImage(d.image,y.x,y.y,y.width,y.height)}catch(C){console.log(w[g]," image bad")}}else{r.drawImage(d.image,d.clipRect.x,d.clipRect.y,d.clipRect.width,d.clipRect.height,y.x,y.y,y.width,y.height)}if(y.angle!==0){r.translate(y.x+y.width/2,y.y+y.height/2)}r.restore();break}else if(d.className()=="DrawableText"){r.save();var E=i.getComponentForEntity("Transformable",w[g]);if(E){for(var S=0;S<E.transforms.length;S++){E.transforms[S](a[b],r)}}r.font=d.font;if(y.angle!==0){r.translate(y.x+y.width/2,y.y+y.height/2);r.rotate(y.angle);r.translate(-y.x-y.width/2,-y.y-y.height/2)}if(y.scale!=1){r.scale(y.scale,y.scale);var x=y.x*y.scale-y.x;var T=y.y*y.scale-y.y;r.translate(-x/y.scale,-T/y.scale)}if(d.shadow){r.fillStyle="black";r.fillText(d.text,y.x+d.shadow.x+d.offset.x,y.y+d.shadow.y+d.offset.y)}r.fillStyle=d.fillStyle;r.fillText(d.text,y.x+d.offset.x,y.y+d.offset.y);r.restore();break}else if(d.className()=="SpineDrawable"&&boc&&boc.spine&&boc.spine.renderSkeleton){r.save();r.translate(y.x,y.y);if(y.angle!==0){r.rotate(y.angle)}if(y.scaleX!=1&&y.scaleY!=1){r.scale(y.scaleX,y.scaleY)}boc.spine.renderSkeleton(d.skeleton,r);r.restore();break}}}}}else if(u==0){a.sort(function(e,t){var n=i.getComponentForEntity("Spatial",e);var r=i.getComponentForEntity("Spatial",t);return n.z-r.z});for(var b=0;b<a.length;b++){var d=null;for(var l=0;l<n.length;l++){d=i.getComponentForEntity(n[l],a[b]);if(!d){continue}var y=i.getComponentForEntity("Spatial",a[b]);if(d.className()=="DrawableRect"){r.save();var E=i.getComponentForEntity("Transformable",a[b]);if(E){for(var S=0;S<E.transforms.length;S++){E.transforms[S](a[b],r)}}if(y.angle!==0){r.translate(y.x+y.width/2,y.y+y.height/2);r.rotate(y.angle);r.translate(-y.x-y.width/2,-y.y-y.height/2)}if(y.scale!=1){r.scale(y.scale,y.scale);var x=y.x*y.scale-y.x;var T=y.y*y.scale-y.y;r.translate(-x/y.scale,-T/y.scale)}r.fillStyle=d.fillStyle;r.globalAlpha=d.alpha;r.fillRect(y.x,y.y,y.width,y.height);if(d.lineWidth>0){r.strokeStyle=d.strokeStyle;r.lineWidth=d.lineWidth;r.strokeRect(y.x+r.lineWidth/2,y.y+r.lineWidth/2,y.width-r.lineWidth,y.height-r.lineWidth)}r.restore();break}else if(d.className()=="FunkyDrawableRect"){r.save();var N=Math.round(d.currentFrame);var E=i.getComponentForEntity("Transformable",a[b]);if(E){for(var S=0;S<E.transforms.length;S++){E.transforms[S](a[b],r)}}r.fillStyle=d.fillStyles[N];r.fillRect(y.x,y.y,y.width,y.height);if(d.lineWidths[N]>0){r.strokeStyle=d.strokeStyles[N];r.lineWidth=d.lineWidths[N];r.strokeRect(y.x+r.lineWidth/2,y.y+r.lineWidth/2,y.width-r.lineWidth,y.height-r.lineWidth)}r.restore();break}else if(d.className()=="DrawableSprite"){r.save();var E=i.getComponentForEntity("Transformable",a[b]);if(E){for(var S=0;S<E.transforms.length;S++){E.transforms[S](a[b],r)}}if(y.angle!==0){r.translate(y.x+y.width/2,y.y+y.height/2);r.rotate(y.angle);r.translate(-y.x-y.width/2,-y.y-y.height/2)}if(y.scale!=1){r.scale(y.scale,y.scale);var x=y.x*y.scale-y.x;var T=y.y*y.scale-y.y;r.translate(-x/y.scale,-T/y.scale)}r.globalAlpha=d.alpha;if(!d.clipRect){r.drawImage(d.image,y.x,y.y,y.width,y.height)}else{r.drawImage(d.image,d.clipRect.x,d.clipRect.y,d.clipRect.width,d.clipRect.height,y.x,y.y,y.width,y.height)}r.restore();break}else if(d.className()=="DrawableText"){r.save();var E=i.getComponentForEntity("Transformable",a[b]);if(E){for(var S=0;S<E.transforms.length;S++){E.transforms[S](a[b],r)}}r.font=d.font;if(y.angle!==0){r.translate(y.x+y.width/2,y.y+y.height/2);r.rotate(y.angle);r.translate(-y.x-y.width/2,-y.y-y.height/2)}if(y.scale!=1){r.scale(y.scale,y.scale);var x=y.x*y.scale-y.x;var T=y.y*y.scale-y.y;r.translate(-x/y.scale,-T/y.scale)}if(d.shadow){r.fillStyle="black";r.fillText(d.text,y.x+d.shadow.x+d.offset.x,y.y+d.shadow.y+d.offset.y)}r.fillStyle=d.fillStyle;r.fillText(d.text,y.x+d.offset.x,y.y+d.offset.y);r.restore();break}else if(d.className()=="SpineDrawable"&&boc&&boc.spine&&boc.spine.renderSkeleton){r.save();boc.spine.renderSkeleton(d.skeleton,r);r.restore();break}}}}r.restore()}};ns("boc.systems");boc.systems.UISystem=function(e){this.processTick=function(t){var n=e.getAllEntitiesWithComponent("IdentifyEvent");var r=[];for(var i=0;i<n.length;i++){var s=n[i];var o=e.getComponentForEntity("IdentifyEvent",s);var u=o.identifiedEntities.slice().sort(function(t,n){var r=e.getComponentForEntity("Spatial",t);var i=e.getComponentForEntity("Spatial",n);if(!r&&!i){return 0}if(r&&!i){return 1}if(!r&&i){return-1}return r.z-i.z});var a=u.pop();var f=e.getComponentForEntity("UIElement",a);var l=boc.utils.getDrawableComponent(a,e);while(a&&(!f||!l.visible)){a=u.pop();if(a){f=e.getComponentForEntity("UIElement",a);l=boc.utils.getDrawableComponent(a,e);}}if(a){if(f.onclick){f.onclick({entity:a})}r.push(s)}}while(r.length>0){e.killEntity(r.pop())}}};ns("boc.components");boc.components.CameraFollow=function(e){this.camera=e.camera;this.className=function(){return"CameraFollow"}};ns("boc.core");boc.core.Component=function(){this.className=function(){return null}};ns("boc.components");boc.components.drawables=["DrawableRect","FunkyDrawableRect","DrawableSprite","DrawableText","SpineDrawable"];ns("boc.components");boc.components.Cursor=function(e){this.target=e.target;this.enabled=e.enabled||true;this.location=e.location;this.className=function(){return"Cursor"}};ns("boc.components");boc.components.DelayedMethod=function(e,t){if($.isFunction(e)&&!isNaN(t)){this.run=e;this.delay=t}else{this.run=e.run;this.delay=e.delay}this.elapsed=0;this.className=function(){return"DelayedMethod"}};ns("boc.components");boc.components.Animation=function(e){this.componentName=e.componentName||null;this.propertyDeltas=e.propertyDeltas||{};this.easing=e.easing||"linearTween";this.duration=e.duration||0;this.elapsedTime=0;this.state=e.state||boc.constants.ANIMATION_STOPPED;this.className=function(){return"Animation"};var t=new boc.utils.EventManager;this.notify=t.notify;this.addListener=t.addListener;this.removeListener=t.removeListener};ns("boc.components");boc.components.DrawableRect=function(e){this.fillStyle=e.fillStyle||"red";this.strokeStyle=e.strokeStyle||"black";this.lineWidth=e.lineWidth!=undefined&&e.lineWidth!=null?e.lineWidth:1;this.alpha=typeof e.alpha!="undefined"&&e.alpha!=null?e.alpha:1;this.visible=e.visible!=undefined&&e.visible!=null?e.visible:true;this.className=function(){return"DrawableRect"};var t=new boc.utils.EventManager(this)};ns("boc.components");boc.components.DrawableSprite=function(e){this.image=e.image;this.clipRect=e.clipRect;this.alpha=e.alpha||1;this.visible=e.visible!=undefined&&e.visible!=null?e.visible:true;this.className=function(){return"DrawableSprite"};var t=new boc.utils.EventManager(this)};ns("boc.components");boc.components.DrawableText=function(e){this.fillStyle=e.fillStyle;this.font=e.font||"bold 8pt Helvetica";this.shadow=e.shadow;this.offset=e.offset||{x:0,y:0};this.text=e.text;this.visible=e.visible!=undefined&&e.visible!=null?e.visible:true;this.className=function(){return"DrawableText"};var t=new boc.utils.EventManager(this)};ns("boc.components");boc.components.Identifiable=function(){this.hot=true;this.className=function(){return"Identifiable"}};ns("boc.components");boc.components.IdentifyEvent=function(e){this.identifiedEntities=e.identifiedEntities;this.className=function(){return"IdentifyEvent"}};ns("boc.components");boc.components.Lifespan=function(e){this.duration=e.duration;this.elapsed=0;this.onKill=null;this.className=function(){return"Lifespan"}};ns("boc.components");boc.components.MouseEvent=function(e){this.action=e.action;this.element=e.element;this.stateObj=e.stateObj;this.timestamp=+(new Date);this.className=function(){return"MouseEvent"}};ns("boc.components");boc.components.SelectedEvent=function(e){this.target=e;this.className=function(){return"SelectedEvent"}};ns("boc.components");boc.components.PanningCameraEvent=function(e){this.action=e;this.className=function(){return"PanningCameraEvent"}};ns("boc.components");boc.components.SpriteAnimation=function(e){this.sprites=e.sprites;this.easing=e.easing||"linear";this.state=e.state||boc.constants.ANIMATION_STOPPED;this.duration=e.duration;this.elapsedTime=0;this.currentFrame=0;this.className=function(){return"SpriteAnimation"};var t=new boc.utils.EventManager;this.notify=t.notify;this.addListener=t.addListener;this.removeListener=t.removeListener};ns("boc.components");boc.components.Spatial=function(e){boc.utils.EventEmitter.call(this,e);this.x=e.x;this.y=e.y;this.z=e.z||0;this.width=e.width;this.height=e.height;this.angle=e.angle||0;this.scale=1;if(typeof e.scale!="undefined"&&e.scale!=null){e.scaleX=e.scale;e.scaleY=e.scale;this.scale=e.scale}this.scaleX=typeof e.scaleX!="undefined"&&e.scaleX!=null?e.scaleX:1;this.scaleY=typeof e.scaleY!="undefined"&&e.scaleY!=null?e.scaleY:1;if(this.scaleX!=this.scale){this.scale=this.scaleX}this.className=function(){return"Spatial"}};boc.utils.inherits(boc.components.Spatial,boc.utils.EventEmitter);boc.components.Spatial.prototype.update=function(e){if(!e){e={}}if(e.x==undefined||e.x==null){e.x=this.x}if(e.y==undefined||e.y==null){e.y=this.y}if(e.z==undefined||e.z==null){e.z=this.z}if(e.width==undefined||e.width==null){e.width=this.width}if(e.height==undefined||e.height==null){e.height=this.height}if(e.scaleX==undefined||e.scaleX==null){e.scaleX=this.scaleX}if(e.scaleY==undefined||e.scaleX==null){e.scaleY=this.scaleY}var t=e.x==this.x&&e.y==this.y&&e.z==this.z&&e.width==this.width&&e.height==this.height&&e.scaleX==this.scaleX&&e.scaleY==this.scaleY;var n={x:this.x,y:this.y,z:this.z,width:this.width,height:this.height,scaleX:this.scaleX,scaleY:this.scaleY};this.x=e.x;this.y=e.y;this.z=e.z;this.width=e.width;this.height=e.height;this.scaleX=e.scaleX;this.scaleY=e.scaleY;if(!t){this.notify("onchange",{oldDimension:n,newDimension:e})}};ns("boc.components");boc.components.SpriteAnimationSet=function(e){for(var t in e){this[t]=e}this.className=function(){return"SpriteAnimationSet"}};ns("boc.components");boc.components.UIElement=function(e){this.onclick=e.onclick;this.className=function(){return"UIElement"}};ns("boc.components");boc.components.Transformable=function(e){this.transforms=e||[];this.className=function(){return"Transformable"}};ns("boc.components");boc.components.UnselectedEvent=function(e){this.target=e;this.className=function(){return"UnselectedEvent"}};ns("boc.components");boc.components.WaitForClick=function(e){if($.isFunction(e)){this.run=e}else{this.run=e.run}this.timestamp=+(new Date);this.className=function(){return"WaitForClick"}};ns("bbq.algorithms");bbq.algorithms.djikstra=function(e){function r(e){var r=new Array;var i={x:e.x,y:e.y-1};var s={x:e.x,y:e.y+1};var o={x:e.x+1,y:e.y};var u={x:e.x-1,y:e.y};var a=[i,s,o,u];for(var f=0;f<a.length;f++){var l=a[f];if(l.x>=0&&l.x<t&&l.y>=0&&l.y<n)r.push(l)}return r}var t=e.sizeX;var n=e.sizeY;var i=e.entityManager;var s=e.entity;var o=e.costMap;var u=e.rangeComponentName;var a=e.rangePropertyName;var f=e.costNodes;var l=e.excludeList;var c=i.getComponentForEntity(u,s);var h=c[a];if(e.rangeOffset){h+=e.rangeOffset}var p=i.getComponentForEntity("MapElement",s);var d=e.startCell||{x:p.x,y:p.y};var v=PriorityQueue({low:true});v.contains=function(e,t){return e.x==t.x&&e.y==t.y};var m=[];var g=[];v.push(d,f[d.x][d.y].cost({em:i,entity:s,rangeComponentName:u,currentCost:-1,maxRange:h}));while(!v.empty()){var y=v.pop();m.push(y);if(h==0)break;var b=o[y.x][y.y];if(b<h){var w=r(y);for(var E=0;E<w.length;E++){var S=w[E];if(l&&l.indexOf(boc.utils.toTileKey(S))>=0){continue}var x=o[S.x][S.y];var T=f[S.x][S.y].cost({em:i,entity:s,rangeComponentName:u,currentCost:b,maxRange:h});if(b==-1){b++}var N=b+T;if(x==-1||N<x){o[S.x][S.y]=N;if(!v.includes(S,v.contains)){v.push(S);g.push(S)}}}}}var C=[];for(var E=0;E<m.length;E++){var k=m[E];var L=o[k.x][k.y];var A=k.x+","+k.y;if((L<=h||boc.utils.toTileKey(d)==A)&&C.indexOf(A)==-1){C.push(A)}}for(var E=0;E<g.length;E++){var k=g[E];o[k.x][k.y]=-1}return C};bbq.algorithms.AStarNode=function(e){this.g=0;this.h=-1;this.f=function(){return this.g+this.h};this.parent=null;this.tile=e;this.getCost=function(e){return Math.abs(this.tile.x-e.tile.x)*100+Math.abs(this.tile.y-e.tile.y)*100}};bbq.algorithms.astar=function(e){function r(e){var r=new Array;var i={x:e.x,y:e.y-1};var s={x:e.x,y:e.y+1};var o={x:e.x+1,y:e.y};var u={x:e.x-1,y:e.y};var a=[i,s,o,u];for(var f=0;f<a.length;f++){var l=a[f];if(l.x>=0&&l.x<t&&l.y>=0&&l.y<n)r.push(l)}return r}function i(e){for(var t=0;t<e.length;t++){var n=e[t];n.g=0;n.h=-1;n.parent=null}}var t=e.sizeX;var n=e.sizeY;var s=e.astarMap;var o=e.costNodes;var u=e.entityManager;var a=e.entity;var f=e.rangeComponentName;var l=e.rangePropertyName;var c=u.getComponentForEntity(f,a);var h=c[l];if(e.rangeOffset){h+=e.rangeOffset}var p=e.startTile;var d=e.endTile;var v=[];var m=new bbq.algorithms.AStarNode(p);var g=new bbq.algorithms.AStarNode(d);var y=e.excludeList;m.g=0;m.h=m.getCost(g);m.parent=null;var b=PriorityQueue({low:true});var w=[];w.indexOfNode=function(e){for(var t=0;t<this.length;t++){if(this[t].tile.x==e.tile.x&&this[t].tile.y==e.tile.y){return t}}return-1};var E=[];b.push(m,m.f());var S=-1;while(!b.empty()){var x=b.pop();if(x.tile.x==g.tile.x&&x.tile.y==g.tile.y){found=x;break}w.push(x);var T=r(x.tile);for(var N=0;N<T.length;N++){var C=T[N];if(y&&y.indexOf(boc.utils.toTileKey(C))>=0){continue}var k=s[C.x][C.y];var L=o[C.x][C.y].cost({em:u,entity:a,rangeComponentName:f,currentCost:k.g,maxRange:h});var A=x.g+L;if(b.includes(k)&&A<k.g)b.remove(k);var O=w.indexOfNode(k);if(O>=0&&A<k.g){w.splice(O,1)}if(!b.includes(k)&&O==-1){k.g=A;k.h=k.getCost(g);k.parent=x;b.push(k,k.f());E.push(k);S=A}}}if(found!=null){var M=[];var _=found;while(_!=null){M.push(_);_=_.parent}for(var N=M.length-1;N>=0;N--){v.push(boc.utils.toTileKey(M[N].tile))}}i(E);return v};bbq.algorithms.getCost=function(e){var t=e.entityManager;var n=e.entity;var r=e.costMap;var i=e.rangeComponentName;var s=e.rangePropertyName;var o=e.costNodes;var u=e.path;var a=t.getComponentForEntity(i,n);var f=a[s];if(e.rangeOffset){f+=e.rangeOffset}var l=0;for(var c=1;c<u.length;c++){var h=u[c].split(",");h={x:+h[0],y:+h[1]};l+=o[h.x][h.y].cost({em:t,entity:n,rangeComponentName:i,currentCost:l,maxRange:f})}return l};ns("bbq.utils");bbq.utils.getTilesWithinVisionRange=function(e){return bbq.algorithms.djikstra({entityManager:e.entityManager,entity:e.entity,costMap:e.costMap,costNodes:e.costNodes,sizeX:e.sizeX,sizeY:e.sizeY,rangeComponentName:"Vision",rangePropertyName:"range",rangeOffset:e.rangeOffset})};bbq.utils.getVisionCost=function(e){return bbq.algorithms.getCost({entityManager:e.entityManager,entity:e.entity,costMap:e.costMap,costNodes:e.costNodes,sizeX:e.sizeX,sizeY:e.sizeY,rangeComponentName:"Vision",rangePropertyName:"range"})};bbq.utils.getTilesWithinAttackRange=function(e){var t=bbq.algorithms.djikstra({entityManager:e.entityManager,entity:e.entity,costMap:e.costMap,costNodes:e.costNodes,sizeX:e.sizeX,sizeY:e.sizeY,rangeComponentName:"Attack",rangePropertyName:"maxRange",rangeOffset:e.rangeOffset});var n=bbq.algorithms.djikstra({entityManager:e.entityManager,entity:e.entity,costMap:e.costMap,costNodes:e.costNodes,sizeX:e.sizeX,sizeY:e.sizeY,rangeComponentName:"Attack",rangePropertyName:"minRange",rangeOffset:-100});for(var r=t.length-1;r>=0;r--){if(n.indexOf(t[r])>=0){t.splice(r,1)}}return t};bbq.utils.getTilesWithinMoveRange=function(e){return bbq.algorithms.djikstra({entityManager:e.entityManager,entity:e.entity,costMap:e.costMap,costNodes:e.costNodes,sizeX:e.sizeX,sizeY:e.sizeY,rangeComponentName:"Movement",rangePropertyName:"range",rangeOffset:e.rangeOffset,startCell:e.startCell,excludeList:e.excludeList})};bbq.utils.getTilesWithinRevealRange=function(e){return bbq.algorithms.djikstra({entityManager:e.entityManager,entity:e.entity,costMap:e.costMap,costNodes:e.costNodes,sizeX:e.sizeX,sizeY:e.sizeY,rangeComponentName:e.rangeComponentName||"Reveal",rangePropertyName:e.rangePropertyName||"range",rangeOffset:e.rangeOffset})};bbq.utils.getMoveCost=function(e){return bbq.algorithms.getCost({entityManager:e.entityManager,entity:e.entity,costMap:e.costMap,costNodes:e.costNodes,rangeComponentName:"Movement",rangePropertyName:"range",path:e.path})};bbq.utils.findMovePath=function(e){return bbq.algorithms.astar({entityManager:e.entityManager,entity:e.entity,astarMap:e.astarMap,costNodes:e.costNodes,sizeX:e.sizeX,sizeY:e.sizeY,rangeComponentName:"Movement",rangePropertyName:"range",rangeOffset:e.rangeOffset,startTile:e.startTile,endTile:e.endTile,excludeList:e.excludeList})};if(!window.bbq){window.bbq={}}if(!bbq.buildings){bbq.buildings={}}bbq.buildings.createBuilding=function(e,t,n){t=t.replace("_","").toLowerCase();var r=new boc.core.Entity({description:e.type,entityManager:n});r.addComponent(new boc.components.Spatial({x:0,y:0,z:bbq.zindex.BUILDINGS,width:0,height:0}));r.addComponent(new boc.components.DrawableSprite({}));r.addComponent(new boc.components.Identifiable({}));r.addComponent(new bbq.components.Building({type:e.type}));if(r.Building.type=="HQ"){r.addComponent(new bbq.components.MapElement({x:-1,y:-1}));r.MapElement.offset={x:0,y:-15}}r.addComponent(new bbq.components.FoodProducer({}));r.addComponent(new bbq.components.Buffable({}));r.addComponent(new bbq.components.Debuffable({}));r.addComponent(new bbq.components.Vision({}));r.addComponent(new bbq.components.Commandable({}));bbq.buildings.specialize(r,e,t,n);return r.id()};bbq.buildings.specialize=function(e,t,n,r){var i=bbq.buildings.configuration[e.Building.type];e.DrawableSprite.image=boc.resources.GraphicsManager.getImage(i.defaultImagePath.replace("$(team)",n));e.Spatial.update({width:e.DrawableSprite.image.width,height:e.DrawableSprite.image.height});e.Building.turnsUntilCapture=t.turnsUntilCapture?t.turnsUntilCapture:i.turnsTilCap;e.FoodProducer.food=i.foodProduced;e.Vision.range=i.vision;if(i.commands){for(var s=0;s<i.commands.length;s++){e.Commandable.commands.push(new bbq.commands[i.commands[s]](r))}}};ns("bbq");ns("boc.utils");boc.utils.getNeighboringTiles=function(e,t,n){var r=new Array;var i={x:e.x,y:e.y-1,heading:"n"};var s={x:e.x,y:e.y+1,heading:"s"};var o={x:e.x+1,y:e.y,heading:"e"};var u={x:e.x-1,y:e.y,heading:"w"};var a={x:e.x+1,y:e.y-1,heading:"ne"};var f={x:e.x-1,y:e.y-1,heading:"nw"};var l={x:e.x+1,y:e.y+1,heading:"se"};var c={x:e.x-1,y:e.y+1,heading:"sw"};var h=[i,s,o,u,a,f,l,c];for(var p=0;p<h.length;p++){var d=h[p];if(d.x>=0&&d.x<t&&d.y>=0&&d.y<n)r.push(d)}return r};bbq.Map=function(e,t,n){function E(e,t){var n=h.getComponentForEntity("Spatial",e);var r=h.getComponentForEntity("Spatial",t);if(!n&&!r){return 0}if(n&&!r){return 1}if(!n&&r){return-1}return r.z-n.z}var r=bbq.maps[e];if(!r){throw"could not find map "+e+"!"}if(!n){n={}}var i=n.tileWidth||50;var s=n.tileHeight||50;var o=r.width;var u=r.height;var a=r.terrain;var f=r.props;var l=r.tileset.toLowerCase();var c={left:n["padding-left"],right:n["padding-right"],top:n["padding-top"],bottom:n["padding-bottom"]};var h=t;var p=new Array(o);var d=new Array(o);var v=new Array(o);var m=new Array(o);var g=new Array(o);var y=new Array(o);for(var b=0;b<o;b++){p[b]=new Array(u);v[b]=new Array(u);d[b]=new Array(u);m[b]=new Array(o);g[b]=new Array(o);y[b]=new Array(o);for(var w=0;w<u;w++){p[b][w]=[];v[b][w]=-1;d[b][w]=new bbq.algorithms.AStarNode({x:b,y:w})}}this.astarMap=function(){return d};this.costMap=function(){return v};this.visionMap=function(){return m};this.movementMap=function(){return g};this.attackMap=function(){return y};this.id=function(){return e};this.tileWidth=function(){return i};this.tileHeight=function(){return s};this.numColumns=function(){return o};this.numRows=function(){return u};this.width=function(){return i*o};this.height=function(){return s*u};this.bounds=function(){return boc.utils.toBounds(I.Spatial)};this.padding=function(){return c};this.avgTurnsToWin=function(){return r.averageTurnsToWin};this.startState=r.startstate;this.getTile=function(e){var t=e;if(typeof t!="string"){t=t.id()}var n=h.getComponentForEntity("Spatial",t);if(n){return{x:Math.floor((n.x+n.width/2)/i),y:Math.floor((n.y+n.height/2)/s)}}return null};this.place=function(e,t,n){var r=e;if(typeof r!="string"){r=r.id()}var o=h.getComponentForEntity("Spatial",r);var u=h.getComponentForEntity("MapElement",r);var a=!u;if(a){u=new bbq.components.MapElement({x:t,y:n});h.addComponentToEntity(u,r)}if(u.x!=t||u.y!=n||a){if(p[u.x]&&p[u.x][u.y]){var f=p[u.x][u.y].indexOf(r);if(f>=0){p[u.x][u.y].splice(f,1)}}p[t][n].push(r);o.update({x:Math.floor(t*i)+(u.offset?u.offset.x:0),y:Math.floor(n*s)+(u.offset?u.offset.y:0)});u.x=t;u.y=n;if($em(r).has("Unit")||$em(r).has("Building")){$em(r).comp("Spatial").update({z:bbq.zindex.UNITSANDBUILDINGS+u.y*10+p[t][n].length})}}if(!u.onKill){u.onKill=function(){var t=-1;if(p[u.x]&&p[u.x][u.y]){t=p[u.x][u.y].indexOf(e)}if(t>=0){p[u.x][u.y].splice(t,1)}};h.addListenerForEntity(e,"onKill",u.onKill)}};this.getEntities=function(e,t,n){var r=[];if(p[e]&&p[e][t]){r=p[e][t].slice();if(n){for(var i=r.length-1;i>=0;i--){var s=r[i];if(!h.getComponentForEntity(n,s)){r.splice(i,1)}}}return r}else{return null}};this.refresh=function(e){if(!e){e=[]}for(var t=0;t<o;t++){for(var n=0;n<u;n++){var r=this.getEntities(t,n,"VisionCostNode").sort(E);for(var i=0;i<r.length;i++){if(e.indexOf(r[i])>=0){continue}m[t][n]=h.getComponentForEntity("VisionCostNode",r[i]);break}var s=this.getEntities(t,n,"MoveCostNode").sort(E);for(var i=0;i<s.length;i++){if(e.indexOf(s[i])>=0){continue}g[t][n]=h.getComponentForEntity("MoveCostNode",s[i]);break}var a=this.getEntities(t,n,"AttackCostNode").sort(E);for(var i=0;i<a.length;i++){if(e.indexOf(a[i])>=0){continue}y[t][n]=h.getComponentForEntity("AttackCostNode",a[i]);break}}}};Math.seedrandom(0);var S=a.split("|");var x=f.split("|");var T=0;for(var b=0;b<S.length;b++){var N=S[b];var C=x[b];for(var w=0;w<N.length;w++){var k=N.charAt(w);var L=C.charAt(w);var A=bbq.tilesets[l].createTile({id:"tile("+w+","+b+")",type:k,x:w,y:b,z:bbq.zindex.TERRAIN,width:i,height:s,entityManager:h});if(A){this.place(A,w,b)}var O=bbq.tilesets[l].createProp({id:"prop("+w+","+b+")",type:L,x:w,y:b,z:bbq.zindex.PROPS,width:i,height:s,entityManager:h});if(k=="w"){T++}if(O){this.place(O,w,b)}}}var M=[];for(var b=0;b<o;b++){for(var w=0;w<u;w++){var _=this.getEntities(b,w,"Terrain")[0];var D=h.getComponentForEntity("Terrain",_);var P=boc.utils.getNeighboringTiles({x:b,y:w},o,u);for(var H=0;H<P.length;H++){var B=P[H];var j=this.getEntities(B.x,B.y,"Terrain")[0];var F=h.getComponentForEntity("Terrain",j);if(F.type==D.type){continue}bbq.tilesets[l].createFringe({id:"fringe("+b+","+w+")",type:D.type,x:B.x,y:B.y,z:bbq.zindex.TERRAIN,width:i,height:s,heading:B.heading,entityManager:h})}}}var I=new boc.core.Entity({entityManager:h});I.addComponent(new boc.components.Spatial({x:-c.left,y:-c.top,z:bbq.zindex.TERRAIN-1,width:i*o+2*c.left,height:s*u+2*c.top}));I.addComponent(new boc.components.DrawableRect({fillStyle:n.bgColor||"black",lineWidth:0}));var q=$em("Terrain").all().concat($em("Prop").all()).concat($em("Fringe").all());var R=75;var U=T>R;console.log("waterTileCount",T);var z=this.id()+"_terrain";var W=this.id()+"_water0";var X,V;if(!boc.resources.GraphicsManager.getImage(z)){var J=$("<canvas>")[0];J.height=this.height();J.width=this.width();var K=J.getContext("2d");var Q=[];var G=[];if(U){for(var Y in bbq.tilesets.forest.water.offsets){var Z=$("<canvas>")[0];Z.height=this.height();Z.width=this.width();G.push(Z);var et=Z.getContext("2d");Q.push(et)}}q.sort(function(e,t){var n=$em(e).comp("Spatial");var r=$em(t).comp("Spatial");return n.z-r.z});for(var b=0;b<q.length;b++){var tt=$em(q[b]).comp("Terrain"),nt=$em(q[b]).comp("DrawableSprite"),rt=$em(q[b]).comp("Spatial");var it;if(tt&&tt.type=="water"){it=Q}else{it=[K]}for(var w=0;w<it.length;w++){var st=it[w];st.save();st.globalAlpha=nt.alpha;var ot=$em(q[b]).comp("SpriteAnimation");if(ot){nt=ot.sprites[w]}if(!nt.clipRect){try{st.drawImage(nt.image,rt.x,rt.y,rt.width,rt.height)}catch(ut){console.log(q[b]," image bad")}}else{st.drawImage(nt.image,nt.clipRect.x,nt.clipRect.y,nt.clipRect.width,nt.clipRect.height,rt.x,rt.y,rt.width,rt.height)}st.restore()}}V=new Image;V.width=this.width();V.height=this.height();console.log("terrain",V.width,V.height);V.src=J.toDataURL();boc.resources.GraphicsManager.addImage(this.id()+"_terrain",V);X=[];for(var b=0;b<Q.length;b++){var at=new Image;at.width=this.width();at.height=this.height();at.src=G[b].toDataURL();var ft=new boc.components.DrawableSprite({image:at});ft.tag="water"+b;X.push(ft);boc.resources.GraphicsManager.addImage(this.id()+"_water"+b,at)}}else{V=boc.resources.GraphicsManager.getImage(this.id()+"_terrain");X=[];var H=0;for(var Y in bbq.tilesets.forest.water.offsets){X.push(new boc.components.DrawableSprite({image:boc.resources.GraphicsManager.getImage(this.id()+"_water"+H++)}))}}if(U){var lt=$em.create(this.id()+"_water");$em(lt).add(new boc.components.Spatial({x:0,y:0,z:bbq.zindex.TERRAIN,width:this.width(),height:this.height()})).add(new boc.components.DrawableSprite({image:boc.resources.GraphicsManager.getImage(this.id()+"_water0"),visible:true}));var ct=new boc.utils.SpriteAnimationSequence({entity:lt,entityManager:$em(),loop:true,animations:[new boc.components.SpriteAnimation({duration:2e3,easing:"linear",sprites:X})]});ct.start()}var ht=$em.create(this.id()+"_terrain");$em(ht).add(new boc.components.Spatial({x:0,y:0,z:bbq.zindex.TERRAIN+1,width:this.width(),height:this.height()})).add(new boc.components.DrawableSprite({image:boc.resources.GraphicsManager.getImage(this.id()+"_terrain"),visible:true}));for(var b=0;b<q.length;b++){var pt=$em(q[b]).comp("DrawableSprite");var dt=$em(q[b]).comp("SpriteAnimation");var D=$em(q[b]).comp("Terrain");if(!U&&D&&D.type=="water"){continue}if(pt){$em(q[b]).remove(pt.className())}if(dt){$em(q[b]).remove(dt.className())}}var vt=bbq.tilesets.forest.edges.offsets;var mt=$em.create(this.id()+"_corner_nw");$em(mt).add(new boc.components.Spatial({x:-vt.nw.width,y:-vt.nw.height,z:bbq.zindex.TERRAIN+1,width:vt.nw.width,height:vt.nw.height})).add(new boc.components.DrawableSprite({image:boc.resources.GraphicsManager.getImage(bbq.tilesets.forest.imagePath),visible:true,clipRect:vt.nw}));mt=$em.create(this.id()+"_corner_ne");$em(mt).add(new boc.components.Spatial({x:this.width(),y:-vt.ne.height,z:bbq.zindex.TERRAIN+1,width:vt.ne.width,height:vt.ne.height})).add(new boc.components.DrawableSprite({image:boc.resources.GraphicsManager.getImage(bbq.tilesets.forest.imagePath),visible:true,clipRect:vt.ne}));mt=$em.create(this.id()+"_corner_sw");$em(mt).add(new boc.components.Spatial({x:-vt.sw.width,y:this.height(),z:bbq.zindex.TERRAIN+1,width:vt.sw.width,height:vt.sw.height})).add(new boc.components.DrawableSprite({image:boc.resources.GraphicsManager.getImage(bbq.tilesets.forest.imagePath),visible:true,clipRect:vt.sw}));mt=$em.create(this.id()+"_corner_se");$em(mt).add(new boc.components.Spatial({x:this.width(),y:this.height(),z:bbq.zindex.TERRAIN+1,width:vt.se.width,height:vt.se.height})).add(new boc.components.DrawableSprite({image:boc.resources.GraphicsManager.getImage(bbq.tilesets.forest.imagePath),visible:true,clipRect:vt.se}));for(var gt=0;gt<o;gt++){var yt=$em.create(this.id()+"_top");$em(yt).add(new boc.components.Spatial({x:gt*i,y:-vt.n.height,z:bbq.zindex.TERRAIN+1,width:vt.n.width,height:vt.n.height})).add(new boc.components.DrawableSprite({image:boc.resources.GraphicsManager.getImage(bbq.tilesets.forest.imagePath),visible:true,clipRect:vt.n}))}for(var gt=0;gt<o;gt++){var yt=$em.create(this.id()+"_bottom");$em(yt).add(new boc.components.Spatial({x:gt*i,y:this.height(),z:bbq.zindex.TERRAIN+1,width:vt.s.width,height:vt.s.height})).add(new boc.components.DrawableSprite({image:boc.resources.GraphicsManager.getImage(bbq.tilesets.forest.imagePath),visible:true,clipRect:vt.s}))}for(var bt=0;bt<u;bt++){var yt=$em.create(this.id()+"_left");$em(yt).add(new boc.components.Spatial({x:-vt.w.width,y:bt*s,z:bbq.zindex.TERRAIN+1,width:vt.w.width,height:vt.w.height})).add(new boc.components.DrawableSprite({image:boc.resources.GraphicsManager.getImage(bbq.tilesets.forest.imagePath),visible:true,clipRect:vt.w}))}for(var bt=0;bt<u;bt++){var yt=$em.create(this.id()+"_right");$em(yt).add(new boc.components.Spatial({x:this.width(),y:bt*s,z:bbq.zindex.TERRAIN+1,width:vt.e.width,height:vt.e.height})).add(new boc.components.DrawableSprite({image:boc.resources.GraphicsManager.getImage(bbq.tilesets.forest.imagePath),visible:true,clipRect:vt.e}))}this.refresh()};window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){var t=1e3/60;window.setTimeout(function(){e(+(new Date))},t)}}();if(!window.bbq){window.bbq={}}bbq.zindex={TERRAIN:0,FRINGE:5,PROPS:10,UNITSANDBUILDINGS:20,BUILDINGS:1e3,UNITS:2e3,FOG:3e3,OVERLAY:4e3,EFFECTS:5e3,CURSOR:6e3,UI:7e3};bbq.teams=["Blue","Red","Yellow"];bbq.lastFrameTime=0;bbq.VictoryConditions={};bbq.VictoryConditions.captureHQ=function(e,t){debugger;if(t.type!="captureHQ"){return}var n=t.player;if(typeof n=="string"){n=boc.utils.getPlayer(n)}var r=[];for(var i=0;i<e.players().length;i++){var s=e.players()[i];if(s==n||s.id=="_neutral_")continue;var o=true;for(var u=0;u<s.buildings.length;u++){if($em(s.buildings[u]).comp("Building").type=="HQ"){o=false;break}}if(o)r.push(s)}if(r.length==e.players().length-2){if(e.onvictory){e.onvictory(n.id)}}};bbq.Game=function(e){var t=this;var n=e.canvas;var r=navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Mobile/i);var i=e.entityManager;boc.utils.setEntityManager(i);var s=e.hud;this.hud=function(){return s};this.state=function(){return e.gameState.state};this.id=function(){return e.gameState.gameid};this.turn=function(){return e.gameState.turn};this.winner=function(){return e.gameState.winner};var o=null;this.map=function(){return o};var u=e.user;this.user=function(){return u};this.onvictory=null;this.victoryCondition=null;this.save=function(e){};this.end=function(e,n){boc.utils.createEvent(new bbq.events.SaveEvent("saveAll",t.getCurrentPlayer().id,function(){var r=+(new Date)+"+"+e+"+"+t.id();boc.utils.getJson("end/"+r,{},function(e){if(e){if(e.status=="ok"){if(n){n(e.result.winner)}}else{alert(e.result)}}else{alert("error ending game.")}})}),i)};this.collect=function(e){var n=+(new Date)+"+"+t.id();boc.utils.getJson("collect/"+n,{},function(t){if(t.status=="ok"){if(e){e(t.result)}}else{alert(t.result)}})};this.clearFog=function(){boc.utils.createEvent(new bbq.events.FogEvent({action:"clear"}),i)};this.endTurn=function(e){boc.utils.createEvent(new bbq.events.CommandEvent({action:"endTurn",args:{callback:e}}),i)};this.refresh=function(){boc.utils.createEvent(new bbq.events.FogEvent({action:"update"}),i);boc.utils.createEvent(new bbq.events.FogEvent({action:"draw"}),i);boc.utils.createEvent(new bbq.events.HudEvent({action:"update"}),i)};var a=new boc.utils.Camera({xmin:0,xmax:n.width,ymin:0,ymax:n.height});this.camera=function(){return a};var f=null,l=null,c=null,h=null,p=null,d=null,v=null,m=null,g=null,y=null,b=null,w=null,E=null,S=null,x=null,T=null,N=null,C=null,k=null,L=null,A=null,O=null,M=null,_=null,D=null,P=null,H=null,B=null;var j=false;var F=null;var I=false;var q=null;var R=function(e){e.preventDefault()};this.touchCallback=R;this.start=function(){function s(t){if(i<=3){e=t;i++;q=requestAnimFrame(s);return}if(j){if(F){F()}if(window.cancelAnimationFrame){cancelAnimationFrame(q)}bbq.lastFrameTime=e;return}q=requestAnimFrame(s);var n=t-e;h.processTick(n);d.processTick(n);l.processTick(n);if(!I){g.processTick(n);E.processTick(n);y.processTick(n);S.processTick(n);x.processTick(n);M.processTick(n);C.processTick(n);T.processTick(n);k.processTick(n);L.processTick(n);A.processTick(n);N.processTick(n);c.processTick(n);b.processTick(n);m.processTick(n);B.processTick(n);v.processTick(n);H.processTick(n);w.processTick(n);_.processTick(n);D.processTick(n);O.processTick(n)}P.processTick(n);f.processTick(n);if(!I){p.processTick(n)}e=t}document.addEventListener("touchmove",R);var e=window.navigator.userAgent.toLowerCase().indexOf("firefox")>=0?+(new Date):bbq.lastFrameTime;var t=true;var n=false,r=false;var i=0;s(e)};this.stop=function(e){j=true;F=e;document.removeEventListener("touchmove",R)};this.pause=function(e){if(e==undefined){return I}I=e};var U=e.scale||1;this.scale=function(e){if(e==undefined){return U}U=e};var z=e.speed||1;this.speed=function(e){if(e==undefined){return z}z=e};this.setTimeout=function(e,t){if(e){setTimeout(e,t/z)}};var W=[];this.players=function(){return W};this.getPlayer=function(e){for(var t=0;t<W.length;t++){if(W[t].id===e){return W[t]}}return null};this.getCurrentPlayer=function(){for(var e=0;e<W.length;e++){if(W[e].id==this.turn()){return W[e]}}return null};var X=true;this.load=function(s,j){a.update({zoom:r?1:1});var F=Math.round(e.canvas.width/a.zoom);var I=Math.round(e.canvas.height/a.zoom);if(s!=null&&typeof s!="undefined"){W=[];i.clear();e.hud.removeListener("trainback");e.hud.removeListener("trainok");e.gameState=s;var q=function(){o=new bbq.Map(e.gameState.mapid,i,{"padding-left":F/2,"padding-right":F/2,"padding-top":I/2,"padding-bottom":I/2});f=new boc.systems.RenderSystem(i,n);f.camera(a);l=new boc.systems.CameraFollowSystem(i);c=new boc.systems.AnimationSystem(i);h=!r?new boc.systems.MouseInputSystem(i,e.canvas):new boc.systems.TouchInputSystem(i,e.canvas);p=new boc.systems.LifespanSystem(i);d=new boc.systems.PanningCameraSystem(i,f.camera());d.bounds(t.map().bounds());v=new boc.pfx.systems.BasicParticleSystem(i);m=new boc.systems.SpriteAnimationSystem(i);g=new boc.systems.IdentifySystem(i,f.camera());y=new bbq.systems.MapSelectSystem(i,a);b=new bbq.systems.ParabolicTranslationSystem(i);w=new bbq.systems.FogSystem(i,t.map());E=new boc.systems.UISystem(i);S=new bbq.systems.UnitSystem(i);x=new bbq.systems.CommandSystem(i,e.canvas,t.map());T=new bbq.systems.MoveSystem(i,t.map());k=new bbq.systems.AttackSystem(i,t.map());L=new bbq.systems.HealSystem(t.map());A=new bbq.systems.RevealSystem(t.map());N=new bbq.systems.UnitCollisionSystem(i,t.map());C=new bbq.systems.HudSystem(i,t.hud());O=new boc.systems.DelayedMethodSystem(i);M=new bbq.systems.TrainingSystem(i,f.camera(),t.map(),{scale:1/a.zoom,hud:t.hud(),touchCallback:R});_=new bbq.systems.HealthSystem(i);D=new bbq.systems.UpkeepSystem(i);P=new bbq.systems.SaveSystem(t,i);H=new bbq.systems.VictorySystem(t,i);B=new boc.spine.SpineAnimationSystem;var s=[];var q=[];for(var U in e.gameState.state){var z=e.gameState.state[U];var V=new boc.core.Entity({description:U,entityManager:i});var $=new bbq.UnitSet(z.team,z.unitSet||["SpearWarrior","DartBlower","Scout","Enforcer","Harvester","Catapult"]);V.addComponent(new bbq.components.Player({id:U,food:z.food,turn:z.turn,team:z.team,upkeep:z.upkeep,buildings:[],units:[],summary:{},lastSeen:z.lastSeen,unitSet:$}));W.push(V.Player);if(z.buildings){for(var J=0;J<z.buildings.length;J++){var K=z.buildings[J];var Q=bbq.buildings.createBuilding(K,V.Player.team,i);V.Player.buildings.push(Q);q.push({bState:K,buildingEnt:Q})}}if(z.units){for(var J=0;J<z.units.length;J++){var G=z.units[J];var Y=bbq.units.createUnit(G,V.Player.team,i);V.Player.units.push(Y);s.push({uState:G,unitEnt:Y});var Z=bbq.units.getLevel(Y);if(Z>1){bbq.units.levelUp(Y,Z,true)}}}}for(var J=0;J<q.length;J++){var Q=q[J].buildingEnt;var K=q[J].bState;o.place(Q,K.location.x,K.location.y)}for(var J=0;J<s.length;J++){var G=s[J].uState;var Y=s[J].unitEnt;o.place(Y,G.location.x,G.location.y);if(G.options&&G.options.gatherTarget){(new bbq.commands.Gather).execute({entity:Y,map:t.map(),showIconOnly:true})}if(G.options&&G.options.captureTarget){(new bbq.commands.Capture).execute({entity:Y,map:t.map(),showIconOnly:true})}}for(var J=0;J<e.gameState.summary.players.length;J++){var et=e.gameState.summary.players[J];var tt=boc.utils.getPlayer(et.playerid);if(tt){tt.summary=et}}var nt=new boc.core.Entity({description:"turn",entityManager:i});nt.addComponent(new bbq.components.Turn({playerid:t.getCurrentPlayer().id,number:t.getCurrentPlayer().turn}));var rt=null;if(u){rt=boc.utils.getPlayer(u.playerid,i)}boc.utils.createEvent(new bbq.events.FogEvent({action:"update",forPlayer:rt}),i);boc.utils.createEvent(new bbq.events.FogEvent({action:"draw",forPlayer:rt}),i);if(rt){boc.utils.createEvent(new bbq.events.CommandEvent({action:"lockCommands",args:{forPlayer:rt}}),i);if(rt.id==t.getCurrentPlayer().id){for(var it=0;it<rt.units.length;it++){if($em(rt.units[it]).comp("Unit").state=="inactive"){boc.utils.createEvent(new bbq.events.UnitEvent({action:"inactivate",args:{entity:rt.units[it]}}),i)}}}}boc.utils.createEvent(new bbq.events.HudEvent({action:"update"}),i);if(rt&&X){for(var st=0;st<rt.buildings.length;st++){var ot=$em(rt.buildings[st]).comp("Building");if(ot&&ot.type==="HQ"){boc.utils.centerCamera(a,rt.buildings[st]);break}}}X=false;if(j){j(t)}};if(bbq.maps[e.gameState.mapid]){q()}else{boc.utils.getJson("get/maps",{mapid:e.gameState.mapid},function(t){if(!t||t.status!="ok"){throw"map "+e.gameState.mapid+" not found!"}else{bbq.maps[e.gameState.mapid]=t.result[0];q()}})}}};window.gCamera=a;this.load(e.gameState,e.onLoad)};if(!boc.utils){boc.utils={}}boc.utils.getCurrentPlayer=function(e){if(!e){e=boc.utils._em}var t=e.getComponentForEntity("Turn",e.getAllEntitiesWithComponent("Turn")[0]);var n=e.getAllComponents("Player");for(i=0;i<n.length;i++){if(n[i].id==t.playerid){return n[i]}}return null};boc.utils.getPlayer=function(e,t){if(!t){t=boc.utils._em}var n=t.getAllComponents("Player");for(i=0;i<n.length;i++){if(n[i].id==e){return n[i]}}};boc.utils.createHitEffect=function(e,t,n){if(!n){n=boc.utils._em}var r=n.createEntity();$em(r).add(new boc.components.Spatial({x:e,y:t,z:bbq.zindex.EFFECTS,width:1,height:1})).add(new boc.pfx.components.Emitter({particleFactory:new boc.pfx.particleFactories.FadingStarFactory(n,20),startVector:{x:0,y:-1},startVelocity:150,accelerationVector:{x:0,y:.05},emitRadius:180,particleDuration:500,particlesPerSecond:30})).add(new boc.components.Lifespan({duration:200}));return r};boc.utils.createSmokeEffect=function(e,t,n){if(!n){n=boc.utils._em}var r=n.createEntity();$em(r).add(new boc.components.Spatial({x:e,y:t,z:bbq.zindex.EFFECTS,width:1,height:1})).add(new boc.pfx.components.Emitter({particleFactory:new boc.pfx.particleFactories.SmokeFactory(n,50),startVector:{x:0,y:1},startVelocity:100,accelerationVector:{x:0,y:-.075},emitRadius:225,particleDuration:500,particlesPerSecond:100})).add(new boc.components.Lifespan({duration:500}));return r};boc.utils.createScrollingDrawable=function(e,t,n,r){if(!r){r={}}if(!r.easing){r.easing="linearTween"}if(!r.duration){r.duration=1e3}var i=$em.create();$em(i).add(new boc.components.Spatial({x:t,y:n,z:bbq.zindex.OVERLAY,width:9,height:13})).add(e).add(new boc.components.Animation({componentName:"Spatial",propertyDeltas:{y:-50},duration:r.duration,easing:r.easing,state:boc.constants.ANIMATION_PLAYING})).add(new boc.components.Lifespan({duration:r.duration}));return i};var bbq=bbq||{};bbq.tilesets=bbq.tilesets||{};bbq.tilesets.forest=bbq.tilesets.forest||{};bbq.tilesets.forest.createTile=function(e){var t=e.entityManager;var n=null;var r=null;var i=0;switch(e.type){case"g":var s=Math._random();if(s<.05){n=bbq.tilesets.forest.grass.offsets.base1}else if(s>=.05&&s<.15){n=bbq.tilesets.forest.grass.offsets.base2}else{n=bbq.tilesets.forest.grass.offsets.base0}r="grass";i=bbq.tilesets.forest.grass.properties.zIndex;break;case"d":n=bbq.tilesets.forest.dirt.offsets.base;i=bbq.tilesets.forest.dirt.properties.zIndex;r="dirt";break;case"w":n=bbq.tilesets.forest.water.offsets.base0;i=bbq.tilesets.forest.water.properties.zIndex;r="water";break;default:return null}var o=t.createEntity(e.id);t.addComponentToEntity(new boc.components.Spatial({x:e.x*e.width,y:e.y*e.height,z:e.z+i,width:e.width,height:e.height}),o);t.addComponentToEntity(new boc.components.DrawableSprite({image:boc.resources.GraphicsManager.getImage(bbq.tilesets.forest.imagePath),clipRect:n}),o);if(e.type=="w"){var u=[];for(var a in bbq.tilesets.forest.water.offsets){u.push(new boc.components.DrawableSprite({image:boc.resources.GraphicsManager.getImage(bbq.tilesets.forest.imagePath),clipRect:bbq.tilesets.forest.water.offsets[a]}))}var f=new boc.utils.SpriteAnimationSequence({entity:o,entityManager:t,loop:true,animations:[new boc.components.SpriteAnimation({duration:2e3,easing:"linear",sprites:u})]});f.start()}t.addComponentToEntity(new bbq.components.Terrain({type:r}),o);t.addComponentToEntity(new boc.components.Identifiable({}),o);t.addComponentToEntity(new bbq.components.MoveCostNode(bbq.tilesets.forest[r].properties.moveCost),o);t.addComponentToEntity(new bbq.components.VisionCostNode(bbq.tilesets.forest[r].properties.visionCost),o);t.addComponentToEntity(new bbq.components.AttackCostNode(bbq.tilesets.forest[r].properties.attackCost),o);return o};bbq.tilesets.forest.createProp=function(e){var t=e.entityManager;var n=null;var r=null;var i=null,s=null,o=null;var u=null;switch(e.type){case"R":n=bbq.tilesets.forest.props.offsets.rock;s=bbq.tilesets.forest.props.properties.rock.moveCost;r="rock";break;case"H":n=bbq.tilesets.forest.props.offsets.highgrass;i=bbq.tilesets.forest.props.properties.highgrass.visionCost;r="highgrass";break;case"T":n=bbq.tilesets.forest.props.offsets.tree;r="tree";break;case"B":n=bbq.tilesets.forest.props.offsets.berries;r="berries";u=new bbq.components.Gatherable(bbq.tilesets.forest.props.properties.berries.foodPerTurn);break;default:return null}var a=t.createEntity(e.id);t.addComponentToEntity(new boc.components.Spatial({x:e.x*e.width,y:e.y*e.height,z:e.z,width:e.width,height:e.height}),a);t.addComponentToEntity(new boc.components.DrawableSprite({image:boc.resources.GraphicsManager.getImage(bbq.tilesets.forest.imagePath),clipRect:n}),a);t.addComponentToEntity(new bbq.components.Prop({type:r}),a);if(u){t.addComponentToEntity(u,a)}t.addComponentToEntity(new boc.components.Identifiable({}),a);if(s){t.addComponentToEntity(new bbq.components.MoveCostNode(s),a)}if(i){t.addComponentToEntity(new bbq.components.VisionCostNode(i),a)}if(o){t.addComponentToEntity(new bbq.components.AttackCostNode(o),a)}return a};bbq.tilesets.forest.createFringe=function(e){var t=e.entityManager;var n=null;switch(e.heading){case"n":n="s";break;case"s":n="n";break;case"e":n="w";break;case"w":n="e";break;case"ne":n="sw";break;case"nw":n="se";break;case"se":n="nw";break;case"sw":n="ne";break}if(!n){return null}var r=null;var i=0;switch(e.type){case"grass":r=bbq.tilesets.forest.grass.offsets[n];i=bbq.tilesets.forest.grass.properties.zIndex;break;case"dirt":r=bbq.tilesets.forest.dirt.offsets[n];i=bbq.tilesets.forest.dirt.properties.zIndex;break;default:return null}var s=t.createEntity(e.id);t.addComponentToEntity(new boc.components.Spatial({x:e.x*e.width,y:e.y*e.height,z:e.z+i,width:e.width,height:e.height}),s);t.addComponentToEntity(new boc.components.DrawableSprite({image:boc.resources.GraphicsManager.getImage(bbq.tilesets.forest.imagePath),clipRect:r}),s);t.addComponentToEntity(new bbq.components.Fringe,s);return s};if(!window.bbq){window.bbq={}}if(!bbq.units){bbq.units={}}bbq.units.createUnit=function(e,t,n){if(e.type=="Gatherer"){e.type="Harvester"}var r=new boc.core.Entity({description:e.type,entityManager:n});r.addComponent(new boc.components.Spatial({x:0,y:0,z:bbq.zindex.UNITS,width:0,height:0}));r.addComponent(new boc.components.DrawableSprite({}));r.addComponent(new boc.spine.SpineDrawable({visible:true}));r.addComponent(new boc.components.Identifiable({}));r.addComponent(new boc.components.SpriteAnimationSet);r.addComponent(new bbq.components.Unit({type:e.type}));r.addComponent(new bbq.components.Buffable({}));r.addComponent(new bbq.components.Debuffable({}));r.addComponent(new bbq.components.Trainable({}));r.addComponent(new bbq.components.Attack({}));r.addComponent(new bbq.components.Retaliate({}));r.addComponent(new bbq.components.Vision({}));r.addComponent(new bbq.components.Movement({}));r.addComponent(new bbq.components.Health({}));r.addComponent(new bbq.components.Commandable({}));r.addComponent(new bbq.components.MoveCostNode(function(){return 99999}));bbq.units.specialize(r,e,t,n);return r.id()};bbq.units.specialize=function(e,t,n,r){var i=bbq.units.configuration[e.Unit.type];e.Unit.state=t.state?t.state:"idle";e.Unit.kills=t.options&&t.options.kills?t.options.kills:0;e.DrawableSprite.image=boc.resources.GraphicsManager.getImage(e.Unit.type+"_"+n.toLowerCase());e.SpineDrawable.skeleton=boc.spine.SkeletonManager.createSkeleton(e.Unit.type.toLowerCase()+"_"+n.toLowerCase(),{x:50,y:-50});e.SpineDrawable.skeleton.setSkinByName("defaultSkin");e.SpineDrawable.skeleton.setSlotsToSetupPose();var s=new boc.spine.SpineAnimation({state:boc.constants.ANIMATION_STOPPED,target:e.id()});s.on("onComplete",function(t){e.SpineDrawable.skeleton.setToSetupPose();e.SpineDrawable.skeleton.updateWorldTransform()});e.addComponent(s);e.Spatial.update({width:50,height:50,scaleX:.5,scaleY:.5});var o=$em.create();$em(o).add(new boc.components.Spatial({x:2,y:e.Spatial.height-2,z:bbq.zindex.UNITS+1,width:e.Spatial.width-4,height:9})).add(new boc.components.DrawableRect({fillStyle:"rgb(64,64,64)",lineWidth:2,strokeStyle:"black"}));var u=new bbq.components.HealthBar(o);e.addComponent(u);boc.utils.follow(e.id(),o,r);$em(e.id()).listen("onKill",function(){$em(o).kill()});e.Trainable.foodCost=i.foodCost;e.Attack.minRange=i.attackMinRange*100;e.Attack.maxRange=i.attackMaxRange*100;e.Attack.damage=i.attackDamage;e.Retaliate.minRange=i.attackMinRange*100;e.Retaliate.maxRange=i.attackMaxRange*100;e.Retaliate.damage=Math.floor(i.attackDamage/2);e.Vision.range=i.visionRange*100;e.Movement.range=i.moveRange*100;e.Movement.velocity=i.moveSpeed;e.Movement.bonus=function(t){if(t==="dirt"){return Math.floor(e.Movement.range/(e.Movement.range+i.moveBonus[t]*100)*100)}return 100};e.Health.current=t.hp?t.hp:i.health;e.Health.max=i.health;for(var a=0;a<i.commands.length;a++){e.Commandable.commands.push(new bbq.commands[i.commands[a]](r))}if(i.defaultImagePath){e.SpriteAnimationSet["default"]=boc.resources.GraphicsManager.getImage(i.defaultImagePath.replace("$(team)",n))}if(i.animationSets){for(var f in i.animationSets){var l=i.animationSets[f];if(e.Unit.type==="Catapult"&&n==="blue"){l=i.animationSetsDefault[f]}var c=[];for(var a=1;a<=l.frameCount;a++){var h=l.imagePath.replace("$(team)",n).replace("$(frame)",boc.utils.leftPad(a,4));c.push(new boc.components.DrawableSprite({image:boc.resources.GraphicsManager.getImage(h)}))}e.SpriteAnimationSet[f]=new boc.components.SpriteAnimation({sprites:c,duration:l.duration,easing:"linearTween",state:boc.constants.ANIMATION_STOPPED})}}if(i.healPoints){e.addComponent(new bbq.components.Heal(i.healPoints))}if(i.revealRange&&i.revealRadius){e.addComponent(new bbq.components.Reveal(i.revealRange*100,i.revealRadius*100))}var p=$em(o).comp("Spatial");u.currentIcon=$em.create();$em(u.currentIcon).add(new boc.components.Spatial({x:p.x+2,y:p.y+2,z:p.z+2,width:0,height:5})).add(new boc.components.DrawableRect({fillStyle:"lime",lineWidth:0}));boc.utils.follow(o,u.currentIcon,r);$em(o).listen("onKill",function(){$em(u.currentIcon).kill()});var d=e.Health;var v=42;var m=d.current/d.max;$em(u.currentIcon).comp("Spatial").update({width:Math.floor(v*m)});if(m>=.65){$em(u.currentIcon).comp("DrawableRect").fillStyle="lime"}else if(m>=.4){$em(u.currentIcon).comp("DrawableRect").fillStyle="gold"}else{$em(u.currentIcon).comp("DrawableRect").fillStyle="firebrick"}if(d.current>=d.max){$em(o).comp("DrawableRect").visible=false;$em(u.currentIcon).comp("DrawableRect").visible=false}};bbq.units.getLevel=function(e){var t=$em(e).comp("Unit");var n=bbq.units.configuration[t.type];if(n&&n.levelUp){var r=1;for(var i=2;i<=n.levelUp.maxLevels;i++){var s=n.levelUp["level"+i].requiredKills;if(t.kills>=s)r++}return r}else{return 1}};bbq.units.levelUp=function(e,t,n){var r=$em(e).comp("Unit");var i=bbq.units.configuration[r.type];if(i&&i.levelUp){for(var s=r.level+1;s<=t;s++){var o=i.levelUp["level"+s];if(o.moveRange){$em(e).comp("Movement").range+=o.moveRange*100}if(o.visionRange){$em(e).comp("Vision").range+=o.visionRange*100}if(o.attackRange){$em(e).comp("Attack").maxRange+=o.attackRange*100}if(o.attackDamage){$em(e).comp("Attack").damage+=o.attackDamage}if(o.healPoints){var u=$em(e).comp("Heal");if(u){u.points+=o.healPoitns}}if(o.health){if(!n){$em(e).comp("Health").current+=o.health}$em(e).comp("Health").max+=o.health}}r.level=t;var a=$em(e).comp("Spatial");if(!n){var f=new boc.components.DrawableText({text:"Level up!",fillStyle:"white"});boc.utils.createScrollingDrawable(f,a.x,a.y+a.height/2,{easing:"easeOutQuad",duration:1300})}}};if(!window.bbq){window.bbq={}}if(!bbq.ui){bbq.ui={}}bbq.ui.configuration={ringPositions:[[{offsetX:0,offsetY:-50,anchorX:.5,anchorY:.5}],[{offsetX:0,offsetY:-50,anchorX:.5,anchorY:.5},{offsetX:0,offsetY:50,anchorX:.5,anchorY:.5}],[{offsetX:-50,offsetY:0,anchorX:.5,anchorY:.5},{offsetX:0,offsetY:-50,anchorX:.5,anchorY:.5},{offsetX:50,offsetY:0,anchorX:.5,anchorY:.5}],[{offsetX:-50,offsetY:0,anchorX:.5,anchorY:.5},{offsetX:0,offsetY:-50,anchorX:.5,anchorY:.5},{offsetX:50,offsetY:0,anchorX:.5,anchorY:.5},{offsetX:0,offsetY:50,anchorX:.5,anchorY:.5}],[{offsetX:-60,offsetY:0,anchorX:.5,anchorY:.5},{offsetX:0,offsetY:-40,anchorX:.5,anchorY:.5},{offsetX:60,offsetY:0,anchorX:.5,anchorY:.5},{offsetX:60,offsetY:-40,anchorX:.5,anchorY:.5},{offsetX:0,offsetY:40,anchorX:.5,anchorY:.5}],[{offsetX:-60,offsetY:0,anchorX:.5,anchorY:.5},{offsetX:0,offsetY:-40,anchorX:.5,anchorY:.5},{offsetX:60,offsetY:0,anchorX:.5,anchorY:.5},{offsetX:60,offsetY:-40,anchorX:.5,anchorY:.5},{offsetX:0,offsetY:40,anchorX:.5,anchorY:.5},{offsetX:-60,offsetY:40,anchorX:.5,anchorY:.5}]]};bbq.ui.createButton=function(e){var t=e.entityManager;if(!e.scale){e.scale=1}var n=new boc.core.Entity({entityManager:t,description:"button"});var r=50,i=50;n.addComponent(new boc.components.Spatial({x:e.x,y:e.y,z:bbq.zindex.UI,width:r,height:i,scale:e.scale}));if(e.followCamera){n.addComponent(new boc.components.CameraFollow({camera:e.followCamera}))}var s=new boc.components.DrawableSprite({image:boc.resources.GraphicsManager.getImage("assets/graphics/"+e.text.toLowerCase()+"Button.png")});s.alpha=1;n.addComponent(s);n.addComponent(new boc.components.UIElement({onclick:e.onclick}));n.addComponent(new boc.components.Identifiable({}));return n.id()};bbq.ui.createAvatarOverlay=function(e){if(!e.scale){e.scale=1}var t=e.entityManager;var n=new boc.core.Entity({description:"avatarOverlay",entityManager:t});n.addComponent(new boc.components.Spatial({x:e.x,y:e.y,z:bbq.zindex.UI,width:186,height:56,scale:e.scale||1}));if(e.followCamera){n.addComponent(new boc.components.CameraFollow({camera:e.followCamera}))}n.addComponent(new boc.components.DrawableSprite({image:boc.resources.GraphicsManager.getImage("assets/UI/HUD/avatar_overlay.png")}));n.addComponent(new boc.components.UIElement({}));n.addComponent(new boc.components.Identifiable({}));n.addComponent(new bbq.components.PlayerStats(null));var r=new boc.core.Entity({entityManager:t});var i=r.id();r.addComponent(new boc.components.Spatial({x:e.x+168*e.scale,y:e.y+21*e.scale,z:bbq.zindex.UI+1,width:14,height:14,scale:e.scale||1}));r.addComponent(new boc.components.DrawableSprite({image:boc.resources.GraphicsManager.getImage("assets/UI/HUD/button_up.png")}));boc.utils.follow(n.id(),r.id(),t);var s=new boc.core.Entity({entityManager:t});var o=s.id();s.addComponent(new boc.components.Spatial({x:e.x+168*e.scale,y:e.y+21*e.scale,z:bbq.zindex.UI+1,width:14,height:14,scale:e.scale||1}));s.addComponent(new boc.components.DrawableSprite({image:boc.resources.GraphicsManager.getImage("assets/UI/HUD/button_down.png")}));s.DrawableSprite.visible=false;boc.utils.follow(n.id(),s.id(),t);var u=boc.utils.getPlayer(e.playerid,t);var a=new boc.core.Entity({entityManager:t});a.addComponent(new boc.components.Spatial({x:e.x+64*e.scale,y:e.y+14*e.scale,z:bbq.zindex.UI+1,width:120,height:14,scale:e.scale||1}));a.addComponent(new boc.components.DrawableText({text:e.playerid,fillStyle:"white",font:"bold 8pt Helvetica"}));boc.utils.follow(n.id(),a.id(),t);var f=new boc.core.Entity({entityManager:t});f.addComponent(new boc.components.Spatial({x:e.x+84*e.scale,y:e.y+31*e.scale,z:bbq.zindex.UI+1,width:34,height:17,scale:e.scale||1}));f.addComponent(new boc.components.DrawableText({text:u.food,fillStyle:"white",font:"bold 8pt Helvetica"}));var l=f.id();var c=$em("Player").all();for(var h=0;h<c.length;h++){(function(e){$em(e).comp("Player").addListener("onFoodChange",function(e){var n=t.getComponentForEntity("DrawableText",l);n.text=e.newFood})})(c[h])}boc.utils.follow(n.id(),f.id(),t);var p=new boc.core.Entity({entityManager:t});p.addComponent(new boc.components.Spatial({x:e.x+140*e.scale,y:e.y+31*e.scale,z:bbq.zindex.UI+1,width:34,height:17,scale:e.scale||1}));p.addComponent(new boc.components.DrawableText({text:u.turn,fillStyle:"white",font:"bold 8pt Helvetica"}));var d=p.id();var v=a.id();boc.utils.follow(n.id(),p.id(),t);var m=false;n.UIElement.onclick=function(r){if(m){if(n.Animation){n.removeComponent("Animation")}n.addComponent(new boc.components.Animation({entity:n.id(),duration:150,state:boc.constants.ANIMATION_PLAYING,componentName:"Spatial",propertyDeltas:{x:55*e.scale,y:18*e.scale}}));t.getComponentForEntity("DrawableSprite",i).visible=true;t.getComponentForEntity("DrawableSprite",o).visible=false;m=false}else{if(n.Animation){n.removeComponent("Animation")}n.addComponent(new boc.components.Animation({entity:n.id(),duration:150,state:boc.constants.ANIMATION_PLAYING,componentName:"Spatial",propertyDeltas:{x:-55*e.scale,y:-18*e.scale}}));t.getComponentForEntity("DrawableSprite",i).visible=false;t.getComponentForEntity("DrawableSprite",o).visible=true;m=true}};n.PlayerStats.addListener("onTargetChange",function(e){t.getComponentForEntity("DrawableText",v).text=e.newTarget.id;t.getComponentForEntity("DrawableText",d).text=e.newTarget.turn;$em(l).comp("DrawableText").text=e.newTarget.food});return n.id()};bbq.ui.createStatsOverlay=function(e){if(!e.scale){e.scale=1}var t=e.entityManager;var n=new boc.core.Entity({description:"statsOverlay",entityManager:t});var r=n.id();n.addComponent(new boc.components.Spatial({x:e.x,y:e.y,z:bbq.zindex.UI,width:238,height:54,scale:e.scale||1}));if(e.followCamera){n.addComponent(new boc.components.CameraFollow({camera:e.followCamera}))}n.addComponent(new boc.components.DrawableSprite({image:boc.resources.GraphicsManager.getImage("assets/UI/HUD/stats_overlay.png")}));n.addComponent(new boc.components.UIElement({}));n.addComponent(new boc.components.Identifiable({}));n.addComponent(new bbq.components.UnitStats(null));var i=new boc.core.Entity({entityManager:t});var s=i.id();i.addComponent(new boc.components.Spatial({x:e.x+16*e.scale,y:e.y+17*e.scale,z:bbq.zindex.UI+1,width:38,height:19,scale:e.scale||1}));i.addComponent(new boc.components.DrawableText({text:"",fillStyle:"white",font:"bold 8pt Helvetica"}));boc.utils.follow(r,s,t);var o=new boc.core.Entity({entityManager:t});var u=o.id();o.addComponent(new boc.components.Spatial({x:e.x+31*e.scale,y:e.y+38*e.scale,z:bbq.zindex.UI+1,width:38,height:19,scale:e.scale||1}));o.addComponent(new boc.components.DrawableText({text:"",fillStyle:"white",font:"bold 8pt Helvetica"}));boc.utils.follow(r,u,t);var a=new boc.core.Entity({entityManager:t});var f=a.id();a.addComponent(new boc.components.Spatial({x:e.x+72*e.scale,y:e.y+38*e.scale,z:bbq.zindex.UI+1,width:38,height:19,scale:e.scale||1}));a.addComponent(new boc.components.DrawableText({text:"",fillStyle:"white",font:"bold 8pt Helvetica"}));boc.utils.follow(r,f,t);var l=new boc.core.Entity({entityManager:t});var c=l.id();l.addComponent(new boc.components.Spatial({x:e.x+117*e.scale,y:e.y+38*e.scale,z:bbq.zindex.UI+1,width:38,height:19,scale:e.scale||1}));l.addComponent(new boc.components.DrawableText({text:"",fillStyle:"white",font:"bold 8pt Helvetica"}));boc.utils.follow(r,c,t);var h=new boc.core.Entity({entityManager:t});var p=h.id();h.addComponent(new boc.components.Spatial({x:e.x+170*e.scale,y:e.y+38*e.scale,z:bbq.zindex.UI+1,width:38,height:19,scale:e.scale||1}));h.addComponent(new boc.components.DrawableText({text:"",fillStyle:"white",font:"bold 8pt Helvetica"}));boc.utils.follow(r,p,t);var d=new boc.core.Entity({entityManager:t});var v=d.id();d.addComponent(new boc.components.Spatial({x:e.x+215*e.scale,y:e.y+38*e.scale,z:bbq.zindex.UI+1,width:38,height:19,scale:e.scale||1}));d.addComponent(new boc.components.DrawableText({text:"",fillStyle:"white",font:"bold 8pt Helvetica"}));boc.utils.follow(r,v,t);var m=new boc.core.Entity({entityManager:t});var g=m.id();m.addComponent(new boc.components.Spatial({x:e.x+139*e.scale,y:e.y+6*e.scale,z:bbq.zindex.UI+1,width:14,height:14,scale:e.scale||1}));m.addComponent(new boc.components.DrawableSprite({image:boc.resources.GraphicsManager.getImage("assets/UI/HUD/button_up.png")}));m.DrawableSprite.visible=false;boc.utils.follow(n.id(),m.id(),t);var y=new boc.core.Entity({entityManager:t});var b=y.id();y.addComponent(new boc.components.Spatial({x:e.x+139*e.scale,y:e.y+6*e.scale,z:bbq.zindex.UI+1,width:14,height:14,scale:e.scale||1}));y.addComponent(new boc.components.DrawableSprite({image:boc.resources.GraphicsManager.getImage("assets/UI/HUD/button_down.png")}));y.DrawableSprite.visible=true;boc.utils.follow(n.id(),y.id(),t);n.UnitStats.addListener("onTargetChange",function(n){if(n.newTarget&&t.getComponentForEntity("Unit",n.newTarget)){var r=$em(n.newTarget).comp("MapElement");var i=t.getComponentForEntity("Unit",n.newTarget);t.getComponentForEntity("DrawableText",s).text=bbq.units.configuration[i.type].displayName+" Lv. "+i.level;var o=t.getComponentForEntity("Health",n.newTarget);t.getComponentForEntity("DrawableText",u).text=o.current;var a=t.getComponentForEntity("Attack",n.newTarget);t.getComponentForEntity("DrawableText",f).text=a.damage;t.getComponentForEntity("DrawableText",c).text=Math.floor(a.minRange/100)+"-"+Math.floor(a.maxRange/100);var l=t.getComponentForEntity("Movement",n.newTarget);t.getComponentForEntity("DrawableText",p).text=Math.floor(l.range/100);var h=t.getComponentForEntity("Vision",n.newTarget);var d=0;var m=e.map.getEntities(r.x,r.y,"Prop");for(var g=0;g<m.length;g++){var y=$em(m[g]).comp("Prop");if(y&&y.type=="tree"){var b=bbq.tilesets.forest.props.properties.tree.visionBonus*100;d+=b}}t.getComponentForEntity("DrawableText",v).text=Math.floor((h.range+d)/100);if(d>0){$em(v).comp("DrawableText").fillStyle="lime"}else if(d<0){$em(v).comp("DrawableText").fillStyle="red"}else{$em(v).comp("DrawableText").fillStyle="white"}}else{t.getComponentForEntity("DrawableText",s).text="";t.getComponentForEntity("DrawableText",u).text="";t.getComponentForEntity("DrawableText",f).text="";t.getComponentForEntity("DrawableText",c).text="";t.getComponentForEntity("DrawableText",p).text="";t.getComponentForEntity("DrawableText",v).text=""}});var w=false;n.UIElement.onclick=function(r){if(w){if(n.Animation){n.removeComponent("Animation")}n.addComponent(new boc.components.Animation({entity:n.id(),duration:150,state:boc.constants.ANIMATION_PLAYING,componentName:"Spatial",propertyDeltas:{x:0,y:-29*e.scale}}));t.getComponentForEntity("DrawableSprite",g).visible=false;t.getComponentForEntity("DrawableSprite",b).visible=true;w=false}else{if(n.Animation){n.removeComponent("Animation")}n.addComponent(new boc.components.Animation({entity:n.id(),duration:150,state:boc.constants.ANIMATION_PLAYING,componentName:"Spatial",propertyDeltas:{x:0,y:29*e.scale}}));t.getComponentForEntity("DrawableSprite",g).visible=true;t.getComponentForEntity("DrawableSprite",b).visible=false;w=true}};return r};bbq.ui.createTrainingWindow=function(e,t){if(!t){t={}}if(typeof t.x=="undefined"){t.x=0}if(typeof t.y=="undefined"){t.y=0}if(!t.scale){t.scale=1}var n=(e.xmin+t.x)*t.scale,r=(e.ymin+t.y)*t.scale,i=420,s=224;if(!t.units){t.units=["Harvester","SpearWarrior","DartBlower","Scout","Enforcer","Catapult"]}if(!t.team){t.team="Blue"}var o=11,u=21,a=111;var f=$em.create("trainingWindow");var l=$em.create();$em(l).add(new boc.components.Spatial({x:e.xmin,y:e.ymin,z:bbq.zindex.UI+o,width:e.xmax-e.xmin,height:e.ymax-e.ymin,scale:t.scale})).add(new boc.components.DrawableRect({fillStyle:"rgba(0,0,0,0.75)",lineWidth:0,visible:true}));$em(f).add(new boc.components.Spatial({x:n,y:r,z:bbq.zindex.UI+u,width:i,height:s,scale:t.scale})).add(new boc.components.DrawableSprite({image:boc.resources.GraphicsManager.getImage("assets/UI/UnitTraining/layout.png"),visible:true}));var c=$em.create();$em(c).add(new boc.components.Spatial({x:n+2*t.scale,y:r+2*t.scale,z:bbq.zindex.UI+a,width:54,height:22,scale:t.scale})).add(new boc.components.DrawableSprite({image:boc.resources.GraphicsManager.getImage("assets/UI/UnitTraining/button.png"),visible:true})).add(new boc.components.Identifiable).add(new boc.components.UIElement({}));var h=$em.create();$em(h).add(new boc.components.Spatial({x:n+14*t.scale,y:r+(4+12)*t.scale,z:bbq.zindex.UI+a+1,width:54,height:22,scale:t.scale})).add(new boc.components.DrawableText({text:"Back",fillStyle:"white",font:"bold 10pt Helvetica",shadow:{x:1,y:1},visible:true}));var p=$em.create();$em(p).add(new boc.components.Spatial({x:n+144*t.scale,y:r+(4+12)*t.scale,z:bbq.zindex.UI+a+1,width:11,height:100,scale:t.scale})).add(new boc.components.DrawableText({text:"Train a tribe member",fillStyle:"white",font:"bold 11pt Helvetica",shadow:{x:1,y:1},visible:true}));var d=$em.create();$em(d).add(new boc.components.Spatial({x:n+(i-2-54)*t.scale,y:r+2*t.scale,z:bbq.zindex.UI+a,width:54,height:22,scale:t.scale})).add(new boc.components.DrawableSprite({image:boc.resources.GraphicsManager.getImage("assets/UI/UnitTraining/button.png"),visible:true})).add(new boc.components.Identifiable).add(new boc.components.UIElement({}));var v=$em.create();$em(v).add(new boc.components.Spatial({x:n+(i-2-54+10)*t.scale,y:r+(4+12)*t.scale,z:bbq.zindex.UI+a+1,width:54,height:22,scale:t.scale})).add(new boc.components.DrawableText({text:"Train",fillStyle:"white",font:"bold 10pt Helvetica",shadow:{x:1,y:1},visible:true}));var m=$em.create();$em(m).add(new boc.components.Spatial({x:n+82*t.scale,y:r+(48+12)*t.scale,z:bbq.zindex.UI+a+1,width:54,height:22,scale:t.scale})).add(new boc.components.DrawableText({text:boc.utils.getCurrentPlayer($em()).id,fillStyle:"black",font:"bold 11pt Helvetica",visible:true}));var g=$em.create();$em(g).add(new boc.components.Spatial({x:n+87*t.scale,y:r+(76+12)*t.scale,z:bbq.zindex.UI+a+1,width:54,height:22,scale:t.scale})).add(new boc.components.DrawableText({text:"Food",fillStyle:"black",font:"bold 9pt Helvetica",visible:true}));var y=$em.create();$em(y).add(new boc.components.Spatial({x:n+123*t.scale,y:r+77*t.scale,z:bbq.zindex.UI+a,width:9,height:13,scale:t.scale})).add(new boc.components.DrawableSprite({image:boc.resources.GraphicsManager.getImage("assets/UI/UnitTraining/iconFood.png"),visible:true}));var b=$em.create();$em(b).add(new boc.components.Spatial({x:n+138*t.scale,y:r+(76+12)*t.scale,z:bbq.zindex.UI+a+1,width:54,height:22,scale:t.scale})).add(new boc.components.DrawableText({text:boc.utils.getCurrentPlayer($em()).food,fillStyle:"black",font:"bold 9pt Helvetica",visible:true}));var w=$em.create();$em(w).add(new boc.components.Spatial({x:n+260*t.scale,y:r+(50+12)*t.scale,z:bbq.zindex.UI+a+1,width:54,height:22,scale:t.scale})).add(new boc.components.DrawableText({text:"Health: ",fillStyle:"black",font:"bold 10pt Helvetica",visible:true}));var E=$em.create();$em(E).add(new boc.components.Spatial({x:n+260*t.scale,y:r+(64+12)*t.scale,z:bbq.zindex.UI+a+1,width:54,height:22,scale:t.scale})).add(new boc.components.DrawableText({text:"Speed: ",fillStyle:"black",font:"bold 10pt Helvetica",visible:true}));var S=$em.create();$em(S).add(new boc.components.Spatial({x:n+260*t.scale,y:r+(78+12)*t.scale,z:bbq.zindex.UI+a+1,width:54,height:22,scale:t.scale})).add(new boc.components.DrawableText({text:"Vision: ",fillStyle:"black",font:"bold 10pt Helvetica",visible:true}));var x=$em.create();$em(x).add(new boc.components.Spatial({x:n+260*t.scale,y:r+(92+12)*t.scale,z:bbq.zindex.UI+a+1,width:54,height:22,scale:t.scale})).add(new boc.components.DrawableText({text:"Attack range: ",fillStyle:"black",font:"bold 10pt Helvetica",visible:true}));var T=$em.create();$em(T).add(new boc.components.Spatial({x:n+260*t.scale,y:r+(106+12)*t.scale,z:bbq.zindex.UI+a+1,width:54,height:22,scale:t.scale})).add(new boc.components.DrawableText({text:"Attack damage: ",fillStyle:"black",font:"bold 10pt Helvetica",visible:true}));var N=$em.create();$em(N).add(new boc.components.Spatial({x:n+14*t.scale,y:r+(124+12)*t.scale,z:bbq.zindex.UI+a+1,width:54,height:22,scale:t.scale})).add(new boc.components.DrawableText({text:"",fillStyle:"black",font:"bold 12pt Helvetica",visible:true}));var C=$em.create();$em(C).add(new boc.components.Spatial({x:0,y:0,z:bbq.zindex.UI+a,width:50,height:50,scale:t.scale})).add(new boc.components.DrawableSprite({image:boc.resources.GraphicsManager.getImage("assets/Misc/select_cursor.png"),visible:false}));var k=null;var L=[];var A=boc.utils.getCurrentPlayer();var O=0;for(var M=0;M<t.units.length;M++){(function(e){var i=bbq.units.configuration[e];var s=$em.create();$em(s).add(new boc.components.Spatial({x:n+(22+65*O)*t.scale,y:r+154*t.scale,z:bbq.zindex.UI+u+1,width:50,height:50,scale:t.scale})).add(new boc.components.DrawableSprite({image:boc.resources.GraphicsManager.getImage(i.defaultImagePath.replace("$(team)",A.team)),visible:true})).add(new boc.components.Identifiable).add(new boc.components.UIElement({onclick:function(t){$em(w).comp("DrawableText").text="Health: "+i.health;$em(E).comp("DrawableText").text="Speed: "+i.moveRange;$em(S).comp("DrawableText").text="Vision: "+i.visionRange;$em(x).comp("DrawableText").text="Attack range: "+i.attackMinRange+"-"+i.attackMaxRange;$em(T).comp("DrawableText").text="Attack damage: "+i.attackDamage;$em(N).comp("DrawableText").text=i.displayName;var n=$em(t.entity).comp("Spatial");$em(C).comp("Spatial").update({x:n.x,y:n.y});$em(C).comp("DrawableSprite").visible=true;k=e}}));var o=$em.create();$em(o).add(new boc.components.Spatial({x:n+(32+65*O)*t.scale,y:r+206*t.scale,z:bbq.zindex.UI+a,width:9,height:13,scale:t.scale})).add(new boc.components.DrawableSprite({image:boc.resources.GraphicsManager.getImage("assets/UI/UnitTraining/iconFood.png"),visible:true}));var f=i.foodCost;var l=$em.create();$em(l).add(new boc.components.Spatial({x:n+(45+65*O)*t.scale,y:r+(206+10)*t.scale,z:bbq.zindex.UI+a+1,width:54,height:22,scale:t.scale})).add(new boc.components.DrawableText({text:f,fillStyle:"black",font:"bold 8pt Helvetica",visible:true}));O++;L.push(s);L.push(o);L.push(l)})(t.units[M])}$em(c).comp("UIElement").onclick=function(){if(t.onBackClick){t.onBackClick(f)}};$em(d).comp("UIElement").onclick=function(){if(t.onTrainClick){t.onTrainClick(f,k)}};$em(f).listen("onKill",function(e){$em(l).kill();$em(c).kill();$em(h).kill();$em(p).kill();$em(d).kill();$em(v).kill();$em(g).kill();$em(y).kill();$em(m).kill();$em(b).kill();$em(w).kill();$em(E).kill();$em(S).kill();$em(x).kill();$em(T).kill();$em(N).kill();$em(C).kill();for(var t in L){$em(L[t]).kill()}});return f};ns("bbq.maps");bbq.maps={testmap:{mapid:"testmap",tileset:"forest",width:21,height:11,terrain:"ggggggggggggggggggggg|dddddddddwwwggggggggg|ggggggggddwgggggggggg|ggggggggdwwwggggggggg|ggggggggdwwwggggggggg|wwwwwwggdddddggwwwwww|gggggggggwwwdgggggggg|gggggggggwwwdgggggggg|ggggggggggwddgggggggg|gggggggggwwwddddddddd|ggggggggggggggggggggg",props:"ggggTgTggHHHggggggggR|dddddddddwwwgRBgggggR|gggHRRRRddwggRRgggggR|gggggggTdwwwggRgTgggg|TTgggggBdwwwBgRggggTT|wwwwwwHHdddddHHwwwwww|TTggggRgBwwwdBgggggTT|ggggTgRggwwwdTggggggg|RgggggRRggwddRRRRHggg|RgggggBRgwwwddddddddd|RggggggggHHHggTgTgggg",averageTurnsToWin:20,startstate:{_0_:{food:60,turn:1,team:"Blue",buildings:[{type:"HQ",location:{x:1,y:9},turnsUntilCapture:1},{type:"Hut",location:{x:1,y:8},turnsUntilCapture:1},{type:"Hut",location:{x:1,y:10},turnsUntilCapture:1},{type:"Hut",location:{x:2,y:9},turnsUntilCapture:1}],units:[]},_1_:{food:60,turn:1,team:"Red",buildings:[{type:"HQ",location:{x:19,y:1},turnsUntilCapture:1},{type:"Hut",location:{x:19,y:0},turnsUntilCapture:1},{type:"Hut",location:{x:18,y:1},turnsUntilCapture:1},{type:"Hut",location:{x:19,y:2},turnsUntilCapture:1}],units:[]},_neutral_:{food:0,turn:0,team:"Neutral",buildings:[{type:"Hut",location:{x:1,y:1},turnsUntilCapture:1},{type:"Hut",location:{x:8,y:1},turnsUntilCapture:1},{type:"Hut",location:{x:10,y:5},turnsUntilCapture:1},{type:"Hut",location:{x:12,y:9},turnsUntilCapture:1},{type:"Hut",location:{x:19,y:9},turnsUntilCapture:1}]}}},maninthemiddle:{mapid:"maninthemiddle",tileset:"forest",width:13,height:17,terrain:"ddddddddddddd|dgggggdgggggd|dgggggdgggggd|dgggggdgggggd|dgggggdgggggd|dgggggdgggggd|dgggggdgggggd|ddddddddddddd|dwdwwdddwwdwd|ddddddddddddd|dgggggdgggggd|dgggggdgggggd|dgggggdgggggd|dgggggdgggggd|dgggggdgggggd|dgggggdgggggd|ddddddddddddd",props:"..t...t...t..|.............|HR..T...B..RH|HR.........RH|HR....t....RH|HR.TB...BT.RH|H.....T.....H|f...........f|..t..q.q..t..|f...........f|H.....T.....H|HR.TB...BT.RH|HR....t....RH|HR.........RH|HR..B...T..RH|.............|..t...t...t..",averageTurnsToWin:20,startstate:{_0_:{food:60,turn:1,team:"Blue",buildings:[{type:"HQ",location:{x:5,y:8},turnsUntilCapture:4},{type:"Hut",location:{x:2,y:0},turnsUntilCapture:2},{type:"Hut",location:{x:6,y:0},turnsUntilCapture:2},{type:"Hut",location:{x:10,y:0},turnsUntilCapture:2}],units:[{type:"DartBlower",location:{x:6,y:1},hp:5,state:"idle"}]},_1_:{food:60,turn:1,team:"Red",buildings:[{type:"HQ",location:{x:7,y:8},turnsUntilCapture:4},{type:"Hut",location:{x:2,y:16},turnsUntilCapture:2},{type:"Hut",location:{x:6,y:16},turnsUntilCapture:2},{type:"Hut",location:{x:10,y:16},turnsUntilCapture:2}],units:[{type:"DartBlower",location:{x:6,y:15},hp:5,state:"idle"}]},_neutral_:{food:0,turn:0,team:"Neutral",buildings:[{type:"Farm",location:{x:0,y:7},turnsUntilCapture:2},{type:"Farm",location:{x:12,y:7},turnsUntilCapture:2},{type:"Farm",location:{x:0,y:9},turnsUntilCapture:2},{type:"Farm",location:{x:12,y:9},turnsUntilCapture:2},{type:"Hut",location:{x:2,y:8},turnsUntilCapture:2},{type:"Hut",location:{x:10,y:8},turnsUntilCapture:2},{type:"Hut",location:{x:6,y:4},turnsUntilCapture:2},{type:"Hut",location:{x:6,y:12},turnsUntilCapture:2}]}}},boulderLine:{tileset:"Forest",mapid:"boulderLine",width:15,height:15,terrain:"ggggggwwwgggggg|ggggggwgwgggggg|ggggggwwwgggggg|ggggggggggggggg|ggggggggggggggg|ggggggggggggggg|dddggwwgwwggddd|dddggwwgwwggddd|dddggwwgwwggddd|gdgggggggggggdg|gdgggggggggggdg|gdgggggggggggdg|gdddddddddddddg|ggggggggggggggg|wwwwwwgggwwwwww",props:"..HHHH...HHHH..|....B..H..B....|...............|....B..R..B....|.......R.......|.......R.......|.......R.......|.......R.......|.......R.......|.......R.......|....B..R..B....|......TRT......|...............|......HHH......|......HHH......",averageTurnsToWin:20,startstate:{_0_:{food:60,turn:1,team:"Blue",buildings:[{type:"HQ",location:{x:13,y:7},turnsUntilCapture:3},{type:"Hut",location:{x:13,y:6},turnsUntilCapture:2},{type:"Hut",location:{x:13,y:8},turnsUntilCapture:2},{type:"Hut",location:{x:12,y:7},turnsUntilCapture:2},{type:"Hut",location:{x:14,y:7},turnsUntilCapture:2}],units:[]},_1_:{food:60,turn:1,team:"Red",buildings:[{type:"HQ",location:{x:1,y:7},turnsUntilCapture:3},{type:"Hut",location:{x:1,y:6},turnsUntilCapture:2},{type:"Hut",location:{x:1,y:8},turnsUntilCapture:2},{type:"Hut",location:{x:0,y:7},turnsUntilCapture:2},{type:"Hut",location:{x:2,y:7},turnsUntilCapture:2}],units:[]},_neutral_:{food:60,turn:0,team:"Neutral",buildings:[{type:"Hut",location:{x:2,y:12},turnsUntilCapture:2},{type:"Hut",location:{x:12,y:12},turnsUntilCapture:2},{type:"Hut",location:{x:12,y:2},turnsUntilCapture:2},{type:"Hut",location:{x:2,y:2},turnsUntilCapture:2}]}}},thelaststand:{tileset:"forest",mapid:"thelaststand",width:20,height:7,terrain:"gggggggggggwgggggggg|gggggggggggggggggggg|gggggggggggggggggggg|gggggggggggggggggggg|gggggggggggggggggggg|gggggggggggggggggggg|ggggggggwggggggggggg",props:"B.....HH.....R.....B|H...........RR.....H|B...B....TH....B...B|H....B...HH...B....H|B...B....HT....B...B|H.....RR...........H|B.....R.....HH.....B",averageTurnsToWin:20,startstate:{_0_:{food:60,turn:1,team:"Blue",buildings:[{type:"HQ",location:{x:1,y:3},turnsUntilCapture:3},{type:"Hut",location:{x:1,y:1},turnsUntilCapture:2},{type:"Hut",location:{x:1,y:5},turnsUntilCapture:2},{type:"Hut",location:{x:2,y:0},turnsUntilCapture:2},{type:"Hut",location:{x:2,y:6},turnsUntilCapture:2}],units:[]},_1_:{food:60,turn:1,team:"Red",buildings:[{type:"HQ",location:{x:18,y:3},turnsUntilCapture:3},{type:"Hut",location:{x:18,y:1},turnsUntilCapture:2},{type:"Hut",location:{x:18,y:5},turnsUntilCapture:2},{type:"Hut",location:{x:17,y:0},turnsUntilCapture:2},{type:"Hut",location:{x:17,y:6},turnsUntilCapture:2}],units:[]},_neutral_:{food:60,turn:0,team:"Neutral",buildings:[{type:"Hut",location:{x:12,y:0},turnsUntilCapture:2},{type:"Hut",location:{x:7,y:6},turnsUntilCapture:2},{type:"Farm",location:{x:7,y:1},turnsUntilCapture:2},{type:"Farm",location:{x:12,y:5},turnsUntilCapture:2},{type:"Hut",location:{x:4,y:3},turnsUntilCapture:2},{type:"Hut",location:{x:15,y:3},turnsUntilCapture:2}]}}},crossbridges:{tileset:"forest",mapid:"crossbridges",width:15,height:15,terrain:"gggggggggggggww|ggggggggggggdww|gggggggggggdddg|ggggggggggwwdgg|gggggggggwwwggg|ggggggggwgwgggg|gggggggwwwggggg|ggggggwgwgggggg|gggggwwwggggggg|ggggwgwgggggggg|gggwwwggggggggg|ggdwwgggggggggg|gdddggggggggggg|wwdgggggggggggg|wwggggggggggggg",props:"RRRR...........|R..............|R.........R....|R....B...B.....|........H...R..|...B...H...B...|......B...H....|.....H.T.H.....|....H...B......|...B...H...B...|..R...H........|.....B...B....R|....R.........R|..............R|...........RRRR",averageTurnsToWin:20,startstate:{_0_:{food:60,turn:1,team:"Blue",buildings:[{type:"HQ",location:{x:1,y:1},turnsUntilCapture:3},{type:"Hut",location:{x:1,y:3},turnsUntilCapture:2},{type:"Hut",location:{x:2,y:2},turnsUntilCapture:2},{type:"Hut",location:{x:3,y:1},turnsUntilCapture:2}],units:[]},_1_:{food:60,turn:1,team:"Red",buildings:[{type:"HQ",location:{x:13,y:13},turnsUntilCapture:3},{type:"Hut",location:{x:12,y:12},turnsUntilCapture:2},{type:"Hut",location:{x:13,y:11},turnsUntilCapture:2},{type:"Hut",location:{x:11,y:13},turnsUntilCapture:2}],units:[]},_neutral_:{food:60,turn:0,team:"Neutral",buildings:[{type:"Hut",location:{x:12,y:2},turnsUntilCapture:2},{type:"Hut",location:{x:2,y:12},turnsUntilCapture:2},{type:"Farm",location:{x:5,y:9},turnsUntilCapture:2},{type:"Farm",location:{x:9,y:5},turnsUntilCapture:2}]}}},riverbends:{tileset:"Forest",mapid:"riverbends",width:10,height:22,terrain:"gggggggggg|wwwwwwgggg|gggggwwwww|gggggggggg|dggggggggg|dddddddddg|dggggggggg|gggggggggg|wwwwwggggw|wgddddddgw|wgdggggdgw|wgdggggdgw|wgddddddgw|wggggwwwww|gggggggggg|gggggggggd|gddddddddd|gggggggggd|gggggggggg|wwwwwggggg|ggggwwwwww|gggggggggg",props:"TTTTTTTTTT|......B..B|..........|..........|..........|........B.|..........|RRRRRRR..T|.....HH...|..........|.H...T..H.|.H..T...H.|..........|...HH.....|T..RRRRRRR|..........|.B........|..........|..........|..........|B..B......|TTTTTTTTTT",averageTurnsToWin:20,startstate:{_0_:{food:60,turn:1,team:"Blue",buildings:[{type:"HQ",location:{x:0,y:5},turnsUntilCapture:3},{type:"Hut",location:{x:0,y:4},turnsUntilCapture:2},{type:"Hut",location:{x:1,y:5},turnsUntilCapture:2},{type:"Hut",location:{x:0,y:6},turnsUntilCapture:2}],units:[]},_1_:{food:60,turn:1,team:"Red",buildings:[{type:"HQ",location:{x:9,y:16},turnsUntilCapture:3},{type:"Hut",location:{x:9,y:15},turnsUntilCapture:2},{type:"Hut",location:{x:8,y:16},turnsUntilCapture:2},{type:"Hut",location:{x:9,y:17},turnsUntilCapture:2}],units:[]},_neutral_:{food:60,turn:0,team:"Neutral",buildings:[{type:"Farm",location:{x:8,y:1},turnsUntilCapture:2},{type:"Farm",location:{x:1,y:20},turnsUntilCapture:2},{type:"Hut",location:{x:3,y:10},turnsUntilCapture:2},{type:"Hut",location:{x:6,y:11},turnsUntilCapture:2},{type:"Farm",location:{x:7,y:1},turnsUntilCapture:2},{type:"Farm",location:{x:2,y:20},turnsUntilCapture:2}]}}},hiddenquarry:{tileset:"Forest",mapid:"hiddenquarry",width:20,height:20,terrain:"gggggggggggggggggggg|gggggggggggggggggggg|ggddddddddddddddddgg|ggdggggggggggggggdgg|ggdggggggggggggggdgg|ggdggggggggggggggdgg|ggdggggggggggggggdgg|ggdggggggggggggggdgg|ggdggggggggggggggdgg|ggdggggggggggggggdgg|ggdggggggggggggggdgg|ggdggggggggggggggdgg|ggdggggggggggggggdgg|ggdggggggggggggggdgg|ggdggggggggggggggdgg|ggdggggggggggggggdgg|ggdggggggggggggggdgg|ggddddddddddddddddgg|gggggggggggggggggggg|gggggggggggggggggggg",props:"TTTTTTTTTTTTTTTTTTTT|T..................T|T..................T|T..................T|T...RRRRRRRRRRRR...T|T...RRRRR..RRRRR...T|TH..R..RR..RR..R..HT|T...R..........R...T|TB..RRR......RRR..BT|T....H...HH........T|T........HH...H....T|TB..RRR......RRR..BT|T...R..........R...T|TH..R..RR..RR..R..HT|T...RRRRR..RRRRR...T|T...RRRRRRRRRRRR...T|T..................T|T..................T|T..................T|TTTTTTTTTTTTTTTTTTTT",averageTurnsToWin:20,startstate:{_0_:{food:60,turn:1,team:"Blue",buildings:[{type:"Hut",location:{x:15,y:2},turnsUntilCapture:2},{type:"Hut",location:{x:13,y:2},turnsUntilCapture:2},{type:"HQ",location:{x:9,y:2},turnsUntilCapture:3},{type:"Hut",location:{x:4,y:2},turnsUntilCapture:2},{type:"Hut",location:{x:6,y:2},turnsUntilCapture:2}],units:[]},_1_:{food:60,turn:1,team:"Red",buildings:[{type:"Hut",location:{x:6,y:17},turnsUntilCapture:2},{type:"Hut",location:{x:4,y:17},turnsUntilCapture:2},{type:"Hut",location:{x:15,y:17},turnsUntilCapture:2},{type:"HQ",location:{x:10,y:17},turnsUntilCapture:3},{type:"Hut",location:{x:13,y:17},turnsUntilCapture:2}],units:[]},_neutral_:{food:60,turn:0,team:"Neutral",buildings:[{type:"Hut",location:{x:5,y:6},turnsUntilCapture:2},{type:"Hut",location:{x:14,y:6},turnsUntilCapture:2},{type:"Hut",location:{x:14,y:13},turnsUntilCapture:2},{type:"Hut",location:{x:5,y:13},turnsUntilCapture:2},{type:"Farm",location:{x:9,y:14},turnsUntilCapture:2},{type:"Farm",location:{x:10,y:14},turnsUntilCapture:2},{type:"Farm",location:{x:9,y:5},turnsUntilCapture:2},{type:"Farm",location:{x:10,y:5},turnsUntilCapture:2}]}}},thatsSoUnfair:{_id:"521562d5a488c61900000001",averageTurnsToWin:20,height:13,mapid:"thatsSoUnfair",props:"RRRRRRHHHH.HHHHRRRRRR|RRRRHH.........HHRRRR|RRHH.....T.T.....HHRR|RH...B.........B...HR|H...................H|H........T.T........H|H.B...............B.H|H........H.H........H|H.T..T...H.H...T..T.H|.......HH...HH.......|H.T..T...H.H...T..T.H|H...................H|HHH...T.......T...HHH",ready:true,startstate:{_0_:{food:10,turn:1,team:"Blue",buildings:[{type:"HQ",location:{x:10,y:9},turnsUntilCapture:3},{type:"Hut",location:{x:10,y:10},turnsUntilCapture:2},{type:"Hut",location:{x:9,y:9},turnsUntilCapture:2},{type:"Hut",location:{x:11,y:9},turnsUntilCapture:2}],units:[]},_1_:{food:10,turn:1,team:"Red",buildings:[{type:"HQ",location:{x:10,y:0},turnsUntilCapture:3},{type:"Hut",location:{x:10,y:1},turnsUntilCapture:2},{type:"Hut",location:{x:7,y:1},turnsUntilCapture:2},{type:"Hut",location:{x:13,y:1},turnsUntilCapture:2}],units:[]},_neutral_:{food:10,turn:0,team:"Neutral",buildings:[{type:"Farm",location:{x:7,y:12},turnsUntilCapture:2},{type:"Farm",location:{x:13,y:12},turnsUntilCapture:2},{type:"Hut",location:{x:5,y:9},turnsUntilCapture:2},{type:"Hut",location:{x:15,y:9},turnsUntilCapture:2},{type:"Hut",location:{x:0,y:9},turnsUntilCapture:2},{type:"Hut",location:{x:20,y:9},turnsUntilCapture:2},{type:"Hut",location:{x:9,y:12},turnsUntilCapture:2},{type:"Hut",location:{x:11,y:12},turnsUntilCapture:2},{type:"Hut",location:{x:19,y:5},turnsUntilCapture:2},{type:"Hut",location:{x:1,y:5},turnsUntilCapture:2},{type:"Hut",location:{x:10,y:5},turnsUntilCapture:2},{type:"Hut",location:{x:4,y:2},turnsUntilCapture:2},{type:"Hut",location:{x:16,y:2},turnsUntilCapture:2}]}},terrain:"ggggggggggggggggggggg|ggggggggggggggggggggg|ggggggggggggggggggggg|ggggggggwwdwwgggggggg|ggggggwwwwdwwwwgggggg|gggggwwwwdddwwwwggggg|ggggwwwwwdddwwwwwgggg|gggwwwwwwdddwwwwwwggg|gggwwddwwdddwwddwwggg|gggdddddddddddddddggg|gggwwddwwdddwwddwwggg|gggwwwwwwwdwwwwwwwggg|gggwwwdddddddddwwwggg",tileset:"Forest",width:21},lanes:{_id:"5220347bc58bba1900000001",averageTurnsToWin:20,height:21,mapid:"lanes",props:".......................|..B......B...B......B..|.B...................B.|.....R...........R.....|.....R....R.R....R.....|.....R..TR...RT..R.B...|.....R..R.....R..R.....|.B...R.R.......R.R...B.|.....R..R.....R..R.....|...B.R..TR...RT..R.....|.....R....R.R....R.....|....R....B...B...TR....|.......................|....RT...B...B....R....|.....R.R..B.B..R.R.....|.....R.R..B.B..R.R.....|.B...R.R.B...B.R.R...B.|....TR.R.T...T.R.RT....|.......R.......R.......|.B..B..TRRR.RRRT..B..B.|.......................",ready:true,startstate:{_0_:{food:60,turn:1,team:"Blue",buildings:[{type:"HQ",location:{x:11,y:12},turnsUntilCapture:3},{type:"Hut",location:{x:6,y:12},turnsUntilCapture:2},{type:"Hut",location:{x:16,y:12},turnsUntilCapture:2},{type:"Hut",location:{x:11,y:17},turnsUntilCapture:2},{type:"Hut",location:{x:10,y:16},turnsUntilCapture:2},{type:"Hut",location:{x:12,y:16},turnsUntilCapture:2},{type:"Farm",location:{x:11,y:15},turnsUntilCapture:2}],units:[]},_1_:{food:60,turn:1,team:"Red",buildings:[{type:"HQ",location:{x:11,y:2},turnsUntilCapture:3},{type:"Hut",location:{x:6,y:2},turnsUntilCapture:2},{type:"Hut",location:{x:16,y:2},turnsUntilCapture:2},{type:"Hut",location:{x:1,y:18},turnsUntilCapture:2},{type:"Hut",location:{x:21,y:18},turnsUntilCapture:2},{type:"Hut",location:{x:20,y:19},turnsUntilCapture:2},{type:"Hut",location:{x:2,y:19},turnsUntilCapture:2},{type:"Farm",location:{x:11,y:0},turnsUntilCapture:2}],units:[]},_neutral_:{food:60,turn:0,team:"Neutral",buildings:[{type:"Hut",location:{x:11,y:7},turnsUntilCapture:2},{type:"Hut",location:{x:2,y:8},turnsUntilCapture:2},{type:"Hut",location:{x:20,y:6},turnsUntilCapture:2},{type:"Farm",location:{x:20,y:8},turnsUntilCapture:2},{type:"Farm",location:{x:2,y:6},turnsUntilCapture:2}]}},terrain:"gggggggggggdggggggggggg|ggggggggggdddgggggggggg|ggdddddddddddddddddddgg|ggdgggdgggdddgggdgggdgg|ggdgggdggggdggggdgggdgg|ggdgggdggggwggggdgggdgg|ggdgggdddddddddddgggdgg|ggdgggdddddddddddgggdgg|ggdgggdddddddddddgggdgg|ggdgggdggggwggggdgggdgg|ggdgggdggggdggggdgggdgg|ggdgggdgggdddgggdgggdgg|ddddddddddddddddddddddd|ggdgggwgggdddgggwgggdgg|ggdgggdggggdggggdgggdgg|ggdgggdggggdggggdgggdgg|ggdgggdgggdddgggdgggdgg|ggdgggwgggddggggwgggdgg|ggdddddggggdggggdddddgg|ggggggdggggdggggdgggggg|ggggggdddddddddddgggggg",tileset:"Forest",width:23},funnel:{_id:"5222e9a06d60b91900000004",averageTurnsToWin:20,height:13,mapid:"funnel",props:"HHHH...TTB..B..BTT...HHHH|H.B.RR...TTB.BTT...RR.B.H|H...TTRR...TTT...RRTT...H|H.....TTRR.....RRTT.....H|H.......TTRRTRRTT.......H|.B.................B...B.|.........................|.B...B.................B.|H.......TTRRTRRTT.......H|H.....TTRR.....RRTT.....H|H...TTRR...TTT...RRTT...H|H.B.RR...TTB.BTT...RR.B.H|HHHH...TTB..B..BTT...HHHH",ready:true,startstate:{_0_:{food:100,turn:1,team:"Blue",buildings:[{type:"HQ",location:{x:21,y:6},turnsUntilCapture:3},{type:"Hut",location:{x:22,y:4},turnsUntilCapture:2},{type:"Hut",location:{x:22,y:8},turnsUntilCapture:2},{type:"Hut",location:{x:23,y:2},turnsUntilCapture:2},{type:"Hut",location:{x:23,y:10},turnsUntilCapture:2}],units:[]},_1_:{food:100,turn:1,team:"Red",buildings:[{type:"HQ",location:{x:3,y:6},turnsUntilCapture:3},{type:"Hut",location:{x:2,y:4},turnsUntilCapture:2},{type:"Hut",location:{x:1,y:2},turnsUntilCapture:2},{type:"Hut",location:{x:1,y:10},turnsUntilCapture:2},{type:"Hut",location:{x:2,y:8},turnsUntilCapture:2}],units:[]},_neutral_:{food:100,turn:0,team:"Neutral",buildings:[{type:"Hut",location:{x:14,y:12},turnsUntilCapture:2},{type:"Hut",location:{x:10,y:0},turnsUntilCapture:2},{type:"Farm",location:{x:14,y:0},turnsUntilCapture:2},{type:"Farm",location:{x:10,y:12},turnsUntilCapture:2},{type:"Hut",location:{x:12,y:6},turnsUntilCapture:2},{type:"Farm",location:{x:5,y:5},turnsUntilCapture:2},{type:"Farm",location:{x:19,y:7},turnsUntilCapture:2},{type:"Hut",location:{x:7,y:6},turnsUntilCapture:2},{type:"Hut",location:{x:17,y:6},turnsUntilCapture:2}]}},terrain:"gggdwwwgggggggggggwwwdggg|gggdggwwwgggggggwwwggdggg|gggdggggwwwgggwwwggggdggg|gggdggggggwwwwwggggggdggg|gggdgggggggggggggggggdggg|gggdgggggggggggggggggdggg|ddddddddddddddddddddddddd|gggdgggggggggggggggggdggg|gggdgggggggggggggggggdggg|gggdggggggwwwwwggggggdggg|gggdggggwwwgggwwwggggdggg|gggdggwwwgggggggwwwggdggg|gggdwwwgggggggggggwwwdggg",tileset:"Forest",width:25}};bbq.maps.tutorial={tileset:"Forest",mapid:"newMap",width:10,height:10,ready:true,terrain:"ggggggwggg|gdggggwgdg|gdggggwgdg|gdggggwgdg|gdggggwgdg|gddddddddg|gdggggggdg|gdggggggdg|gdggggggdg|gggggggggg",props:"..........|.....T....|..........|..........|..........|B......H..|..RRRRR...|......R...|......R...|......R...",averageTurnsToWin:20,startstate:{_0_:{food:60,turn:1,team:"Blue",buildings:[{type:"HQ",location:{x:1,y:8},turnsUntilCapture:3},{type:"Hut",location:{x:1,y:5},turnsUntilCapture:2}],units:[]},_1_:{food:60,turn:1,team:"Red",buildings:[{type:"HQ",location:{x:8,y:1},turnsUntilCapture:3},{type:"Hut",location:{x:8,y:5},turnsUntilCapture:2}],units:[]},_neutral_:{food:60,turn:0,team:"Neutral",buildings:[{type:"Hut",location:{x:1,y:1},turnsUntilCapture:2},{type:"Farm",location:{x:8,y:8},turnsUntilCapture:2}]}}};var bbq=bbq||{};bbq.UnitSet=function(e,t){Array.call(this);var n=e;var r=-1;this.team=function(){return n};this.selected_=r;if(t){for(var i=0;i<t.length;i++){this.push(t[i])}}};boc.utils.inherits(bbq.UnitSet,Array);(function(e){e.prototype.select=function(e){if(typeof e=="number"){this.selected_=e;if(this.selected_<0||this.selected_>=this.length){throw new Error("index "+this.selected_+" out of bounds")}}else{this.selected_=this.indexOf(e);if(this.selected_==-1){throw new Error("unit type '"+e+"' not found")}}};e.prototype.selected=function(){return this.selected_};e.prototype.info=function(e){if(typeof e=="undefined"){e=this.selected()}var t=bbq.units.configuration[this[e]];if(t.defaultImagePath){t.defaultImagePath=t.defaultImagePath.replace(/\$\(team\)/g,this.team())}return t}})(bbq.UnitSet);ns("bbq.components");bbq.components.AttackOverlay=function(e){this.className=function(){return"AttackOverlay"}};ns("bbq.components");bbq.components.AttackCostNode=function(e){this.cost=e;this.className=function(){return"AttackCostNode"}};ns("bbq.components");bbq.components.Building=function(e){this.type=e.type;this.turnsUntilCapture=e.turnsUntilCapture;this.className=function(){return"Building"}};ns("bbq.components");bbq.components.Buffable=function(e){this.className=function(){return"Buffable"}};ns("bbq.components");bbq.components.Capture=function(e,t){this.target=e;this.icon=t;this.className=function(){return"Capture"}};ns("bbq.components");bbq.components.CommandRing=function(){this.className=function(){return"CommandRing"}};ns("bbq.components");bbq.components.Attack=function(e){this.minRange=e.minRange;this.maxRange=e.maxRange;this.damage=e.damage;this.className=function(){return"Attack"}};ns("bbq.components");bbq.components.Commandable=function(e){this.commands=e.commands||[];this.className=function(){return"Commandable"}};ns("bbq.events");bbq.events.CommandEvent=function(e){this.action=e.action;this.args=e.args;this.timeStamp=+(new Date);this.className=function(){return"CommandEvent"}};ns("bbq.components");bbq.components.Cursor=function(){this.className=function(){return"Cursor"}};ns("bbq.components");bbq.components.Fringe=function(){this.className=function(){return"Fringe"}};ns("bbq.components");bbq.components.Debuffable=function(e){this.className=function(){return"Debuffable"}};ns("bbq.events");bbq.events.FogEvent=function(e){this.action=e.action;this.forPlayer=e.forPlayer;this.args=e.args;this.timeStamp=+(new Date);this.className=function(){return"FogEvent"}};ns("bbq.components");bbq.components.Fog=function(e){this.className=function(){return"Fog"}};ns("bbq.components");bbq.components.FoodProducer=function(e){this.food=e.food;this.className=function(){return"FoodProducer"}};ns("bbq.components");bbq.components.Gather=function(e,t){this.target=e;this.icon=t;this.className=function(){return"Gather"}};ns("bbq.components");bbq.components.Gatherable=function(e){this.foodPerTurn=e;this.className=function(){return"Gatherable"}};ns("bbq.components");bbq.components.Heal=function(e){this.points=e;this.className=function(){return"Heal"}};ns("bbq.components");bbq.components.HealOverlay=function(){this.className=function(){return"HealOverlay"}};ns("bbq.events");bbq.events.HealEvent=function(e){this.entity=e;this.className=function(){return"HealEvent"}};ns("bbq.events");bbq.events.HealthBarEvent=function(){this.className=function(){return"HealthBarEvent"}};ns("bbq.components");bbq.components.Health=function(e){this.current=e.current;this.max=e.max;this.className=function(){return"Health"}};ns("bbq.components");bbq.components.HealthBar=function(e){this.icon=e;this.className=function(){return"HealthBar"}};ns("bbq.events");bbq.events.HudEvent=function(e){this.action=e.action;this.entity=e.entity;this.className=function(){return"HudEvent"}};ns("bbq.events");bbq.events.MapSelectEvent=function(e){this.action=e.action;this.args=e.args;this.timeStamp=+(new Date);this.className=function(){return"MapSelectEvent"}};ns("bbq.components");bbq.components.MoveCostNode=function(e){this.cost=e;this.className=function(){return"MoveCostNode"}};ns("bbq.components");bbq.components.Movement=function(e){this.range=e.range;this.velocity=e.velocity||200;this.bonus=e.bonus;this.className=function(){return"Movement"}};ns("bbq.components");bbq.components.MapElement=function(e){this.x=e.x;this.y=e.y;this.className=function(){return"MapElement"}};ns("bbq.components");bbq.components.MoveArrow=function(e){this.heading=e;this.className=function(){return"MoveArrow"}};ns("bbq.components");bbq.components.MoveOverlay=function(e){this.className=function(){return"MoveOverlay"}};ns("bbq.components");bbq.components.ParabolicTranslationAnimation=function(e){this.dx=e.dx;this.dy=e.dy;this.easing=e.easing||"linearTween";this.height=e.height||70;this.duration=e.duration;this.elapsedTime=0;this.state=e.state||boc.constants.ANIMATION_STOPPED;this.className=function(){return"ParabolicTranslationAnimation"};var t=new boc.utils.EventManager;this.notify=t.notify;this.addListener=t.addListener;this.removeListener=t.removeListener};ns("bbq.components");bbq.components.PathAnchor=function(e){this.path=[];this.className=function(){return"PathAnchor"}};ns("bbq.components");bbq.components.Player=function(e){this.id=e.id;this.team=e.team;this.food=e.food;this.turn=e.turn;this.upkeep=e.upkeep;this.buildings=e.buildings;this.units=e.units;this.lastSeen=e.lastSeen||{};this.visibleMapTiles=e.visibleMapTiles||[];this.summary=e.summary;this.moves=[];this.unitSet=e.unitSet;this.className=function(){return"Player"};var t=new boc.utils.EventManager;this.addListener=t.addListener;this.removeListener=t.removeListener;this.updateFood=function(e){var n=this.food;if(n==e){return}this.food=e;t.notify("onFoodChange",{oldFood:n,newFood:e});var r=e-n;if(r>0){var i=this.summary.foodCollected||0;this.updateSummary({foodCollected:i+r})}else{var s=this.summary.foodConsumed||0;this.updateSummary({foodConsumed:s-r})}};this.updateTurn=function(e){var n=this.turn;if(n==e){return}this.turn=e;t.notify("onTurnChange",{oldTurn:n,newTurn:e})};this.addUnit=function(e){this.units.push(e);t.notify("onUnitsUpdated",{event:"add",unit:e});var n=this.summary.unitsProduced||0;this.updateSummary({unitsProduced:n+1})};this.removeUnit=function(e){var n=this.units.indexOf(e);if(n==-1){throw"Unit not found"}this.units.splice(n,1);t.notify("onUnitsUpdated",{event:"remove",unit:e});var r=this.summary.unitsLost||0;this.updateSummary({unitsProduced:r+1})};this.addBuilding=function(e){this.buildings.push(e);t.notify("onBuildingsUpdated",{event:"add",building:e});var n=this.summary.buildingsCaptured||0;this.updateSummary({buildingsCaptured:n+1})};this.removeBuilding=function(e){var n=this.buildings.indexOf(e);if(n==-1){throw"Building not found"}this.buildings.splice(n,1);t.notify("onBuildingsUpdated",{event:"remove",building:e});var r=this.summary.buildingsLost||0;this.updateSummary({buildingsLost:r+1})};this.updateSummary=function(e){for(var n in e){if(this.summary[n]==undefined||this.summary[n]==null){this.summary[n]=0}var r=this.summary[n];var i=e[n];if(r==i){continue}this.summary[n]=i;t.notify("onSummaryChange",{propertyName:n,oldValue:r,newValue:i})}};this.hasEntity=function(e){return this.units.indexOf(e)>=0||this.buildings.indexOf(e)>=0}};ns("bbq.components");bbq.components.Prop=function(e){this.type=e.type;this.className=function(){return"Prop"}};ns("bbq.components");bbq.components.ReplayScript=function(e,t,n){this.playerId=e;this.script=t;this.onComplete=n;this.className=function(){return"ReplayScript"}};ns("bbq.components");bbq.components.Retaliate=function(e){this.minRange=e.minRange;this.maxRange=e.maxRange;this.damage=e.damage;this.className=function(){return"Retaliate"}};ns("bbq.components");bbq.components.PlayerStats=function(e){this.className=function(){return"PlayerStats"};var t=new boc.utils.EventManager;var n=e;this.target=function(e){if(typeof e=="undefined"){return n}if(n==e){return}var r=n;n=e;t.notify("onTargetChange",{oldTarget:r,newTarget:e})};this.addListener=t.addListener;this.removeListener=t.removeListener};ns("bbq.components");bbq.components.PathArrow=function(e){this.heading=e;this.className=function(){return"PathArrow"}};ns("bbq.components");bbq.components.RevealSpot=function(e,t,n,r){this.x=e;this.y=t;this.range=n;this.srcPlayerId=r;this.className=function(){return"RevealSpot"}};ns("bbq.components");bbq.components.Reveal=function(e,t){this.range=e;this.radius=t;this.className=function(){return"Reveal"}};ns("bbq.events");bbq.events.SaveEvent=function(e,t,n){this.action=e;this.playerid=t;this.onSaveComplete=n;this.className=function(){return"SaveEvent"}};ns("bbq.components");bbq.components.RevealOverlay=function(){this.className=function(){return"RevealOverlay"}};ns("bbq.components");bbq.components.Terrain=function(e){this.type=e.type;this.className=function(){return"Terrain"}};ns("bbq.events");bbq.events.RevealEvent=function(e){this.entity=e;this.className=function(){return"RevealEvent"}};ns("bbq.components");bbq.components.Trainable=function(e){this.foodCost=e.foodCost;this.className=function(){return"Trainable"}};ns("bbq.events");bbq.events.TrainingEvent=function(e){this.action=e;this.className=function(){return"TrainingEvent"}};ns("bbq.components");bbq.components.TrainingUnit=function(e){this.type=e;this.className=function(){return"TrainingUnit"}};ns("bbq.events");bbq.events.UnitEvent=function(e){this.action=e.action;this.args=e.args;this.timeStamp=+(new Date);this.className=function(){return"UnitEvent"}};ns("bbq.components");bbq.components.Unit=function(e){this.type=e.type;this.state=e.state||"idle";this.level=e.level||1;this.kills=e.kills||0;this.className=function(){return"Unit"}};ns("bbq.components");bbq.components.Turn=function(e){this.playerid=e.playerid;this.number=e.number;this.className=function(){return"Turn"}};ns("bbq.components");bbq.components.UnitStats=function(e){this.className=function(){return"UnitStats"};var t=e;var n=new boc.utils.EventManager;this.target=function(e){if(typeof e=="undefined"){return t}var r=t;t=e;n.notify("onTargetChange",{oldTarget:r,newTarget:e})};this.addListener=n.addListener;this.removeListener=n.addListener};ns("bbq.events");bbq.events.VictoryEvent=function(e,t){this.type=e;this.player=t;this.className=function(){return"VictoryEvent"}};ns("bbq.components");bbq.components.Vision=function(e){this.range=e.range;this.className=function(){return"Vision"}};ns("bbq.components");bbq.components.VisionCostNode=function(e){this.cost=e;this.className=function(){return"VisionCostNode"}};ns("bbq.systems");bbq.systems.AttackSystem=function(e,t){function s(){n="wait";r=null;i=null}function o(){var t=$em("AttackOverlay").all().slice();for(var n=0;n<t.length;n++){e.killEntity(t[n])}}function u(n){var r=bbq.utils.getTilesWithinAttackRange({entityManager:e,entity:n,costMap:t.costMap(),costNodes:t.attackMap(),sizeX:t.numColumns(),sizeY:t.numRows(),rangeOffset:0});for(var i=0;i<r.length;i++){var s=r[i].split(",");var o=new boc.core.Entity({entityManager:e});o.addComponent(new boc.components.Spatial({x:0,y:0,z:bbq.zindex.OVERLAY,width:t.tileWidth(),height:t.tileHeight()}));o.addComponent(new boc.components.DrawableRect({fillStyle:"rgba(255,0,0,0.25)",lineWidth:0}));o.addComponent(new bbq.components.AttackOverlay);o.addComponent(new boc.components.Identifiable);t.place(o.id(),+s[0],+s[1]);$em("Player").each(function(n,r){if(r.id===boc.utils.getCurrentPlayer(e).id){return}var i=t.getEntities(+s[0],+s[1],"Unit")[0];if(i&&r.hasEntity(i)&&$em(i).comp("DrawableSprite").visible){o.AttackOverlay.target=i;var u=$em.create();$em(u).add(new boc.components.Spatial({x:0,y:0,z:bbq.zindex.OVERLAY+1,width:t.tileWidth(),height:t.tileHeight()})).add(new boc.components.DrawableRect({fillStyle:"rgba(255,0,0,0.35)",lineWidth:0,visible:true})).add(new bbq.components.AttackOverlay);boc.utils.createBlinkingAnimation(u,{easing:"easeInCubic",drawableName:"DrawableRect",delta:1}).start();t.place(u,+s[0],+s[1])}})}}function a(t,r,i,s,o){$em($em.create()).add(new boc.components.DelayedMethod(function(){var s=$em(r).comp("Spatial");boc.utils.createHitEffect(s.x,s.y,e);boc.utils.createBouncingText(i,s.x+s.width/2-2,s.y+s.height-6,{fillStyle:"white",z:bbq.zindex.EFFECTS+1});bbq.sh().play(bbq.sh().getAudio(t,"weaponHit"));bbq.sh().play(bbq.sh().getAudio(r,"unitHit"));var u=$em(r).comp("Health");u.current-=i;var a=null,f=null;$em("Player").each(function(e,n){if(n.hasEntity(t)){f=n}if(n.hasEntity(r)){a=n}});if(u.current<=0){var l=f.summary.unitsKilled||0;var c=a.summary.unitsLost||0;f.updateSummary({unitsKilled:l+1});a.updateSummary({unitsLost:c+1});$em(t).comp("Unit").kills++;var h=bbq.units.getLevel(t);if(h>$em(t).comp("Unit").level){bbq.units.levelUp(t,h,false)}}var p=$em(r).comp("HealthBar");var d=p.icon;if(u.current<u.max){$em(d).comp("DrawableRect").visible=true;$em(p.currentIcon).comp("DrawableRect").visible=true}if(n=="attackComplete"){n="retaliateMode"}else if(n=="attacking"){n="attackHit"}if(o){o()}},s))}function f(t,n,r,i){if($em(t).comp("SpriteAnimation")){$em(t).comp("SpriteAnimation").state=boc.constants.ANIMATION_STOPPED}var s=$em(t).comp("SpriteAnimationSet");var o=null;if(s&&s["attack"]){o=(new boc.utils.SpriteAnimationSequence({entity:t,entityManager:e,loop:false,onLoopComplete:i,animations:[s["attack"]]})).start()}var u=e.getComponentForEntity("SpineAnimation",t);if(u){u.state=boc.constants.ANIMATION_PLAYING;u.animationState.setAnimationByName("attack",false);u._previousDrawable=u._previousDrawable||e.getComponentForEntity("DrawableSprite",t);e.removeComponentFromEntity(u._previousDrawable.className(),t);if(!u._onAttackEnd){u._onAttackEnd=i;u.on("onComplete",function(e){if(e=="attack"){if(u._onAttackEnd){u._onAttackEnd()}var t=$em(u.target).comp("SpineDrawable").skeleton;t.setToSetupPose();t.getRootBone().x=50;t.getRootBone().y=-50;t.updateWorldTransform();if(u._previousDrawable){$em(u.target).add(u._previousDrawable);u._previousDrawable=null}}})}}var f=$em(t).comp("Unit");bbq.sh().play(bbq.sh().getAudio(t,"weaponWindup"));if(f.type==="Catapult"){function l(e){var i=e.entity;$em(i).remove("ParabolicTranslationAnimation");$em(g).kill();a(t,n,r,0)}var c=$em(t).comp("Spatial"),h=$em(n).comp("Spatial");var p=h.x-c.x,d=h.y-c.y;var v=Math.sqrt(p*p+d*d);var m=300;var g=$em.create();var y=new bbq.components.ParabolicTranslationAnimation({dx:p,dy:d,easing:"linearTween",duration:v/m*1e3,state:boc.constants.ANIMATION_STOPPED});y.addListener("onComplete",l);$em(g).add(new boc.components.Spatial({x:c.x+c.width/2-6,y:c.y+c.height/2-6,z:c.z+1,width:13,height:13})).add(new boc.components.DrawableSprite({image:boc.resources.GraphicsManager.getImage("assets/Projectiles/rock.png"),visible:false})).add(y);$em($em.create()).add(new boc.components.DelayedMethod(function(){$em(g).comp("ParabolicTranslationAnimation").state=boc.constants.ANIMATION_PLAYING;$em(g).comp("DrawableSprite").visible=true},1100))}else if(f.type==="DartBlower"){function b(e){var i=e.entity;$em(i).remove("Animation");$em(w).kill();a(t,n,r,0)}var w=$em.create();var c=$em(t).comp("Spatial"),h=$em(n).comp("Spatial");var p=h.x-c.x,d=h.y-c.y;var E=-Math.atan2(p,d);var v=Math.sqrt(p*p+d*d);var m=300;var y=new boc.components.Animation({componentName:"Spatial",propertyDeltas:{x:p,y:d},easing:"linearTween",duration:v/m*1e3,state:boc.constants.ANIMATION_PLAYING});y.addListener("onComplete",b);$em(w).add(new boc.components.Spatial({x:c.x+c.width/2-6,y:c.y+c.height/2-12,z:Math.max(c.z,h.z)+1,angle:E,width:12,height:23})).add(new boc.components.DrawableSprite({image:boc.resources.GraphicsManager.getImage("assets/Projectiles/dart.png"),visible:true})).add(y)}else{a(t,n,r,500)}}function l(e){var t=null;for(var s=0;s<e.length;s++){t=$em(e[s]).comp("AttackOverlay");if(t){break}}if(t&&t.target){o();boc.utils.createEvent(new bbq.events.MapSelectEvent({action:"hideCursor"}));i=t.target;var u=$em(r).comp("Attack").damage;f(r,i,u,function(){if(n=="attackHit"){n="retaliateMode"}else if(n=="attacking"){n="attackComplete"}});n="attacking";return true}return false}function c(){var s=false;$em("Player").each(function(o,u){if($em(i).exists()&&u.hasEntity(i)&&$em(i).comp("Health").current>0){var a=boc.utils.toTileKey($em(r).comp("MapElement"));var l=bbq.utils.getTilesWithinAttackRange({entityManager:e,entity:i,costMap:t.costMap(),costNodes:t.attackMap(),sizeX:t.numColumns(),sizeY:t.numRows(),rangeOffset:0});if(u.visibleMapTiles.indexOf(a)>=0&&l.indexOf(a)>=0){var c=Math.floor($em(i).comp("Retaliate").damage);f(i,r,c,function(){n="cleanup"});s=true}}});if(s){n="retaliating"}else{n="cleanup"}return s}var n="wait";var r=null;var i=null;this.processTick=function(t){$em("CommandEvent").each(function(e,t){if(t.action==="attackMode"){n="attackMode";r=t.args.entity;u(r)}else if(t.action==="attackEntity"){f(t.args.src,t.args.dst,t.args.damage,t.args.onAttackEnd)}boc.utils.consumeEvent(e,t.className(),$em())});if(n==="attackMode"){$em("IdentifyEvent").each(function(t,n){var u=null;for(var a=0;a<n.identifiedEntities.length;a++){if($em(n.identifiedEntities[a]).comp("Cursor")){u=n.identifiedEntities[a];break}}if(u){if($em(r).comp("Unit").state=="idle"){boc.utils.createEvent(new bbq.events.MapSelectEvent({action:"unlockCursor"}),e)}boc.utils.createEvent(new bbq.events.CommandEvent({action:"showCommands",args:{entity:r}}),e);o();s()}else{if(l(n.identifiedEntities)){var f=boc.utils.getCurrentPlayer();var c=$em(r).comp("MapElement"),h=$em(i).comp("MapElement");f.moves.push("("+c.x+","+c.y+")a("+h.x+","+h.y+")")}}boc.utils.consumeEvent(t,n.className(),e)})}else if(n==="retaliateMode"){if(c()){var a=boc.utils.getCurrentPlayer();var h=$em(r).comp("MapElement"),p=$em(i).comp("MapElement");a.moves.push("("+p.x+","+p.y+")r("+h.x+","+h.y+")")}}else if(n==="cleanup"){boc.utils.createEvent(new bbq.events.MapSelectEvent({action:"unlockCursor"}),e);boc.utils.createEvent(new bbq.events.MapSelectEvent({action:"showCursor"}),e);boc.utils.createEvent(new bbq.events.UnitEvent({action:"inactivate",args:{entity:r}}),e);var d=$em(r).comp("Commandable");if(d){d=d.commands;for(var v=0;v<d.length;v++){if(d[v].name()==="Attack"&&d[v].onAttackEnd){d[v].onAttackEnd()}}}s();n="wait"}}};ns("bbq.systems");bbq.systems.CommandSystem=function(e,t,n){function i(t,n){var r=boc.utils.getCurrentPlayer(e);r.updateTurn(r.turn+1);r.upkeep=false;r.moves.push("e");var i=e.getAllComponents("Player");var s=(bbq.teams.indexOf(r.team)+1)%bbq.teams.length;var o=null;while(!o){for(var u=0;u<i.length;u++){if(i[u].id==r.id){continue}if(i[u].team==bbq.teams[s]){o=i[u]}}s=(s+1)%bbq.teams.length}var a=e.getAllEntitiesWithComponent("Turn")[0];e.getComponentForEntity("Turn",a).playerid=o.id;e.getComponentForEntity("Turn",a).number=o.turn;for(var f=0;f<i.length;f++){for(var u=0;u<i[f].units.length;u++){var l=e.getComponentForEntity("Unit",i[f].units[u]);e.getComponentForEntity("DrawableSprite",i[f].units[u]).image=boc.resources.GraphicsManager.getImage(l.type+"_"+i[f].team.toLowerCase());if(i[f].id==o.id){l.state="idle";var c=e.getComponentForEntity("Commandable",i[f].units[u]).commands;for(var h=0;h<c.length;h++){if(c[h].disabled){c[h].disabled(false)}}}}}if(n){n()}boc.utils.createEvent(new bbq.events.SaveEvent("saveAll",r.id,function(){if(t){t()}}),e)}function s(t){var i=t.spatial||e.getComponentForEntity("Spatial",t.entity);var s=e.getComponentForEntity("Commandable",t.entity);if(!s||!s.commands){return}var o=s.commands.slice();for(var u=o.length-1;u>=0;u--){if(o[u].disabled&&o[u].disabled({entityManager:e,map:n,entity:t.entity})){o.splice(u,1)}}console.log(o);var a=new boc.core.Entity({entityManager:e});a.addComponent(new boc.components.Spatial({x:i.x+i.width/2,y:i.y+i.height/2,z:bbq.zindex.UI,width:1,height:1}));a.addComponent(new bbq.components.CommandRing);var f=bbq.ui.configuration.ringPositions[o.length-1];var l=[];for(var u=0;u<o.length;u++){var c=bbq.ui.createButton({entityManager:e,context:r,x:a.Spatial.x,y:a.Spatial.y,text:o[u].name(),textFillStyle:"white"});var h=e.getComponentForEntity("Spatial",c);h.update({x:h.x-h.width/2,y:h.y-h.height/2});var p=a.Spatial.x+f[u].offsetX-f[u].anchorX*h.width-h.x;var d=a.Spatial.y+f[u].offsetY-f[u].anchorY*h.height-h.y;e.addComponentToEntity(new boc.components.Animation({duration:150,easing:"easeOutCubic",componentName:"Spatial",propertyDeltas:{x:p,y:d},state:boc.constants.ANIMATION_PLAYING}),c);l.push(c);(function(r,i){e.getComponentForEntity("UIElement",r).onclick=function(){boc.utils.createEvent(new bbq.events.CommandEvent({action:"hideCommands"}),e);boc.utils.createEvent(new bbq.events.MapSelectEvent({action:"lockCursor"}),e);i.execute({entity:t.entity,map:n,sender:r,command:i})}})(c,o[u])}a.addListener("onKill",function(){for(var t=0;t<l.length;t++){e.killEntity(l[t])}});return a.id()}var r=t.getContext("2d");var o=null;this.processTick=function(t){var r=e.getAllEntitiesWithComponent("CommandEvent");for(var u=0;u<r.length;u++){var a=r[u];var f=e.getComponentForEntity("CommandEvent",a);var l=o!=null&&boc.utils.getCurrentPlayer(e)!=o;if(f.action=="lockCommands"){o=f.args?f.args.forPlayer:null}else if(!l&&f.action=="showCommands"){var c=e.getAllEntitiesWithComponent("CommandRing");if(c){c=c.slice();while(c.length>0){e.killEntity(c.pop())}}if(f.args.entity&&boc.utils.getCurrentPlayer(e).hasEntity(f.args.entity)){f.args.map=n;s(f.args)}}else if(!l&&f.action=="hideCommands"){var c=e.getAllEntitiesWithComponent("CommandRing");if(c){c=c.slice();while(c.length>0){e.killEntity(c.pop())}}}else if(!l&&f.action=="endTurn"){i(f.args.callback,f.args.tutorialCallback)}boc.utils.consumeEvent(a,"CommandEvent",e)}}};ns("bbq.systems");bbq.systems.FogSystem=function(e,t){function n(t){var n=e.getAllEntitiesWithComponent("Player");for(var r=0;r<n.length;r++){var i=e.getComponentForEntity("Player",n[r]);for(var s=0;s<i.buildings.length;s++){var o=e.getComponentForEntity("Building",i.buildings[s]);if(o.type=="HQ"){continue}var u=e.getComponentForEntity("MapElement",i.buildings[s]);var a=e.getComponentForEntity("DrawableSprite",i.buildings[s]);if(i.id==t.id){var f=bbq.buildings.configuration[o.type].defaultImagePath.replace("$(team)",i.team.toLowerCase());a.image=boc.resources.GraphicsManager.getImage(f);continue}var l=u.x+","+u.y;var f=null;var c=false;for(var h=0,p=t.visibleMapTiles.length;h<p;h++){if(t.visibleMapTiles[h]===l){c=true;break}}if(!c){if(t.lastSeen[l]){f=bbq.buildings.configuration[o.type].defaultImagePath.replace("$(team)",t.lastSeen[l].toLowerCase())}else{f=bbq.buildings.configuration[o.type].defaultImagePath.replace("$(team)","neutral")}}else{f=bbq.buildings.configuration[o.type].defaultImagePath.replace("$(team)",i.team.toLowerCase());t.lastSeen[l]=i.team}if(f){a.image=boc.resources.GraphicsManager.getImage(f)}}}}function r(){i();var r=[];var s=e.getAllComponents("Player");var u=o||boc.utils.getCurrentPlayer(e);for(var a=0;a<s.length;a++){var f=s[a];f.visibleMapTiles=[];var l=f.units.slice().concat(f.buildings.slice());for(var c=0;c<l.length;c++){var h=l[c];var p=e.getComponentForEntity("Vision",h);var d=e.getComponentForEntity("MapElement",h);var v=0;var m=t.getEntities(d.x,d.y,"Prop");for(var g=0;g<m.length;g++){var y=$em(m[g]).comp("Prop");if(y&&y.type=="tree"){var b=bbq.tilesets.forest.props.properties.tree.visionBonus*100;if(b){v+=b}}}var w=bbq.utils.getTilesWithinVisionRange({entityManager:e,entity:h,costMap:t.costMap(),costNodes:t.visionMap(),sizeX:t.numColumns(),sizeY:t.numRows(),rangeOffset:v});$em("RevealSpot").each(function(n,r){var i=bbq.utils.getTilesWithinRevealRange({entityManager:e,entity:n,costMap:t.costMap(),costNodes:t.attackMap(),sizeX:t.numColumns(),sizeY:t.numRows(),rangeOffset:0,rangeComponentName:"RevealSpot",rangePropertyName:"range"});for(var s=0,o=i.length;s<o;s++){var u=false;for(var a=0,f=w.length;a<f;a++){if(i[s]===w[a]){u=true;break}}if(!u){w.push(i[s])}}});for(var g=0;g<w.length;g++){var E=w[g].split(",");var S=false;for(var x=0,T=f.visibleMapTiles.length;x<T;x++){if(f.visibleMapTiles[x]===w[g]){S=true;break}}if(!S){f.visibleMapTiles.push(w[g])}var N=t.getEntities(+E[0],+E[1],"Unit");for(var x=0;x<N.length;x++){var C=e.getComponentForEntity("DrawableSprite",N[x])||e.getComponentForEntity("SpineDrawable",N[x]);if(C){C.visible=true}var k=$em(N[x]).comp("HealthBar").icon;$em(k).comp("DrawableRect").visible=true;var L=$em(N[x]).comp("HealthBar").currentIcon;if(L){$em(L).comp("DrawableRect").visible=true}var A=$em(N[x]).comp("Gather");if(A){var O=A.icon;$em(O).comp("DrawableSprite").visible=true}var M=$em(N[x]).comp("Capture");if(M){var O=M.icon;$em(O).comp("DrawableSprite").visible=true}}var _=t.getEntities(+E[0],+E[1],"Fog");for(var x=0;x<_.length;x++){e.killEntity(_[x])}}}if(u.id==f.id){for(var c=0;c<s.length;c++){for(var g=0;g<s[c].units.length;g++){if(u.id==s[c].id){r.push(s[c].units[g])}else{var D=boc.utils.toTileKey($em(s[c].units[g]).comp("MapElement"));var S=false;for(var x=0,T=u.visibleMapTiles.length;x<T;x++){if(u.visibleMapTiles[x]===D){S=true;break}}if(!S){r.push(s[c].units[g])}}}}t.refresh(r);n(f)}}}function i(t){var r=e.getAllEntitiesWithComponent("Fog");r=r.slice();var i=boc.utils.getCurrentPlayer(e);i.visibleMapTiles=[];for(var s=r.length-1;s>=0;s--){var o=e.getComponentForEntity("MapElement",r[s]);var u=o.x+","+o.y;i.visibleMapTiles.push(u);e.killEntity(r[s])}var a=e.getAllEntitiesWithComponent("Unit");for(var s=0;s<a.length;s++){var f=e.getComponentForEntity("DrawableSprite",a[s])||e.getComponentForEntity("SpineDrawable",a[s]);f.visible=true}if(t){n(i)}}function s(n){if(!n){n=boc.utils.getCurrentPlayer()}var r={};for(var i=0,s=n.visibleMapTiles.length;i<s;i++){r[n.visibleMapTiles[i]]=true}var o=t.tileWidth(),u=t.tileHeight();for(var a=0,f=t.numColumns();a<f;a++){for(var l=0,c=t.numRows();l<c;l++){var h=a+","+l;if(r[h]){continue}var p=e.createEntity("fog("+a+","+l+")");e.addComponentToEntity(new bbq.components.Fog,p);var d=new boc.components.Spatial({x:0,y:0,z:bbq.zindex.FOG,width:o,height:u});e.addComponentToEntity(d,p);e.addComponentToEntity(new boc.components.DrawableRect({fillStyle:"rgba(0, 0, 0, 0.6)",lineWidth:0},true),p);t.place(p,a,l);var v=t.getEntities(a,l,"Unit");for(var i=0;i<v.length;i++){var m=e.getComponentForEntity("DrawableSprite",v[i])||e.getComponentForEntity("SpineDrawable",v[i]);m.visible=false;var g=$em(v[i]).comp("HealthBar").icon;var y=$em(v[i]).comp("HealthBar").currentIcon;$em(g).comp("DrawableRect").visible=false;if(y){$em(y).comp("DrawableRect").visible=false}else{console.log("no current health bar for",v[i])}var b=$em(v[i]).comp("Gather");if(b){var w=b.icon;$em(w).comp("DrawableSprite").visible=false}b=$em(v[i]).comp("Capture");if(b){var w=b.icon;$em(w).comp("DrawableSprite").visible=false}}}}}var o=null;this.processTick=function(t){var n=e.getAllEntitiesWithComponent("FogEvent");for(var u=0;u<n.length;u++){var a=e.getComponentForEntity("FogEvent",n[u]);if(a.action=="update"){if(a.forPlayer){o=a.forPlayer}r();boc.utils.consumeEvent(n[u],"FogEvent",e)}else if(a.action=="draw"){if(a.forPlayer){o=a.forPlayer}s(o);boc.utils.consumeEvent(n[u],"FogEvent",e)}else if(a.action=="clear"){i(true);boc.utils.consumeEvent(n[u],"FogEvent",e)}}}};ns("bbq.systems");bbq.systems.HealthSystem=function(e){this.processTick=function(t){var n=null;$em("Health").each(function(t,r){if(r.current<=0){var i=bbq.sh().getAudio(t,"unitDeath");if(i){bbq.sh().play(i)}if(!n){n=[]}n.push(t);var s=$em(t).comp("Spatial");boc.utils.createSmokeEffect(s.x,s.y,e);var o=null;$em("Player").each(function(e,n){if(n.hasEntity(t)){o=n}});if(o){o.removeUnit(t)}boc.utils.createEvent(new bbq.events.FogEvent({action:"update"}),e);boc.utils.createEvent(new bbq.events.FogEvent({action:"draw"}),e)}});while(n&&n.length>0){$em(n.pop()).kill()}$em("HealthBar").each(function(e,t){var n=$em(e).comp("DrawableSprite");if(n){var r=t.icon;var i=$em(e).comp("Health");var s=42;var o=i.current/i.max;$em(t.currentIcon).comp("Spatial").update({width:Math.floor(s*o)});if(o>=.65){$em(t.currentIcon).comp("DrawableRect").fillStyle="lime"}else if(o>=.4){$em(t.currentIcon).comp("DrawableRect").fillStyle="gold"}else{$em(t.currentIcon).comp("DrawableRect").fillStyle="firebrick"}if(i.current>=i.max){$em(r).comp("DrawableRect").visible=false;$em(t.currentIcon).comp("DrawableRect").visible=false}}})}};ns("bbq.systems");bbq.systems.HudSystem=function(e,t){this.processTick=function(n){var r=e.getAllEntitiesWithComponent("HudEvent");for(var i=0;i<r.length;i++){var s=r[i];var o=e.getComponentForEntity("HudEvent",s);if(o.action=="update"){var u=boc.utils.getCurrentPlayer(e);t.food(u.food)}if(typeof o.entity!="undefined"){var a=o.entity?$em(o.entity).comp("Unit"):null;if(a){t.showUnitStats();var f=bbq.units.configuration[a.type];if(f){t.name(f.displayName);t.health($em(o.entity).comp("Health").current);t.attack($em(o.entity).comp("Attack").damage);t.movement(Math.floor($em(o.entity).comp("Movement").range/100));t.vision(Math.floor($em(o.entity).comp("Vision").range/100));t.range(Math.floor($em(o.entity).comp("Attack").minRange/100)+" - "+Math.floor($em(o.entity).comp("Attack").maxRange/100))}}else{t.hideUnitStats()}}var u=boc.utils.getCurrentPlayer(e);t.food(u.food);boc.utils.consumeEvent(s,"HudEvent",e)}}};ns("bbq.systems");bbq.systems.MapSelectSystem=function(e,t){var n=new boc.core.Entity({description:"mapCursor"});n.currentSelection=null;n.previousSelection=null;n.hide=false;n.locked=false;n.addComponent(new boc.components.Spatial({x:0,y:0,z:bbq.zindex.CURSOR,width:50,height:50}));n.addComponent(new boc.components.DrawableSprite({image:boc.resources.GraphicsManager.getImage("assets/Misc/select_cursor.png"),alpha:1,visible:false}));n.addComponent(new bbq.components.MapElement({x:0,y:0}));n.addComponent(new boc.components.Identifiable({}));n.addComponent(new bbq.components.Cursor);n.oldZ=null;var r=[1,1,1,1,.95,.9,.85,.8,.75,.7,.65,.6,.55,.5,.45,.4];var i=[];for(var s=0;s<r.length;s++){i.push(new boc.components.DrawableSprite({image:boc.resources.GraphicsManager.getImage("assets/Misc/select_cursor.png"),alpha:r[s]}))}for(var s=r.length-1;s>=0;s--){i.push(new boc.components.DrawableSprite({image:boc.resources.GraphicsManager.getImage("assets/Misc/select_cursor.png"),alpha:r[s]}))}var o=new boc.utils.SpriteAnimationSequence({entityManager:e,entity:n,loop:true,animations:[new boc.components.SpriteAnimation({sprites:i,duration:1500,easing:"linear"})]});o.start();this.processTick=function(t){var r=e.getAllEntitiesWithComponent("MapSelectEvent");for(var i=0;i<r.length;i++){var s=e.getComponentForEntity("MapSelectEvent",r[i]);if(s.action=="hideCursor"){n.hide=true;n.DrawableSprite.visible=false}else if(s.action=="showCursor"){n.hide=false;n.DrawableSprite.visible=true}else if(s.action=="lockCursor"){n.locked=true}else if(s.action=="unlockCursor"){n.locked=false}else if(s.action==="selectAndHide"){n.DrawableSprite.visible=false;n.currentSelection=s.args?s.args.selected:null}else if(s.action=="moveCursor"&&s.args.entity){var o=e.getComponentForEntity("Spatial",s.args.entity);var u=e.getComponentForEntity("MapElement",s.args.entity);n.Spatial.update({x:o.x+o.width-n.Spatial.width,y:o.y+o.height-n.Spatial.height});n.MapElement.x=u.x;n.MapElement.y=u.y}boc.utils.consumeEvent(r[i],"MapSelectEvent",e)}if(n.locked){return}var a=e.getAllEntitiesWithComponent("IdentifyEvent");for(var i=0;i<a.length;i++){var f=a[i];var l=e.getComponentForEntity("IdentifyEvent",f);var c=l.identifiedEntities.slice().sort(function(t,n){var r=e.getComponentForEntity("Spatial",t);var i=e.getComponentForEntity("Spatial",n);if(!r&&!i){return 0}if(r&&!i){return 1}if(!r&&i){return-1}return r.z-i.z});var h=c.pop();var p=e.getComponentForEntity("MapElement",h);var d=e.getComponentForEntity("DrawableSprite",h)||e.getComponentForEntity("SpineDrawable",h);var v=e.getComponentForEntity("Identifiable",h);var m=d&&d.visible||!d&&v&&v.hot;while(h&&(!p||!m)){h=c.pop();if(h){p=e.getComponentForEntity("MapElement",h);d=e.getComponentForEntity("DrawableSprite",h)||e.getComponentForEntity("Spinedrawable",h);v=e.getComponentForEntity("Identifiable",h);m=d&&d.visible||v&&v.hot}}if(h){n.previousSelection=n.currentSelection;if(h==n.id()){n.DrawableSprite.visible=false;n.currentSelection=null}else{var g=e.getComponentForEntity("Spatial",h);n.Spatial.update({x:g.x+g.width-n.Spatial.width,y:g.y+g.height-n.Spatial.height});n.MapElement.x=p.x;n.MapElement.y=p.y;if(!n.hide){n.DrawableSprite.visible=true}n.currentSelection=h}boc.utils.createEvent(new bbq.events.MapSelectEvent({action:"select",args:{selected:n.currentSelection,previous:n.previousSelection}}),e)}boc.utils.consumeEvent(f,"IdentifyEvent",e)}}};ns("bbq.systems");bbq.systems.MoveSystem=function(e,t){function u(){var t=e.getAllEntitiesWithComponent("PathArrow").slice();while(t.length>0){e.killEntity(t.pop())}}function a(n,r){function i(e){if(e.up==11||e.down==11)return s.vert;if(e.left==11||e.right==11)return s.hori;if(e.up==10){if(e.left==1)return s.upleft;if(e.right==1)return s.upright;return s.up}if(e.down==10){if(e.left==1)return s.downleft;if(e.right==1)return s.downright;return s.down}if(e.left==10){if(e.up==1)return s.downright;if(e.down==1)return s.upright;return s.left}if(e.right==10){if(e.up==1)return s.downleft;if(e.down==1)return s.upleft;return s.right}return null}if(r.length>0){if(/\d+,\d+/.test(r[0])){var o=[];for(var u=1;u<r.length;u++){var a=r[u].split(",");var f=r[u-1].split(",");if(+a[1]>+f[1]){o.push("down")}else if(+a[1]<+f[1]){o.push("up")}else if(+a[0]>+f[0]){o.push("right")}else if(+a[0]<+f[0]){o.push("left")}}r=o}var l=e.getComponentForEntity("Spatial",n);var c={up:0,down:0,left:0,right:0,x:l.x,y:l.y};var h=[];for(var u=0;u<r.length;u++){var p=r[u];var d={up:0,down:0,left:0,right:0,x:c.x,y:c.y};if(p=="up"){d.y-=t.tileHeight()}else if(p=="down"){d.y+=t.tileHeight()}else if(p=="right"){d.x+=t.tileWidth()}else if(p=="left"){d.x-=t.tileWidth()}h.push(d);c[p]+=1;d[p]+=10;c=d}for(var u=0;u<h.length;u++){var v=h[u];var m=new boc.core.Entity({entityManager:e});m.addComponent(new boc.components.Spatial({x:v.x,y:v.y,z:bbq.zindex.UI-1,width:t.tileWidth(),height:t.tileHeight()}));m.addComponent(new boc.components.DrawableSprite({image:i(v),visible:true}));m.addComponent(new bbq.components.PathArrow)}}}function p(){var t=e.getAllEntitiesWithComponent("MoveOverlay").slice();while(t.length>0){e.killEntity(t.pop())}}function d(n,i,s){r="movingEntity";var o=[];var u=250;for(var a=1;a<n.length;a++){var f=0,l=0;var c=boc.utils.toTile(n[a]);var h=boc.utils.toTile(n[a-1]);f=(c.x-h.x)*t.tileWidth();l=(c.y-h.y)*t.tileHeight();var p=new boc.components.Animation({duration:e.getComponentForEntity("Movement",i).velocity,easing:"linearTween",componentName:"Spatial",propertyDeltas:{x:f,y:l}});o.push(p);u+=e.getComponentForEntity("Movement",i).velocity}var d=new bbq.events.UnitEvent({action:"moveEntity",args:{player:boc.utils.getCurrentPlayer(e),entity:i}});var v=boc.utils.createEvent(d,e,{duration:u});var p=(new boc.utils.AnimationSequence({entity:i,entityManager:e,loop:false,animations:o,onLoopComplete:function(){var n=t.getTile(i);t.place(i,n.x,n.y);boc.utils.createEvent(new bbq.events.MapSelectEvent({action:"showCursor"}),e);boc.utils.createEvent(new bbq.events.MapSelectEvent({action:"moveCursor",args:{entity:i}}),e);boc.utils.createEvent(new bbq.events.MapSelectEvent({action:"select",args:{selected:i,previous:i}}),e);boc.utils.createEvent(new bbq.events.FogEvent({action:"update"}),e);boc.utils.createEvent(new bbq.events.FogEvent({action:"draw"}),e);var o=e.getComponentForEntity("Commandable",i).commands;console.log(o);for(var u=0;u<o.length;u++){if(o[u].name()=="Move"){o[u].disabled(true)}if(o[u].name()=="Hold"){o[u].disabled(false)}}r="wait";g=null;var a=$em(i).comp("SpriteAnimation")||$em(i).comp("SpineAnimation");if(a){a.state=boc.constants.ANIMATION_STOPPED}$em(i).comp("Unit").state="hasMoved";if(!s){var f=$em(i).comp("SpriteAnimationSet");if(f&&f["idle"]){var l=new boc.utils.SpriteAnimationSequence({entity:i,entityManager:e,loop:true,animations:[m["idle"]]});l.start()}var c=bbq.sh().getAudio(i,"unitWalk");bbq.sh().fadeOut(c,100,function(e){console.log(e);bbq.sh().reset(e.audio)})}else{s()}boc.utils.consumeEvent(v,"UnitEvent",e)}})).start();if($em(i).comp("SpriteAnimation")){$em(i).comp("SpriteAnimation").state=boc.constants.ANIMATION_STOPPED}var m=$em(i).comp("SpriteAnimationSet");if(m&&m["walk"]){var y=new boc.utils.SpriteAnimationSequence({entity:i,entityManager:e,loop:true,animations:[m["walk"]]});y.start()}var b=e.getComponentForEntity("SpineAnimation",i);if(b){b.state=boc.constants.ANIMATION_PLAYING;b.animationState.setAnimationByName("move",true);b._previousDrawable=b._previousDrawable||e.getComponentForEntity("DrawableSprite",i);e.removeComponentFromEntity(b._previousDrawable.className(),i)}var w=bbq.sh().getAudio(i,"unitWalk");if(w){bbq.sh().play(w,true)}}function v(n,r){var i=null;var s=null;var o=e.getAllEntitiesWithComponent("PathAnchor")[0];var c=e.getComponentForEntity("PathAnchor",o);var h=null;var v=null;var y=null;for(var b=0;b<n.length;b++){s=e.getComponentForEntity("MoveArrow",n[b]);if(s){i=n[b];break}v=e.getComponentForEntity("MoveOverlay",n[b]);if(v){h=n[b];break}}if(s){var w=t.getTile(i);var E=t.getEntities(w.x,w.y,"MoveOverlay");var S=false;if(c&&c.path.length>1&&c.path[c.path.length-2]==boc.utils.toTileKey(w)){c.path.pop();S=true}if(E.length>0||S){if(s.heading=="up"){l.Spatial.update({y:l.Spatial.y-t.tileHeight()})}else if(s.heading=="down"){l.Spatial.update({y:l.Spatial.y+t.tileHeight()})}else if(s.heading=="left"){l.Spatial.update({x:l.Spatial.x-t.tileWidth()})}else if(s.heading=="right"){l.Spatial.update({x:l.Spatial.x+t.tileWidth()})}w=t.getTile(l.id());var x=t.getEntities(w.x,w.y,"Unit");var T=null;for(var N=0;N<x.length;N++){if(e.getComponentForEntity("DrawableSprite",x[N]).visible){T=x[N];break}}if(T){l.DrawableRect.fillStyle="rgba(255,0,0,0.3)"}else{l.DrawableRect.fillStyle="rgba(0,0,255,0.3)"}if(!S){c.path.push(boc.utils.toTileKey(w))}l.show();u();a(o,c.path);p();var C=$em(f).comp("Commandable").commands;var k=null;for(var L=0;L<C.length;L++){if(C[L].name()==="Move"){k=C[L].moveTiles}}m(f,k)}}else if(v){u();var A=t.getTile(l);var O=t.getTile(h);var M=true;var T=t.getEntities(O.x,O.y,"Unit");if(T&&T.length>0){T=T[0];M=!$em(T).comp("DrawableSprite").visible}if(A.x==O.x&&A.y==O.y&&M){p();l.hide();var _=e.getAllEntitiesWithComponent("PathAnchor").slice();while(_.length>0){e.killEntity(_.pop())}boc.utils.createEvent(new bbq.events.MapSelectEvent({action:"hideCursor"}));d(c.path,f,g?g.onMoveEnd:null);y="";for(var b=1;b<c.path.length;b++){var D=boc.utils.toTile(c.path[b]);var P=boc.utils.toTile(c.path[b-1]);if(D.x>P.x){y+="e"}if(D.x<P.x){y+="w"}if(D.y>P.y){y+="s"}if(D.y<P.y){y+="n"}}}else{var H=bbq.utils.getMoveCost({entityManager:e,entity:f,costMap:t.costMap(),costNodes:t.movementMap(),path:c.path});var B=bbq.utils.findMovePath({entityManager:e,entity:f,astarMap:t.astarMap(),costNodes:t.movementMap(),sizeX:t.numColumns(),sizeY:t.numRows(),rangeOffset:-H,startTile:A,endTile:O,excludeList:c.path});for(var N=0;N<B.length;N++){if(c.path.indexOf(B[N])==-1){c.path.push(B[N])}}var j=c.path[c.path.length-1].split(",");j={x:+j[0],y:+j[1]};l.Spatial.update({x:j.x*t.tileWidth(),y:j.y*t.tileHeight()});var w=t.getTile(l.id());var x=t.getEntities(w.x,w.y,"Unit");var T=null;for(var N=0;N<x.length;N++){if(e.getComponentForEntity("DrawableSprite",x[N]).visible){T=x[N];break}}if(T){l.DrawableRect.fillStyle="rgba(255,0,0,0.3)"}else{l.DrawableRect.fillStyle="rgba(0,0,255,0.3)"}l.show();a(o,c.path);p();m(f)}}return y}function m(n,r){var i=0;var s=null;var o=null;try{o=e.getAllComponents("PathAnchor");if(o&&o.length>0){o=o[0];i=-bbq.utils.getMoveCost({entityManager:e,entity:n,costMap:t.costMap(),costNodes:t.movementMap(),path:o.path});s=o.path[o.path.length-1].split(",");s={x:+s[0],y:+s[1]}}}catch(u){console.log("path anchor not found.",u)}var a=r||bbq.utils.getTilesWithinMoveRange({entityManager:e,entity:n,costMap:t.costMap(),costNodes:t.movementMap(),sizeX:t.numColumns(),sizeY:t.numRows(),rangeOffset:i,startCell:s,excludeList:o?o.path:null});for(var f=0;f<a.length;f++){var l=a[f].split(",");var c=new boc.core.Entity({entityManager:e});c.addComponent(new boc.components.Spatial({x:0,y:0,z:bbq.zindex.OVERLAY,width:t.tileWidth(),height:t.tileHeight()}));c.addComponent(new boc.components.DrawableRect({fillStyle:"rgba(0,0,255,0.25)",lineWidth:0}));c.addComponent(new bbq.components.MoveOverlay);c.addComponent(new boc.components.Identifiable);t.place(c.id(),+l[0],+l[1])}}var n=this;var r="wait";var i=["up","down","right","left","hori","vert","upleft","upright","downleft","downright"];var s={};for(var o=0;o<i.length;o++){s[i[o]]=boc.resources.GraphicsManager.getImage("assets/Misc/arrow_"+i[o]+".png")}var f=null;var l=new boc.core.Entity({description:"moveArrow",entityManager:e});l.addComponent(new boc.components.Spatial({x:0,y:0,z:bbq.zindex.UI,width:t.tileWidth(),height:t.tileHeight()}));l.addComponent(new boc.components.DrawableRect({fillStyle:"rgba(0,0,255,0.35)",lineWidth:0,visible:false}));boc.utils.createBlinkingAnimation(l,{easing:"easeInCubic",drawableName:"DrawableRect"}).start();l.arrows=[];l.hide=function(){this.DrawableRect.visible=false;for(var e=0;e<this.arrows.length;e++){this.arrows[e].DrawableSprite.visible=false}};l.show=function(){this.DrawableRect.visible=true;for(var e=0;e<this.arrows.length;e++){this.arrows[e].DrawableSprite.visible=this.arrows[e].Spatial.x>=0&&this.arrows[e].Spatial.x<t.width()&&this.arrows[e].Spatial.y>=0&&this.arrows[e].Spatial.y<t.height()}};var c=["right",t.tileWidth(),0,"down",0,t.tileHeight(),"left",-t.tileWidth(),0,"up",0,-t.tileHeight()];for(var o=0;o<c.length;o+=3){var h=new boc.core.Entity({description:"moveArrow_"+c[o],entityManager:e});h.addComponent(new boc.components.Spatial({x:l.Spatial.x+c[o+1],y:l.Spatial.y+c[o+2],z:l.Spatial.z,width:l.Spatial.width,height:l.Spatial.height}));h.addComponent(new boc.components.DrawableSprite({image:boc.resources.GraphicsManager.getImage("assets/Misc/arrowbutton_"+c[o]+".png"),visible:false}));h.addComponent(new boc.components.Identifiable({}));h.addComponent(new bbq.components.MoveArrow(c[o]));l.arrows.push(h);boc.utils.follow(l.id(),h.id(),e)}var g=null;this.processTick=function(t){if(r=="moveMode"){var n=e.getAllEntitiesWithComponent("IdentifyEvent");for(var i=0;i<n.length;i++){var s=n[i];var o=e.getComponentForEntity("IdentifyEvent",s);var a=null;for(var c=0;c<o.identifiedEntities.length;c++){if(e.getComponentForEntity("Cursor",o.identifiedEntities[c])){a=o.identifiedEntities[c];break}}if(a){p();boc.utils.createEvent(new bbq.events.MapSelectEvent({action:"unlockCursor"}),e);var h=e.getComponentForEntity("Commandable",f).commands;for(var y=0;y<h.length;y++){if(h[y].name()=="Hold"){h[y].disabled(true)}}boc.utils.createEvent(new bbq.events.CommandEvent({action:"showCommands",args:{entity:f}}),e);f=null;r="wait";g=null;l.hide();var b=e.getAllEntitiesWithComponent("PathAnchor").slice();while(b.length>0){e.killEntity(b.pop())}u()}else{var w=v(o.identifiedEntities);if(w!=null){var E=$em(f).comp("MapElement");boc.utils.getCurrentPlayer().moves.push("("+E.x+","+E.y+")m('"+w+"')")}}boc.utils.consumeEvent(s,"IdentifyEvent",e)}}var S=e.getAllEntitiesWithComponent("CommandEvent");for(var i=0;i<S.length;i++){var x=S[i];var T=e.getComponentForEntity("CommandEvent",x);if(T.action=="moveMode"){var N=T.args;m(N.entity,N.command.moveTiles);r="moveMode";g=N.command;f=N.entity;var C=e.getComponentForEntity("Spatial",f);l.Spatial.update({x:C.x,y:C.y});l.show();var k=new boc.core.Entity({entityManager:e});k.addComponent(new bbq.components.PathAnchor);k.PathAnchor.path.push(boc.utils.toTileKey(e.getComponentForEntity("MapElement",f)));k.addComponent(new boc.components.Spatial({x:C.x,y:C.y,z:bbq.zindex.UI,width:C.width,height:C.height}))}else if(T.action=="moveEntity"){var N=T.args;d(N.path,N.entity,N.onMoveEnd||N.command.onMoveEnd)}}}};ns("bbq.systems");bbq.systems.ParabolicTranslationSystem=function(e){this.processTick=function(t){var n=e.getAllEntitiesWithComponent("ParabolicTranslationAnimation");for(var r=0;r<n.length;r++){var i=n[r];var s=e.getComponentForEntity("Spatial",i);var o=e.getComponentForEntity("ParabolicTranslationAnimation",i);if(o.state!=boc.constants.ANIMATION_PLAYING){continue}if(o.elapsedTime==0){if(o.dx==0){o.dx++}var u=s.x;var a=s.x+o.dx;var f=s.y;var l=s.y+o.dy;o.xstart=u;o.xend=a;o.ystart=f;o.yend=l;var c=(u+a)/2;var h=(f+l)/2-o.height;var p=(u-c)*(u-a)*(c-a);o.A=(a*(h-f)+c*(f-l)+u*(l-h))/p;o.B=(a*a*(f-h)+c*c*(l-f)+u*u*(h-l))/p;o.C=(c*a*(c-a)*f+a*u*(a-u)*h+u*c*(u-c)*l)/p;o.m=(l-f)/(a-u)}o.elapsedTime+=t;if(o.elapsedTime>=o.duration){s.update({x:o.xend,y:o.yend});o.state=boc.constants.ANIMATION_COMPLETE;o.notify("onComplete",{entity:i});console.log("complete"+o.duration)}else{var d=Math[o.easing]||"linearTween";var v=d(o.elapsedTime,o.xstart,o.dx,o.duration);var m=o.A*v*v+o.B*v+o.C;s.update({x:v,y:m})}}}};ns("bbq.systems");bbq.systems.ReplaySystem=function(e){this.map=e};bbq.systems.ReplaySystem.prototype.processTick=function(e){var t=this;$em("ReplayScript").each(function(e,n){var r=boc.utils.getPlayer(n.playerId,$em());if(n.script=="e"){var i=$em().getAllComponents("Player");var s=(bbq.teams.indexOf(r.team)+1)%bbq.teams.length;var o=null;while(!o){for(var u=0;u<i.length;u++){if(i[u].id==r.id){continue}if(i[u].team==bbq.teams[s]){o=i[u]}}s=(s+1)%bbq.teams.length}var a=$em("Turn").first();$em(a).comp("Turn").playerid=o.id;$em(a).comp("Turn").number=o.turn;r=o;if(n.onComplete){n.onComplete()}}else{var f=/\(([\d,]+)\)(\w+)(\(.+\))?/.exec(n.script);var l=f[1].split(",");var c={x:+l[0],y:+l[1]};switch(f[2]){case"a":case"r":if(f[3]){var h=/\(([\d,]+)\)/.exec(f[3])[1];var p=h.split(",");p={x:+p[0],y:+p[1]};var d=t.map.getEntities(c.x,c.y,"Unit")[0];var v=t.map.getEntities(p.x,p.y,"Unit")[0];if(d&&v){var m=$em(d).comp("Attack").damage;boc.utils.createEvent(new bbq.events.CommandEvent({action:"attackEntity",args:{src:d,dst:v,damage:m,onAttackEnd:n.onComplete}}),$em())}else{if(n.onComplete){n.onComplete()}}}break;case"m":if(f[3]){var h=/\('(\w+)'\)/.exec(f[3])[1];var g=c.x,y=c.y;var b=[g+","+y];for(var w=0;w<h.length;w++){if(h[w]=="e"){g++}else if(h[w]=="w"){g--}else if(h[w]=="n"){y--}else if(h[w]=="s"){y++}b.push(g+","+y)}boc.utils.createEvent(new bbq.events.CommandEvent({action:"moveEntity",args:{entity:t.map.getEntities(c.x,c.y,"Unit")[0],path:b,onMoveEnd:n.onComplete}}),$em())}break;case"t":if(f[3]){var E=/\('(\w+)'\)/.exec(f[3])[1];var S=bbq.units.createUnit({type:E},r.team,$em());r.units.push(S);t.map.place(S,c.x,c.y)}if(n.onComplete){n.onComplete()}break;case"h":var x=t.map.getEntities(c.x,c.y,"Unit")[0];if(x){(new bbq.commands.Hold($em())).execute({entity:x})}if(n.onComplete){n.onComplete()}break;case"g":var x=t.map.getEntities(c.x,c.y,"Unit")[0];if(x){(new bbq.commands.Gather($em())).execute({entity:x,map:t.map})}if(n.onComplete){n.onComplete()}break;case"c":var x=t.map.getEntities(c.x,c.y,"Unit")[0];if(x){(new bbq.commands.Capture($em())).execute({entity:x,map:t.map})}if(n.onComplete){n.onComplete()}break;case"hl":if(f[3]){var h=/\(([\d,]+)\)/.exec(f[3])[1];var p=h.split(",");p={x:+p[0],y:+p[1]};var d=t.map.getEntities(c.x,c.y,"Unit")[0];var v=t.map.getEntities(p.x,p.y,"Unit")[0];var T=$em(d).comp("Heal").points;var N=new bbq.events.HealEvent(d);N.dstEntity=v;N.healPoints=T;N.onComplete=n.onComplete}break;case"rv":if(f[3]){var h=/\(([\d,]+)\)/.exec(f[3])[1];var p=h.split(",");p={x:+p[0],y:+p[1]};var d=t.map.getEntities(c.x,c.y,"Unit")[0];var v=t.map.getEntities(p.x,p.y,"Terrain")[0];var C=$em(v).comp("MapElement").x;var k=$em(v).comp("MapElement").y;var L=$em(d).comp("Reveal").radius;var A=$em.create();$em(A).add(new boc.components.Spatial({x:0,y:0,z:bbq.zindex.OVERLAY,width:t.map.tileWidth(),height:t.map.tileHeight()})).add(new bbq.components.RevealSpot(C,k,L,r.id));t.map.place(A,C,k);var O=new bbq.events.RevealEvent(d);O.dstEntity=A;O.onComplete=n.onComplete;boc.utils.createEvent(O,$em())}break}boc.utils.createEvent(new bbq.events.FogEvent({action:"update"}),$em());boc.utils.createEvent(new bbq.events.FogEvent({action:"draw",forPlayer:r}),$em())}boc.utils.consumeEvent(e,n.className(),$em())})};ns("bbq.systems");bbq.systems.RevealSystem=function(e){var t=$em();var n="wait";var r=null,i=null;var s=function(){r=null;i=null;n="wait"};var o=function(n){var r=bbq.utils.getTilesWithinRevealRange({entityManager:t,entity:n,costMap:e.costMap(),costNodes:e.attackMap(),sizeX:e.numColumns(),sizeY:e.numRows(),rangeOffset:0});for(var i=0;i<r.length;i++){var s=r[i].split(",");var o=new boc.core.Entity({entityManager:t});o.addComponent(new boc.components.Spatial({x:0,y:0,z:bbq.zindex.OVERLAY,width:e.tileWidth(),height:e.tileHeight()}));o.addComponent(new boc.components.DrawableRect({fillStyle:"rgba(255,255,255,0.25)",lineWidth:0}));o.addComponent(new bbq.components.RevealOverlay);o.addComponent(new boc.components.Identifiable);boc.utils.createBlinkingAnimation(o,{easing:"easeInCubic",drawableName:"DrawableRect",delta:1}).start();e.place(o.id(),+s[0],+s[1])}};var u=function(){var e=$em("RevealOverlay").all().slice();for(var n=0;n<e.length;n++){t.killEntity(e[n])}};var a=function(e,r,i){$em($em.create()).add(new boc.components.DelayedMethod(function(){boc.utils.createEvent(new bbq.events.FogEvent({action:"update"}),t);boc.utils.createEvent(new bbq.events.FogEvent({action:"draw"}),t);console.log("Fog updated!");if(n=="revealComplete"){n="cleanup"}else if(n=="revealing"){n="revealHit"}},i))};var f=function(e,r,i){if($em(e).comp("SpriteAnimation")){$em(e).comp("SpriteAnimation").state=boc.constants.ANIMATION_STOPPED}var s=t.getComponentForEntity("SpineAnimation",e);if(s){s.state=boc.constants.ANIMATION_PLAYING;try{s.animationState.setAnimationByName("reveal",false)}catch(o){console.log(o);n="wait";return}s._previousDrawable=s._previousDrawable||t.getComponentForEntity("DrawableSprite",e);t.removeComponentFromEntity(s._previousDrawable.className(),e);if(!s._onRevealEnd){s._onRevealEnd=function(){if(n=="revealHit"){n="cleanup"}else if(n=="revealing"){n="revealComplete"}if(i){i()}};s.on("onComplete",function(e){if(e=="reveal"){s._onRevealEnd();var t=$em(s.target).comp("SpineDrawable").skeleton;t.setToSetupPose();t.getRootBone().x=50;t.getRootBone().y=-50;t.updateWorldTransform();if(s._previousDrawable){$em(s.target).add(s._previousDrawable);s._previousDrawable=null}}})}}var u=$em(r).comp("Spatial");boc.utils.createHitEffect(u.x,u.y,t);a(e,r,300)};var l=function(t){var s=null,o=null;for(var a=0;a<t.length;a++){o=t[a];s=$em(t[a]).comp("RevealOverlay");if(s){break}}if(s){var l=$em(o).comp("MapElement").x;var c=$em(o).comp("MapElement").y;var h=$em(r).comp("Reveal").radius;u();boc.utils.createEvent(new bbq.events.MapSelectEvent({action:"hideCursor"}));var p=null;$em("Player").each(function(e,t){if(t.hasEntity(r)){p=t}});i=$em.create();$em(i).add(new boc.components.Spatial({x:0,y:0,z:bbq.zindex.OVERLAY,width:e.tileWidth(),height:e.tileHeight()})).add(new bbq.components.RevealSpot(l,c,h,p));e.place(i,l,c);f(r,i);n="revealing";return true}return false};this.processTick=function(e){$em("RevealEvent").each(function(e,i){if(!i.dstEntity){n="revealMode";r=i.entity;o(r)}else{f(i.entity,i.dstEntity,i.onComplete)}boc.utils.consumeEvent(e,i.className(),t)});if(n=="revealMode"){$em("IdentifyEvent").each(function(e,n){var o=null;for(var a=0;a<n.identifiedEntities.length;a++){if($em(n.identifiedEntities[a]).comp("Cursor")){o=n.identifiedEntities[a];break}}if(o){if($em(r).comp("Unit").state=="idle"){boc.utils.createEvent(new bbq.events.MapSelectEvent({action:"unlockCursor"}),t)}boc.utils.createEvent(new bbq.events.CommandEvent({action:"showCommands",args:{entity:r}}),t);u();s()}else{if(l(n.identifiedEntities)){var f=boc.utils.getCurrentPlayer();var c=$em(r).comp("MapElement"),h=$em(i).comp("MapElement");f.moves.push("("+c.x+","+c.y+")rv("+h.x+","+h.y+")")}}boc.utils.consumeEvent(e,n.className(),t)})}else if(n=="cleanup"){boc.utils.createEvent(new bbq.events.MapSelectEvent({action:"unlockCursor"}),t);boc.utils.createEvent(new bbq.events.MapSelectEvent({action:"showCursor"}),t);boc.utils.createEvent(new bbq.events.UnitEvent({action:"inactivate",args:{entity:r}}),t);s()}}};ns("bbq.systems");bbq.systems.SaveSystem=function(e,t){function n(e){var t={food:e.food,turn:e.turn,team:e.team,unitSet:e.unitSet,upkeep:e.upkeep,buildings:[],units:[],lastSeen:e.lastSeen};for(var n=0;n<e.buildings.length;n++){var r=e.buildings[n];var i=$em(r).comp("MapElement");var s=undefined;var o=undefined;var u={type:$em(r).comp("Building").type.replace(/\s/g,""),location:{x:i.x,y:i.y},turnsUntilCapture:$em(r).comp("Building").turnsUntilCapture,buffs:s,debuffs:o};t.buildings.push(u)}for(var a=0;a<e.units.length;a++){var f=e.units[a];var l=$em(f).comp("MapElement");var c={};if($em(f).comp("Unit").type=="Harvester"){c.gatherTarget=$em(f).has("Gather");c.captureTarget=$em(f).has("Capture")}c.kills=$em(f).comp("Unit").kills;var s=undefined;var o=undefined;var h={type:$em(f).comp("Unit").type.replace(/\s/g,""),location:{x:l.x,y:l.y},state:$em(f).comp("Unit").state,hp:$em(f).comp("Health").current,options:c,buffs:s,debuffs:o};t.units.push(h)}return t}function r(t,r){var i=$em("Turn").all()[0];var s={turn:$em(i).comp("Turn").playerid,state:{},lastupdate:+(new Date),summary:{players:[]}};for(var o=0;o<e.players().length;o++){var u=e.players()[o];s.summary.players.push(u.summary);s.state[u.id]=n(u)}var a=JSON.stringify({gameid:e.id()});var f=JSON.stringify(s);boc.utils.getJson("transact/update/games",{query:a,document:f},function(e){if(r){r()}})}function i(t,n){var r=[];var i=boc.utils.getPlayer(t);if(!i){throw"player "+t+" not found"}for(var s=0;s<i.moves.length;s++){r.push({playerid:i.id,command:i.moves[s],turn:i.turn})}var o={query:JSON.stringify({gameid:e.id()}),document:JSON.stringify({$pushAll:{moves:r}})};boc.utils.getJson("transact/update/games",o,function(e){i.moves=[];if(n){n()}})}this.processTick=function(e){$em("SaveEvent").each(function(e,n){if(n.action=="saveAll"){r(n.playerid,function(){i(n.playerid,n.onSaveComplete)})}else if(n.action=="saveGameState"){r(n.playerid,n.onSaveComplete)}else if(n.action=="saveMoves"){i(n.playerid,n.onSaveComplete)}boc.utils.consumeEvent(e,n.className(),t)})}};ns("bbq.systems");bbq.systems.TrainingSystem=function(e,t,n,r){if(!r){r={}}if(!r.scale){r.scale=1}var i="closed";r.hud.on("trainback",function(){if(!r.hud._dontShowCommands){boc.utils.createEvent(new bbq.events.CommandEvent({action:"showCommands",args:{entity:r.hud._trainingEntity}}),e)}boc.utils.createEvent(new bbq.events.MapSelectEvent({action:"unlockCursor"}),e);boc.utils.createEvent(new boc.components.PanningCameraEvent("unlock"),e);r.hud.hideUnitStats();r.hud._trainingEntity=null;r.hud._dontShowCommands=null;document.addEventListener("touchmove",r.touchCallback)});r.hud.on("trainok",function(t){if(t.selected){var i=t.selected;var s=bbq.units.configuration[i];var o=boc.utils.getCurrentPlayer(e);if(o.food>=s.foodCost){o.updateFood(o.food-s.foodCost);var u=o.summary.unitsProduced||0;o.updateSummary({unitsProduced:u+1});var a=bbq.units.createUnit({type:i},o.team,e);o.addUnit(a);var f=$em(r.hud._trainingEntity).comp("MapElement");n.place(a,f.x,f.y);boc.utils.createEvent(new bbq.events.MapSelectEvent({action:"unlockCursor"}),e);boc.utils.createEvent(new boc.components.PanningCameraEvent("unlock"),e);boc.utils.createEvent(new bbq.events.UnitEvent({action:"inactivate",args:{entity:a}}),e);boc.utils.createEvent(new bbq.events.FogEvent({action:"update"}),e);boc.utils.createEvent(new bbq.events.FogEvent({action:"draw"}),e);boc.utils.createEvent(new bbq.events.HudEvent({action:"update"}),e);boc.utils.getCurrentPlayer().moves.push("("+f.x+","+f.y+")t('"+i+"')");r.hud._dontShowCommands=true;r.hud.closeTrainWindow();var l=bbq.sh().getAudio(a,"unitTrain");bbq.sh().play(l)}else{alert("Not enough food!")}}else{alert("no unit selected!")}});this.processTick=function(t){$em("TrainingEvent").each(function(t,n){if(n.action=="show"){r.hud.openTrainWindow(boc.utils.getCurrentPlayer().unitSet);r.hud._trainingEntity=n.entity;boc.utils.consumeEvent(t,n.className(),e);var i=function(e){e.preventDefault()};document.removeEventListener("touchmove",r.touchCallback)}})}};ns("bbq.systems");bbq.systems.HealSystem=function(e){var t=$em();var n="wait";var r=null,i=null;var s=function(){r=null;i=null;n="wait"};var o=function(n){var r=bbq.utils.getTilesWithinAttackRange({entityManager:t,entity:n,costMap:e.costMap(),costNodes:e.attackMap(),sizeX:e.numColumns(),sizeY:e.numRows(),rangeOffset:0});for(var i=0;i<r.length;i++){var s=r[i].split(",");var o=new boc.core.Entity({entityManager:t});o.addComponent(new boc.components.Spatial({x:0,y:0,z:bbq.zindex.OVERLAY,width:e.tileWidth(),height:e.tileHeight()}));o.addComponent(new boc.components.DrawableRect({fillStyle:"rgba(0,255,0,0.25)",lineWidth:0}));o.addComponent(new bbq.components.HealOverlay);o.addComponent(new boc.components.Identifiable);e.place(o.id(),+s[0],+s[1]);$em("Player").each(function(n,r){if(r.id!=boc.utils.getCurrentPlayer(t).id){return}var i=e.getEntities(+s[0],+s[1],"Unit")[0];if(i&&r.hasEntity(i)&&$em(i).comp("DrawableSprite").visible){o.HealOverlay.target=i;var u=$em.create();$em(u).add(new boc.components.Spatial({x:0,y:0,z:bbq.zindex.OVERLAY+1,width:e.tileWidth(),height:e.tileHeight()})).add(new boc.components.DrawableRect({fillStyle:"rgba(0,255,0,0.35)",lineWidth:0,visible:true})).add(new bbq.components.HealOverlay);boc.utils.createBlinkingAnimation(u,{easing:"easeInCubic",drawableName:"DrawableRect",delta:1}).start();e.place(u,+s[0],+s[1])}})}};var u=function(){var e=$em("HealOverlay").all().slice();for(var n=0;n<e.length;n++){t.killEntity(e[n])}};var a=function(e,r,i,s){$em($em.create()).add(new boc.components.DelayedMethod(function(){var s=$em(r).comp("Spatial");boc.utils.createHitEffect(s.x,s.y,t);boc.utils.createBouncingText(i,s.x+s.width/2-2,s.y+s.height-6,{fillStyle:"lime",z:bbq.zindex.EFFECTS+1});var o=$em(r).comp("Health");o.current+=i;o.current=Math.min(o.current,o.max);var u=null,a=null;$em("Player").each(function(t,n){if(n.hasEntity(e)){a=n}if(n.hasEntity(r)){u=n}});var f=$em(r).comp("HealthBar");var l=f.icon;if(o.current<o.max){$em(l).comp("DrawableRect").visible=true;$em(f.currentIcon).comp("DrawableRect").visible=true}if(n=="healComplete"){n="cleanup"}else if(n=="healing"){n="healHit"}},s))};var f=function(e,r,i,s){if($em(e).comp("SpriteAnimation")){$em(e).comp("SpriteAnimation").state=boc.constants.ANIMATION_STOPPED}var o=t.getComponentForEntity("SpineAnimation",e);if(o){o.state=boc.constants.ANIMATION_PLAYING;try{o.animationState.setAnimationByName("heal",false)}catch(u){console.log(u);n="wait";return}o._previousDrawable=o._previousDrawable||t.getComponentForEntity("DrawableSprite",e);t.removeComponentFromEntity(o._previousDrawable.className(),e);if(!o._onHealEnd){o._onHealEnd=function(){if(n=="healHit"){n="cleanup"}else if(n=="healing"){n="healComplete"}if(s){s()}};o.on("onComplete",function(e){if(e=="heal"){o._onHealEnd();var t=$em(o.target).comp("SpineDrawable").skeleton;t.setToSetupPose();t.getRootBone().x=50;t.getRootBone().y=-50;t.updateWorldTransform();if(o._previousDrawable){$em(o.target).add(o._previousDrawable);o._previousDrawable=null}}})}}a(e,r,i,500,s)};var l=function(e){var t=null;for(var s=0;s<e.length;s++){t=$em(e[s]).comp("HealOverlay");if(t){break}}if(t&&t.target){u();boc.utils.createEvent(new bbq.events.MapSelectEvent({action:"hideCursor"}));i=t.target;var o=$em(r).comp("Heal").points;f(r,i,o);n="healing";return true}return false};this.processTick=function(e){$em("HealEvent").each(function(e,i){if(!i.srcEntity){n="healMode";r=i.entity;o(r)}else{f(i.entity,i.dstEntity,i.healPoints,i.onComplete)}boc.utils.consumeEvent(e,i.className(),t)});if(n=="healMode"){$em("IdentifyEvent").each(function(e,n){var o=null;for(var a=0;a<n.identifiedEntities.length;a++){if($em(n.identifiedEntities[a]).comp("Cursor")){o=n.identifiedEntities[a];break}}if(o){if($em(r).comp("Unit").state=="idle"){boc.utils.createEvent(new bbq.events.MapSelectEvent({action:"unlockCursor"}),t)}boc.utils.createEvent(new bbq.events.CommandEvent({action:"showCommands",args:{entity:r}}),t);u();s()}else{if(l(n.identifiedEntities)){var f=boc.utils.getCurrentPlayer();var c=$em(r).comp("MapElement"),h=$em(i).comp("MapElement");f.moves.push("("+c.x+","+c.y+")hl("+h.x+","+h.y+")")}}boc.utils.consumeEvent(e,n.className(),t)})}else if(n=="cleanup"){boc.utils.createEvent(new bbq.events.MapSelectEvent({action:"unlockCursor"}),t);boc.utils.createEvent(new bbq.events.MapSelectEvent({action:"showCursor"}),t);boc.utils.createEvent(new bbq.events.UnitEvent({action:"inactivate",args:{entity:r}}),t);s()}}};ns("bbq.systems");bbq.systems.UnitCollisionSystem=function(e,t){this.processTick=function(n){var r=e.getAllEntitiesWithComponent("UnitEvent");for(var i=0;i<r.length;i++){var s=r[i];var o=e.getComponentForEntity("UnitEvent",s);if(o.action=="moveEntity"){var u=o.args.player;var a=o.args.entity;var f=e.getComponentForEntity("Spatial",a);var l=$em(a).comp("MapElement");var c=t.getTile(a);var h=e.getAllComponents("Player");for(var p=0;p<h.length;p++){if(h[p].id==u.id){continue}for(var d=0;d<h[p].units.length;d++){var v=h[p].units[d];var m=e.getComponentForEntity("Spatial",v);if(boc.utils.toBounds(m).intersects(boc.utils.toBounds(f))){var g=bbq.sh().getAudio(a,"unitCollide");if(g){bbq.sh().play(g)}boc.utils.createBouncingText("!",f.x+f.width-14,f.y+16,{z:f.z+1,font:"bold 14pt Helvetica",fillStyle:"rgb(255,100,100)"});var y=t.getTile(a);t.place(a,y.x,y.y);boc.utils.consumeEvent(s,"UnitEvent",e);boc.utils.createEvent(new bbq.events.UnitEvent({action:"inactivate",args:{entity:a}}),e);$em(a).comp("Animation").state=boc.constants.ANIMATION_STOPPED;boc.utils.createEvent(new bbq.events.FogEvent({action:"update"}),e);boc.utils.createEvent(new bbq.events.FogEvent({action:"draw"}),e);boc.utils.createEvent(new bbq.events.MapSelectEvent({action:"unlockCursor"}),e);boc.utils.createEvent(new bbq.events.MapSelectEvent({action:"showCursor"}),e);$em(a).comp("Spatial").update({x:y.x*t.tileWidth(),y:y.y*t.tileHeight()});var b=$em(a).comp("Commandable").commands;for(var w=0;w<b.length;w++){if(b[w].name()==="Move"&&b[w].onMoveEnd){b[w].onMoveEnd()}}}}}}}}};ns("bbq.systems");bbq.systems.UpkeepSystem=function(e){this.processTick=function(t){var n=boc.utils.getCurrentPlayer();if(!n.upkeep&&n.turn>1&&SharedSession&&SharedSession.user&&SharedSession.user.playerid==n.id){var r=0;$em("FoodProducer").each(function(e,t){if(n.hasEntity(e)){r+=t.food;var i=$em(e).comp("Spatial");var s=new boc.components.DrawableText({text:t.food,fillStyle:"white",shadow:{x:1,y:1},font:"bold 10pt Helvetica"});var o=new boc.components.DrawableSprite({image:boc.resources.GraphicsManager.getImage("ui/images/icon_food_small.png"),visible:true});boc.utils.createScrollingDrawable(s,i.x+i.width/2,i.y+i.height/2+11,{easing:"easeOutQuad",duration:1300});boc.utils.createScrollingDrawable(o,i.x+i.width/2-10,i.y+i.height/2,{easing:"easeOutQuad",duration:1300})}});$em("Gather").each(function(e,t){if(n.hasEntity(e)){var i=t.target;var s=$em(i).comp("Gatherable").foodPerTurn;r+=s;var o=$em(e).comp("Spatial");var u=new boc.components.DrawableText({text:s,fillStyle:"white",shadow:{x:1,y:1},font:"bold 10pt Helvetica"});var a=new boc.components.DrawableSprite({image:boc.resources.GraphicsManager.getImage("ui/images/icon_food_small.png"),visible:true});boc.utils.createScrollingDrawable(u,o.x+o.width/2,o.y+o.height/2+11,{easing:"easeOutQuad",duration:1300});boc.utils.createScrollingDrawable(a,o.x+o.width/2-10,o.y+o.height/2,{easing:"easeOutQuad",duration:1300})}});n.updateFood(n.food+r);n.upkeep=true;boc.utils.createEvent(new bbq.events.HudEvent({action:"update"}),e)}}};ns("bbq.systems");bbq.systems.VictorySystem=function(e,t){this.processTick=function(){$em("VictoryEvent").each(function(n,r){if(e.victoryCondition){e.victoryCondition(e,r)}boc.utils.consumeEvent(n,"VictoryEvent",t)})}};ns("bbq.commands");bbq.commands.Attack=function(e){this.name=function(){return"Attack"};this.execute=function(t){boc.utils.createEvent(new bbq.events.CommandEvent({action:"attackMode",args:t}),e)};var t=false;this.disabled=function(e){if(e===true){t=true;return t}if(e===false){t=false;return t}return t}};ns("bbq.commands");bbq.commands.Cancel=function(e){this.name=function(){return"Cancel"};this.execute=function(e){}};ns("bbq.commands");bbq.commands.Capture=function(e){this.name=function(){return"Capture"};this.execute=function(t){var n=$em(t.entity).comp("Spatial");var r=$em(t.entity).comp("MapElement");var i=$em(t.entity).comp("Capture");var s=t.map.getEntities(r.x,r.y,"Building");if(s&&s.length>0){s=s[0]}else{return}var o=$em(s).comp("Building");if(!i){var u=$em.create("captureIcon");$em(u).add(new boc.components.Spatial({x:n.x,y:n.y+n.height-15,z:bbq.zindex.UNITS+1,width:15,height:15})).add(new boc.components.DrawableSprite({image:boc.resources.GraphicsManager.getImage("assets/Misc/icon_capture.png"),visible:true}));n._onCaptureMoved=function(){$em(t.entity).remove("Capture")};n.addListener("onchange",n._onCaptureMoved);i=new bbq.components.Capture(s,u);$em(t.entity).add(i).listen("onComponentRemoved",function(e){if(e.componentName=="Capture"){if($em(u).exists()){$em(u).kill()}o.turnsUntilCapture=bbq.buildings.configuration[o.type].turnsTilCap;n.removeListener("onchange",n._onCaptureMoved);delete n["_onCaptureMoved"]}})}if(o&&!t.showIconOnly){var a=1;o.turnsUntilCapture-=a;if(o.turnsUntilCapture<=0){$em(i.icon).kill();$em(t.entity).remove("Capture");o.turnsUntilCapture=bbq.buildings.configuration[o.type].turnsTilCap;$em("Player").each(function(e,t){if(t.hasEntity(s)){t.removeBuilding(s)}});var f=boc.utils.getCurrentPlayer(e);f.addBuilding(s);$em(s).comp("DrawableSprite").image=boc.resources.GraphicsManager.getImage(bbq.buildings.configuration[o.type].defaultImagePath.replace("$(team)",f.team.toLowerCase()));boc.utils.createEvent(new bbq.events.VictoryEvent("captureHQ",f.id),e)}var l=$em(t.entity).comp("MapElement");boc.utils.getCurrentPlayer(e).moves.push("("+l.x+","+l.y+")c");bbq.commands.endUnitTurn(t.entity);if(t.command&&t.command.onCaptureEnd){t.command.onCaptureEnd()}}};var t=false;this.disabled=function(n){if(n===true){t=true;return t}if(n===false){t=false;return t}var r=e.getComponentForEntity("MapElement",n.entity);var i=n.map.getEntities(r.x,r.y,"Building");var s=boc.utils.getCurrentPlayer(e);var o=$em("Player").all();if(i&&i.length>0){for(var u=0;u<o.length;u++){var a=$em(o[u]).comp("Player");if(a.id!=s.id){if(a.buildings.indexOf(i[0])>=0){return t}}}}return true}};var bbq=bbq||{};bbq.commands=bbq.commands||{};bbq.commands.Heal=function(t){this.name=function(){return"Heal"};this.execute=function(e){var n=new bbq.events.HealEvent(e.entity);boc.utils.createEvent(n,t);boc.utils.createEvent(new bbq.events.CommandEvent({action:"hideCommands"}),t)}};bbq.components=bbq.components||{};bbq.components.HealOverlay=function(){this.className=function(){return"HealOverlay"}};bbq.components.Heal=function(e){this.points=e;this.className=function(){return"Heal"}};bbq.events=bbq.events||{};bbq.events.HealEvent=function(e){this.entity=e;this.className=function(){return"HealEvent"}};bbq.systems=bbq.systems||{};bbq.systems.HealSystem=function(e){var t=$em();var n="wait";var r=null,i=null;var s=function(){r=null;i=null;n="wait"};var o=function(n){var r=bbq.utils.getTilesWithinAttackRange({entityManager:t,entity:n,costMap:e.costMap(),costNodes:e.attackMap(),sizeX:e.numColumns(),sizeY:e.numRows(),rangeOffset:0});for(var i=0;i<r.length;i++){var s=r[i].split(",");var o=new boc.core.Entity({entityManager:t});o.addComponent(new boc.components.Spatial({x:0,y:0,z:bbq.zindex.OVERLAY,width:e.tileWidth(),height:e.tileHeight()}));o.addComponent(new boc.components.DrawableRect({fillStyle:"rgba(0,255,0,0.25)",lineWidth:0}));o.addComponent(new bbq.components.HealOverlay);o.addComponent(new boc.components.Identifiable);e.place(o.id(),+s[0],+s[1]);$em("Player").each(function(n,r){if(r.id!=boc.utils.getCurrentPlayer(t).id){return}var i=e.getEntities(+s[0],+s[1],"Unit")[0];if(i&&r.hasEntity(i)&&$em(i).comp("DrawableSprite").visible){o.HealOverlay.target=i;var u=$em.create();$em(u).add(new boc.components.Spatial({x:0,y:0,z:bbq.zindex.OVERLAY+1,width:e.tileWidth(),height:e.tileHeight()})).add(new boc.components.DrawableRect({fillStyle:"rgba(0,255,0,0.35)",lineWidth:0,visible:true})).add(new bbq.components.HealOverlay);boc.utils.createBlinkingAnimation(u,{easing:"easeInCubic",drawableName:"DrawableRect",delta:1}).start();e.place(u,+s[0],+s[1])}})}};var u=function(){var e=$em("HealOverlay").all().slice();for(var n=0;n<e.length;n++){t.killEntity(e[n])}};var a=function(e,r,i,s){$em($em.create()).add(new boc.components.DelayedMethod(function(){var s=$em(r).comp("Spatial");boc.utils.createHitEffect(s.x,s.y,t);boc.utils.createBouncingText(i,s.x+s.width/2-2,s.y+s.height-6,{fillStyle:"lime",z:bbq.zindex.EFFECTS+1});var o=$em(r).comp("Health");o.current+=i;o.current=Math.min(o.current,o.max);var u=null,a=null;$em("Player").each(function(t,n){if(n.hasEntity(e)){a=n}if(n.hasEntity(r)){u=n}});var f=$em(r).comp("HealthBar");var l=f.icon;if(o.current<o.max){$em(l).comp("DrawableRect").visible=true;$em(f.currentIcon).comp("DrawableRect").visible=true}if(n=="healComplete"){n="cleanup"}else if(n=="healing"){n="healHit"}},s))};var f=function(e,r,i,s){if($em(e).comp("SpriteAnimation")){$em(e).comp("SpriteAnimation").state=boc.constants.ANIMATION_STOPPED}var o=t.getComponentForEntity("SpineAnimation",e);if(o){o.state=boc.constants.ANIMATION_PLAYING;try{o.animationState.setAnimationByName("heal",false)}catch(u){console.log(u);n="wait";return}o._previousDrawable=o._previousDrawable||t.getComponentForEntity("DrawableSprite",e);t.removeComponentFromEntity(o._previousDrawable.className(),e);if(!o._onHealEnd){o._onHealEnd=function(){if(n=="healHit"){n="cleanup"}else if(n=="healing"){n="healComplete"}};o.on("onComplete",function(e){if(e=="heal"){o._onHealEnd();var t=$em(o.target).comp("SpineDrawable").skeleton;t.setToSetupPose();t.getRootBone().x=50;t.getRootBone().y=-50;t.updateWorldTransform();if(o._previousDrawable){$em(o.target).add(o._previousDrawable);o._previousDrawable=null}}})}}a(e,r,i,500,s)};var l=function(e){var t=null;for(var s=0;s<e.length;s++){t=$em(e[s]).comp("HealOverlay");if(t){break}}if(t&&t.target){u();boc.utils.createEvent(new bbq.events.MapSelectEvent({action:"hideCursor"}));i=t.target;var o=$em(r).comp("Heal").points;f(r,i,o);n="healing";return true}return false};this.processTick=function(e){$em("HealEvent").each(function(e,i){n="healMode";r=i.entity;o(r);boc.utils.consumeEvent(e,i.className(),t)});if(n=="healMode"){$em("IdentifyEvent").each(function(e,n){var o=null;for(var a=0;a<n.identifiedEntities.length;a++){if($em(n.identifiedEntities[a]).comp("Cursor")){o=n.identifiedEntities[a];break}}if(o){if($em(r).comp("Unit").state=="idle"){boc.utils.createEvent(new bbq.events.MapSelectEvent({action:"unlockCursor"}),t)}boc.utils.createEvent(new bbq.events.CommandEvent({action:"showCommands",args:{entity:r}}),t);u();s()}else{if(l(n.identifiedEntities)){var f=boc.utils.getCurrentPlayer();var c=$em(r).comp("MapElement"),h=$em(i).comp("MapElement");f.moves.push("("+c.x+","+c.y+")hl("+h.x+","+h.y+")")}}boc.utils.consumeEvent(e,n.className(),t)})}else if(n=="cleanup"){boc.utils.createEvent(new bbq.events.MapSelectEvent({action:"unlockCursor"}),t);boc.utils.createEvent(new bbq.events.MapSelectEvent({action:"showCursor"}),t);boc.utils.createEvent(new bbq.events.UnitEvent({action:"inactivate",args:{entity:r}}),t);s()}}};ns("bbq.commands");bbq.commands.Gather=function(e){this.name=function(){return"Gather"};this.execute=function(t){var n=$em(t.entity).comp("Spatial");var r=$em(t.entity).comp("MapElement");var i=$em(t.entity).comp("Gather");var s=t.map.getEntities(r.x,r.y,"Gatherable");if(s&&s.length>0){s=s[0]}else{return}if(!i){var o=$em.create("gatherIcon");$em(o).add(new boc.components.Spatial({x:n.x,y:n.y+n.height-15,z:bbq.zindex.UNITS+1,width:15,height:15})).add(new boc.components.DrawableSprite({image:boc.resources.GraphicsManager.getImage("assets/Misc/icon_gather.png"),visible:true}));n._onGatherMoved=function(){$em(t.entity).remove("Gather")};n.addListener("onchange",n._onGatherMoved);$em(t.entity).add(new bbq.components.Gather(s,o)).listen("onComponentRemoved",function(e){if(e.componentName=="Gather"){if($em(o).exists()){$em(o).kill()}n.removeListener("onchange",n._onGatherMoved);delete n["_onGatherMoved"]}})}if(!t.showIconOnly){var u=$em(t.entity).comp("MapElement");boc.utils.getCurrentPlayer(e).moves.push("("+u.x+","+u.y+")g");bbq.commands.endUnitTurn(t.entity)}var a=bbq.sh().getAudio(t.entity,"unitGather");bbq.sh().play(a);if(t.command&&t.command.onGatherEnd){t.command.onGatherEnd()}};var t=false;this.disabled=function(n){if(n===true){t=true;return t}if(n===false){t=false;return t}var r=e.getComponentForEntity("MapElement",n.entity);var i=n.map.getEntities(r.x,r.y,"Prop");for(var s=0;s<i.length;s++){if(e.getComponentForEntity("Prop",i[s]).type=="berries"){return t}}return true}};ns("bbq.systems");bbq.systems.UnitSystem=function(e){this.processTick=function(t){var n=e.getAllEntitiesWithComponent("UnitEvent");for(var r=0;r<n.length;r++){var i=e.getComponentForEntity("UnitEvent",n[r]);if(i.action=="inactivate"&&$em(i.args.entity).exists()){var s=e.getComponentForEntity("Unit",i.args.entity);var o=boc.utils.getCurrentPlayer(e).team;s.state="inactive";var u=e.getComponentForEntity("Spatial",i.args.entity);var a=e.getComponentForEntity("DrawableSprite",i.args.entity);if(!a){a=new boc.components.DrawableSprite({image:f});e.addComponentToEntity(a,i.args.entity)}var f=boc.utils.createFilteredImage(s.type+"_"+o.toLowerCase(),u.width,u.height,.5);a.image=f;var l=e.getComponentForEntity("SpriteAnimation",i.args.entity);if(l){l.state=boc.constants.ANIMATION_STOPPED}boc.utils.consumeEvent(n[r],"UnitEvent",e)}}var c=e.getAllEntitiesWithComponent("MapSelectEvent");for(var r=0;r<c.length;r++){var h=e.getComponentForEntity("MapSelectEvent",c[r]);if(h.action=="select"){if(h.args.selected){var p=bbq.sh().getAudio(h.args.selected,"unitSelect");if(p){bbq.sh().play(p)}}if(h.args.previous&&(e.getComponentForEntity("Building",h.args.previous)||e.getComponentForEntity("Unit",h.args.previous))){if(!e.getComponentForEntity("Unit",h.args.previous)||e.getComponentForEntity("Unit",h.args.previous).state!="inactive"){var d=e.getComponentForEntity("SpriteAnimation",h.args.previous)||e.getComponentForEntity("SpineAnimation",h.args.previous);if(d){d.state=boc.constants.ANIMATION_STOPPED;if(d.className()=="SpineAnimation"){var v=$em(d.target).comp("SpineDrawable").skeleton;v.setToSetupPose();v.getRootBone().x=50;v.getRootBone().y=-50;$em(d.target).comp("SpineDrawable").skeleton.updateWorldTransform();if(d._previousDrawable){$em(d.target).add(d._previousDrawable);d._previousDrawable=null}}}var m=e.getComponentForEntity("SpriteAnimationSet",h.args.previous);var g=e.getComponentForEntity("DrawableSprite",h.args.previous);if(m&&m["default"]&&g){g.image=m["default"]}}}if(h.args.selected&&boc.utils.getCurrentPlayer(e).hasEntity(h.args.selected)){var s=e.getComponentForEntity("Unit",h.args.selected);if(s){if(s.state!="inactive"){var y=e.getComponentForEntity("SpriteAnimationSet",h.args.selected);if(y&&y["idle"]){var b=new boc.utils.SpriteAnimationSequence({entity:h.args.selected,entityManager:e,loop:true,animations:[y["idle"]]});b.start()}var w=e.getComponentForEntity("SpineAnimation",h.args.selected);if(w){w.state=boc.constants.ANIMATION_PLAYING;w.animationState.setAnimationByName("idle",true);w._previousDrawable=w._previousDrawable||e.getComponentForEntity("DrawableSprite",h.args.selected);e.removeComponentFromEntity(w._previousDrawable.className(),h.args.selected)}var E=e.getComponentForEntity("Commandable",h.args.selected).commands;var S=false;for(var x=0;x<E.length;x++){if(E[x].name()=="Move"){if(E[x].disabled()==true){S=true;break}}}for(var x=0;x<E.length;x++){if(E[x].name()=="Hold"){if(S){E[x].disabled(false)}else{E[x].disabled(true)}break}}boc.utils.createEvent(new bbq.events.CommandEvent({action:"showCommands",args:{entity:h.args.selected}}),e)}else{boc.utils.createEvent(new bbq.events.CommandEvent({action:"hideCommands",args:{entity:h.args.selected}}),e)}}else{boc.utils.createEvent(new bbq.events.CommandEvent({action:"showCommands",args:{entity:h.args.selected}}),e);var p=bbq.sh().getAudio("effects/buttonClick");console.log(p);if(p){bbq.sh().play(p)}}}else{boc.utils.createEvent(new bbq.events.CommandEvent({action:"hideCommands",args:{entity:h.args.selected}}),e)}boc.utils.createEvent(new bbq.events.HudEvent({entity:h.args.selected}),e)}boc.utils.consumeEvent(c[r],"MapSelectEvent",e)}}};ns("bbq.commands");bbq.commands.Hold=function(e){this.name=function(){return"Hold"};this.execute=function(t){e.getComponentForEntity("Unit",t.entity).state="inactive";boc.utils.createEvent(new bbq.events.UnitEvent({action:"inactivate",args:{entity:t.entity}}),e);boc.utils.createEvent(new bbq.events.MapSelectEvent({action:"unlockCursor"}),e);var n=$em(t.entity).comp("MapElement");boc.utils.getCurrentPlayer(e).moves.push("("+n.x+","+n.y+")h");if(t.command&&t.command.onHoldEnd){t.command.onHoldEnd()}};var t=false;this.disabled=function(e){if(e===true){t=true;return t}if(e===false){t=false;return t}return t}};ns("bbq.commands");bbq.commands.Move=function(e){this.name=function(){return"Move"};this.execute=function(t){boc.utils.createEvent(new bbq.events.CommandEvent({action:"moveMode",args:t}),e)};var t=false;this.disabled=function(e){if(e===true){t=true;return t}if(e===false){t=false;return t}return t}};var bbq=bbq||{};bbq.commands=bbq.commands||{};bbq.commands.Reveal=function(t){this.name=function(){return"Reveal"};this.execute=function(e){var n=new bbq.events.RevealEvent(e.entity);boc.utils.createEvent(n,t);boc.utils.createEvent(new bbq.events.CommandEvent({action:"hideCommands"}),t)}};bbq.components=bbq.components||{};bbq.components.RevealOverlay=function(){this.className=function(){return"RevealOverlay"}};bbq.components.Reveal=function(e,t){this.range=e;this.radius=t;this.className=function(){return"Reveal"}};bbq.components.RevealSpot=function(e,t,n,r){this.x=e;this.y=t;this.range=n;this.srcPlayerId=r;this.className=function(){return"RevealSpot"}};bbq.events=bbq.events||{};bbq.events.RevealEvent=function(e){this.entity=e;this.className=function(){return"RevealEvent"}};bbq.systems=bbq.systems||{};bbq.systems.RevealSystem=function(e){var t=$em();var n="wait";var r=null,i=null;var s=function(){r=null;i=null;n="wait"};var o=function(n){var r=bbq.utils.getTilesWithinRevealRange({entityManager:t,entity:n,costMap:e.costMap(),costNodes:e.attackMap(),sizeX:e.numColumns(),sizeY:e.numRows(),rangeOffset:0});for(var i=0;i<r.length;i++){var s=r[i].split(",");var o=new boc.core.Entity({entityManager:t});o.addComponent(new boc.components.Spatial({x:0,y:0,z:bbq.zindex.OVERLAY,width:e.tileWidth(),height:e.tileHeight()}));o.addComponent(new boc.components.DrawableRect({fillStyle:"rgba(255,255,255,0.25)",lineWidth:0}));o.addComponent(new bbq.components.RevealOverlay);o.addComponent(new boc.components.Identifiable);boc.utils.createBlinkingAnimation(o,{easing:"easeInCubic",drawableName:"DrawableRect",delta:1}).start();e.place(o.id(),+s[0],+s[1])}};var u=function(){var e=$em("RevealOverlay").all().slice();for(var n=0;n<e.length;n++){t.killEntity(e[n])}};var a=function(e,r,i){$em($em.create()).add(new boc.components.DelayedMethod(function(){boc.utils.createEvent(new bbq.events.FogEvent({action:"update"}),t);boc.utils.createEvent(new bbq.events.FogEvent({action:"draw"}),t);if(n=="revealComplete"){n="cleanup"}else if(n=="revealing"){n="revealHit"}},i))};var f=function(e,r){if($em(e).comp("SpriteAnimation")){$em(e).comp("SpriteAnimation").state=boc.constants.ANIMATION_STOPPED}var i=t.getComponentForEntity("SpineAnimation",e);if(i){i.state=boc.constants.ANIMATION_PLAYING;try{i.animationState.setAnimationByName("reveal",false)}catch(s){console.log(s);n="wait";return}i._previousDrawable=i._previousDrawable||t.getComponentForEntity("DrawableSprite",e);t.removeComponentFromEntity(i._previousDrawable.className(),e);if(!i._onRevealEnd){i._onRevealEnd=function(){if(n=="revealHit"){n="cleanup"}else if(n=="revealing"){n="revealComplete"}};i.on("onComplete",function(e){if(e=="reveal"){i._onRevealEnd();var t=$em(i.target).comp("SpineDrawable").skeleton;t.setToSetupPose();t.getRootBone().x=50;t.getRootBone().y=-50;t.updateWorldTransform();if(i._previousDrawable){$em(i.target).add(i._previousDrawable);i._previousDrawable=null}}})}}var o=$em(r).comp("Spatial");boc.utils.createHitEffect(o.x,o.y,t);a(e,r,300)};var l=function(t){var s=null,o=null;for(var a=0;a<t.length;a++){o=t[a];s=$em(t[a]).comp("RevealOverlay");if(s){break}}if(s){var l=$em(o).comp("MapElement").x;var c=$em(o).comp("MapElement").y;var h=$em(r).comp("Reveal").radius;u();boc.utils.createEvent(new bbq.events.MapSelectEvent({action:"hideCursor"}));var p=null;$em("Player").each(function(e,t){if(t.hasEntity(r)){p=t}});i=$em.create();$em(i).add(new boc.components.Spatial({x:0,y:0,z:bbq.zindex.OVERLAY,width:e.tileWidth(),height:e.tileHeight()})).add(new bbq.components.RevealSpot(l,c,h,p));e.place(i,l,c);f(r,i);n="revealing";return true}return false};this.processTick=function(e){$em("RevealEvent").each(function(e,i){n="revealMode";r=i.entity;o(r);boc.utils.consumeEvent(e,i.className(),t)});if(n=="revealMode"){$em("IdentifyEvent").each(function(e,n){var o=null;for(var a=0;a<n.identifiedEntities.length;a++){if($em(n.identifiedEntities[a]).comp("Cursor")){o=n.identifiedEntities[a];break}}if(o){if($em(r).comp("Unit").state=="idle"){boc.utils.createEvent(new bbq.events.MapSelectEvent({action:"unlockCursor"}),t)}boc.utils.createEvent(new bbq.events.CommandEvent({action:"showCommands",args:{entity:r}}),t);u();s()}else{if(l(n.identifiedEntities)){var f=boc.utils.getCurrentPlayer();var c=$em(r).comp("MapElement"),h=$em(i).comp("MapElement");f.moves.push("("+c.x+","+c.y+")rv("+h.x+","+h.y+")")}}boc.utils.consumeEvent(e,n.className(),t)})}else if(n=="cleanup"){boc.utils.createEvent(new bbq.events.MapSelectEvent({action:"unlockCursor"}),t);boc.utils.createEvent(new bbq.events.MapSelectEvent({action:"showCursor"}),t);boc.utils.createEvent(new bbq.events.UnitEvent({action:"inactivate",args:{entity:r}}),t);s()}}};ns("bbq.commands");bbq.commands.Train=function(e){this.name=function(){return"Train"};this.execute=function(t){var n=new bbq.events.TrainingEvent("show");n.entity=t.entity;boc.utils.createEvent(n,e);boc.utils.createEvent(new bbq.events.CommandEvent({action:"hideCommands"}),e)};var t=false;this.disabled=function(e){if(e===true){t=true;return t}if(e===false){t=false;return t}return t}};ns("bbq.commands");bbq.commands.endUnitTurn=function(e,t){if(!t){t=$em()}boc.utils.createEvent(new bbq.events.MapSelectEvent({action:"unlockCursor"}),t);boc.utils.createEvent(new bbq.events.MapSelectEvent({action:"showCursor"}),t);boc.utils.createEvent(new bbq.events.UnitEvent({action:"inactivate",args:{entity:e}}),t)};(function(){function r(e,r){if(e==t){$(n[e]).css("display","");if(r){r()}return}$(n[e]).css("display","");var i="-="+($(n[e]).position().left-$(n[t]).position().left);var s=0;for(var o=0;o<n.length;o++){$(n[o]).animate({left:i},350,function(){s++;if(s==n.length&&r){$(this).css("left","0px");r()}})}}var e=null;var t=0;var n=[];window.director={};director.setContainer=function(t){e=t};director.push=function(i,s,o){var u=$("<div>").addClass("scene").addClass("noSelect").addClass("noDrag").css("display","none");u.attr("id","scene_"+n.length);u.html(i);n.push(u);$(e).append(u);if(s){s(u)}if(n.length==1){$(u).css("display","");if(o){o(u)}return}var a=$(n[t]).position().left+$(n[t]).width();$(u).css("left",a+"px");r(t+1,function(){t++;if(o){o(u)}})};director.pop=function(e){if(t==0){var i=n.pop();if(e){e(i)}$(i).remove();return}r(t-1,function(){var r=n.pop();if(e){e(r)}$(r).remove();t--})};director.replace=function(i,s,o){var u=$("<div>").addClass("scene").addClass("noSelect").addClass("noDrag").css("display","none");u.attr("id","scene_r"+n.length);u.html(i);n.push(u);$(e).append(u);if(s){s(u)}if(n.length==1){$(u).css("display","");if(o){o(u)}return}var a=$(n[t]).position().left+$(n[t]).width();$(u).css("left",a+"px");r(t+1,function(){var e=n.splice(n.length-2,1)[0];e.remove();if(o){o(u)}})};director.currentScene=function(){return n[t]}})();if(!window.bbq){window.bbq={}}bbq.Session=function(){boc.utils.EventEmitter.call(this);var e=this;this.user=null;this.gameObj=null;this.refreshUser=function(t){boc.utils.getJson("userinfo",{},function(n){e.user=new bbq.User(n.result);if(t){t(e.user)}})};var e=this;var t={sound:"on"};this.settings=function(n,r){if(arguments.length===1){return t[n]}else{var i=t[n];t[n]=r;e.emit("settingsChanged",{name:n,oldValue:i,newValue:r})}}};boc.utils.inherits(bbq.Session,boc.utils.EventEmitter);var SharedSession=new bbq.Session;ns("bbq.hud");bbq.hud.IHud=function(){var e=new boc.utils.EventManager(this)};(function(e){e.prototype.food=function(e){};e.prototype.name=function(e){};e.prototype.health=function(e){};e.prototype.attack=function(e){};e.prototype.range=function(e){};e.prototype.movement=function(e){};e.prototype.vision=function(e){};e.prototype.openTrainWindow=function(e){};e.prototype.closeTrainWindow=function(){};e.prototype.openSummaryWindow=function(){};e.prototype.closeSummaryWindow=function(){};e.prototype.openMenuWindow=function(){};e.prototype.closeMenuWindow=function(){};e.prototype.canvas=function(e){};e.prototype.clear=function(){};e.prototype.summary=function(){}})(bbq.hud.IHud);bbq.hud.HtmlHud=function(e){bbq.hud.IHud.call(this);this.id=function(){return e};var t=this;var n=$("#"+e);n.find(".myTribeWindow").hide();n.find(".smallInfoButton").click(function(){t.emit("info",{})});n.find(".btnSpellbook").click(function(){t.emit("spellbook",{})});n.find(".btnPause").click(function(){t.emit("pause",{})});n.find("#btnEndTurn").click(function(){t.emit("endturn",{})});n.find(".trainButton").click(function(){t.emit("trainok",{selected:t._selected})});n.find("#closeTrainWindow").click(function(){t.closeTrainWindow()});n.find(".pauseMenu #menuResume").click(function(){t.emit("menuresume",t)});n.find(".pauseMenu #menuForfeit").click(function(){t.emit("menuforfeit",t)});n.find(".pauseMenu #menuBattles").click(function(){t.emit("menubattles",t)});n.find("#summaryCollect").click(function(){t.emit("summarycollect",t)});var r="on";this.soundState=function(e){r=e;i();return r};var i=function(){n.find(".soundBtn .labelSmall").text(r);if(r==="on"){n.find(".soundOff").removeClass("soundOff").addClass("soundOn")}else{n.find(".soundOn").removeClass("soundOn").addClass("soundOff")}};n.find(".soundBtn").click(function(){if(r==="on"){r="off"}else{r="on"}i();t.emit("sound",r)});i()};boc.utils.inherits(bbq.hud.HtmlHud,bbq.hud.IHud);(function(e){var t='<div class="unitContainer"> <div class="unitBg"> <img class="unitImage" /> <div class="unitPriceBg"> <div class="vAlign"> <img class="unitPriceIcon iconFoodSmall" /></div><div class="vAlign"> <span class="unitPriceValue">$foodCost</span></div></div></div></div>';e.prototype.food=function(e){if(typeof e=="undefined"){return $("#foodValue").text()}var t=Number($("#"+this.id()+" #foodValue").text());if(t==null||t==undefined){$("#foodValue").text(e).css("z-index",100);return}var n=500;$({someValue:t}).animate({someValue:e},{duration:n,easing:"linear",step:function(){$("#foodValue").text(Math.ceil(this.someValue)).css("z-index",100)},complete:function(){$("#foodValue").text(e).css("z-index",100)}});return this};e.prototype.name=function(e){if(typeof e=="undefined"){return $("#"+this.id()+" #unitName").text()}$("#"+this.id()+" #unitName").text(e).css("z-index",100);return this};e.prototype.health=function(e){if(typeof e=="undefined"){return $("#"+this.id()+" #unitHealth").text()}$("#"+this.id()+" #unitHealth").text(e).css("z-index",100);return this};e.prototype.attack=function(e){if(typeof e=="undefined"){return $("#"+this.id()+" #unitAttack").text()}$("#"+this.id()+" #unitAttack").text(e).css("z-index",100);return this};e.prototype.range=function(e){if(typeof e=="undefined"){return $("#"+this.id()+" #unitRange").text()}$("#"+this.id()+" #unitRange").text(e).css("z-index",100);return this};e.prototype.movement=function(e){if(typeof e=="undefined"){return $("#"+this.id()+" #unitMovement").text()}$("#"+this.id()+" #unitMovement").text(e).css("z-index",100);return this};e.prototype.vision=function(e){if(typeof e=="undefined"){return $("#"+this.id()+" #unitVision").text()}$("#"+this.id()+" #unitVision").text(e).css("z-index",100);return this};e.prototype.openTrainWindow=function(e){$("#"+this.id()+" #trainUnitContainer").empty();$trainWindow=$("#"+this.id()+" #trainWindow");var n=document.documentElement;var r=(n.clientHeight-$trainWindow.outerHeight())/2;$trainWindow.css("top",r);$("#"+this.id()+" #trainWindow").show();var i=this;for(var s=0;s<e.length;s++){(function(n){var r=t.replace(/\$foodCost/g,e.info(n).foodCost);var s=$(r);var o=e.info(n).defaultImagePath||e[n]+"_"+e.team().toLowerCase();console.log(e.info(n));var u=s.find(".unitBg").find("img.unitImage").attr("src",$(boc.resources.GraphicsManager.getImage(o)).attr("src"));u.attr("width",100).attr("height",100);$("#"+i.id()+" #trainUnitContainer").append(s);s.click(function(){var t='<div class="unitInfo center"> <div class="unitNameBg"> <span>$displayName</span> </div> <!-- unitNameBg --> <div class="unitDesc"> $description </div> <!-- unitDesc --> <div class="unitPriceBg"> <div class="vAlign"> <div class="trainButton center buttonContainer button buttonBlue"> <div class="content"> <span class="labelLarge btnWord"> Train </span> </div> <!-- content --> </div> <!-- buttonContainer --> </div> <!-- vAlign --> </div> <!-- unitPriceBg --> </div> <!-- unitInfo -->'.replace(/\$displayName/g,e.info(n).displayName).replace(/\$description/g,e.info(n).description);$("#"+i.id()+" .unitContainerExpand").removeClass("unitContainerExpand");$("#"+i.id()+" .unitInfo").remove();var r=$(t);r.prependTo(s);s.addClass("unitContainerExpand");e.select(n);i._selected=e[e.selected()];r.find(".trainButton").click(function(){i.emit("trainok",{selected:i._selected})});i.emit("updateStats",{unitInfo:e.info(n)})})})(s)}this.emit("open",this)};e.prototype.closeTrainWindow=function(e){var t=$("#"+this.id());t.find(".btnUnit").remove();t.find("#trainWindow").hide();this._selected=null;this.emit("trainback",e)};e.prototype.canvas=function(e){if(typeof e=="undefined"){return $("#"+this.id()+" .hud canvas")[0]}$("#"+this.id()+" .hud canvas").remove();$("#"+this.id()+" .hud").prepend(e);return this};e.prototype.clear=function(){this.attack("");this.food("");this.health("");this.movement("");this.name("");this.range("");this.vision("")};e.prototype.hideUnitStats=function(){$("#unitStats").removeClass("unitStatsShow");$("#unitStats").addClass("unitStatsHide")};e.prototype.showUnitStats=function(){$("#unitStats").removeClass("unitStatsHide");$("#unitStats").addClass("unitStatsShow")};e.prototype.openMenuWindow=function(){var e=$(".pauseMenuContainer").css("z-index",1e3);$("#"+this.id()).append(e);e.show()};e.prototype.closeMenuWindow=function(){$(".pauseMenuContainer").hide()};e.prototype.openSummaryWindow=function(e){e=e||"Summary";$("#summaryTitle").text(e);$("#summaryWindow").show()};e.prototype.closeSummaryWindow=function(){$(".summaryWindow").hide()};e.prototype.summary=function(e,t,n,r){$("#summaryRow1Column2Value").text(e.unitsKilled);$("#summaryRow1Column3Value").text(e.unitsLost);$("#summaryRow2Column2Value").text(e.buildingsCaptured);$("#summaryRow2Column3Value").text("0");$("#summaryRow3Column2Value").text(e.foodCollected);$("#summaryRow3Column3Value").text(e.foodConsumed);$("#summaryRow4Column2Value").text(t);$("#summaryRow4Column3Value").text(n);$("#summaryRewardValue").text(r)}})(bbq.hud.HtmlHud);var bbq=bbq||{};(function(){bbq.TurnClient=function(e,t){if(!t){t={}}if(!t.host){t.host=boc.constants.API_HOST}this.eventManager_=new boc.utils.EventManager(this);this.socket_=null;this.sessionKey=e;this.serverHost=t.host;this.connected=false};var e=bbq.TurnClient;e.prototype.connect=function(){var e=this;io.transports=["xhr-polling","jsonp-polling"];var t=io.connect(this.serverHost,{"force new connection":true});this.socket_=t;t.on("challenge request",function(){console.log("challenge requested");t.emit("challenge response",{origin:location.origin,boc_session:e.sessionKey})});t.on("challenge accepted",function(t){console.log("challenge accepted",t);e.connected=true;e.emit("connect")});t.on("challenge rejected",function(){console.log("challenge rejected");t.disconnect()});t.on("your turn",function(t){console.log("my turn for game id",t);e.emit("your turn",t)});t.on("turn request ended",function(t){console.log("turn request ended",t);e.emit("turn request ended",t)})};e.prototype.disconnect=function(){var e=this;this.socket_.disconnect();e.connected=false;e.emit("disconnect")};e.prototype.wait=function(e){this.socket_.emit("request turn",e)}})();ns("bbq");bbq.Replay=function(e,t,n){var r=navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i);if(!t){t={}}var i=t.em||$em();this._em=i;this._gameEngine=null;this._mapId=null;this._mapObj=null;this._debug=t.__adminKey;this._stop=false;this.gameId=function(){return e};this.currentFrame=0;this.maxFrames=0;this.moves=null;this.players=null;this.neutralPlayer=null;var s=t.canvasId?$("#"+optons.canvasId)[0]:$("canvas")[0];if(!s){throw new Error("No canvas found/given!")}this.camera=new boc.utils.Camera({xmin:0,xmax:s.width,ymin:0,ymax:s.height});var o=this;var u=function(){boc.utils.getJson("get/games",{gameid:e,__adminkey:o._debug},function(t){if(t){if(t.status=="ok"){var n=t.result[0];o._mapId=n.mapid;o.moves=n.moves;o.maxFrames=n.moves.length;var r=[];for(var i in n.state){var s=n.state[i];$em($em.create(i)).add(new bbq.components.Player({id:i,food:s.food,turn:s.turn,team:s.team,upkeep:s.upkeep,buildings:[],units:[],summary:{},lastSeen:s.lastSeen}));if(i=="_neutral_"){o.neutralPlayer=i}else{r.push(i)}}var u=[];for(var f=0;f<r.length;f++){if(e.indexOf("_"+r[f]+"_")==-1){throw"player not found in game."}u.push({playerid:r[f],i:f})}u.sort(function(e,t){return e.i-t.i});o.players=[u[0].playerid,u[1].playerid];a()}else{alert(t.result)}}else{throw new Error("error retrieving game "+e)}})};var a=function(){var e=Math.round(s.width/o.camera.zoom);var t=Math.round(s.height/o.camera.zoom);var n={"padding-left":e/2,"padding-right":e/2,"padding-top":t/2,"padding-bottom":t/2};if(bbq.maps[o._mapId]){o._mapObj=new bbq.Map(o._mapId,$em(),n);f()}else{boc.utils.getJson("get/maps",{mapid:o._mapId,__adminkey:o._debug},function(e){if(!e||e.status!="ok"){throw"map "+o._mapId+" not found!"}else{bbq.maps[o._mapId]=e.result[0];o._mapObj=new bbq.Map(o._mapId,$em(),n);f()}})}};var f=function(){var e=new boc.systems.RenderSystem(i,s);e.camera(o.camera);var t=new boc.systems.CameraFollowSystem(i);var n=new boc.systems.AnimationSystem(i);var u=!r?new boc.systems.MouseInputSystem(i,s):new boc.systems.TouchInputSystem(i,s);var a=new boc.systems.LifespanSystem(i);var f=new boc.systems.PanningCameraSystem(i,e.camera());f.bounds(o._mapObj.bounds());var c=new boc.pfx.systems.BasicParticleSystem(i);var h=new boc.systems.SpriteAnimationSystem(i);var p=new boc.systems.IdentifySystem(i,e.camera());var d=new bbq.systems.MapSelectSystem(i,o.camera);var v=new bbq.systems.ParabolicTranslationSystem(i);var m=new bbq.systems.FogSystem(i,o._mapObj);var g=new boc.systems.UISystem(i);var y=new bbq.systems.UnitSystem(i);var b=new bbq.systems.MoveSystem(i,o._mapObj);var w=new bbq.systems.AttackSystem(i,o._mapObj);var E=new bbq.systems.HealSystem(o._mapObj);var S=new bbq.systems.RevealSystem(o._mapObj);var x=new bbq.systems.UnitCollisionSystem(i,o._mapObj);var T=new boc.systems.DelayedMethodSystem(i);var N=new bbq.systems.HealthSystem(i);var C=new boc.spine.SpineAnimationSystem;var k=new bbq.systems.ReplaySystem(o._mapObj);o._gameEngine=new boc.core.GameEngine([u,f,t,p,g,d,k,y,b,w,E,S,x,n,v,h,C,c,m,N,T,e,a]);o._gameEngine.start();l()};var l=function(){var e=new boc.core.Entity({description:"turn",entityManager:i});e.addComponent(new bbq.components.Turn({playerid:o.moves[0].playerid,number:0}));var t=o.players.concat([o.neutralPlayer]);var r=[];var s=[];for(var u=0;u<t.length;u++){var a="_"+(t[u]==o.neutralPlayer?"neutral":u)+"_";var f=o._mapObj.startState[a];var l=boc.utils.getPlayer(t[u],i);for(var c=0;f.buildings&&c<f.buildings.length;c++){var h=f.buildings[c];var p=bbq.buildings.createBuilding(h,l.team,i);l.buildings.push(p);s.push({bState:h,buildingEnt:p})}for(var d=0;f.units&&d<f.units.length;d++){var v=pState.units[d];var m=bbq.units.createUnit(v,l.team,i);l.units.push(m);r.push({uState:v,unitEnt:m});var g=bbq.units.getLevel(m);if(g>1){bbq.units.levelUp(m,g,true)}}}for(var u=0;u<s.length;u++){var p=s[u].buildingEnt;var h=s[u].bState;o._mapObj.place(p,h.location.x,h.location.y)}for(var u=0;u<r.length;u++){var v=r[u].uState;var m=r[u].unitEnt;o._mapObj.place(m,v.location.x,v.location.y)}o.fog(true);if(n){n(o)}};u()};bbq.Replay.prototype.play=function(){this._stop=false;var e=this;var t=function(){if(e._stop){return}setTimeout(function(){e.forward(t)},100)};t()};bbq.Replay.prototype.pause=function(){_this._gameEngine.pause()};bbq.Replay.prototype.forward=function(e){boc.utils.createEvent(new bbq.components.ReplayScript(this.moves[this.currentFrame].playerid,this.moves[this.currentFrame].command,e),this._em);this.currentFrame++};bbq.Replay.prototype.back=function(){};bbq.Replay.prototype.stop=function(e){this._stop=true};bbq.Replay.prototype.speed=function(e){this._gameEngine.speed(e)};bbq.Replay.prototype.fog=function(e){if(typeof e=="boolean"){if(e){boc.utils.createEvent(new bbq.events.FogEvent({action:"clear"}),this._em);boc.utils.createEvent(new bbq.events.FogEvent({action:"update"}),this._em);boc.utils.createEvent(new bbq.events.FogEvent({action:"draw",forPlayer:boc.utils.getCurrentPlayer(this._em)}),this._em)}else{boc.utils.createEvent(new bbq.events.FogEvent({action:"clear"}),this._em)}}else if(typeof e=="string"){var t=boc.utils.getPlayer(e,this._em);if(t){boc.utils.createEvent(new bbq.events.FogEvent({action:"update"}),this._em);boc.utils.createEvent(new bbq.events.FogEvent({action:"draw",forPlayer:t}),this._em)}}};bbq.Replay.prototype.center=function(e){};ns("bbq.frontend");bbq.frontend._initialFillScreen=false;bbq.frontend.centerElem=function(e){console.log("CENTERING");var t=document.documentElement;var n=t.clientWidth,r=t.clientHeight;var i=(r-e.height())/2,s=(n-e.width())/2;var o=document.getElementsByClassName("pauseMenu")[0];console.log(r,e.height(),o.offsetHeight,i);e.css("top",i+"px").css("left",s+"px")};bbq.frontend.fillScreen=function(){var e=document.documentElement;var t=e.clientWidth,n=e.clientHeight;var r=0,i=0;if(r&&t<r){t=r}if(i&&n<i){n=i}bbq.frontend.width=t;bbq.frontend.height=n;var s=$(".sceneContainer")[0];bbq.frontend._initialFillScreen=true;var o=$("canvas")[0];if(o){o.style.width="";o.style.height="";o.width=t;o.height=n;console.log(t,n)}if(SharedSession&&SharedSession.gameObj&&SharedSession.gameObj.camera){var u=SharedSession.gameObj.camera;if(typeof u==="function"){u=u()}u.update({xmax:u.xmin+t,ymax:u.ymin+n})}var a=$(".hud")[0];if(a){a.style.width=t+"px";a.style.height=n+"px"}var f=$(".toast")[0];if(f&&a){console.log($(a).width());var l=(parseInt($(a).width())-parseInt($(f).width()))/2;var c=150;f.style.left=l.toString()+".px";f.style.top="";f.style.bottom=c.toString()+".px";console.log("toast.style.bottom",f.style.bottom)}$(".autoadjust").each(function(){var e=$(this);var r=(n-e.height())/2,i=(t-e.width())/2;e.css("top",r+"px").css("left",i+"px")});$(".autofill").each(function(){$(this).width(t).height(n)})};window.addEventListener("resize",bbq.frontend.fillScreen,false);bbq.frontend.fadeblackHtml='<div class="fadeBlack hidden autofill" style="display: block;"></div>';bbq.frontend.showYesNo=function(e,t,n,r){var i=$("<div>");var s=$(bbq.frontend.fadeblackHtml);s.width(document.documentElement.clientWidth).height(document.documentElement.clientHeight).css("z-index","1500");$(document.body).append(s);var i=$('<div style="position:absolute;top:0px;left:0px;z-index:2000">');var o="yesNoWindow";var u=$(bbq.UiCache["ui/yesNoWindow.html"]);u.hide();i.attr("id",o).append(u);$(document.body).append(i);var a=(document.documentElement.clientWidth-u.width())/2,f=(document.documentElement.clientHeight-u.height())/2;u.css("left",a+"px").css("top",f+"px");u.addClass("autoadjust");u.slideDown(200);var l=new bbq.scenes.HtmlYesNoWindow(e,t,o);var c=function(){s.remove();i.remove()};l.on("yes",function(){bbq.sh().play(bbq.sh().getAudio("effects/buttonClick"));c();if(n){n()}});l.on("no",function(){bbq.sh().play(bbq.sh().getAudio("effects/buttonClick"));c();if(r){r()}})};bbq.frontend.hideEndTurn=function(){$(".btnEndTurn").hide()};bbq.frontend.showEndTurn=function(){$(".btnEndTurn").show()};bbq.frontend.toast=function(e,t){if(!t){t={}}var n=t.delay||2e3;var r=t.id?$("#"+t.id):$(document.body);var i=$('<div class="toast boxShadowLarge">'+e+"</div>");i.parent(".hud");if(t.more){var s=$("<span></span>");s.css("position","absolute").css("bottom","0px").css("right","5px").css("font-family","MolotRegular").html("More>>").appendTo(i)}if(typeof t.fade=="undefined"){t.fade=true}if(t.fade){i.fadeIn(200)}r.append(i);if(!t.position){t.position="bottom-center"}var o,u,a;if(t.position=="center"){o=t.left||r.width()/2-i.width()/2;u=t.top||r.height()/2-i.height()/2}else{o=t.left||r.width()/2-i.width()/2;a=t.bottom||150}if(typeof u=="number"&&typeof o=="number"){i.css("top",u+"px").css("left",o+"px")}else if(typeof a=="number"&&typeof o=="number"){i.css("bottom",a+"px").css("left",o+"px")}if(n!=-1){setTimeout(function(){if(t.fade){i.fadeOut(200,function(){i.remove()})}else{i.remove()}},n)}return i};bbq.frontend.toggleSound=function(e){if(e==="on"){bbq.sh().allOn()}else{bbq.sh().allOff()}};bbq.frontend.setupScenes=function(e){var t=function(){director.setContainer($("#"+e)[0]);director.push(n["ui/mainMenu3.html"]);var t=director.currentScene().attr("id");var r=new bbq.scenes.HtmlMainMenu(t);r.on("signIn",function(){bbq.sh().play(bbq.sh().getAudio("effects/buttonClick"));var e=encryptedString(boc.utils.API_KEY,$('input[name="username"]').val()+"+"+$('input[name="password"]').val()+"+"+ +(new Date));boc.utils.getJson("login/"+e,{},function(e){if(e.status=="ok"){SharedSession.sessionKey=e.result.boc_session;boc.utils.getJson("userinfo",{},function(e){if(e.status=="ok"){SharedSession.user=new bbq.User(e.result);$(".signIn").hide();$("#mainMenuButtons").show()}else{alert(e.result)}})}else{alert(e.result)}})});var i=function(e){if(e.name==="sound"){r.soundState(e.newValue);bbq.frontend.toggleSound(e.newValue)}};SharedSession.on("settingsChanged",i);r.soundState(SharedSession.settings("sound"));r.on("sound",function(){bbq.sh().play(bbq.sh().getAudio("effects/buttonClick"));var e=SharedSession.settings("sound");SharedSession.settings("sound",e==="on"?"off":"on")});r.on("credits",function(){bbq.sh().play(bbq.sh().getAudio("effects/buttonClick"));director.push(n["ui/credits.html"],function(e){var t=new bbq.scenes.HtmlCredits(e.attr("id"));var n=function(e){if(e.name==="sound"){t.soundState(e.newValue);bbq.frontend.toggleSound(e.newValue)}};SharedSession.on("settingsChanged",n);t.soundState(SharedSession.settings("sound"));t.on("sound",function(){bbq.sh().play(bbq.sh().getAudio("effects/buttonClick"));var e=SharedSession.settings("sound");SharedSession.settings("sound",e==="on"?"off":"on")});t.on("back",function(){bbq.sh().play(bbq.sh().getAudio("effects/buttonClick"));SharedSession.removeListener("settingsChanged",n);director.pop()})})});var s=null;var o=function(e,t){var n=new bbq.hud.HtmlHud(e.attr("id"));var r=$(bbq.frontend.fadeblackHtml);n.on("pause",function(){bbq.sh().play(bbq.sh().getAudio("effects/buttonClick"));r.width(document.documentElement.clientWidth).height(document.documentElement.clientHeight);$(document.body).append(r);n.openMenuWindow()});n.on("menuresume",function(){bbq.sh().play(bbq.sh().getAudio("effects/buttonClick"));r.remove();n.closeMenuWindow()});var i=function(e){if(e.name==="sound"){n.soundState(e.newValue);bbq.frontend.toggleSound(e.newValue)}};SharedSession.on("settingsChanged",i);n.soundState(SharedSession.settings("sound"));n.on("sound",function(){bbq.sh().play(bbq.sh().getAudio("effects/buttonClick"));var e=SharedSession.settings("sound");SharedSession.settings("sound",e==="on"?"off":"on")});if(!t){n.on("menubattles",function(){bbq.sh().play(bbq.sh().getAudio("effects/buttonClick"));SharedSession.removeListener("settingsChanged",i);var e=bbq.sh().getAudio("music/forest");bbq.sh().fadeOut(e,3e3,function(){bbq.sh().reset(e);var t=bbq.sh().getAudio("music/menu");if(t){t.volume=0;bbq.sh().play(t,true);bbq.sh().fadeIn(t,1e3)}});if(SharedSession.turnClient){SharedSession.turnClient.disconnect()}SharedSession.gameObj.stop(function(){n.closeMenuWindow();r.remove();$(".toast").remove();bbq.frontend.refreshMatches(function(){pendingMatches=SharedSession.user.pendingMatches.length;s.refresh(SharedSession.user);SharedSession.user.currentGame=null;director.pop()})})});n.on("menuforfeit",function(){bbq.sh().play(bbq.sh().getAudio("effects/buttonClick"));bbq.frontend.showYesNo("Forfeit","Really forfeit?",function(){SharedSession.gameObj.end(0,function(e){SharedSession.gameObj.collect(function(e){r.remove();n.closeMenuWindow();SharedSession.gameObj.clearFog();bbq.frontend.toast("You lose!",{id:"sceneContainer"});bbq.sh().play(bbq.sh().getAudio("effects/defeat"));var t=SharedSession.gameObj.getPlayer(SharedSession.user.playerid);var i=e.turnTokens+e.foodTokens+e.buildingTokens+e.winBonus.tokens+e.itemBonus.tokens;n.summary(t.summary,t.turn,SharedSession.gameObj.map().avgTurnsToWin(),i);n.openSummaryWindow("You Lose!")})})})});n.on("summarycollect",function(){bbq.sh().play(bbq.sh().getAudio("effects/buttonClick"));$("#sceneContainer").width(document.documentElement.clientWidth).height(document.documentElement.clientHeight);SharedSession.refreshUser(function(e){s.user(e);bbq.frontend.refreshMatches(function(){pendingMatches=e.pendingMatches.length;s.refresh();if(SharedSession.turnClient){SharedSession.turnClient.disconnect()}SharedSession.gameObj.stop(function(){$(".toast").remove();var e=bbq.sh().getAudio("music/forest");bbq.sh().fadeOut(e,3e3,function(){bbq.sh().reset(e);var t=bbq.sh().getAudio("music/menu");if(t){t.volume=0;bbq.sh().play(t,true);bbq.sh().fadeIn(t,1e3)}});bbq.frontend.refreshMatches(function(){pendingMatches=SharedSession.user.pendingMatches.length;s.refresh(SharedSession.user);SharedSession.user.currentGame=null;director.pop()})})})})});n.on("endturn",function(){bbq.sh().play(bbq.sh().getAudio("effects/buttonClick"));if(SharedSession.gameObj.getCurrentPlayer().id==SharedSession.user.playerid){bbq.frontend.showYesNo("End turn","End your turn now?",function(){SharedSession.gameObj.endTurn(function(){bbq.frontend.toast("Waiting for your turn",{id:"sceneContainer",delay:-1});bbq.frontend.hideEndTurn();if(SharedSession.turnClient){SharedSession.turnClient.wait(SharedSession.gameObj.id())}})})}})}else{n.on("menubattles",function(){bbq.sh().play(bbq.sh().getAudio("effects/buttonClick"));SharedSession.removeListener("settingsChanged",i);SharedSession.gameObj.stop(function(){var e=bbq.sh().getAudio("music/forest");bbq.sh().fadeOut(e,3e3,function(){bbq.sh().reset(e);var t=bbq.sh().getAudio("music/menu");if(t){t.volume=0;bbq.sh().play(t,true);bbq.sh().fadeIn(t,1e3)}});n.closeMenuWindow();r.remove();$(".toast").remove();SharedSession.user.currentGame=null;director.pop()})})}n.on("updateStats",function(e){var t=e.unitInfo;n.showUnitStats();console.log(n);n.name(t.displayName);n.attack(t.attackDamage);n.health(t.health);n.range(t.attackMinRange+"-"+t.attackMaxRange);n.movement(t.moveRange);n.vision(t.visionRange);console.log(t)});return n};r.on("battles",function(e){bbq.sh().play(bbq.sh().getAudio("effects/buttonClick"));if(e&&e.element&&$(e.element).attr("disabled")){return}director.push(n["ui/battleMenu3.html"],function(e){var t=e.attr("id");s=new bbq.scenes.HtmlBattleMenu(SharedSession.user,t);var i=s.footer(n["ui/footer.html"]);var u=function(e){if(e.name==="sound"){i.soundState(e.newValue);bbq.frontend.toggleSound(e.newValue)}};SharedSession.on("settingsChanged",u);i.on("sound",function(e){var t=SharedSession.settings("sound");SharedSession.settings("sound",t==="on"?"off":"on")});i.soundState(SharedSession.settings("sound"));s.on("back",function(){bbq.sh().play(bbq.sh().getAudio("effects/buttonClick"));SharedSession.removeListener("settingsChanged",u);director.pop(function(){r.clearSignIn()})});var a=1;s.on("match",function(){bbq.sh().play(bbq.sh().getAudio("effects/buttonClick"));if(a==0){boc.utils.getJson("matchmake",{},function(e){if(e.status=="ok"){bbq.frontend.refreshMatches(function(){a=SharedSession.user.pendingMatches.length;s.refresh(SharedSession.user)})}})}});s.on("refresh",function(){bbq.sh().play(bbq.sh().getAudio("effects/buttonClick"));if(SharedSession&&SharedSession.user){SharedSession.refreshUser(function(e){s.user(e);bbq.frontend.refreshMatches(function(){a=e.pendingMatches.length;s.refresh()})})}});s.on("challengeDecline",function(){});s.on("challengeAccept",function(){});s.on("replayPanel",function(){});s.on("battlePanel",function(e){bbq.sh().play(bbq.sh().getAudio("effects/buttonClick"));var t=$(e.element).attr("gameid");SharedSession.user.currentGame=t;var r=function(e,t,r){var i=function(t){var n=o(t,false);bbq.frontend.gameLoadScripts(e,n,function(){})};if(!t){director.push(n["ui/hud.html"],null,i)}else{director.replace(n["ui/hud.html"],i)}};boc.utils.getJson("get/games",{gameid:t},function(e){if(e&&e.status=="ok"){var t=e.result[0];var o=t;if(o.winner){r(o,false,true)}else if(o.turn==SharedSession.user.playerid&&o.state[SharedSession.user.playerid].turn==1){director.push(n["ui/tribeMemberSelect3.html"],function(e){var t=new bbq.scenes.HtmlTribeMemberSelect(SharedSession.user,$(e).attr("id"));var u=t.footer(n["ui/footer.html"]);var f=function(e){if(e.name==="sound"){u.soundState(e.newValue);bbq.frontend.toggleSound(e.newValue)}};SharedSession.on("settingsChanged",f);u.soundState(SharedSession.settings("sound"));u.on("sound",function(e){bbq.sh().play(bbq.sh().getAudio("effects/buttonClick"));var t=SharedSession.settings("sound");SharedSession.settings("sound",t==="on"?"off":"on")});t.on("back",function(){bbq.sh().play(bbq.sh().getAudio("effects/buttonClick"));SharedSession.removeListener("settingsChanged",f);bbq.frontend.refreshMatches(function(){a=SharedSession.user.pendingMatches.length;s.refresh(SharedSession.user);SharedSession.user.currentGame=null;i.soundState(SharedSession.settings.sound);director.pop()})});t.on("done",function(e){bbq.sh().play(bbq.sh().getAudio("effects/buttonClick"));if(e){var n=e.selected;bbq.frontend.showYesNo("Confirmation","Choose "+n+"?",function(){o.state[SharedSession.user.playerid].unitSet=t.loadout()?bbq.units.configuration.baseLoadout.concat(t.loadout()):bbq.units.configuration.baseLoadout.slice(0);r(o,true)})}else{bbq.frontend.showYesNo("Confirmation","You've not chosen a special unit. Proceed?",function(){o.state[SharedSession.user.playerid].unitSet=t.loadout()?bbq.units.configuration.baseLoadout.concat(t.loadout()):bbq.units.configuration.baseLoadout.slice(0);r(o,true)})}});t.on("unitInfo",function(e){t.showUnitInfoWindow(e.unitType)});t.on("unit",function(e){t.loadout([e.unitType])});t.on("unitPurchase",function(e){bbq.sh().play(bbq.sh().getAudio("effects/buttonClick"));bbq.frontend.showYesNo("Confirmation","Purchase "+bbq.units.configuration[e.unitType].displayName+"?",function(){boc.utils.getJson("purchaseUnit/"+e.unitType,{},function(e){if(e){if(e.status=="ok"){SharedSession.refreshUser(function(n){debugger;t.refresh(n);bbq.frontend.toast(e.result,{id:"sceneContainer"})})}else{bbq.frontend.toast(e.result,{id:"sceneContainer"})}}else{bbq.frontend.toast("Server error, please try again later",{id:"sceneContainer"})}})})});t.on("loadout",function(e){bbq.sh().play(bbq.sh().getAudio("effects/buttonClick"));t.loadout(null)})})}else{r(o)}}})});i.on("purchaseBadges",function(){console.log("purchaseBadges")});i.on("purchaseTokens",function(){console.log("purchaseTokens")});i.on("purchaseExp",function(){console.log("purchaseExp")});if(SharedSession&&SharedSession.user){SharedSession.refreshUser(function(e){s.user(e);bbq.frontend.refreshMatches(function(){a=e.pendingMatches.length;s.refresh()})})}})});r.on("newAccount",function(){bbq.sh().play(bbq.sh().getAudio("effects/buttonClick"));director.push(n["ui/createAccount2.html"],function(e){var t=new bbq.scenes.HtmlCreateAccount(e.attr("id"));t.on("back",function(){bbq.sh().play(bbq.sh().getAudio("effects/buttonClick"));director.pop(function(){r.clearSignIn()})});t.on("create",function(){bbq.sh().play(bbq.sh().getAudio("effects/buttonClick"));if(t.validate()){boc.utils.getJson("createuser",{name:$('input[name="displayName"]').val(),email:$('input[name="create_email"]').val(),password:encryptedString(boc.utils.API_KEY,"^$"+$('input[name="create_password"]').val()),recaptcha_challenge_field:Recaptcha.get_challenge(),recaptcha_response_field:Recaptcha.get_response(),recaptcha_ignore:true},function(e){if(e.status=="ok"){alert(e.result);director.pop(function(){r.clearSignIn()})}else{t.showMessageBox(e.result);Recaptcha.reload()}})}})})});r.on("myTribe",function(e){if(e&&e.element&&$(e.element).attr("disabled")){return}director.push(n["ui/myTribe.html"],function(e){var t=new bbq.scenes.HtmlMyTribe(SharedSession.user,e.attr("id"));t.on("back",function(){director.pop(function(){r.clearSignIn()})});var i=t.footer(n["ui/footer.html"]);i.on("purchaseBadges",function(){console.log("myTribe purchaseBadges")});i.on("purchaseTokens",function(){console.log("myTribe purchaseTokens")});i.on("purchaseExp",function(){console.log("myTribe purchaseExp")})})});r.on("friends",function(e){if(e&&e.element&&$(e.element).attr("disabled")){return}director.push(n["ui/friends.html"],function(e){var t=new bbq.scenes.HtmlFriends(SharedSession.user,e.attr("id"));t.on("back",function(){director.pop(function(){r.clearSignIn()})});t.on("add",function(){console.log("add friend!")});var i=t.footer(n["ui/footer.html"]);i.on("purchaseBadges",function(){console.log("friends purchaseBadges")});i.on("purchaseTokens",function(){console.log("friends purchaseTokens")});i.on("purchaseExp",function(){console.log("friends purchaseExp")})})});r.on("tutorial",function(e){bbq.sh().play(bbq.sh().getAudio("effects/buttonClick"));var t={};for(var r in bbq.tutorialGameState){t[r]=bbq.tutorialGameState[r];if(r==="state"){t.state={};for(var i in bbq.tutorialGameState[r]){t.state[i]=bbq.tutorialGameState[r][i]}}}var s=t.state.$playerid;delete t.state.$playerid;t.state[SharedSession.user.playerid]=s;t.turn=SharedSession.user.playerid;var u=function(e){var n=o(e,true);debugger;bbq.frontend.gameLoadScripts(t,n,function(){},true)};director.push(n["ui/hud.html"],null,u)});r.on("logout",function(e){bbq.sh().play(bbq.sh().getAudio("effects/buttonClick"));$(".signIn").show();$("#mainMenuButtons").hide();r.clearSignIn()})};var n=bbq.UiCache;n.loadUi("ui/",["credits.html","battleMenu3.html","mainMenu3.html","friends.html","footer.html","myTribe.html","myChieftain.html","createAccount2.html","hud.html","tribeMemberSelect3.html","yesNoWindow.html","unitInfoWindow.html"],function(){t()},["ui.css","ui2.css"])};bbq.frontend.GameHUD={sharedSession:null,rootDiv:null,init:function(e,t,n){bbq.frontend.GameHUD.rootDiv=n;$("#game_btngame_menuShow").click(function(){$(this).hide();$("#game_menu").show();$(".game_battleNavBg").slideDown("fast");$("#game_menu .panel").slideDown("fast",function(){if(t&&t.onMenuShow){t.onMenuShow()}})});$("#game_btngame_menuClose").click(function(){$("#game_menu .panel").slideUp("fast",function(){$("#game_menu").hide();$("#game_btngame_menuShow").show()});$(".game_battleNavBg").slideUp("fast");if(t&&t.onMenuHide){t.onMenuHide()}});for(var r=0;r<e.length;r++){$("#"+e[r].id).click(e[r].callback)}},YesNoModalWindow:function(e,t,n){var r=this;var i=$("<div>").addClass("game_fadeScreen");var s=$("<div>").addClass("panel game_dialog");$(i).append(s);var o=$("<div>").addClass("game_dialogText").text(e);var u=$("<div>").addClass("game_dialogButtons");var a=$("<div>").addClass("button").css("margin-left","5px").css("margin-right","5px").text("Yes").click(function(){if(t){t()}r.remove()});var f=$("<div>").addClass("button").css("margin-left","5px").css("margin-right","5px").text("No").click(function(){if(n){n()}r.remove()});$(u).append(a).append(f);$(s).append(o).append(u);this.show=function(){$(bbq.frontend.GameHUD.rootDiv).append(i)};this.remove=function(){$(i).remove()}},ToastWindow:function(e,t){if(t&&!isNaN(t)){t={duration:t}}var n=this;var r=$("<div>").addClass("toast").addClass("boxShadowLarge").text(e).hide();if(t&&t.duration){setTimeout(function(){n.remove(t.onremove)},t.duration)}$(bbq.frontend.GameHUD.rootDiv).append(r);$(r).css("left",($(bbq.frontend.GameHUD.rootDiv).width()-$(r).width())/2+"px");$(r).fadeIn("fast");this.remove=function(e){$(r).fadeOut("fast",function(){$(this).remove();if(e){e()}})}},CurrentBattles:{add:function(e){var t=$("<div>").addClass("game_battlePanel").addClass("button").addClass("scroll");var n=$("<div>").addClass("game_vsAvatar");var r=$("<div>").addClass("game_vsName").text(e.opponent);var i=$("<div>").addClass("game_vsDesc").text(e.description);$(t).append(n).append(r).append(i);$(t).click(e.onclick);$(".game_battleNav").append(t)},clear:function(){$(".game_battleNav").empty()}},SummaryWindow:function(e,t,n){var r="";var i=this;if(e==SharedSession.user.playerid){r="You win!"}else{r="You lose!"}$(".game_summaryBg_root").show();$(".game_summaryBg").slideDown("fast");this.onContinueClick=null;$(".game_summaryContinue").click(function(){$(".game_summaryBg").slideUp("fast",function(){$(".game_summaryBg_root").hide()});if(i.onContinueClick){i.onContinueClick()}});$(".game_summaryTitle").text(r);$("#summary_unitsKilled").text(t.unitsKilled?t.unitsKilled:0);$("#summary_unitsLost").text(t.unitsLost?t.unitsLost:0);$("#summary_unitsTokens").text("+"+n.unitTokens);$("#summary_foodGathered").text(t.foodCollected?t.foodCollected:0);$("#summary_foodConsumed").text(t.foodConsumed?t.foodConsumed:0);$("#summary_foodTokens").text("+"+n.foodTokens);$("#summary_buildingsCaptured").text(t.buildingsCaptured?t.buildingsCaptured:0);$("#summary_buildingsLost").text(t.buildingsLost?t.buildingsLost:0);$("#summary_buildingsTokens").text("+"+n.buildingTokens);$("#summary_turnsTotal").text(t.turns?t.turns:0);$("#summary_turnsTokens").text("+"+n.turnTokens);$("#summary_totalXP").text("+"+(n.preBonusTotal.xp+n.winBonus.xp+n.itemBonus.xp));$("#summary_totalTokens").text("+"+(n.preBonusTotal.tokens+n.winBonus.tokens+n.itemBonus.tokens))},ModalWindow:function(e,t){var n=this;var r=$("<div>").addClass("game_fadeScreen");if(t){r.attr("id",t)}var i=$("<div>").addClass("panel game_dialog");$(r).append(i);var s=$("<div>").addClass("game_dialogTextVertical").text(e);$(i).append(s);this.show=function(e){if(!e){e=bbq.frontend.GameHUD.rootDiv}$(e).append(r)};this.remove=function(){$(r).remove()}}};bbq.frontend.waitForTurnToast=null;bbq.frontend.waitForTurnTid=null;bbq.frontend.waitForTurnInterval=5e3;bbq.frontend.waitForTurn=function(){if(bbq.frontend.waitForTurnTid){clearTimeout(bbq.frontend.waitForTurnTid)}if(SharedSession.gameObj.winner()){}else{boc.utils.getJson("get/games",{gameid:SharedSession.gameObj.id(),_fields:"turn"},function(e){if(e.status=="ok"){var t=e.result[0].turn;if(t==SharedSession.user.playerid){if(bbq.frontend.waitForTurnToast){bbq.frontend.waitForTurnToast.remove();bbq.frontend.waitForTurnToast=null}boc.utils.getJson("get/games",{gameid:SharedSession.gameObj.id()},function(e){if(e&&e.status=="ok"){gameState=e.result[0];SharedSession.gameObj.load(gameState);new bbq.frontend.GameHUD.ToastWindow("Your turn!",3e3);bbq.frontend.showEndTurn()}})}else{if(!bbq.frontend.waitForTurnToast){bbq.frontend.waitForTurnToast=new bbq.frontend.GameHUD.ToastWindow("Waiting for "+t+"'s turn!")}bbq.frontend.waitForTurnTid=setTimeout(function(){bbq.frontend.waitForTurn()},bbq.frontend.waitForTurnInterval)}}})}};bbq.frontend.refreshMatches=function(e){SharedSession.user.pendingMatches=[];SharedSession.user.activeMatches=[];SharedSession.user.retiredMatches=[];SharedSession.user.pendingChallengeRequests=[];SharedSession.user.pendingChallengeReplies=[];boc.utils.getJson("getmatches",{playerid:SharedSession.user.playerid},function(t){if(t.status=="ok"){for(var n=0;n<t.result.length;n++){var r=t.result[n].status;if(r=="pending"){SharedSession.user.pendingMatches.push(new bbq.Match(t.result[n]))}else if(r=="active"){SharedSession.user.activeMatches.push(new bbq.Match(t.result[n]))}else if(r=="retired"){SharedSession.user.retiredMatches.push(new bbq.Match(t.result[n]))}else if(r=="challenging"){SharedSession.user.pendingChallengeRequests.push(new bbq.Match(t.result[n]))}else if(r=="challenged"){SharedSession.user.pendingChallengeReplies.push(new bbq.Match(t.result[n]))}}SharedSession.user.pendingMatches.sort(function(e,t){return t.lastupdate-e.lastupdate});SharedSession.user.activeMatches.sort(function(e,t){return t.lastupdate-e.lastupdate});SharedSession.user.retiredMatches.sort(function(e,t){return t.lastupdate-e.lastupdate});SharedSession.user.pendingChallengeRequests.sort(function(e,t){return t.lastupdate-e.lastupdate});SharedSession.user.pendingChallengeReplies.sort(function(e,t){return t.lastupdate-e.lastupdate})}if(e){e()}})};bbq.frontend.handleSurrender=function(){SharedSession.gameObj.end("0",function(e){bbq.frontend.handleCollect(e)})};bbq.frontend.handleUserWin=function(){SharedSession.gameObj.end("1",function(e){bbq.frontend.handleCollect(e)})};bbq.frontend.handleCollect=function(e){SharedSession.gameObj.collect(function(t){var n=boc.utils.getPlayer(SharedSession.user.playerid);var r=n.summary;r.turns=n.turn;var i=new bbq.frontend.GameHUD.SummaryWindow(e,r,t);i.onContinueClick=function(){bbq.frontend.handleGameWin(e);SharedSession.refreshUser()}})};bbq.frontend.handleGameWin=function(e){new bbq.frontend.GameHUD.ToastWindow("Game over! Winner is "+e+"!",6e3);SharedSession.gameObj.clearFog()};bbq.frontend.onScriptLoaded=function(e,t,n,r){var i=function(){var i=boc.core.Entity_internal.em();i.clear();var s=null;var o=$("canvas")[0];if(!o){o=document.createElement("canvas");o.classList.add("viewport")}t.canvas(o);bbq.frontend.fillScreen();if(!r){var s=new bbq.Game({gameState:e,canvas:o,entityManager:i,user:SharedSession.user,hud:t,onLoad:function(e){var r=bbq.sh().getAudio("music/forest");if(r){r.volume=0;bbq.sh().play(r,true);bbq.sh().fadeIn(r)}e.victoryCondition=bbq.VictoryConditions.captureHQ;e.onvictory=function(){e.end(1,function(n){e.collect(function(n){e.clearFog();var r=bbq.sh().getAudio("music/forest");bbq.sh().fadeOut(r,3e3,function(){var e=bbq.sh().getAudio("effects/victory");bbq.sh().play(e);bbq.sh().fadeOut(e,450,function(){bbq.sh().fadeIn(r)})});bbq.frontend.toast("You win!",{id:"sceneContainer"});var i=SharedSession.gameObj.getPlayer(SharedSession.user.playerid);var s=n.turnTokens+n.foodTokens+n.buildingTokens+n.winBonus.tokens+n.itemBonus.tokens;t.summary(i.summary,i.turn,SharedSession.gameObj.map().avgTurnsToWin(),s);t.openSummaryWindow("You Win!")})})};e.start();$(".toast").remove();SharedSession.gameObj=e;var i=e.winner();if(i){SharedSession.gameObj.collect(function(n){e.clearFog();var r=i===SharedSession.user.playerid;bbq.frontend.toast("You "+(r?"win":"lose")+"!",{id:"sceneContainer"});var s=SharedSession.gameObj.getPlayer(SharedSession.user.playerid);var o=n.turnTokens+n.foodTokens+n.buildingTokens+n.winBonus.tokens+n.itemBonus.tokens;t.summary(s.summary,s.turn,SharedSession.gameObj.map().avgTurnsToWin(),o);bbq.sh().play(bbq.sh().getAudio(r?"effects/victory":"effects/defeat"));t.openSummaryWindow(r?"You win!":"You lose!")})}else{if(SharedSession.turnClient){SharedSession.turnClient.disconnect()}SharedSession.turnClient=new bbq.TurnClient(SharedSession.sessionKey);SharedSession.turnClient.on("connect",function(){if(SharedSession.user.playerid!=SharedSession.gameObj.getCurrentPlayer().id)SharedSession.turnClient.wait(SharedSession.gameObj.id())});SharedSession.turnClient.on("disconnect",function(){});SharedSession.turnClient.on("your turn",function(e){SharedSession.gameObj.load(e,function(){$(".toast").remove();bbq.frontend.toast("Your turn",{id:"sceneContainer"});bbq.frontend.showEndTurn()})});SharedSession.turnClient.connect();if(SharedSession.user.playerid!=e.getCurrentPlayer().id){bbq.frontend.toast("Waiting for your turn",{id:"sceneContainer",delay:-1});bbq.frontend.hideEndTurn()}else{bbq.frontend.toast("Your turn",{id:"sceneContainer"});bbq.frontend.showEndTurn()}}if(n){n()}}})}else{var u=new bbq.Tutorial("tutorial",{gameState:e,canvas:o,entityManager:i,user:SharedSession.user,hud:t},function(e){var t=bbq.sh().getAudio("music/forest");if(t){t.volume=0;bbq.sh().play(t,true);bbq.sh().fadeIn(t)}$(".toast").remove();SharedSession.gameObj=e;if(n){n()}})}};var s=0;var o=function(){var e=4;if(++s==e){i()}};boc.sm().loadFiles(bbq.assets.sounds,o);boc.resources.GraphicsManager.loadFiles(["assets/graphics/pfx_smoke_small.png","assets/graphics/pfx_star_small.png","assets/graphics/attackButton.png","assets/graphics/cancelButton.png","assets/graphics/captureButton.png","assets/graphics/gatherButton.png","assets/graphics/trainButton.png","assets/graphics/holdButton.png","assets/graphics/moveButton.png","assets/graphics/healButton.png","assets/graphics/revealButton.png","assets/graphics/forestTiles.png","assets/graphics/tutorial_arrow.png","ui/images/icon_food_small.png"],o);boc.resources.GraphicsManager.load(bbq.assets.graphics,o);var u=[];var a=bbq.units.configuration.baseLoadout;a=a.concat(bbq.units.configuration.unlockableUnits);for(var f=0;f<a.length;f++){u.push(bbq.units.configuration[a[f]].spinePath)}var l=["blue","red"];boc.spine.loadSpineAssets(u,{teams:l,onload:function(e){boc.spine.SkeletonManager.load(e);for(var t=0;t<a.length;t++){for(var n=0;n<l.length;n++){var r=l[n];var i=boc.resources.GraphicsManager.getImage(a[t]+"_"+r);if(!i){var s=document.createElement("canvas");s.width=100;s.height=100;var u=s.getContext("2d");var f=boc.spine.SkeletonManager.createSkeleton(a[t].toLowerCase()+"_"+r,{x:50,y:-50});f.setSkinByName("defaultSkin");f.setSlotsToSetupPose();boc.spine.renderSkeleton(f,u);i=document.createElement("img");i.width=100;i.height=100;i.src=s.toDataURL();boc.resources.GraphicsManager.addImage(a[t]+"_"+r,i)}}}o()}})};bbq.frontend.gameLoadScripts=function(e,t,n,r){bbq.frontend.toast("Loading...",{id:"sceneContainer",delay:-1,position:"center",fade:false});var i=bbq.sh().getAudio("music/menu");bbq.sh().fadeOut(i,4e3,function(){bbq.sh().reset(i)});if(!SharedSession.user.scriptsLoaded){var s=["assets/graphics/graphics.js"].concat(include.bbq_deferred||[]);var o=0;for(var u=0;u<s.length;u++){var a=document.createElement("script");a.type="text/javascript";a.src=s[u];a.onload=function(){o++;if(o==s.length){SharedSession.user.scriptsLoaded=true;bbq.frontend.onScriptLoaded(e,t,n,r)}};document.getElementsByTagName("head")[0].appendChild(a)}}else{bbq.frontend.onScriptLoaded(e,t,n,r)}};var windowsOpened=0;var windowStack=new Array;bbq.frontend.setupDirector=function(){boc.utils.requestApiKey();(function(e){function i(e,t){if(e==n){$(r[e]).css("display","");if(t){t()}return}$(r[e]).css("display","");var i="-="+($(r[e]).position().left-$(r[n]).position().left);var s=0;for(var o=0;o<r.length;o++){$(r[o]).animate({left:i},350,function(){s++;if(s==r.length&&t){t()}})}}function s(e,t){$('a[href="'+t.src+'"]').attr("href","#").click(function(){director.pop()});for(var n=0;n<t.links.length;n++){(function(e){$('a[href="'+e.src+'"]').attr("href","#").click(function(){if(!$(this).attr("disabled")){director.push(e.src,e.onsceneload,e.onsceneunload,e.onscrollend,e.onreplaceend)}})})(t.links[n])}}var t=null;var n=0;var r=[];window.director={};director.setContainer=function(e){t=e};var o=null;var u=null;var a=[];director.setStoryboard=function(e){o=e;u=e;a.push(u);director.push(u.src,u.onsceneload,u.onsceneunload,u.onscrollend,u.onreplaceend)};director.push=function(e,f,l,c,h){var p=$("<div>").addClass("scene").addClass("noSelect").addClass("noDrag").css("display","none");p.onsceneload=f;p.onsceneunload=l;p.onpushscrollend=c;p.onreplaceend=h;p.load(e,function(){r.push(p);$(t).append(this);s(p,u);if(o){var f=false;for(var l=0;l<u.links.length;l++){if(u.links[l].src===e){a.push(u);u=u.links[l];f=true;break}}if(!f){a.push(u)}}if(r.length==1){$(p).css("display","");if(p.onsceneload){p.onsceneload()}return}var c=$(r[n]).position().left+$(r[n]).width();$(p).css("left",c+"px");if(p.onsceneload){p.onsceneload()}i(n+1,function(){if(p.onpushscrollend){p.onpushscrollend()}n++})})};director.pop=function(){if(o){a.pop();u=a[a.length-1]}if(n==0){var e=r.pop();if(e.onsceneunload){e.onsceneunload()}$(e).remove();return}if(r[n-1].onload){r[n-1].onload()}i(n-1,function(){var e=r.pop();if(e.onsceneunload){e.onsceneunload()}$(e).remove();n--})};director.replace=function(){$(scene).css("left",$(r[n]).css("left"));if(r[n].onsceneunload){r[n].onsceneunload()}$(r[n]).remove();$(t).append(scene);r[n]=scene;armScene(scene);if(scene.onsceneload){scene.onsceneload()}if(scene.onreplaceend){scene.onreplaceend()}};director.currentScene=function(){return r[n]}})("sceneContainer");$(document).ready(function(){var e={src:"mainMenu3.html",onsceneload:function(){},links:[{src:"createAccount.html",onsceneload:function(){},links:[]},{src:"battleMenu3.html",onsceneload:function(){},onsceneunload:function(){var e=this.find("#battle_backButton")[0];if(e&&e.clearAutoRefresh){e.clearAutoRefresh()}},links:[]},{src:"myChieftain.html",onsceneload:function(){},links:[]},{src:"myTribe.html",onsceneload:function(){},links:[]},{src:"friends.html",onsceneload:function(){},links:[]}]};director.setContainer($("#sceneContainer")[0]);director.setStoryboard(e)})};bbq.frontend.setupBattleMenu=function(){function e(){$(".footerLevel .footerLevelValue").text(SharedSession.user.level);$(".footerLevel .footerValue").text(SharedSession.user.playerid);$(".footerBattleBadges .footerValue").text(SharedSession.user.skulls);$(".footerTribeTokens .footerValue").text(SharedSession.user.shields)}function f(){bbq.frontend.refreshMatches(function(){function v(e,t){var n=+$(e).attr("index");var r=SharedSession.user.pendingChallengeReplies[n];boc.utils.getJson("battle/"+t,{matchid:r.matchid,challengeid:r.challengeid},function(e){if(e){if(e.status=="ok"){f()}else{alert(e.result)}}})}$(".section").empty();for(var c=0;c<SharedSession.user.pendingMatches.length;c++){var h=SharedSession.user.pendingMatches[c];$(n).addClass("searching").attr("matchid",h.matchid).prependTo($("#currentBattles"))}t=SharedSession.user.pendingMatches.length;for(var c=0;c<SharedSession.user.pendingChallengeReplies.length;c++){var h=SharedSession.user.pendingChallengeReplies[c];$(o.replace(/\$friendName/g,h.opponent).replace(/\$i/g,c)).addClass("challengeReply").prependTo($("#currentBattles"))}for(var c=0;c<SharedSession.user.pendingChallengeRequests.length;c++){var h=SharedSession.user.pendingChallengeRequests[c];$(u.replace(/\$friendName/g,h.opponent).replace(/\$i/g,c)).prependTo($("#currentBattles"))}var p=[];for(var c=0;c<SharedSession.user.activeMatches.length;c++){var h=SharedSession.user.activeMatches[c];if(h.winner){var d=SharedSession.user.playerid==h.winner?"win":"lose";$(a.replace("$opponent",h.opponent).replace("$winlose",d)).attr("matchid",h.matchid).attr("gameid",h.gameid).attr("winner",h.winner).prependTo($("#currentBattles"))}else if(h.turn==SharedSession.user.playerid){$(r.replace("$mapid",h.mapid).replace("$opponent",h.opponent)).attr("matchid",h.matchid).attr("gameid",h.gameid).appendTo($("#currentBattles"))}else{p.push(h)}}p.reverse();while(p.length>0){var h=p.pop();if(h.winner){var d=SharedSession.user.playerid==h.winner?"win":"lose";$(a.replace("$opponent",h.opponent).replace("$winlose",d)).attr("matchid",h.matchid).attr("gameid",h.gameid).attr("winner",h.winner).prependTo($("#currentBattles"))}else{$(i.replace("$mapid",h.mapid).replace("$opponent",h.opponent)).attr("matchid",h.matchid).attr("gameid",h.gameid).appendTo($("#currentBattles"))}}for(var c=0;c<SharedSession.user.retiredMatches.length;c++){var h=SharedSession.user.retiredMatches[c];$(s.replace("$mapid",h.mapid).replace("$opponent",h.opponent)).attr("matchid",h.matchid).attr("gameid",h.gameid).appendTo($("#finishedBattles"))}$(".challengeReply .btnDecline").click(function(){v(this,"decline")});$(".challengeReply .btnAccept").click(function(){v(this,"accept")});$(".battlePanel").click(function(){SharedSession.user.currentGame=$(this).attr("gameid");var t=new bbq.frontend.GameHUD.ModalWindow("Loading...");var n,r;if(n=$(this).attr("winner")){r=function(){t.remove();bbq.frontend.handleCollect(n)}}else{r=function(){t.remove()}}director.push("game2.html",function(){clearTimeout(l);t.show($("canvas").parent(),"loadingDiv")},function(){SharedSession.user.currentGame=null;f();e()},function(){bbq.frontend.gameLoadScripts(r)})});$(".replayPanel").click(function(){})})}function c(){var e=$(".searching");var t=false;var n=0;for(var r=0;r<e.length;r++){(function(r){boc.utils.getJson("get/matches",{matchid:r,_fields:"status"},function(r){if(r.status=="ok"){for(var i=0;i<r.result.length;i++){if(r.result[i].status=="active"){t=true}}}n++;if(n==e.length&&t){f()}})})($(e[r]).attr("matchid"))}l=setTimeout(function(){c()},5e3)}$("#footer").load("footer.html",function(){e()});$("#purchaseWindow").load("purchaseWindow.html");$(".section").empty();var t=1;var n='<div class="btnBattle btnBattleMargin"><div class="btnBattleChiefImage iconPlaceholder"></div><div class="btnBattleBg btnBattleYourTurnImage"><div class="btnBattleContent"><div class="btnBattleUsername">Finding opponent...</div></div></div></div>';var r='<div class="btnBattle btnBattleMargin battlePanel"><div class="btnBattleChiefImage iconPlaceholder"></div><div class="btnBattleBg btnBattleYourTurnImage"><div class="btnBattleContent"><div class="btnBattleUsername">$opponent</div><div class="btnBattleMap">$mapid</div><div class="btnBattleTurn">Your turn</div></div></div></div>';var i='<div class="btnBattle btnBattleMargin battlePanel"><div class="btnBattleChiefImage iconPlaceholder"></div><div class="btnBattleBg btnBattleWaitingImage"><div class="btnBattleContent"><div class="btnBattleUsername">$opponent</div><div class="btnBattleMap">$mapid</div><div class="btnBattleTurn">Waiting...</div></div></div></div>';var s='<div class="btnBattle btnBattleMargin replayPanel"><div class="btnBattleChiefImage iconPlaceholder"></div><div class="btnBattleBg btnBattleFinishedImage"><div class="btnBattleContent"><div class="btnBattleUsername">$opponent</div><div class="btnBattleMap">$mapid</div><div class="btnBattleResult btnBattleVictory"></div></div></div></div>';var o='<div class="btnBattle btnBattleMargin"><div class="btnBattleChiefImage iconPlaceholder"></div><div class="btnBattleBg btnBattleYourTurnImage"><div class="btnBattleContent"><div class="btnBattleUsername" style="text-align:right">$friendName</div><div class="btnBattleMap">has challenged you!</div><div style="margin-top:35px"><div index="$i" class="btnAccept" style="margin-left:5px" ></div><div index="$i" class="btnDecline" ></div></div></div></div></div>';var u='<div class="btnBattle btnBattleMargin"><div class="btnBattleChiefImage iconPlaceholder"></div><div class="btnBattleBg btnBattleWaitingImage"><div class="btnBattleContent"><div class="btnBattleMap">Challenging</div><div class="btnBattleUsername" style="text-align:right">$friendName</div><div class="btnBattleMap">Awaiting reply</div></div></div></div>';var a='<div class="btnBattle btnBattleMargin battlePanel"><div class="btnBattleChiefImage iconPlaceholder"></div><div class="btnBattleBg btnBattleYourTurnImage"><div class="btnBattleContent"><div class="btnBattleUsername" style="text-align:right">$opponent</div><div class="btnBattleMap">You\'ve $winlose! Click to collect.</div></div></div></div>';var l=null;$("#battlematch").click(function(){if(t==0){boc.utils.getJson("matchmake",{},function(e){if(e.status=="ok"){$(n).addClass("searching").attr("matchid",e.result.matchid).prependTo($("#currentBattles"));t=1}})}});$("#battle_backButton")[0].clearAutoRefresh=function(){clearTimeout(l)};f();c()};bbq.frontend.setupFriends=function(){function e(e,t){boc.utils.post("friend/"+t,{playerid:e},function(e){if(e&&e.status=="ok"){}else{alert("something went wrong with friend "+t)}n()})}function t(){if(typeof SharedSession!="undefined"){$("#friendContainer").empty();var t='<div class="btnBattle btnBattleMargin"><div class="btnBattleChiefImage iconPlaceholder"></div><div class="btnBattleBg btnBattleFinishedImage"><div class="btnBattleContent"><div class="btnBattleMap">Waiting for</div><div class="btnBattleUsername" style="text-align:right">$friendName</div> <div class="btnBattleMap">to reply</div></div></div></div>';var n='<div class="btnBattle btnBattleMargin"><div class="btnBattleChiefImage iconPlaceholder"></div><div class="btnBattleBg btnBattleWaitingImage"><div class="btnBattleContent"><div class="btnBattleMap">Request from</div><div class="btnBattleUsername" style="text-align:right">$friendName</div><div style="margin-top:35px"><div id="acceptBtn$i" class="btnAccept" style="margin-left:5px" ></div><div id="declineBtn$i" class="btnDecline" ></div></div></div></div></div>';var r='<div class="btnBattle btnBattleMargin"><div class="btnBattleChiefImage iconPlaceholder"></div><div class="btnBattleBg btnBattleYourTurnImage"><div class="btnBattleContent"><div class="btnBattleUsername">$friendName</div><div id="unfriendBtn$i" class="windowUniversalCompactButton btnUnfriend"></div><div id="battleBtn$i" class="windowUniversalCompactButton btnBattleFriend"></div></div></div></div>';for(var i=0;i<SharedSession.user.pendingFriendResponses.length;i++){var s=SharedSession.user.pendingFriendResponses[i];$("#friendContainer").append($(n.replace("$friendName",s).replace(/\$i/g,i)));(function(t,n){$("#acceptBtn"+n).click(function(){e(t,"confirm")});$("#declineBtn"+n).click(function(){e(t,"decline")})})(s,i)}for(var i=0;i<SharedSession.user.friends.length;i++){var s=SharedSession.user.friends[i];$("#friendContainer").append($(r.replace("$friendName",s).replace(/\$i/g,i)));(function(e,t){$("#battleBtn"+i).click(function(){boc.utils.getJson("battle/challenge",{opponentid:e},function(e){if(e){alert(e.result)}})});$("#unfriendBtn"+i).click(function(){})})(s,i)}for(var i=0;i<SharedSession.user.pendingFriendRequests.length;i++){var s=SharedSession.user.pendingFriendRequests[i];$("#friendContainer").append($(t.replace("$friendName",s).replace(/\$i/g,i)))}}}function n(){if(typeof SharedSession!="undefined"&&boc.utils.getJson){SharedSession.user.friends=[];SharedSession.user.pendingFriendRequests=[];SharedSession.user.pendingFriendResponses=[];boc.utils.getJson("get/friends",{playerid:SharedSession.user.playerid},function(e){if(e.status=="ok"){for(var n=0;n<e.result.length;n++){var r=e.result[n];if(r.requestStatus=="confirm"){SharedSession.user.friends.push(r.friendid)}else if(r.requestStatus=="pending"){SharedSession.user.pendingFriendRequests.push(r.friendid)}}boc.utils.getJson("get/friends",{friendid:SharedSession.user.playerid,requestStatus:"pending"},function(e){if(e.status=="ok"){for(var n=0;n<e.result.length;n++){var r=e.result[n];SharedSession.user.pendingFriendResponses.push(r.playerid)}t()}else{alert("failed friend retrieval!!")}})}else{alert("failed friend retrieval!!")}})}}$("#btnAddFriend").click(function(){showWindow("#addFriendWindow")});$("#addFriendClose").click(function(){hideWindow()});$("#footer").load("footer.html",function(){if(typeof SharedSession!="undefined"){$(".footerLevel .footerLevelValue").text(SharedSession.user.level);$(".footerLevel .footerValue").text(SharedSession.user.playerid);$(".footerBattleBadges .footerValue").text(SharedSession.user.skulls);$(".footerTribeTokens .footerValue").text(SharedSession.user.shields)}});$("#purchaseWindow").load("purchaseWindow.html");debugger;$("#friendContainer").empty();n();$("#friendSend").click(function(){boc.utils.post("friend/request",{playerid:$("#friendName").val()},function(e){if(e&&e.status=="ok"){n()}else{alert(e.result)}hideWindow()})})};bbq.frontend.setupCreateAccount=function(){$("#addFriendClose").click(function(){hideWindow()});$("#footer").load("footer.html");$("#purchaseWindow").load("purchaseWindow.html");Recaptcha.create(RECAPTCHA_KEY,"recaptchaDiv",{theme:"custom",custom_theme_widget:"recaptchaCustomWidget",callback:function(){}});$("#btnCreateAccount").click(function(){if($('input[name="create_email"]').val()==""){$(".createAccountMessageBg").text("Email must be non-empty!").show();return}if($('input[name="displayName"]').val()==""){$(".createAccountMessageBg").text("Name must not be empty!").show();return}if($('input[name="create_password"]').val()==""){$(".createAccountMessageBg").text("Password must not be empty!").show();return}if($('input[name="create_password"]').val()!=$('input[name="confirm_password"]').val()){$(".createAccountMessageBg").text("Passwords don't match!").show();return}boc.utils.getJson("createuser",{name:$('input[name="displayName"]').val(),email:$('input[name="create_email"]').val(),password:encryptedString(boc.utils.API_KEY,"^$"+$('input[name="create_password"]').val()),recaptcha_challenge_field:Recaptcha.get_challenge(),recaptcha_response_field:Recaptcha.get_response()},function(e){if(e.status=="ok"){alert(e.result);$("#create_back").click()}else{$(".createAccountMessageBg").text(e.result);Recaptcha.reload()}})})};bbq.frontend.setupMainMenu=function(){$("input[name='password']").keyup(function(e){if(e.keyCode==13){$(".btn_signIn").click()}});$(".btn_signIn").click(function(){var e=encryptedString(boc.utils.API_KEY,$('input[name="username"]').val()+"+"+$('input[name="password"]').val()+"+"+ +(new Date));boc.utils.getJson("login/"+e,{},function(e){if(e.status=="ok"){SharedSession.sessionKey=e.result.boc_session;boc.utils.getJson("userinfo",{},function(e){if(e.status=="ok"){SharedSession.user=new bbq.User(e.result);$(".disabled").removeClass("disabled");$("a").removeAttr("disabled");$(".signIn").hide();$("#mainMenuButtons").show();debugger}else{alert(e.result)}})}else{alert(e.result)}})})};bbq.frontend.setupGame=function(e){if(e&&e.width){bbq.frontend.width=e.width}if(e&&e.height){bbq.frontend.height=e.height}var t=function(e){e.preventDefault()};document.addEventListener("touchmove",t)};ns("bbq");bbq.tutorialGameState={gameid:"game_$playerid_computer_1234",lastupdate:1378848826338,mapid:"tutorial",turn:"$playerid",winner:null,state:{$playerid:{food:500,turn:1,team:"Blue",unitSet:{0:"Harvester",selected_:-1,length:1},upkeep:false,buildings:[{type:"HQ",location:{x:1,y:8},turnsUntilCapture:3},{type:"Hut",location:{x:1,y:5},turnsUntilCapture:2}],units:[],lastSeen:{}},Computer:{food:0,turn:1,team:"Red",unitSet:{0:"SpearWarrior",1:"DartBlower",2:"Scout",3:"Harvester",4:"Enforcer",5:"Catapult",selected_:3,length:6},upkeep:false,buildings:[{type:"HQ",location:{x:8,y:1},turnsUntilCapture:3},{type:"Hut",location:{x:8,y:5},turnsUntilCapture:2}],units:[],lastSeen:{}},_neutral_:{food:0,turn:0,team:"Neutral",unitSet:{0:"SpearWarrior",1:"DartBlower",2:"Scout",3:"Enforcer",4:"Harvester",5:"Catapult",selected_:-1,length:6},upkeep:false,buildings:[{type:"Hut",location:{x:1,y:1},turnsUntilCapture:2},{type:"Farm",location:{x:8,y:8},turnsUntilCapture:2}],units:[],lastSeen:{}}},summary:{players:[{playerid:"$playerid",team:"Blue",unitsProduced:0,unitsKilled:0,unitsLost:0,buildingsCaptured:0,buildingsLost:0,foodCollected:0,foodConsumed:0},{playerid:"computer",team:"Red",unitsProduced:0,unitsKilled:0,unitsLost:0,buildingsCaptured:0,buildingsLost:0,foodCollected:0,foodConsumed:0},{}]}};bbq.Tutorial=function(e,t,n){var r=navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Mobile/i);if(!t){t={}}var i=t.entityManager||$em();var s=t.hud;var o=0;this._em=i;this._gameEngine=null;this._mapId=null;this._mapObj=null;this._debug=t.__adminKey;this._stop=false;this.victoryCondition=null;this.gameId=function(){return e};this.currentFrame=0;this.maxFrames=0;this.moves=null;this.players=null;this.neutralPlayer=null;var u=t.canvasId?$("#"+optons.canvasId)[0]:$("canvas")[0];if(!u){throw new Error("No canvas found/given!")}this.camera=new boc.utils.Camera({xmin:0,xmax:u.width,ymin:0,ymax:u.height});var a=this;var f=function(){var e=bbq.tutorialGameState;a._mapId=e.mapid;var t=[];for(var n in e.state){var r=e.state[n];$em($em.create(n)).add(new bbq.components.Player({id:n,food:r.food,turn:r.turn,team:r.team,upkeep:r.upkeep,buildings:[],units:[],summary:{},lastSeen:r.lastSeen,unitSet:new bbq.UnitSet(r.team,r.unitSet||["SpearWarrior","DartBlower","Scout","Enforcer","Harvester","Catapult"])}));if(n=="_neutral_"){a.neutralPlayer=n}else{t.push(n)}}l()};var l=function(){a.camera.update({zoom:r?1:1});var e=Math.round(u.width/a.camera.zoom);var t=Math.round(u.height/a.camera.zoom);var n={"padding-left":e/2,"padding-right":e/2,"padding-top":t/2,"padding-bottom":t/2};if(bbq.maps[a._mapId]){a._mapObj=new bbq.Map(a._mapId,$em(),n);c()}else{boc.utils.getJson("get/maps",{mapid:a._mapId,__adminkey:a._debug},function(e){if(!e||e.status!="ok"){throw"map "+a._mapId+" not found!"}else{bbq.maps[a._mapId]=e.result[0];a._mapObj=new bbq.Map(a._mapId,$em(),n);c()}})}};var c=function(){var e=new boc.systems.RenderSystem(i,u);e.camera(a.camera);var n=new boc.systems.CameraFollowSystem(i);var s=new boc.systems.AnimationSystem(i);var o=!r?new boc.systems.MouseInputSystem(i,u):new boc.systems.TouchInputSystem(i,u);var f=new boc.systems.LifespanSystem(i);var l=new boc.systems.PanningCameraSystem(i,e.camera());l.bounds(a._mapObj.bounds());var c=new boc.pfx.systems.BasicParticleSystem(i);var p=new boc.systems.SpriteAnimationSystem(i);var d=new boc.systems.IdentifySystem(i,e.camera());var v=new bbq.systems.MapSelectSystem(i,a.camera);var m=new bbq.systems.ParabolicTranslationSystem(i);var g=new bbq.systems.FogSystem(i,a._mapObj);var y=new boc.systems.UISystem(i);var b=new bbq.systems.UnitSystem(i);var w=new bbq.systems.MoveSystem(i,a._mapObj);var E=new bbq.systems.AttackSystem(i,a._mapObj);var S=new bbq.systems.HealSystem(a._mapObj);var x=new bbq.systems.RevealSystem(a._mapObj);var T=new bbq.systems.UnitCollisionSystem(i,a._mapObj);var N=new boc.systems.DelayedMethodSystem(i);var C=new bbq.systems.HealthSystem(i);var k=new boc.spine.SpineAnimationSystem;var L=new bbq.systems.ReplaySystem(a._mapObj);var A=new bbq.systems.CommandSystem(i,u,a._mapObj);var O=new bbq.systems.TrainingSystem(i,a.camera,a._mapObj,t);var M=new bbq.systems.HudSystem(i,t.hud);var _=new bbq.systems.VictorySystem(a,i);var D=new boc.systems.WaitForClickSystem(i);a._gameEngine=new boc.core.GameEngine([o,D,l,n,d,y,v,L,b,A,O,M,w,E,S,x,T,s,m,p,k,c,_,g,C,N,e,f]);a._gameEngine.start();h()};var h=function(){var e=new boc.core.Entity({description:"turn",entityManager:i});e.addComponent(new bbq.components.Turn({playerid:bbq.tutorialGameState.turn,number:0}));var t=[bbq.tutorialGameState.turn,"Computer","_neutral_"];var r=[];var s=[];for(var o=0;o<t.length;o++){var u="_"+(t[o]==a.neutralPlayer?"neutral":o)+"_";var f=a._mapObj.startState[u];var l=boc.utils.getPlayer(t[o],i);for(var c=0;f.buildings&&c<f.buildings.length;c++){var h=f.buildings[c];var p=bbq.buildings.createBuilding(h,l.team,i);l.buildings.push(p);s.push({bState:h,buildingEnt:p})}for(var d=0;f.units&&d<f.units.length;d++){var v=pState.units[d];var m=bbq.units.createUnit(v,l.team,i);l.units.push(m);r.push({uState:v,unitEnt:m});var g=bbq.units.getLevel(m);if(g>1){bbq.units.levelUp(m,g,true)}}}for(var o=0;o<s.length;o++){var p=s[o].buildingEnt;var h=s[o].bState;a._mapObj.place(p,h.location.x,h.location.y)}for(var o=0;o<r.length;o++){var v=r[o].uState;var m=r[o].unitEnt;a._mapObj.place(m,v.location.x,v.location.y)}boc.utils.createEvent(new bbq.events.FogEvent({action:"update"}),a._em);boc.utils.createEvent(new bbq.events.FogEvent({action:"draw",forPlayer:boc.utils.getCurrentPlayer(a._em)}),a._em);if(n){n(a)}};f();var p=$em.create("tutorial_arrow");$em(p).add(new boc.components.Spatial({x:95,y:200,z:bbq.zindex.OVERLAY,width:56,height:63})).add(new boc.components.DrawableSprite({image:boc.resources.GraphicsManager.getImage("assets/graphics/tutorial_arrow.png"),visible:true}));var d=bbq.frontend.toast("Select the hut and Train",{delay:-1});boc.utils.centerCamera(this.camera,boc.utils.getCurrentPlayer().buildings[1]);var v=function(){$em(p).comp("DrawableSprite").visible=true;$em(p).comp("Spatial").angle=boc.utils.degToRad(180);$em(p).comp("Spatial").update({x:a.camera.xmax-155,y:a.camera.ymin+70});if(!$em(p).has("CameraFollow")){$em(p).add(new boc.components.CameraFollow({camera:a.camera}))}};var m=function(){$em(p).comp("DrawableSprite").visible=true;$em(p).comp("Spatial").angle=boc.utils.degToRad(180);$em(p).comp("Spatial").update({x:a.camera.xmax-105,y:a.camera.ymin+70});if(!$em(p).has("CameraFollow")){$em(p).add(new boc.components.CameraFollow({camera:a.camera}))}};var g=function(){$em(p).comp("DrawableSprite").visible=true;$em(p).comp("Spatial").angle=0;$em(p).comp("Spatial").update({x:95,y:5})};var y=function(){$em(p).comp("DrawableSprite").visible=true;$em(p).comp("Spatial").angle=0;$em(p).comp("Spatial").update({x:95,y:195})};var b=function(e){boc.utils.createEvent(new bbq.events.CommandEvent({action:"endTurn",args:{tutorialCallback:e}}),i)};var w=function(){s.removeListener("trainback");s.removeListener("open");s.removeListener("endturn")};var E=false;s.on("trainback",function(){if(o===0){d.remove();var e=boc.utils.getCurrentPlayer();if(e.units.length===0){d=bbq.frontend.toast("Select the Hut and Train",{delay:-1})}else{N("Notice your food decreased after training your Harvester.",-1,null,true);$em(p).comp("DrawableSprite").visible=true;$em(p).comp("Spatial").angle=boc.utils.degToRad(135);$em(p).comp("Spatial").update({x:a.camera.xmin+60,y:a.camera.ymin+80});$em(p).add(new boc.components.CameraFollow({camera:a.camera}));boc.utils.waitForClick(function(){N("Food increases every turn for each berry and building you own.",-1,null,true);boc.utils.waitForClick(function(){$em(p).comp("Spatial").angle=boc.utils.degToRad(180);$em(p).comp("Spatial").update({x:a.camera.xmax-155,y:a.camera.ymin+70});d.remove();d=bbq.frontend.toast("Hit End Turn",{delay:-1});E=true})})}}});s.on("open",function(){d.remove();d=bbq.frontend.toast("Select the Harvester and then click Train",{delay:-1})});s.on("endturn",function(){if(o===0&&boc.utils.getCurrentPlayer().units.length>0&&E){var e=function(){var e=boc.utils.getCurrentPlayer();var t=e.units[0];var n=$em(t).comp("Commandable").commands;for(var r=0;r<n.length;r++){if(n[r].name()==="Attack"||n[r].name()==="Hold"){n[r].disabled(true)}else if(n[r].name()==="Move"){n[r].moveTiles=["1,1"];n[r].onMoveEnd=function(){$em(p).comp("DrawableSprite").visible=false;d.remove();d=bbq.frontend.toast("Excellent. Now Capture the hut!",{delay:-1});this.onMoveEnd=null}}else if(n[r].name()==="Capture"){n[r].onCaptureEnd=function(){d.remove();d=bbq.frontend.toast("Huts take 2 turns to capture. Why don't you train a Scout in the meantime?",{delay:-1});$em(p).comp("Spatial").update({x:95,y:195});$em(p).comp("DrawableSprite").visible=true;var e=boc.utils.getCurrentPlayer();e.unitSet=new bbq.UnitSet(e.team,["Scout"]);s.removeListener("open");s.removeListener("trainback");s.removeListener("endturn");s.on("open",function(){d.remove();d=bbq.frontend.toast("Select the Scout and then click Train",{delay:-1})});s.on("trainback",function(){if(e.units.length===1){d.remove();d=bbq.frontend.toast("Click the hut to train a Scout",{delay:-1});boc.utils.createEvent(new bbq.events.MapSelectEvent({action:"unlockCursor",args:{}}),i)}else{N("Scouts have awesome vision and can move really far. Take advantage of it.",-1,null,true);boc.utils.waitForClick(function(){N("Nothing else to do. Hit end turn");$em(p).comp("Spatial").angle=boc.utils.degToRad(180);$em(p).comp("Spatial").update({x:a.camera.xmax-155,y:a.camera.ymin+70});$em(p).add(new boc.components.CameraFollow({camera:a.camera}))})}});s.on("endturn",function(){if(e.units.length===2){$em(p).comp("DrawableSprite").visible=false;$em(p).remove("CameraFollow");boc.utils.createEvent(new bbq.events.CommandEvent({action:"endTurn",args:{tutorialCallback:S}}),i)}})}}}var o=$em(t).comp("Spatial");var u=$em(p).comp("Spatial");u.update({x:o.x+45,y:o.y-55});u.angle=0;$em(p).comp("DrawableSprite").visible=true;var f=new boc.components.Animation({componentName:"Spatial",propertyDeltas:{y:-190},easing:"linearTween",duration:2e3,state:boc.constants.ANIMATION_STOPPED});$em(p).add(f);boc.utils.createEvent(new boc.components.DelayedMethod(function(){f.state=boc.constants.ANIMATION_PLAYING},1e3),i,{duration:2e3})};o++;$em(p).comp("DrawableSprite").visible=false;$em(p).remove("CameraFollow");boc.utils.createEvent(new bbq.events.CommandEvent({action:"endTurn",args:{}}),i);boc.utils.createEvent(new bbq.events.MapSelectEvent({action:"hideCursor"}),i);boc.utils.createEvent(new bbq.events.MapSelectEvent({action:"lockCursor"}),i);N("At this point your opponent is calculating a move",-1,null,true);boc.utils.waitForClick(function(){N("Normally you would go back to the battle menu until it's your turn",-1,null,true);boc.utils.waitForClick(function(){N("But in this case it's a tutorial, so go ahead and move your unit next",-1,null,true);boc.utils.waitForClick(function(){N("Select your Harvester and then move to the upper hut.");boc.utils.createEvent(new bbq.events.CommandEvent({action:"endTurn",args:{tutorialCallback:e}}),i);boc.utils.createEvent(new bbq.events.MapSelectEvent({action:"showCursor",args:{}}),i);boc.utils.createEvent(new bbq.events.MapSelectEvent({action:"unlockCursor",args:{}}),i)})})})}});var S=function(){s.removeListener("endturn");s.removeListener("open");s.removeListener("trainback");d.remove();N("It's been pretty quiet so far. Why don't you move to enemy territory?",-1,null,true);var e=boc.utils.getCurrentPlayer();var t=bbq.units.createUnit({type:"SpearWarrior"},e.team,$em());$em(t).comp("DrawableSprite").visible=false;$em(t).comp("Health").current=5;e.units.push(t);a._mapObj.place(t,7,5);t=bbq.units.createUnit({type:"SpearWarrior"},e.team,$em());$em(t).comp("DrawableSprite").visible=false;$em(t).comp("Health").current=4;e.units.push(t);a._mapObj.place(t,8,1);var n=function(){$em(p).comp("Spatial").angle=0;$em(p).comp("Spatial").update({x:95,y:195});$em(p).comp("DrawableSprite").visible=true;d.remove();d=bbq.frontend.toast("Select your Scout and charge!",{delay:-1});var e=new boc.components.Animation({componentName:"Spatial",propertyDeltas:{x:350},easing:"linearTween",duration:2e3,state:boc.constants.ANIMATION_STOPPED});$em(p).remove("Animation");$em(p).add(e);boc.utils.createEvent(new boc.components.DelayedMethod(function(){e.state=boc.constants.ANIMATION_PLAYING},1e3),i,{duration:2e3});var t=boc.utils.getCurrentPlayer();var n=t.units[0];$em(n).comp("Unit").state="inactive";var s=t.units[1];var o=$em(s).comp("Commandable").commands;for(var u=0;u<o.length;u++){if(o[u].name()==="Hold"){o[u].disabled(true)}else if(o[u].name()==="Move"){o[u].moveTiles=["8,5"];o[u].onMoveEnd=r}}};var r=function(){N("Whoops! Looks like you collided with a hidden enemy.",-1,null,true);$em(p).comp("DrawableSprite").visible=false;boc.utils.waitForClick(function(){N("Enemies are hidden under fog of war.",-1,null,true);boc.utils.waitForClick(function(){N("Tall grass like this one can be revealed only if your unit is beside it.",-1,null,true);boc.utils.waitForClick(function(){N("Select your harvester and finish capturing that hut.",-1,null,true);$em(p).comp("Spatial").update({x:95,y:5});$em(p).comp("DrawableSprite").visible=true;boc.utils.waitForClick(function(){var e=boc.utils.getCurrentPlayer();var t=e.units[0];$em(t).comp("Unit").state="idle";var n=$em(t).comp("Commandable").commands;for(var r=0;r<n.length;r++){if(n[r].name()!="Capture"){n[r].disabled(true)}else{n[r].onCaptureEnd=function(){N("You can now train new units on your new hut! But you first need to move your harvester away from the hut on your next turn.",-1,null,true);var e=boc.utils.getCurrentPlayer();e.unitSet=new bbq.UnitSet(e.team,["Harvester"]);boc.utils.waitForClick(function(){o=true;N("End your turn now");$em(p).comp("Spatial").angle=boc.utils.degToRad(180);$em(p).comp("Spatial").update({x:a.camera.xmax-155,y:a.camera.ymin+70});$em(p).add(new boc.components.CameraFollow({camera:a.camera}))})}}}})})})})};boc.utils.waitForClick(function(){boc.utils.createEvent(new bbq.events.CommandEvent({action:"endTurn",args:{tutorialCallback:n}}),i)});s.on("open",function(){s.closeTrainWindow();boc.utils.createEvent(new bbq.events.MapSelectEvent({action:"unlockCursor",args:{}}),i)});var o=false;s.on("endturn",function(){if(o){$em(p).comp("DrawableSprite").visible=false;$em(p).remove("CameraFollow");L=boc.utils.getCurrentPlayer();boc.utils.createEvent(new bbq.events.CommandEvent({action:"endTurn",args:{tutorialCallback:A}}),i)}})};var x=function(){boc.utils.createEvent(new bbq.events.MapSelectEvent({action:"showCursor",args:{}}),i);boc.utils.createEvent(new bbq.events.MapSelectEvent({action:"unlockCursor",args:{}}),i)};var T=function(){boc.utils.createEvent(new bbq.events.MapSelectEvent({action:"hideCursor"}),i);boc.utils.createEvent(new bbq.events.MapSelectEvent({action:"lockCursor"}),i)};var N=function(e,t,n,r){if(t){boc.utils.createEvent(new boc.components.DelayedMethod(function(){if(d){d.remove()}d=bbq.frontend.toast(e,{delay:-1,more:r});if(n){n()}},t),i,{duration:t+1e3})}else{if(d){d.remove()}d=bbq.frontend.toast(e,{delay:-1,more:r});if(n){n()}}};var C=function(e,t,n){var e=a._mapObj.tileWidth()*e+45,t=a._mapObj.tileHeight()*t-50;$em(p).comp("Spatial").angle=n?boc.utils.degToRad(n):0;$em(p).comp("Spatial").update({x:e,y:t})};var k=function(e,t,n){boc.utils.createEvent(new boc.components.DelayedMethod(function(){e=a._mapObj.tileWidth()*e+45;t=a._mapObj.tileHeight()*t-50;var r=$em(p).comp("Spatial");var i=new boc.components.Animation({componentName:"Spatial",propertyDeltas:{x:e-r.x,y:t-r.y},easing:"linearTween",duration:n?n:2e3,state:boc.constants.ANIMATION_PLAYING});$em(p).remove("Animation");$em(p).add(i)},1e3),i,{duration:2e3})};var L=null;var A=function(){o=3;s.removeListener("endturn");s.removeListener("trainback");s.removeListener("open");T();var e=boc.utils.getCurrentPlayer();d.remove();N("Looks like the enemy wants some blood!",-1,null,true);boc.utils.centerCamera(a.camera,e.units[0]);var t=false;var n=function(){d.remove();if(!t){t=true;d=bbq.frontend.toast("Your turn! Finish it!",{delay:-1});$em(p).comp("Spatial").angle=0;$em(p).comp("Spatial").update({x:345,y:200});$em(p).comp("DrawableSprite").visible=true;boc.utils.createEvent(new bbq.events.CommandEvent({action:"endTurn",args:{tutorialCallback:r}}),i)}else if(o===3){x();f();turn3Complete=true}};boc.utils.waitForClick(function(){var t=e.units[0];var r=L.units[1];var i=$em(t).comp("Attack").damage;var s=Math.floor($em(t).comp("Attack").damage/2);boc.utils.createEvent(new bbq.events.CommandEvent({action:"attackEntity",args:{src:t,dst:r,damage:i,onAttackEnd:function(){N("Ouch! At least your Scout survived.",-1,null,true);boc.utils.waitForClick(function(){N("Your unit will retaliate if it's within attack range at half the damage.",-1,null,true);boc.utils.waitForClick(function(){boc.utils.createEvent(new bbq.events.CommandEvent({action:"attackEntity",args:{src:r,dst:t,damage:s,onAttackEnd:n}}),$em())})})}}}),$em())});var r=function(){x();var e=L.units[0];$em(e).comp("Unit").state="inactive";var t=L.units[1];var n=$em(t).comp("Commandable").commands;for(var r=0;r<n.length;r++){if(n[r].name()!=="Attack"){n[r].disabled(true)}}for(r=0;r<L.buildings.length;r++){var i=$em(L.buildings[r]).comp("Commandable").commands;for(var s=0;s<i.length;s++){i[s].disabled(true)}}};var u=false;var f=function(){boc.utils.createEvent(new bbq.events.UnitEvent({action:"inactivate",args:{entity:L.units[1]}}),i);$em(p).comp("Spatial").update({x:95,y:0});var e=new boc.components.Animation({componentName:"Spatial",propertyDeltas:{x:200},easing:"linearTween",duration:2e3,state:boc.constants.ANIMATION_STOPPED});$em(p).remove("Animation");$em(p).add(e);boc.utils.createEvent(new boc.components.DelayedMethod(function(){e.state=boc.constants.ANIMATION_PLAYING},1e3),i,{duration:2e3});d=bbq.frontend.toast("Good job! Move your Harvester to the tree",{delay:-1});var t=L.units[0];var n=$em(t).comp("Commandable").commands;$em(t).comp("Unit").state="idle";for(var r=0;r<n.length;r++){if(n[r].name()==="Move"){n[r].disabled(false);n[r].moveTiles=["5,1"];n[r].onMoveEnd=function(){for(var e=0;e<n.length;e++){if(n[e].name()==="Hold"){n[e].disabled(false);n[e].onHoldEnd=function(){c()}}}d.remove();d=bbq.frontend.toast("Your unit gains 1 vision when it's on a tree. Click Wait.",{delay:-1});u=true}}else{n[r].disabled(true)}}};var l=false;var c=function(){var e=$em(L.buildings[1]).comp("Commandable").commands;for(var t=0;t<e.length;t++){e[t].disabled(false)}y();d.remove();d=bbq.frontend.toast("Train another Harvester.",{delay:-1})};var h=false;var m=function(){d.remove();d=bbq.frontend.toast("Now train an Axe Thrower.",{delay:-1});var e=$em(L.buildings[2]).comp("Commandable").commands;for(var t=0;t<e.length;t++){e[t].disabled(false)}L.unitSet=new bbq.UnitSet(L.team,["DartBlower"]);g()};s.on("trainback",function(){if(!l){if(L.units.length<3){N("Train another Harvester.")}else{l=true;m()}}if(l&&!h){if(L.units.length<4){N("Train an Axe Thrower.")}else{h=true;N("Axe throwers can attack from afar; keep that in mind",-1,null,true);boc.utils.waitForClick(function(){N("End your turn now");v()})}}});s.on("open",function(){if(!u){s.closeTrainWindow();x()}else{if(!l&&!h){}else if(l&&!h){}else if(l&&h){}}});s.on("endturn",function(){if(l&&h&&L.units.length===4){b(O)}})};var O=function(){o=4;w();$em(p).comp("DrawableSprite").visible=false;N("Calculating computer moves...");N("Move your harvester to the berries",1e3,function(){b(e)});var e=function(){for(var e=0;e<L.buildings.length;e++){var n=$em(L.buildings[e]).comp("Commandable").commands;for(var r=0;r<n.length;r++){n[r].disabled(true)}}var i=$em(L.units[2]).comp("Commandable").commands;for(var r=0;r<i.length;r++){if(i[r].name()==="Gather"){i[r].onGatherEnd=function(){N("At the start of the next turn you'll gain some food!",-1,null,true);boc.utils.waitForClick(function(){N("Move your other Harvester");t()})};continue}else if(i[r].name()==="Move"){i[r].moveTiles=["0,5"];i[r].onMoveEnd=function(){N("Choose Harvest")}}else{i[r].disabled(true)}}for(var s=0;s<L.units.length;s++){if(s===2){continue}i=$em(L.units[s]).comp("Commandable").commands;for(r=0;r<i.length;r++){i[r].disabled(true)}}$em(p).remove("CameraFollow");$em(p).comp("DrawableSprite").visible=true;C(1,5);k(0,5,500)};var t=function(){var e=$em(L.units[0]).comp("Commandable").commands;var t=null;for(var r=0;r<e.length;r++){if(e[r].name()==="Hold"){e[r].onHoldEnd=n;t=e[r]}else if(e[r].name()==="Move"){e[r].moveTiles=["6,1"];e[r].onMoveEnd=function(){t.disabled(false);N("Notice your unit couldn't move past the water",-1,null,true);boc.utils.waitForClick(function(){N("Water will impede movement. Hit Wait.")})};e[r].disabled(false)}else{e[r].disabled(true)}}C(5,1);k(6,1,500)};var n=function(){N("Move your Axe Thrower by the tree");C(1,1);k(4,1,500);var e=$em(L.units[3]).comp("Commandable").commands;var t=null;for(var n=0;n<e.length;n++){e[n].disabled(false);if(e[n].name()==="Move"){e[n].moveTiles=["4,1"];e[n].onMoveEnd=function(){$em(p).comp("DrawableSprite").visible=false;N("Enemy within range! Attack!")};e[n].disabled(false)}else if(e[n].name()==="Attack"){e[n].disabled(false);e[n].onAttackEnd=function(){v();N("Time to finish this! Hit End Turn")}}else{e[n].disabled(true)}}};s.on("endturn",function(){$em(p).comp("DrawableSprite").visible=false;N("Calculating moves...");b(function(){b(M)})})};var M=function(){o=5;w();N("Choose your Harvester and move to the HQ!",1e3,function(){$em(p).remove("CameraFollow");$em(p).comp("DrawableSprite").visible=true;C(6,1,0);k(8,1,500)});for(var e=0;e<L.buildings.length;e++){var t=$em(L.buildings[e]).comp("Commandable").commands;for(var n=0;n<t.length;n++){t[n].disabled(true)}}var r=false;var i=function(){N("In a real match, HQs take 3 turns to capture.",-1,null,true);boc.utils.waitForClick(function(){N("That's it! You've finished the tutorial!",-1,null,true);boc.utils.waitForClick(function(){N("Hit pause to go back to the main menu.");r=true;m()})})};for(var s=0;s<L.units.length;s++){if(s===0){$em(L.units[s]).comp("Movement").range=2}var u=$em(L.units[s]).comp("Commandable").commands;for(var n=0;n<u.length;n++){if(s===0){if(u[n].name()==="Move"){u[n].moveTiles=["8,1"];u[n].onMoveEnd=function(){N("Capture their HQ to win!")}}else if(u[n].name()==="Capture"){u[n].onCaptureEnd=i}else{u[n].disabled(true)}}else{u[n].disabled(true)}}}}};bbq.Tutorial.prototype.pause=function(){_this._gameEngine.pause()};bbq.Tutorial.prototype.back=function(){};bbq.Tutorial.prototype.stop=function(e){this._gameEngine.stop(e)};var bbq=bbq||{};(function(e){var t=function(){};t.prototype.loadUi=function(e,t,n,r){var i=0;var s=this;for(var o=0;o<t.length;o++){var u=e+t[o];(function(o){boc.utils.loadHtml(o,e,function(e){s[o]=e;if(++i==t.length&&n){n()}},r)})(u)}};e.UiCache=new t})(bbq);if(!window.bbq){window.bbq={}}var MAX_PENDING_MATCHES=1;bbq.User=function(e){this.playerid=null;this.displayname=null;this.email=null;this.wins=0;this.losses=0;this.rating=0;this.level=0;this.experience=0;this.avatar=null;this.skulls=0;this.shields=0;this.unlockedUnits=null;this.tutorialComplete=false;if(e){for(var t in e){this[t]=e[t]}}this.pendingMatches=[];this.activeMatches=[];this.retiredMatches=[];this.pendingChallengeRequests=[];this.pendingChallengeReplies=[];this.friends=[];this.pendingFriendRequests=[];this.pendingFriendResponses=[]};bbq.Match=function(e){this.matchid=null;this.gameid=null;this.opponent=null;this.status=null;this.turn=null;this.winner=null;this.mapid=null;this.challengeid=null;if(e){for(var t in e){this[t]=e[t]}}};ns("bbq.scenes");(function(e){var t=0;var n=new Array;e.showWindow=function(e){if(n.length==0){$(".fadeBlack").fadeIn(200)}if(n.length>0){$(n[n.length-1]).fadeOut(200)}$(e).slideDown(200);n.push(e);t++;console.log(n)};e.hideWindow=function(e){if(t>0){t--}if(n.length>0){$(n[n.length-1]).fadeOut(200)}if(e==undefined){e=1}if(n.length==1){n.pop()}else if(e>0){n.splice(n.length-e,n.length)}if(n.length>0){$(n[n.length-1]).slideDown(200)}if(n.length==0){$(".fadeBlack").fadeOut(200)}}})(bbq.scenes);bbq.scenes.Scene=function(){var e=new boc.utils.EventManager(this)};bbq.scenes.Scene.prototype.refresh=function(){};bbq.scenes.MainMenu=function(){bbq.scenes.Scene.call(this)};boc.utils.inherits(bbq.scenes.MainMenu,bbq.scenes.Scene);(function(e){e.prototype.clearSignIn=function(){};e.prototype.hideSignIn=function(){};e.prototype.showSignIn=function(){}})(bbq.scenes.MainMenu);bbq.scenes.BattleMenu=function(e){bbq.scenes.Scene.call(this)};boc.utils.inherits(bbq.scenes.BattleMenu,bbq.scenes.Scene);bbq.scenes.BattleMenu.prototype.footer=function(){};bbq.scenes.CreateAccount=function(){bbq.scenes.Scene.call(this)};(function(e){e.prototype.validate=function(){return false};e.prototype.showMessageBox=function(e){};e.prototype.hideMessageBox=function(){};e.prototype.reloadRecaptcha=function(){}})(bbq.scenes.CreateAccount);boc.utils.inherits(bbq.scenes.CreateAccount,bbq.scenes.Scene);bbq.scenes.Footer=function(e){bbq.scenes.Scene.call(this);var t=e;this.user=function(e){if(typeof e!="undefined"){t=e}return t}};boc.utils.inherits(bbq.scenes.Footer,bbq.scenes.Scene);(function(e){e.prototype.name=function(){return this.user().displayname};e.prototype.experience=function(){return this.user().experience};e.prototype.level=function(){return this.user().level};e.prototype.badges=function(){return this.user().skulls};e.prototype.tokens=function(){return this.user().shields}})(bbq.scenes.Footer);bbq.scenes.MyTribe=function(e){bbq.scenes.Scene.call(this);var t=e;this.user=function(e){if(typeof e!="undefined"){t=e}return t}};boc.utils.inherits(bbq.scenes.MyTribe,bbq.scenes.Scene);(function(e){e.prototype.footer=function(){};e.prototype.showUnitInfoWindow=function(e){};e.prototype.hideUnitInfoWindow=function(){};e.prototype.showPurchaseWindow=function(e){};e.prototype.hidePurchaseWindow=function(){}})(bbq.scenes.MyTribe);bbq.scenes.Friends=function(e){bbq.scenes.Scene.call(this);var t=e;this.user=function(e){if(typeof e!="undefined"){t=e}return t}};boc.utils.inherits(bbq.scenes.Friends,bbq.scenes.Scene);bbq.scenes.Friends.prototype.footer=function(){};bbq.scenes.TribeMemberSelect=function(e){bbq.scenes.Scene.call(this);var t=e;this.user=function(e){if(typeof e!="undefined"){t=e}return t}};boc.utils.inherits(bbq.scenes.TribeMemberSelect,bbq.scenes.Scene);bbq.scenes.TribeMemberSelect.prototype.refresh=function(e){};bbq.scenes.TribeMemberSelect.prototype.loadout=function(e){};bbq.scenes.TribeMemberSelect.prototype.showUnitInfoWindow=function(e){};bbq.scenes.TribeMemberSelect.prototype.footer=function(){};bbq.scenes.YesNoWindow=function(e,t){bbq.scenes.Scene.call(this)};boc.utils.inherits(bbq.scenes.YesNoWindow,bbq.scenes.Scene);bbq.scenes.UnitInfoWindow=function(e){bbq.scenes.Scene.call(this);this._unitType=e};boc.utils.inherits(bbq.scenes.UnitInfoWindow,bbq.scenes.Scene);bbq.scenes.UnitInfoWindow.prototype.close=function(){};bbq.scenes.Credits=function(e){bbq.scenes.Scene.call(this)};boc.utils.inherits(bbq.scenes.Credits,bbq.scenes.Scene);ns("bbq.scenes");bbq.scenes.HtmlCreateAccount=function(e){bbq.scenes.CreateAccount.call(this);this.id=function(){return e};Recaptcha.create(RECAPTCHA_KEY,"recaptchaDiv",{theme:"custom",custom_theme_widget:"recaptchaCustomWidget",callback:function(){}});var t=this;$("#"+e+" #btnBack").attr("href","#").click(function(){t.emit("back",{})});$("#"+e+" #btnCreateAccount").click(function(){t.emit("create",{})})};(function(e){boc.utils.inherits(e,bbq.scenes.CreateAccount);e.prototype.validate=function(){if($("#"+this.id()+' input[name="create_email"]').val()==""){$("#"+this.id()+" .createAccountMessageBg").text("Email must be non-empty!").show();return false}if($("#"+this.id()+' input[name="displayName"]').val()==""){$("#"+this.id()+" .createAccountMessageBg").text("Name must not be empty!").show();return false}if($("#"+this.id()+' input[name="create_password"]').val()==""){$("#"+this.id()+" .createAccountMessageBg").text("Password must not be empty!").show();return false}if($("#"+this.id()+' input[name="create_password"]').val()!=$('input[name="confirm_password"]').val()){$("#"+this.id()+" .createAccountMessageBg").text("Passwords don't match!").show();return false}return true};e.prototype.showMessageBox=function(e){$("#"+this.id()+" .createAccountMessageBg").text(e).show()};e.prototype.hideMessageBox=function(){$("#"+this.id()+" .createAccountMessageBg").hide()};e.prototype.reloadRecaptcha=function(){Recaptcha.reload()}})(bbq.scenes.HtmlCreateAccount);ns("bbq.scenes");bbq.scenes.HtmlCredits=function(e){bbq.scenes.Friends.call(this,e);this.id=function(){return e};var t=this;var n=$("#"+e);n.find("#battle_backButton").attr("href","#").click(function(){t.emit("back")});var r="on";this.soundState=function(e){r=e;i();return r};var i=function(){n.find(".soundBtn .labelSmall").text(r);if(r==="on"){n.find(".soundOff").removeClass("soundOff").addClass("soundOn")}else{n.find(".soundOn").removeClass("soundOn").addClass("soundOff")}};n.find(".soundBtn").click(function(){if(r==="on"){r="off"}else{r="on"}i();t.emit("sound",r)});i()};boc.utils.inherits(bbq.scenes.HtmlCredits,bbq.scenes.Credits);ns("bbq.scenes");bbq.scenes.HtmlFooter=function(e,t){bbq.scenes.Footer.call(this,e);this.id=function(){return t};var n=this;var r=$("#"+t);r.find(".footerPlusLevel").click(function(){n.emit("purchaseExp")});r.find(".footerBattleBadges .footerPlus").click(function(){n.emit("purchaseTokens")});r.find(".footerTribeTokens .footerPlus").click(function(){n.emit("purchaseBadges")});var i="on";var s=function(){r.find("#soundBtn .labelSmall").text(i);if(i==="on"){r.find(".soundOff").removeClass("soundOff").addClass("soundOn")}else{r.find(".soundOn").removeClass("soundOn").addClass("soundOff")}};this.soundState=function(e){i=e;s();return i};r.find("#soundBtn").click(function(){if(i==="on"){i="off"}else{i="on"}s();n.emit("sound",i)});s();this.refresh()};boc.utils.inherits(bbq.scenes.HtmlFooter,bbq.scenes.Footer);bbq.scenes.HtmlFooter.prototype.refresh=function(){$("#"+this.id()+" .footerLevelValue").text(this.level());$("#"+this.id()+" .footerValue.footerExp").text(this.experience());$("#"+this.id()+" #footerBadges").text(this.badges());$("#"+this.id()+" .footerTribeTokens .footerValue").text(this.tokens())};ns("bbq.scenes");bbq.scenes.HtmlFriends=function(e,t){bbq.scenes.Friends.call(this,e);this.id=function(){return t};var n=this;$("#"+t+' a[href="mainMenu2.html"]').attr("href","#").click(function(){n.emit("back")});$("#"+t+"#btnAddFriend").click(function(){n.emit("add")})};boc.utils.inherits(bbq.scenes.HtmlFriends,bbq.scenes.Friends);(function(e){e.prototype.footer=function(e){if(typeof e!="undefined"){$("#"+this.id()+" #footer").html(e);this.footer_=new bbq.scenes.HtmlFooter(this.user(),this.id()+" #footer")}return this.footer_};e.prototype.refresh=function(){if(this.footer_){this.footer_.refresh()}}})(bbq.scenes.HtmlFriends);ns("bbq.scenes");bbq.scenes.HtmlMainMenu=function(e){bbq.scenes.MainMenu.call(this);this.id=function(){return e};var t=this;$("#"+e+' a[href="createAccount.html"]').attr("href","#").click(function(){t.emit("newAccount",{})});$("#"+e+" #btnSignIn").click(function(){t.emit("signIn",{element:this})});$("#"+e+" #btnPlay").click(function(){t.emit("battles",{element:this})});$("#"+e+' a[href="myTribe.html"]').attr("href","#").click(function(){t.emit("myTribe",{element:this})});$("#"+e+' a[href="friends.html"]').attr("href","#").click(function(){t.emit("friends",{element:this})});$("#"+e+" #btnLogOut").click(function(){t.emit("logout",{element:this})});$("#"+e+" #btnTutorial").click(function(){t.emit("tutorial",{element:this})});$("#"+e+" .creditsBtn").click(function(){t.emit("credits",{element:this})});var n=$("#"+e);var r="on";this.soundState=function(e){r=e;i();return r};var i=function(){n.find(".soundBtn .labelSmall").text(r);if(r==="on"){n.find(".soundOff").removeClass("soundOff").addClass("soundOn")}else{n.find(".soundOn").removeClass("soundOn").addClass("soundOff")}};n.find(".soundBtn").click(function(){if(r==="on"){r="off"}else{r="on"}i();t.emit("sound",r)});i()};(function(e){boc.utils.inherits(e,bbq.scenes.MainMenu);e.prototype.clearSignIn=function(){$("#"+this.id()+' input[name="username"]').val("");$("#"+this.id()+' input[name="password"]').val("")};e.prototype.hideSignIn=function(){$("#"+this.id()+" .signInWindow").hide();$("#"+this.id()+" .btnPlay").show()};e.prototype.showSignIn=function(){$("#"+this.id()+" .signInWindow").show();$("#"+this.id()+" .btnPlay").hide()}})(bbq.scenes.HtmlMainMenu);ns("bbq.scenes");bbq.scenes.HtmlMyTribe=function(e,t){bbq.scenes.MyTribe.call(this,e);this.id=function(){return t};var n=this;$("#"+t+' a[href="mainMenu2.html"]').attr("href","#").click(function(){n.emit("back")});$("#"+t+" .btnSquareInfo").click(function(){n.showUnitInfoWindow($(this).attr("unitType"))});$("#"+t+" #unitInfoClose").click(function(){n.hideUnitInfoWindow()})};boc.utils.inherits(bbq.scenes.HtmlMyTribe,bbq.scenes.MyTribe);(function(e){e.prototype.footer=function(e){if(typeof e!="undefined"){$("#"+this.id()+" #footer").html(e);this.footer_=new bbq.scenes.HtmlFooter(this.user(),this.id()+" #footer")}return this.footer_};e.prototype.refresh=function(){if(this.footer_){this.footer_.refresh()}};e.prototype.showUnitInfoWindow=function(e){bbq.scenes.showWindow("#unitInfoWindow")};e.prototype.hideUnitInfoWindow=function(){bbq.scenes.hideWindow("#unitInfoWindow")};e.prototype.showPurchaseWindow=function(e){};e.prototype.hidePurchaseWindow=function(){}})(bbq.scenes.HtmlMyTribe);ns("bbq.scenes");bbq.scenes.HtmlTribeMemberSelect=function(e,t){bbq.scenes.TribeMemberSelect.call(this,e);this.id=function(){return t};var n=this;$("#"+t+' a[href="mainMenu2.html"]').attr("href","#").click(function(){n.emit("back")});$("#"+t+" #btnContinue").attr("href","#").click(function(){n.emit("done")});$("#"+t+" .imageSquareUnlocked").click(function(){n.emit("loadout",{loadout:this._loadout})});$("#"+this.id()+" #unitInfoClose").click(function(){hideWindow(1)});this.refresh(e)};boc.utils.inherits(bbq.scenes.HtmlTribeMemberSelect,bbq.scenes.TribeMemberSelect);(function(e){var t='<div class="unitContainer"> <div class="unitBg loadoutSlot"> <img class="unitImage" /> <div class="unitPriceBg"> <div class="vAlign center"> <span class="unitPriceSmall">Unlocked!</span></div></div></div></div>';var n='<div class="unitContainer"> <div class="unitBg loadoutSlot"> <img class="unitImage" /> <div class="unitPriceBg"> <div class="vAlign"> <img class="unitPriceIcon icon$currency" /></div><div class="vAlign"> <span class="unitPriceValue">$price</span></div></div></div></div>';var r='<div class="unitInfo center"> <div class="unitNameBg"> <span>$displayName</span> </div> <!-- unitNameBg --> <div class="unitDesc"> $description </div> <!-- unitDesc --> <div class="unitPriceBg"> <div class="vAlign"> <div class="trainButton center buttonContainer button buttonBlue"> <div class="content"> <span id="actionButton" class="labelLarge btnWord"> $btnLabel </span> </div> <!-- content --> </div> <!-- buttonContainer --> </div> <!-- vAlign --> </div> <!-- unitPriceBg --> </div> <!-- unitInfo -->';e.prototype.refresh=function(e){var i=this;if(this.footer_){this.footer_.user(e);this.footer_.refresh()}var s=bbq.units.configuration.unlockableUnits;var o=[];for(var u=0;u<s.length;u++){o.push(bbq.units.configuration[s[u]].spinePath)}$("#"+this.id()+" #unitContainer").empty();var a=0;if(e.unlockedUnits){for(var f=0;f<e.unlockedUnits.length;f++){if(!bbq.units.configuration[e.unlockedUnits[f]]){continue}var l=t;debugger;var c=$(l);if(a==0){c.addClass("btnUnitFirst")}c.find(".btnSquareInfo").click(function(){i.emit("unitInfo",{unitType:$(this).attr("unitType")})});c.find(".imageSquareUnlocked").click(function(){i.emit("unit",{unitType:$(this).attr("unitType")})});$("#"+i.id()+" #unitContainer").append(c);a++;var h=e.unlockedUnits[f];console.log(h);c.attr("id",h);c.click(function(e){$("#"+i.id()+" .unitContainerExpand").removeClass("unitContainerExpand");$("#"+i.id()+" .unitInfo").remove();var t=e.currentTarget;t.classList.add("unitContainerExpand");var n=t.id;var s=r.replace(/\$displayName/g,bbq.units.configuration[n].displayName).replace(/\$description/g,bbq.units.configuration[n].description).replace(/\$btnLabel/g,"Choose");var o=$(s);o.prependTo(t);$(t).find("#actionButton").click(function(){i._loadout=t.id;i.emit("done",{selected:bbq.units.configuration[n].displayName})})})}}for(var f=0;f<s.length;f++){var p=s[f];if(e.unlockedUnits&&e.unlockedUnits.indexOf(p)>=0){continue}var l=n.replace(/\$unitType/g,p).replace("$currency",bbq.units.configuration[p].unlock.currency).replace("$price",bbq.units.configuration[p].unlock.price);var c=$(l);if(a==0){c.addClass("btnUnitFirst")}c.find(".btnSquareInfo").click(function(){i.emit("unitInfo",{unitType:$(this).attr("unitType")})});c.attr("id",p);$("#"+this.id()+" #unitContainer").append(c);a++;c.click(function(e){$("#"+i.id()+" .unitContainerExpand").removeClass("unitContainerExpand");var t=e.currentTarget;t.classList.add("unitContainerExpand");targetUnit=t.id;var n=r.replace(/\$displayName/g,bbq.units.configuration[targetUnit].displayName).replace(/\$description/g,bbq.units.configuration[targetUnit].description).replace(/\$btnLabel/g,"Purchase");var s=$(n);$(t).find(".unitInfo").remove();s.prependTo(t);s.find(".trainButton").click(function(){i.emit("trainok",{selected:i._selected})});$(t).find("#actionButton").click(function(){i.emit("unitPurchase",{unitType:t.id})})})}boc.spine.loadSpineAssets(o,{teams:["blue","red"],onload:function(e){boc.spine.SkeletonManager.load(e);for(var t=0;t<s.length;t++){var n=boc.resources.GraphicsManager.getImage(s[t]+"_blue");if(!n){var r=document.createElement("canvas");r.width=100;r.height=100;var o=r.getContext("2d");var u=boc.spine.SkeletonManager.createSkeleton(s[t].toLowerCase()+"_blue",{x:50,y:-50});u.setSkinByName("defaultSkin");u.setSlotsToSetupPose();boc.spine.renderSkeleton(u,o);n=document.createElement("img");n.width=100;n.height=100;n.src=r.toDataURL();boc.resources.GraphicsManager.addImage(s[t]+"_blue",n)}$("#"+i.id()+" #"+s[t]).find("img").attr("src",n.src)}}})};e.prototype.loadout=function(e){if(arguments&&arguments.length==0){return this._loadout}else{this._loadout=e;if(e){for(var t=0;t<e.length;t++){var n=document.createElement("img");n.width=100;n.height=100;n.src=$("#"+e[t]+" img").attr("src");$("#"+this.id()+" .loadoutSlot").removeClass("iconPlaceholder").empty().append(n)}}else{$("#"+this.id()+" .loadoutSlot").empty().addClass("iconPlaceholder")}}};e.prototype.showUnitInfoWindow=function(e){var t=$("#"+this.id()+" #unitInfoWindow");var n=boc.resources.GraphicsManager.getImage(e+"_blue");var r=document.createElement("img");r.src=n.src;t.find(".windowTitle").html("<h1>"+bbq.units.configuration[e].displayName+"</h1>");t.find(".btnUnitImage").empty().append(r);t.find(".unitInfoStatHealth .unitInfoStatValue").text(bbq.units.configuration[e].health);t.find(".unitInfoStatAttack .unitInfoStatValue").text(bbq.units.configuration[e].attackDamage);t.find(".unitInfoStatRange .unitInfoStatValue").text(bbq.units.configuration[e].attackMinRange+" - "+bbq.units.configuration[e].attackMaxRange);t.find(".unitInfoStatFood .unitInfoStatValue").text(bbq.units.configuration[e].foodCost);t.find(".unitInfoStatVision .unitInfoStatValue").text(bbq.units.configuration[e].visionRange);t.find(".unitInfoStatMovement .unitInfoStatValue").text(bbq.units.configuration[e].moveRange);t.find(".unitInfoDesc").text(bbq.units.configuration[e].description);showWindow("#"+this.id()+" #unitInfoWindow")};e.prototype.footer=function(e){if(typeof e!="undefined"){$("#"+this.id()+" #footer").html(e);this.footer_=new bbq.scenes.HtmlFooter(this.user(),this.id()+" #footer")}return this.footer_}})(bbq.scenes.HtmlTribeMemberSelect);ns("bbq.scenes");bbq.scenes.HtmlBattleMenu=function(e,t){bbq.scenes.BattleMenu.call(this);var n=e;this.user=function(e){if(typeof e!="undefined"){n=e}return n};this.id=function(){return t};var r=this;var i=$("#"+t);this.html={findMatch:i.find("#findMatch")[0].outerHTML,tutorial:i.find('.battleButton[paneltype="tutorial"]')[0].outerHTML,yourTurn:i.find('.battleButton[paneltype="yourturn"]')[0].outerHTML,waiting:i.find('.battleButton[paneltype="waiting"]')[0].outerHTML,collectWin:i.find('.battleButton[paneltype="collectwin"]')[0].outerHTML,collectLose:i.find('.battleButton[paneltype="collectlose"]')[0].outerHTML,searching:i.find('div[paneltype="searching"]')[0].outerHTML};$("#"+t+" #battle_backButton").attr("href","#").click(function(){r.emit("back")});$("#"+t+" #refreshBtn").click(function(){r.emit("refresh")});i.find(".battleButton").remove();i.find('div[paneltype="searching"]').remove();this.refresh()};(function(e){boc.utils.inherits(e,bbq.scenes.BattleMenu);e.prototype.footer=function(e){if(typeof e!="undefined"){$("#"+this.id()+" #footer").html(e);this.footer_=new bbq.scenes.HtmlFooter(this.user(),"footer")}return this.footer_};e.prototype.refresh=function(e){var t=this;if(this.footer_){if(e){this.footer_.user(e)}this.footer_.refresh()}if(e){this.user(e)}$("#"+this.id()).find(".battleButton").remove();$("#"+this.id()).find('div[paneltype="searching"]').remove();$("#"+this.id()).find("#findMatch").remove();$(this.html.findMatch).prependTo($("#currentBattles"));$("#"+this.id()+" #findMatch").click(function(){t.emit("match")});var n=[];for(var r=0;r<t.user().activeMatches.length;r++){var i=t.user().activeMatches[r];if(i.winner){var s=t.user().playerid==i.winner;if(s){$(t.html.collectWin.replace("$mapid",i.mapid).replace("$opponent",i.opponent)).attr("matchid",i.matchid).attr("gameid",i.gameid).attr("winner",i.winner).appendTo($("#currentBattles"))}else{$(t.html.collectLose.replace("$mapid",i.mapid).replace("$opponent",i.opponent)).attr("matchid",i.matchid).attr("gameid",i.gameid).attr("winner",i.winner).appendTo($("#currentBattles"))}}else if(i.turn==t.user().playerid){$(t.html.yourTurn.replace("$mapid",i.mapid).replace("$opponent",i.opponent)).attr("matchid",i.matchid).attr("gameid",i.gameid).appendTo($("#currentBattles"))}else{n.push(i)}}n.reverse();while(n.length>0){var i=n.pop();if(i.winner){var s=t.user().playerid==i.winner;if(s){$(t.html.collectWin.replace("$mapid",i.mapid).replace("$opponent",i.opponent)).attr("matchid",i.matchid).attr("gameid",i.gameid).attr("winner",i.winner).appendTo($("#currentBattles"))}else{$(t.html.collectLose.replace("$mapid",i.mapid).replace("$opponent",i.opponent)).attr("matchid",i.matchid).attr("gameid",i.gameid).attr("winner",i.winner).appendTo($("#currentBattles"))}}else{$(t.html.waiting.replace("$mapid",i.mapid).replace("$opponent",i.opponent)).attr("matchid",i.matchid).attr("gameid",i.gameid).appendTo($("#currentBattles"))}}if(t.user().pendingMatches.length){$("#"+this.id()+" #findMatch").remove();for(var r=0;r<t.user().pendingMatches.length;r++){var i=t.user().pendingMatches[r];$(this.html.searching).addClass("searching").attr("matchid",i.matchid).prependTo($("#currentBattles"))}}$("#"+t.id()+" .battleButton").click(function(){t.emit("battlePanel",{element:this})})}})(bbq.scenes.HtmlBattleMenu);ns("bbq.scenes");bbq.scenes.HtmlYesNoWindow=function(e,t,n){bbq.scenes.YesNoWindow.call(this,e,t);var r=this;$("#"+n+" #yesbtn").click(function(){r.emit("yes")});$("#"+n+" #nobtn").click(function(){r.emit("no")});$("#"+n+" #close").click(function(){r.emit("no")});$("#"+n+" #title h1").text(e);$("#"+n+" #message").text(t)};boc.utils.inherits(bbq.scenes.HtmlYesNoWindow,bbq.scenes.YesNoWindow);ns("bbq.scenes");bbq.scenes.HtmlUnitInfoWindow=function(e,t){bbq.scenes.Scene.call(this,e);var n=$("#"+t+" #unitInfoWindow");var r=boc.resources.GraphicsManager.getImage(e+"_blue");var i=document.createElement("img");i.src=r.src;n.find(".windowTitle").html("<h1>"+bbq.units.configuration[e].displayName+"</h1>");n.find(".btnUnitImage").empty().append(i);n.find(".unitInfoStatHealth .unitInfoStatValue").text(bbq.units.configuration[e].health);n.find(".unitInfoStatAttack .unitInfoStatValue").text(bbq.units.configuration[e].attackDamage);n.find(".unitInfoStatRange .unitInfoStatValue").text(bbq.units.configuration[e].attackMinRange+" - "+bbq.units.configuration[e].attackMaxRange);n.find(".unitInfoStatFood .unitInfoStatValue").text(bbq.units.configuration[e].foodCost);n.find(".unitInfoStatVision .unitInfoStatValue").text(bbq.units.configuration[e].visionRange);n.find(".unitInfoStatMovement .unitInfoStatValue").text(bbq.units.configuration[e].moveRange);n.find(".unitInfoDesc").text(bbq.units.configuration[e].description);$("#"+t+" #unitInfoClose").click(function(){hideWindow(1,function(){$("#"+t).remove()})});showWindow("#"+t+" #unitInfoWindow")};boc.utils.inherits(bbq.scenes.HtmlUnitInfoWindow,bbq.scenes.UnitInfoWindow)