<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
        <title>Project BBQ</title>
        <style type="text/css">
            .sceneContainer
            {
	            background-color: #373737;
	            height: 640px;
	            width: 960px;
	            position:relative;
	            overflow:hidden;
            }

            .scene
            {
	            width:960px;
	            height:640px;
	            position:absolute;
            }
        </style>
        <link href="ui/ui.css" rel="stylesheet" type="text/css" />
        <script type="text/javascript" src="http://www.google.com/recaptcha/api/js/recaptcha_ajax.js"></script>
        <script type="text/javascript" src="libs/core/namespace.js"></script>
        <script type="text/javascript" src="include/bbq.js"></script>
        <script type="text/javascript" src="include/config.js"></script>
        <script type="text/javascript" src="include/core.js"></script>        

        <script type="text/javascript">
            var RECAPTCHA_KEY = '6LckmuMSAAAAADLg6hMl0l58dc9-IWPC_uk30iqy';
            var replayObj;

            // dev stuff
            if (!window.location.origin)
                window.location.origin = window.location.protocol + "//" + window.location.host;

            if (window.location.origin.indexOf('http://localhost') == 0) {
                var scripts = include.config.concat(include.core).concat(include.bbq_deferred).concat(include.bbq);                
                loadScripts(scripts, function () {
                    //boc.constants.API_HOST = 'http://localhost:3000';
                    boc.constants.API_HOST = 'http://toptribe.cfapps.io:80';
                    boc.utils.requestApiKey();

                    boc.resources.GraphicsManager.loadFiles(['assets/graphics/pfx_smoke_small.png', 'assets/graphics/pfx_star_small.png', ]);

                    loadScripts(['assets/graphics/graphics.js'], function () {
                        var allSpinePaths = [];
                        var units = bbq.units.configuration.baseLoadout;
                        units = units.concat(bbq.units.configuration.unlockableUnits);
                        for (var u = 0; u < units.length; u++) {
                            allSpinePaths.push(bbq.units.configuration[units[u]].spinePath);
                        }

                        // gets all the spine assets
                        var teams = ['blue', 'red'];
                        boc.spine.loadSpineAssets(
                            allSpinePaths,
                            {
                                teams: teams,
                                onload: function (assets) {
                                    // put it in memory
                                    boc.spine.SkeletonManager.load(assets);

                                    // render a "default image" for each unit and put it in the cache
                                    for (var i = 0; i < units.length; i++) {
                                        for (var j = 0; j < teams.length; j++) {
                                            var team = teams[j];
                                            var img = boc.resources.GraphicsManager.getImage(units[i] + '_' + team);
                                            if (!img) {
                                                var canvas = document.createElement('canvas');
                                                canvas.width = 100;
                                                canvas.height = 100;
                                                var context = canvas.getContext('2d');
                                                var skele = boc.spine.SkeletonManager.createSkeleton(units[i].toLowerCase() + '_' + team, { x: 50, y: -50 });
                                                skele.setSkinByName('defaultSkin');
                                                skele.setSlotsToSetupPose();
                                                boc.spine.renderSkeleton(skele, context);
                                                img = document.createElement('img');
                                                img.width = 100;
                                                img.height = 100;
                                                img.src = canvas.toDataURL();
                                                boc.resources.GraphicsManager.addImage(units[i] + '_' + team, img);
                                            }
                                        } // j
                                    } // i
                                    boc.resources.GraphicsManager.load(bbq.assets.graphics, function () {
                                        new bbq.Replay('game_mark_alvin_1378319167991', { __adminKey : 'BoC1234' }, function (rObj) {
                                            replayObj = rObj;
                                        });
                                    });
                                } // onload
                            } // onLoadSpineAssets
                        );
                    });
                });                
            }

            //// production
            //else {
            //    loadScripts(['libs/bbq.compiled.js'], function () {
            //        include.bbq_deferred = null;
            //        boc.constants.API_HOST = 'http://toptribe.cfapps.io:80';
            //        boc.utils.requestApiKey();
            //        bbq.frontend.setupScenes('sceneContainer');
            //    });                
            //}

            //boc.constants.API_HOST = 'http://toptribe.mooo.com:3000';            
        </script>
    </head>
    <body>
        <div id="sceneContainer" class="sceneContainer">
            <canvas id="myReplay" width="960" height="640"></canvas>
        </div>           
    </body>
</html>
